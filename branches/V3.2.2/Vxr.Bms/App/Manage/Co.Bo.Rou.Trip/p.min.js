define({_escapeSearchString:function(n){return n.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a").replace(/Đ/g,"D").replace(/đ/g,"d").replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y").replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u").replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ.+/g,"o").replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ.+/g,"e").replace(/ì|í|ị|ỉ|ĩ/g,"i")},_reloadTrips:function(n,t){var i=this;i._reloadMainData(i.model?i.model.Id:null,null,null,n);t&&t.call(i)},getTripDate:function(n,t){var i=t.Time,r=t.Date;return vAddTime(i,r)},_checkBeforeDelete:function(n,t){var i=this,f=i.o,e=i.view,u,r,o;if(n&&t){t.call(i);return}u=f.checkDelConditions;r=vCloneObj(u._c);$.each(r,function(n,t){var e,o,u,s;t=="$base"?r[n]=i._getBaseModel().Id:t.indexOf&&t.indexOf("$")==0?(e=t.substring(1),i._applyCondition(gDx(f),e,r,n)):t.params&&t.get?(o=t.params.split(","),u={},$.each(o,function(n,t){if(t.indexOf("$")==0){var r=t.substring(1);i._applyCondition(gDx(f),r,u,r)}}),s=i[t.get].call(i,t,u),r[n]=s):r[n]=t});o={_a:u._a,_c:r,_f:u._f};vRql(o,{z:function(n,r,f){if(f){var o=u.existMsg.replace("{$x}",f);vv.showMessage({element:e.find(".alert.message"),type:"alert-danger",content:o})}else t&&t.call(i)}},i,e)},_checkInputTime:function(n){var r=this,i=r.view,u=r._getOptions("select.pickup-time option"),t;if(n.length==5&&n.indexOf(":")!=-1)if(t=n.split(":"),t[0].length==2&&t[1].length==2)if(parseInt(t[0])>=0&&parseInt(t[0])<=24&&parseInt(t[1])>=0&&parseInt(t[1])<=60){if(u.indexOf(n)<0)return!0;vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Giờ này đã tồn tại, bạn nên chọn Bus khác để tạo chuyến cùng giờ."})}else vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Thời gian không chính xác, vui lòng kiểm tra lại."});else vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Vui lòng nhập thời gian theo dạng --:--"});else vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Vui lòng nhập thời gian theo dạng --:--"});return!1},_checkHasTicket:function(n,t){var i=this,u=i.o,o=i.view,f=u.checkHasTicket,r=vCloneObj(f._c),e;$.each(r,function(n,t){var e,o,f,s;t=="$base"?r[n]=i._getBaseModel().Id:t.indexOf&&t.indexOf("$")==0?(e=t.substring(1),i._applyCondition(gDx(u),e,r,n)):t.params&&t.get?(o=t.params.split(","),f={},$.each(o,function(n,t){if(t.indexOf("$")==0){var r=t.substring(1);i._applyCondition(gDx(u),r,f,r)}}),s=i[t.get].call(i,t,f),r[n]=s):r[n]=t});e={_a:f._a,_c:r,_f:f._f};vRql(e,{z:function(r,u,f){if(f){var o=u,e=!0;$.each(o,function(t,r){var u=r[0].split("|"),f=u[1]+"|"+u[2]+"|"+u[3];if(n.indexOf(f)!=-1)return vv.showMessage({element:i.view.find(".alert.message"),type:"alert-danger",content:"Đã có vé được đặt vào vị trí ghế bị khóa, vui lòng kiểm tra lại."}),e=!1,!1});e&&t&&t.call()}else t&&t.call()}},i,o)},onItemLoaded:function(n){var t=this.o.view;t.find("total-booked-seats").val(n.TotalBookedSeats);t.find("total-paid-seats").val(n.TotalPaidSeats)},onAfterUnloadItem:function(){var n=this.o.view;n.find("total-booked-seats").val("");n.find("total-paid-seats").val("")},onBeginSelectionChange:function(n,t){var i="button.delete",r=!0;t?(n.find(i).removeAttr("disabled"),t.StatusInfo==oTrs.cancel?(n.find(i).removeClass("btn-danger").addClass("btn-success").text("Phục hồi"),r=!1):(n.find(i).removeClass("btn-success").addClass("btn-danger").text("Hủy"),r=!0)):(n.find(i).removeAttr("disabled"),n.find(i).removeClass("btn-success").addClass("btn-danger").text("Hủy"),r=this.isCancell);this.isCancell=r},getFinalExtRow:function(n){return vSort("Time",!0,n)},afterUpdate:function(){$("#bksContent").vbooking&&(FlatObj.FTripGetTrip=!1,$("#bksContent").vbooking("load"))},onBeginFirstLoad:function(){$("input[name=Date]").datepicker("setDate",new Date(moment(app.cDate).format("YYYY-MM-DD")))},afterReload:function(){vbv("clickdatve",function(n){n.preventDefault();$(".dialog-config").find("button.close").trigger("click");var t={d:moment(n.d.tripDate,"DD-MM-YYYY").format("DD.MM.YYYY"),t:parseInt(n.d.tripId),h:moment(n.d.tripTime,"HH:mm").format("HH.mm")};vdc.gD(t,function(){vbf("rlBKS",{o:{data:t}})})});var n=this;n._updateSubtitle();jQuery.isEmptyObject(app.oldData)||$("select[name=Time]").find("option:contains("+app.oldData.h.replace(".",":")+")").attr("selected","selected")},_loadPersons:function(){var n=this,t={_a:"fGetPerson",_c:{CompId:app.cid,IsPrgStatus:1,Type:"($x in (2,4,5))"},_f:"Id, Type, FullName, PhoneInfo"},i;n._listPersons=[];i=t._f.split(",");vRql(t,{a:function(){},m:function(t,r){var u={};$.each(i,function(n,t){t=t.trim();u[t]=r[n]});n._listPersons.push(u)},z:function(){n._listPersons=vSort("FullName",!1,n._listPersons);n._initOptionPerson("Driver",oPst.driver);n._initOptionPerson("Assistant",oPst.assistant)}},n)},onBeginLoadBaseData:function(){this._loadPersons()},_updateSubtitle:function(){var n=this.o.view,t=n.find("select[name=Name]").val(),i=n.find('select[name=Name] option[value="'+t+'"]').text();$(".gSubTitle").html("Tuyến: <b>"+i+"<\/b> - Ngày: <b>"+$("input[name=Date]").val()+"<\/b>")},_initOptionPerson:function(n,t){var u=this,f=u.o,o=f.view,r=vGetObj({name:n},gDx(f)),i,e;r&&(r.options=[],i=o.find("select[name="+n+"]"),i.empty(),e=vGetArr({Type:t},!1,u._listPersons),$.each(e,function(n,t){vIsEstStr(t.FullName)&&(r.options.push(t),$.vCheckAndAppendOptions(i,t.Id,t.FullName,"R"))}),i.trigger("chosen:updated"))},reloadTimeCount:0,checkAndSave:function(n){var i=this,r=i.view;if(typeof _dict._blockSeatByVehicle!="undefined"){var f=r.find('select[name="Vehicle"]').val(),u=r.find('select[name="Vehicle"] option[value="'+f+'"]').text(),t=[];typeof _dict._unblockSeatByVehicle!="undefined"&&_dict._unblockSeatByVehicle[u]?$.each(_dict._blockSeatByVehicle,function(n,i){_dict._unblockSeatByVehicle[u].indexOf(i)==-1&&t.push(i)}):t=_dict._blockSeatByVehicle;t.length>0?i._checkHasTicket(t,n):n.call()}else n.call()},onVMLoaded:function(){var t=this,n=!1;$(document).ajaxStop(function(){n||(t._selectRowFromForm(),n=!0)})},onClickAddBus:function(){var n=this,t=n.o,i=n.view,r=n._getMatchedRecords(n.mainModels,t.keyFields,!1,t.finalKeyFields,!0);r.length>=1?vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Chuyến đã tồn tại, vui lòng chọn Bus khác"}):n._updateByInsert("Thêm")},onClickAddTime:function(n,t){var r=this,u=r.view,f=u.find(t.inputRef).val(),e=r._checkInputTime(f),i;if(e){i=r._getD({Time:f,StatusInfo:oTrs.add},!0);delete i.TotalBookedSeats;delete i.TotalPaidSeats;delete i.TeamInfo;delete i.VehicleInfo;delete i.Note;var o=$('select[name="Name"]').find("option:selected").val(),s=$('input[name="Date"]').val(),h=$('input:text[name="AddTime"]').val();r._ajaxInsert("AddTime",i,"Thêm chuyến",function(){u.find("input.departure").trigger("change");r._reloadMainData("New");$("#bksContent").vbooking&&(FlatObj.FTripGetTrip=!1,$("#bksContent").vbooking("load",{t:o,d:s,h:h}))})}},onDateChange:function(n,t){var i=this;i.noLoadForm=!0;i._reloadTrips({Date:t})},onBaseIdChange:function(){this._reloadTrips()},onRunTimeChange:function(){this._selectRowFromForm()},onAliasChange:function(){var n=this,t=n.o,r=n.view,i;n._selectRowFromForm();i=n._getMatchedRecords(n.mainModels,t.keyFields,!1,t.finalKeyFields,!0);i.length<1&&(i=n._getMatchedRecords(n.baseDetailModels,t.keyFields,!1,t.finalKeyFields,!0));i.length>=1?r.find("button.addBus").prop("disabled",!0):r.find("button.addBus").prop("disabled",!1)},onClosedStatusChange:function(n,t){var i=t.val();i==1&&app.rights.indexOf($.rights.mTrip_eiad.val)==-1&&($(".form-control.Vehicle").prop("disabled",!0).trigger("chosen:updated"),$(".form-control.Driver").prop("disabled",!0).trigger("chosen:updated"),$(".form-control.Assistant").prop("disabled",!0).trigger("chosen:updated"),$(".mt5 button.multiselect.dropdown-toggle.btn.btn-default").prop("disabled",!0).trigger("chosen:updated"))},getData:function(n){var t=oTrs.cancel;return n.StatusInfo==oTrs.cancel&&(t=oTrs.reactive),{_d:{StatusInfo:t},isUndel:t!=oTrs.cancel}},onClickBtnCancel:function(){var n=this,t=n.o,u="",r,i;n.model&&(u=n.model.Id);r={};u?(i=n.getData(n.model),n._checkBeforeDelete(i.isUndel,function(){if(u.indexOf)r=n._getD({StatusInfo:oTrs.cancel}),n._ajaxInsert(t.insertAction,r,"Hủy "+t.name.toLocaleLowerCase(),function(){n._reloadMainData("New");t.afterUpdate&&t.afterUpdate.call(t)});else{var f=i.isUndel?"Phục hồi thành công.":"Hủy thành công.",e=i.isUndel?"Phục hồi thất bại, vui lòng thử lại sau.":"Hủy thất bại, vui lòng kiểm thử lại sau.";r=i._d;n._ajaxUpdate(u,r,i.isUndel,function(){t.afterUpdate&&t.afterUpdate.call(t)},f,e)}})):vv.showMessage({element:n.view.find(".alert.message"),type:"alert-danger",content:"Vui lòng chọn "+t.name})},onVehicleChange:function(){$("body").find("select.vehicle").trigger("chosen:updated")},gDisDate:function(n){return n.record.Date},gDisStpl:function(n){var r=this.cf.options,t="",u=vGtp(n.record.SeatTemplateInfo,"Id"),i=_.where(r,{Id:u});return i[0]&&(t=i[0].Name),t},gDisFare:function(n){return vGpp(n.record.FareInfo,"Price")},gDisClosedStatus:function(n){return n.record.ClosedStatus?"Đã xuất bến":"---"},gDisVehicle:function(n){return n.record.VehicleInfo?vGvp(n.record.VehicleInfo,"LicensePlate"):""},gDisTeam:function(n){var t="",i=vGtmp(n.record.TeamInfo,oPst.assistant),r=vGtmp(n.record.TeamInfo,oPst.driver),u=vGtmp(n.record.TeamInfo,oPst.guide);return r&&(t=", T: "+r),i&&(t=t+", L: "+i),u&&(t=t+", G: "+u),t.substring(1)},gDisStatusInfo:function(n){var t=n.record.StatusInfo;return vGTrds(t)},gDisAction:function(n){var t=n.record.BaseId,i=n.record.Date,r=n.record.Time;return"<button class=\"btn btn-success btn-sm\" onclick=\"event.preventDefault(); vbf('clickdatve',{tripId:'"+t+"',tripDate:'"+i+"',tripTime:'"+r+"'})\">Đặt vé<\/button>"},gDisDriver:function(n){return vGtmp(n.record.TeamInfo,oPst.driver)},gDisAid:function(n){return vGtmp(n.record.TeamInfo,oPst.assistant)},gDisGuide:function(n){return vGtmp(n.record.TeamInfo,oPst.guide)},gDisSeatStatus:function(n){var t=n.record.TotalBookedSeats,i=n.record.TotalPaidSeats,r,u;return t=vIsEstStr(t)?t:0,i=vIsEstStr(i)?i:0,r=parseInt(n.record.SeatTemplateInfo.split("|")[2])-parseInt(t)-parseInt(i),u=t+" -- "+i+" -- "+r,u},gDisTripStatus:function(n){var t=n.record;if(t.ClosedStatus==1)return"Xuất bến";if(t.ClosedStatus==2)return"Chốt phơi";switch(t.StatusInfo){case 2:return"Tăng cường";case 3:return"Hủy";default:return"--"}},svcTime:function(n,t){var i=t.split("-");return i&&i[0]?i[0].trim():""},svcStpl:function(n,t){return t+"~"+vFindById(t,n.options).Info},svcDi:function(n,t){return t+"~"+vFindById(t,n.options).Info},svcFI:function(n,t){var i=this.view,r=i.find("input.from-area").val(),u=i.find("input.to-area").val();return"1~"+vGai(r)+"|"+vGai(u)+"|"+parseInt(t.replace(/\./g,"")+"|đ||")},svcXB:function(n,t){return typeof t!="undefined"&&t?1:0},svcVhc:function(n,t){var i=vFindById(t,n.options);return i?vGvs(i.Id,i.Type,i.LicensePlate,i.VehicleTypeName):""},svcVhcI:function(n,t,i){return i.Vehicle},svcTI:function(n,t,i){var r=app.mvs,u=r;return($.each(i,function(n,t){t&&(r=r+"~"+t)}),u!=r)?r:""},svcSI:function(n,t,i){if(t==oTrs.cancel)return t;if(i){var r=i.Base,u=i.Time;if(r&&r.Info.indexOf(u)>=0)return oTrs.normal}return oTrs.add},svcMem:function(n,t,i){if(!i||jQuery.isEmptyObject(i))return"";var r="";return $.each(i,function(t,i){i&&(r+="~"+vGpi(n.mType,t,i.FullName,i.PhoneInfo))}),r.substring(1)},rvcDriver:function(n,t){var e=this.view,u="",o=e.find("select.pickup-time option:selected").text().split("-"),i,r,f;if(t!=null)if(i=t.split("~"),i.length>1)for(r=0;r<i.length;r++)f=i[r].split("|"),o==f[0]&&(u=f[1]);else u=t;return u},rvcStpl:function(n,t){return vGtp(t,"Id")},rvcVhc:function(n,t){return vGvp(t,"Id")},rvcMem:function(n,t){return vGtmp(t,n.mType,!0)},rvcFI:function(n,t){return vGfa(t)},cpcDate:function(n,t,i){return i},cpcAlias:function(){return 0},cpcSI:function(){return oTrs.waiting},svbMem:function(n,t){return vGetSearchCondt(t)},svbTime:function(n,t){var i=t.split("-");return i&&i[0]?i[0].trim():""},svbStpl:function(n,t){return"$x like '"+t+"~%'"},svbFare:function(n,t){return"1|"+parseInt(t.replace(/\./g,""))+""},svbVhc:function(n,t){return"$x like '"+app.mvs+"~"+t+"|%'"},svbNote:function(n,t){return"$x like '%"+t+"%'"},xchrTime:function(n,t){return t.split("~")},xchvTime:function(n,t){var i=[],r={},u={};return n&&n.Info&&$.each(n.Info.split("~"),function(n,t){t.indexOf(":")>0&&(r[t]=!0,i.push(t))}),$.each(t,function(n,t){var f=t.Time,e,o,s;r[f]?(e="",o=t.StatusInfo,o==oTrs.cancel&&(e=" - Hủy"),s=i.indexOf(f),i[s]=f+e):u[f]||(u[f]=!0,f=f+" - Tăng cường",i.push(f))}),vSort(null,!0,i)},gDisDrivertip:function(n){var r=n.record.Description,f=n.record.Time,t,i,u;if(r!=null){if(t=r.split("~"),t.length>1)for(i=0;i<t.length;i++)u=t[i].split("|"),f==u[0]&&(text=u[1]);else text=r;return text}return""}});
//# sourceMappingURL=p.min.js.map
