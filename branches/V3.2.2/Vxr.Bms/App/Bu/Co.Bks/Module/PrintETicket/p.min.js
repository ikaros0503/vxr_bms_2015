define({start:function(){try{var n=this;vbv("collectDataForPrintETicket",function(n){n.d&&vbf("onGetCurrentTripInfo")});vbv("doPrintETicket",function(t){t.d&&(n._creatPrintETicketContainer(),n._creatPrintETicketBody(),n._printETicket(t.d.tInfo,t.d.cTrip,t.d.tId,t.d.tName,t.d.tDate))})}catch(t){console.error(t)}},_creatPrintETicketContainer:function(){this._$printETicketContainer=$("<div />").addClass("print-container")},_creatPrintETicketBody:function(){this._$printETicketBody=$("<div />").addClass("row").appendTo(this._$printETicketContainer)},_resetETicket:function(){this._$printETicketBody.empty()},_printETicket:function(n,t,i,r,u){var e=this;e._resetETicket();e._renderETicket(n,t,i,r,u);var s=$("<div />").append(e._$printETicketContainer),h=new Date,o="ETicket"+h.getTime(),f=window.open("about:blank",o,"width="+screen.width+", height="+screen.height+", scrollbars=1");f.document.write("<html><head><title>"+o+'<\/title><link rel="stylesheet" href="'+_dict._eStyleUrl+'" type="text/css" /><\/head><body>'+s.html()+"<\/body><\/html>");f.focus();setTimeout(function(){f.print()},2500);typeof _dict._hasQuickPrint!="undefined"&&_dict._hasQuickPrint&&setTimeout(function(){f.close()},1e3)},_renderETicket:function(n,t,i,r,u){var h=this,f=[],c=t.Name.split("-"),l="",a="",o="",s="",p=t.FromArea.split("~"),v,e,y;p.length>1&&(l=p[1].split("|")[3]);v=t.ToArea.split("~");v.length>1&&(a=v[1].split("|")[3]);e={};$.each(app.branchInfo,function(n,t){$.isEmptyObject(e)&&t[0]==app.aid&&(e=t)});_dict._multiSeatOnTicket?(y=[],$.each(app.seatStack,function(t,i){var r=i._getCurrentTicket(),v,h,p,u;r.fromArea&&(o=r.fromArea.split("|")[3]);r.toArea&&(s=r.toArea.split("|")[3]);$.isEmptyObject(r)||(v=r._getPickupInfo(),h="",$.isEmptyObject(v)||(h=v.text),p=(r._cname+r._cphone+h).hashCode(),u=y.indexOf(p),u==-1&&(u=y.push(p)-1),typeof f[u]=="undefined"&&(f[u]={ticket:{_phone:$.trim(e[5]),_address:$.trim(e[4]),_from:$.trim(c[0]),_to:$.trim(c[1]),_fromArea:o!=""?o:l,_toArea:s!=""?s:a,_tripDate:r._pdate.toFormatString("dd/mm/yyyy"),_tripHour:r._pdate.toFormatString("hh:mm"),_numSeat:0,_seatCodes:[],_fare:r._fare,_total:0,_cname:r._cname,_cphone:r._getDefaultPhoneNumber(),_pick:h,_user:app.un,_note:r._note,_deposit:r._deposit.toMn()+" đ",_vehicleNumber:n._vehicleNumber}}),f[u].ticket._seatCodes.push(i._label),f[u].ticket._total+=r._fare,f[u].ticket._numSeat++,typeof f[u].ticket._deposit!="undefined"&&typeof r._deposit!="undefined"&&r._deposit!=0&&(f[u].ticket._fare=0,f[u].ticket._total=0))})):$.each(app.seatStack,function(t,i){var r=i._getCurrentTicket(),u,h,v,y;r.fromArea&&(o=r.fromArea.split("|")[3]);r.toArea&&(s=r.toArea.split("|")[3]);$.isEmptyObject(r)||(u=r._getPickupInfo(),h="",$.isEmptyObject(u)||(h=u.text),v=$.trim(c[0]),y=$.trim(c[1]),r.stage_point1!=null&&(v=r.stage_point1.Name,y=r.stage_point2.Name),f.push({ticket:{_phone:$.trim(e[5]),_address:$.trim(e[4]),_from:v,_to:y,_fromArea:o!=""?o:l,_toArea:s!=""?s:a,_tripDate:r._pdate.toFormatString("dd/mm/yyyy"),_tripHour:r._pdate.toFormatString("hh:mm"),_numSeat:1,_seatCodes:[i._label],_fare:r._fare,_total:r._fare,_cname:r._cname,_cphone:r._getDefaultPhoneNumber(),_pick:h,_user:app.un,_note:r._note,_deposit:r._deposit.toMn()+" đ",_vehicleNumber:n._vehicleNumber?n._vehicleNumber:""}}))});$.each(f,function(n,f){vbf("onStoreHistory",{un:app.un,key:"print-ticket",his:{_tid:i,_tname:r,_tdate:u,_s:f.ticket._seatCodes}});f.ticket._seatCodes=f.ticket._seatCodes.join(", ");f.ticket._fare=f.ticket._fare.toMn();f.ticket._total=f.ticket._total.toMn();f.ticket._numSeat>4?typeof _dict._eTicket.custom!="undefined"?h._$printETicketBody.append(vtpl(_dict._eTicket.custom[t.Id].lg,f)):h._$printETicketBody.append(vtpl(_dict._eTicket.lg,f)):typeof _dict._eTicket.custom!="undefined"?h._$printETicketBody.append(vtpl(_dict._eTicket.custom[t.Id].sm,f)):h._$printETicketBody.append(vtpl(_dict._eTicket.sm,f))})}});$(document).ready(function(){});
//# sourceMappingURL=p.min.js.map
