define({x:null,_$filterSearchResult:null,currentText:"",start:function(n){try{this.o=n;this.x=$(n.x);$(".HomeTopSearch").html($("#HomeTopSearch").html());this._bindFilterEvents(n);this._bindBodyEvents(n)}catch(t){console.error(t)}},_bindBodyEvents:function(){var n=this;vbv("doSetSearchBox",function(t){n.x.val(t.d.value)})},_bindFilterEvents:function(n){var i=this.x,t=this;if(i){$("form.BSFilterForm").on("submit",function(n){n.preventDefault()});vev(n.x,"keyup",function(i){if((i.keyCode!=86||!i.ctrlKey)&&i.keyCode!=17){var r=0,u=$(n.x).val();u!=t.currentText&&(t.currentText=u,r=u.length,r<3?(i.preventDefault(),i.stopPropagation(),t._clearSearchResult()):r==6?(i.preventDefault(),i.stopPropagation(),isNaN(u)?t._searchTicket(this.value,!0):t._searchTicket(this.value)):vIsNumKey(i)?r==3||r>=6?(i.preventDefault(),i.stopPropagation(),t._searchTicket(this.value)):(i.preventDefault(),i.stopPropagation(),t._clearSearchResult()):_dict._arrows.indexOf(i.keyCode)==-1)}});vev(n.x,"paste",function(n){n.preventDefault();n.stopPropagation();var i=$.trim(n.originalEvent.clipboardData.getData("Text"));if($(".searchInput").val(i),t.x.blur(),i.length==6||i.length==10||i.length==11){if(i.length==6){t._searchTicket(i,!0);return}if(!isNaN(this.value)){t._searchTicket(i);return}}else t._clearSearchResult()});vev(n.x,"focus",function(){vbf("onSearchBoxFocused")})}else setTimeout(t._bindFilterEvents,50)},_searchTicket:function(n,t){var i=this,e,o,s,h,f;if(app.module.toLowerCase()=="bks")i._clearSearchResult(),i._renderSearchResult(null,"start"),e=i._createSearchTicketObj(n,t),o=function(n,r){n==1&&(i._clearSearchResult(),r&&r.length>0&&(i._searchResult=r,i._totalSearchResult=r.length),i._renderSearchResult(t),FlatObj.HScrolled=!1,FlatObj.STBPhone=!0)},vRqs(e,o);else{var r={},u=[],c=i._crProOrderObj(n);i._clearSearchResult();i._renderSearchResult(null,"start");s=function(t,f,e){e>0&&$.each(f,function(t,r){var f=i._convertDbIntoSearchPhone(r,n);u.push(f)});r.listResult=u;r.totalItems=u.length};vRqs(c,s);h=$.getHtml("search-phone",r);i._clearSearchResult();i._$searchTicketFilter.parent().append(h);f=i._$searchTicketFilter.parent().find("li");f.on("click",function(n){n.preventDefault();n.stopPropagation();var t=$(this).attr("data-proid"),r=$(this).attr("data-tripid"),u=$(this).attr("data-triptime"),f=$(this).attr("data-tripdate"),e=$(this).attr("data-typeofview");$("#product-content").product("load",{proId:t,pIndex:1,pSize:10,tId:r,tTime:u,tDate:f,tOView:e});i._clearSearchResult();i._$searchTicketFilter.val("")}).hover(function(){f.removeClass("selected");$(this).addClass("selected")})}},_createSearchTicketObj:function(n,t){var s=this,h=$("input[name=type_filterdate]").val(),f=s._getLimitedSDate(),c=$(".BSFilterForm"),i={},r,u,o;if(typeof t!="undefined"&&t)i._a="fGetCustomerTripTicket1",i._c={Code:$.trim(n).toUpperCase()},i._f="Id, TripId, AgentId, SeatCode, PickupDate, CustomerInfo, Status, Fare, Note, PickupInfo, Code, TripDate, CustomerNote",i._f="Code, SeatCode, TripDate, TripId, Name, TripName, Phone, Note, Status, Fare, CustomerId";else{i._a="fGetCustomerTrip1";r="($x like N'%"+n+"%')";switch(n.length){case 3:r="($x like '%"+n+"')";break;case 4:case 5:r="($x like '%"+n+"%')";break;case 6:r="($x like '%"+n+"%')"}u="$x >= '"+f.toFormatString("iso")+"'";switch(parseInt(h)){case 1:u=_dict._allowSearchBefore!=undefined?"$x >= '"+f.addMinutes(_dict._allowSearchBefore).toFormatString("iso")+"'":"$x >= '"+f.toFormatString("iso")+"'";break;case 2:u="$x is not null";break;case 3:var l=c.find("button").html(),a=new Date(vPrsDt(l).getTime()),e=new Date;e.setDate(a.getDate()-1);o=new Date;o.setDate(e.getDate()+2);u="$x > '"+e.toFormatString("iso")+"' and $x < '"+o.toFormatString("iso")+"'"}i._c={CompId:parseInt(app.cid),Phone:r,TripDate:u};i._f="Name, TripName, Note, Phone, BookingTicket, TotalBooking, ListSeatBooking, PaidTicket,ListSeatPaid, CancelTicket, TotalCancel, ListSeatCancel, NotComeTicket, TotalNotCome, ListSeatNotCome,PassTicket, TotalPass, ListSeatPass, KeepOnTimeTicket, TotalKeepOnTime, ListSeatKeepOnTime, CustomerNote, CompId, TripDate, TripId, TotalPaid "}return i},_crProOrderObj:function(n){var t={};return t._a="fGetProductOrder",t._c={PickupInfo:"($x like N'%"+n+"%' or DropOffInfo like N'%"+n+"%') order by IsPrgCreatedDate desc"},t._f="Id,TripTime,TripDate,PickupInfo,DropOffInfo,Fare,Status,TripId,AgentInfo,ReceivedAgentInfo",t},_convertDbIntoSearchPhone:function(n,t){var i={},u=n[3].split("|"),r,f,e;i.senderName=u[3].length>10?vGln(u[3]):u[3];i.senderPhone=u[4];i.keySender=u[4].indexOf(t)==0?"vred":"";r=n[4].split("|");i.receiverName=r[3].length>10?vGln(r[3]):r[3];i.receiverPhone=r[4];i.keyReceiver=r[4].indexOf(t)==0?"vred":"";f=n[8].split("|");i.fromName=f[2];e=n[9].split("|");i.toName=e[2];i.fare=vToMn(n[5]);i.proId=n[0];i.tripId=n[7];i.tripTime=n[1];i.tripDate=vPrsDt(n[2]).toFormatString("dd-mm-yyyy");vIsEstStr(i.tripTime)&&vIsEstStr(i.tripDate)&&(i.tripDepartureDate="/ "+i.tripTime+" ngày "+i.tripDate);switch(parseInt(n[6])){case 1:i.status="Chưa nhận";i.typeOfView="kho-hang-di";break;case 2:i.status="Chưa nhận";i.typeOfView="kho-hang-di";break;case 3:i.status="Chưa nhận";i.typeOfView="xem-chuyen";break;case 4:i.status="Đã nhận";i.typeOfView="xem-chuyen";break;case 5:i.status="Chưa nhận";i.typeOfView="xem-chuyen";break;case 6:i.status="Đã nhận";i.typeOfView="xem-chuyen";break;case 7:i.status="Chưa giao";i.typeOfView="kho-hang-ve";break;case 8:i.status="Chưa giao";i.typeOfView="kho-hang-ve";break;case 9:i.status="Đã giao";i.typeOfView="kho-hang-ve";break;default:i.status="";i.typeOfView=""}return i},_getLimitedSDate:function(){var n=new Date;return typeof _dict._limitedMinuteBefore!="undefined"?new Date(n.getTime()).addMinutes(app.sOffsetMinute):new Date(n.getTime()).addMinutes(app.sOffsetMinute)},_clearSearchResult:function(){var n=this;n._searchResult=[];n._totalSearchResult=0;n._hasSearchPhone=!1;$("div.searchContainer div.search-result").remove()},_renderSearchResult:function(n,t){var i=this,o,r=$("<tbody><\/tbody>"),u,f,e,s;if(o=$("<table><\/table>").addClass("search-items"),u=0,t=="start")r.html($("#startSearchTemplate").html());else if(i._totalSearchResult>0)if(typeof n!="undefined"&&n)if(f={},i._searchResult.length>0){if(f={code:i._searchResult[0][0],tripDate:moment(i._searchResult[0][2]).format("DD-MM-YYYY"),tripTime:moment(i._searchResult[0][2]).format("HH:mm"),tripId:i._searchResult[0][3],seatCodes:getSubItem(i._searchResult[0][1],"|",0),name:i._searchResult[0][4],tripName:i._searchResult[0][5],phone:i._searchResult[0][6],note:i._searchResult[0][7],status:i._searchResult[0][8],fare:i._searchResult[0][9],customerId:i._searchResult[0][10],totalSeats:i._searchResult.length,type:parseInt(i._searchResult[0][8])==3?"isCancelled":""},i._searchResult.length>1)for(e=1;e<i._searchResult.length;e++)f.seatCodes=f.seatCodes+", "+getSubItem(i._searchResult[e][1],"|",0);r.append(vtpl($("#searchTicketResultItemTemplate").html(),f))}else r.append($(vtpl($("#noResultItemTemplate").html())));else $.each(i._searchResult,function(n,t){if(typeof t!="undefined"&&t!=null){var i={name:t[0],tripName:t[1],note:t[2],phone:t[3],customerNote:t[21],tripDate:moment(t[23]).format("DD-MM-YYYY"),tripTime:moment(t[23]).format("HH:mm"),tripId:t[24],bookedStr:"",paidStr:"",cancelStr:""},f=parseInt(t[4])+parseInt(t[7]),e=parseInt(t[9]);f>0&&(i.status="Đã đặt",i.totalTickets=f,i.tickets=vIsEstStr(t[6])?vIsEstStr(t[8])?t[6]+", "+t[8]:t[6]:vIsEstStr(t[8])?t[8]:"",i.money=(parseInt(t[5])+parseInt(t[25])).toMn()+"đ",r.append($(vtpl($("#searchResultItemTemplate").html(),i))),u++);e>0&&(i.status="Đã hủy",i.type="isCancelled",i.totalTickets=e,i.tickets=t[11],i.money=t[10]!=null?t[10].toMn()+"đ":"",r.append($(vtpl($("#searchResultItemTemplate").html(),i))),u++)}}),u==0&&r.append($(vtpl($("#noResultItemTemplate").html())));else r.append($(vtpl($("#noResultItemTemplate").html())));o.append(r);i._$filterSearchResult=$("<div />").addClass("dropdown-menu search-result").append($("<div />").addClass("search-title").append(t=="start"?"Đang tìm":u>0?"Tìm được "+u+" kết quả":"Kết quả")).append(o);s=$(".searchContainer").find("div.dropdown-menu.search-result");s.length>0&&s.remove();$(".searchContainer").append(i._$filterSearchResult);$("button.customer-profile-item").unbind().click(function(n){n.stopPropagation();n.preventDefault();app.cusphone=$(this).attr("data-phone");$(this).attr("data-customerId")!=null&&$(this).attr("data-customerId")!=""&&(app.cusId=$(this).attr("data-customerId"));$("#showCustomerProfile").trigger("click")});u>0&&i._bindEventOnSearchResult()},_bindEventOnSearchResult:function(){var t=this,n;t._totalSearchResult>0&&(n=$("div.searchContainer table.search-items tr"),n.length>0&&(n.unbind("click").on("click",function(n){n.preventDefault();n.stopPropagation();var i=parseInt($(this).attr("data-tripId")),r=$(this).attr("data-tripDate"),u=$(this).attr("data-tripTime"),f=$(this).attr("data-phone"),e=$(this).attr("data-code"),o=$(this).attr("data-type");t._clearSearchResult();$(".searchInput").val("");$("div.searchContainer div.search-result").remove();vbf("onSearchResultSelected",{tId:i,tDate:r,tTime:u,phone:f,code:e,isCanceled:o})}).hover(function(){n.removeClass("selected");$(this).addClass("selected")}),t._bindArrowEventList(n)))},_bindArrowEventList:function(n){var t,i=n.parent(),r=i.height(),u=i.prop("scrollHeight"),f=1,e=Math.round(u/r)-1;$(window).keydown(function(o){var s,c,h,l;o.which===40?(t?(n.removeClass("selected"),s=t.next(),t=s.length>0?s.addClass("selected"):n.eq(0).addClass("selected")):t=n.eq(0).addClass("selected"),t.position().top<0?(i.animate({scrollTop:0},500),f=1):t.position().top>r&&(c=Math.floor(r*f)-35,i.animate({scrollTop:c},500),f++)):o.which===38&&(t?(n.removeClass("selected"),h=t.prev(),t=h.length>0?h.addClass("selected"):n.last().addClass("selected")):t=n.last().addClass("selected"),t.position().top<=0?(l=Math.floor(u-r*e)+35,i.animate({scrollTop:l},500),e++):t.position().top>r&&(i.animate({scrollTop:u},500),e=Math.round(u/r)-1))})}});
//# sourceMappingURL=p.min.js.map
