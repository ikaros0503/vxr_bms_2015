function isAgentAvailable(n){try{if(accInfo.role==role.officeManager||accInfo.role==role.seller)return n==accInfo.agentId;if(accInfo.role==role.reporter||accInfo.role==role.admin||accInfo.role==role.office)return!0;if(accInfo.role<0)return n==accInfo.agentId}catch(t){}return!1}function isUserAvailable(n){try{if(n.username==accInfo.username)return!0;if(accInfo.role.indexOf(role.officeManager)>=0)return n.agentId==accInfo.agentId;if(accInfo.role.indexOf(role.seller)>=0)return n.username==accInfo.username;if(accInfo.role.indexOf(role.reporter)>=0)return n.username.indexOf("admin")<0;if(accInfo.role.indexOf(role.admin)>=0)return!0;if(accInfo.role.indexOf(role.office)>=0)return n.username.indexOf("admin")<0}catch(t){}return!1}function getRoute(n){var t=$("#"+n[0]);vRqs({_a:"fGetTrip",_c:{Type:1,CompId:app.cid,IsPrgStatus:1},_f:"Id, Name"},function(n,i,r){t.append(jHtml.filterDefaultRouteOption);for(var u=0;u<r;u++)t.append('<option value="'+i[u][0]+'">'+i[u][1]+"<\/option>");t.val(t.find("option:first").val());t.chosen({width:"100%",search_contains:!0})})}function getStatus(n){var t=$("#"+n[0]);t.append('<option value="" selected="selected">----Chọn trạng thái----<\/option>');t.append('<option value="1">Đã đặt<\/option>');t.append('<option value="3">Đã hủy<\/option>')}function getComp(n){var i=$("#"+n[0]),t=$("#"+n[1]);vRqs({_a:"fGetCompany",_c:{IsPrgStatus:1,HasOnlineContract:"($x=1 or HasOfflineContract=1)",Type:"($x=1)"},_f:"Id, Name"},function(n,r,u){i.append(jHtml.filterDefaultCompanyOption);for(var f=0;f<u;f++)i.append('<option value="'+r[f][0]+'">'+r[f][1]+"<\/option>");i.val(i.find("option:first").val());i.chosen({width:"100%",search_contains:!0});t.append(jHtml.filterDefaultRouteOption);t.chosen({width:"100%",search_contains:!0});i.change(function(){if(!($(this).val()!=null&&$(this).val()!="")){t.html("");t.append(jHtml.filterDefaultRouteOption);t.val(t.find("option:first").val());t.data("chosen").destroy().chosen();t.chosen({width:"100%",search_contains:!0});return}vRqs({_a:"fGetTrip",_c:{Type:1,CompId:$(this).val(),IsPrgStatus:1},_f:"Id, Name"},function(n,i){t.html("");t.append(jHtml.filterDefaultRouteOption);for(var r=0;r<i.length;r++)t.append('<option value="'+i[r][0]+'">'+i[r][1]+"<\/option>");t.val(t.find("option:first").val());t.data("chosen").destroy().chosen();t.chosen({width:"100%",search_contains:!0})})})})}function getBranchAndAgents(n){var t=$("#"+n[0]);vRqs({_a:"fGetCompany",_c:{BaseId:app.cid,Type:"($x=2 or $x=3)",IsPrgStatus:1},_f:"Id, Name"},function(n,i,r){accInfo.role!=role.officeManager&&accInfo.role!=role.seller&&accInfo.role>0&&t.append(jHtml.filterDefaultBranhAndAgentOption);for(var u=0;u<r;u++)isAgentAvailable(i[u][0])&&t.append('<option value="'+i[u][0]+'">'+i[u][1]+"<\/option>");t.val(t.find("option:first").val());t.chosen({width:"100%",search_contains:!0})})}function getUser(n){var t=$("#"+n[0]),i={CompId:app.cid,Type:1,IsPrgStatus:1};$("#"+n[1]).val()!=""&&$("#"+n[1]).val()!=null&&(i.AgentId=$("#"+n[1]).val());vRqs({_a:"fGetAccount",_c:i,_f:"Id, Username, AgentId"},function(n,i,r){var u,f;for(accInfo.role!=role.seller&&accInfo.role>0&&t.append(jHtml.filterDefaultUserOption),u=0;u<r;u++)f={id:i[u][0],username:i[u][1],agentId:i[u][2]},isUserAvailable(f)&&t.append('<option data-agentId="'+i[u][2]+'" value="'+i[u][0]+'">'+i[u][1]+"<\/option>");t.val(t.find("option:first").val());t.chosen({width:"100%",search_contains:!0})})}function getRouteTime(n){var t=$("#"+n[0]),i=$("#"+n[1]),r=vDtToStr("iso",vGtDptTm($("#fromdate").val(),"00:00"));vRqs({_a:"fGetTrip",_c:{CompId:"$x = "+app.cid+" and (Type = 1 or (Type = 2 and Time is not null and Date = '"+r+"'))",IsPrgStatus:1},_f:"Id, BaseId, Name, StatusInfo, Info, Time"},function(n,r,u,f){var s,o,f,c,e,h;for(t.empty(),s=[],o=0;o<u;o++)if(r[o][1]==null){for(f={Base:r[o],a:[]},c=r[o][4].split("~"),e=0;e<c.length;e++)f.a.push({Time:c[e],Status:r[o][3]});for(e=0;e<u;e++)if(r[e][1]==r[o][0])if(r[o][4].indexOf(r[e][5])>=0){for(h=0;h<f.a.length;h++)if(f.a[h].Time==r[e][5]){f.a[h].Status=r[e][3];break}}else f.a.push({Time:r[e][5],Status:r[e][3]});s.push(f);t.append('<option value="'+r[o][0]+'">'+r[o][2]+"<\/option>")}t.val(t.find("option:first").val());t.change(function(){var n,r;for(i.empty(),n=0;n<s.length;n++)if(s[n].Base[0]==t.val())for(r=0;r<s[n].a.length;r++)i.append('<option value="'+s[n].a[r].Time+'">'+s[n].a[r].Time+(s[n].a[r].Status==3?" - Hủy":s[n].a[r].Status==2?" - Thêm ":"")+"<\/option>")});t.trigger("change")})}function getRouteTimeNo(n){var t=$("#"+n[0]),i=$("#"+n[1]),r=$("#"+n[2]),u;r.val()!=""?(u=vDtToStr("iso",vGtDptTm(r.val(),"00:00")),vRqs({_a:"fGetTrip",_c:{CompId:"$x = "+app.cid+" and (Type = 1 or (Type = 2 and Time is not null and Date = '"+u+"'))",IsPrgStatus:1},_f:"Id, BaseId, Name, StatusInfo, Info, Time"},function(n,r,u,f){var s,o,f,c,e,h;for(t.empty(),t.append(jHtml.filterDefaultRouteOption),s=[],o=0;o<u;o++)if(r[o][1]==null){for(f={Base:r[o],a:[]},c=r[o][4].split("~"),e=0;e<c.length;e++)f.a.push({Time:c[e],Status:r[o][3]});for(e=0;e<u;e++)if(r[e][1]==r[o][0])if(r[o][4].indexOf(r[e][5])>=0){for(h=0;h<f.a.length;h++)if(f.a[h].Time==r[e][5]){f.a[h].Status=r[e][3];break}}else f.a.push({Time:r[e][5],Status:r[e][3]});s.push(f);t.append('<option value="'+r[o][0]+'">'+r[o][2]+"<\/option>")}t.val(t.find("option:first").val());t.change(function(){var n,r;if(i.empty(),i.append(jHtml.filterDefaultTripTimeOption),t.val()!="")for(n=0;n<s.length;n++)if(s[n].Base[0]==t.val())for(r=0;r<s[n].a.length;r++)i.append('<option value="'+s[n].a[r].Time+'">'+s[n].a[r].Time+(s[n].a[r].Status==3?" - Hủy":s[n].a[r].Status==2?" - Thêm ":"")+"<\/option>")});t.trigger("change")})):(t.empty(),t.append(jHtml.filterDefaultRouteOption),i.empty(),i.append(jHtml.filterDefaultTripTimeOption))}function getBranchEmployer(n){var t=$("#"+n[0]),i=$("#"+n[1]);vRqs({_a:"fGetCompany",_c:{BaseId:app.cid,IsPrgStatus:1,Type:2},_f:"Id, Name"},function(n,r,u){if(t.empty(),accInfo.role!=role.officeManager&&accInfo.role!=role.seller&&accInfo.role>0&&t.append(jHtml.filterDefaultBranhOption),n&&u>0){for(var f=0;f<u;f++)isAgentAvailable(r[f][0])&&t.append('<option value="'+r[f][0]+'">'+r[f][1]+"<\/option>");t.chosen({width:"100%",search_contains:!0})}t.val(t.find("option:first").val());t.trigger("change");t.change(function(){var n={CompId:app.cid,Type:1,IsPrgStatus:1,Username:"$x not like N'admin.%'"};$(this).val()!=""&&$(this).val()!=null&&(n.AgentId=$(this).val());vRqs({_a:"fGetAccount",_c:n,_f:"Id, Username, AgentId"},function(n,t,r){i.html("");i.append(jHtml.filterDefaultUserOption);for(var u=0;u<r;u++)i.append('<option data-agentId="'+t[u][2]+'" value="'+t[u][0]+'">'+t[u][1]+"<\/option>");i.val(i.find("option:first").val());i.data("chosen").destroy().chosen();i.chosen({width:"100%",search_contains:!0})})})})}function reloadPickupDate(n){var t=$("#"+n[0]),i=$("#"+n[1]),r=$("#"+n[2]);t.change(function(){i.unbind("change");$.getRouteTime(i,r,vDtToStr("iso",vGtDptTm(t.val(),"00:00")))})}function rpCustomerByTrip(n,t){var i=$("#"+t[0]).val(),u=$("#"+t[1]).val(),f=$("#"+t[1]).find("option:selected").text(),r=$("#"+t[2]).val(),e=" '"+vDtToStr("iso",vGtDptTm(i.replace(/\//gi,"-"),r))+"'=TripDate  and CompId = "+app.cid+" and TripId = "+u+" and TripAlias = 0 and Type != 2 and Type != 3";n._a="rpCustomerByTrip";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:8,mArrArgSumary:[8,9,10],reportId:102,compId:app.cid,strOrderBy:" order by SeatCode ",hdValue:"Tuyến "+f+"<br />Khởi hành lúc "+r+" ngày "+i,classRowSumGobal:"danger-total text-right",classCol:[[0,"text-center"],[1,"text-center"],[2,"text-center"],[3,"text-center"],[6,"text-center"],[7,"text-center"],[8,"text-right"],[9,"text-right"],[10,"text-right"]],where:e}}function rpCustomerByTripForSapa(n,t){var i=$("#"+t[0]).val(),u=$("#"+t[1]).val(),f=$("#"+t[1]).find("option:selected").text(),r=$("#"+t[2]).val(),e=" '"+vDtToStr("iso",vGtDptTm(i.replace(/\//gi,"-"),r))+"'=TripDate  and CompId = "+app.cid+" and TripId = "+u+" and TripAlias = 0 and Status != 3";n._a="rpCustomerByTrip";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:8,mArrArgSumary:[8,9,10],reportId:109,compId:app.cid,strOrderBy:" order by SeatCode ",hdValue:"Tuyến "+f+"<br />Khởi hành lúc "+r+" ngày "+i,classRowSumGobal:"danger-total text-right",classCol:[[0,"text-center"],[1,"text-center"],[2,"text-center"],[3,"text-center"],[6,"text-center"],[7,"text-center"],[8,"text-right"],[9,"text-right"],[10,"text-right"]],where:e}}function rpStaffByPickupDate(n,t){var r=$("#"+t[2]).val(),c=$("#"+t[2]).find('option[value="'+r+'"]').text(),f=$("#"+t[0]).val(),e=$("#"+t[1]).val(),u=$("#"+t[3]).val(),l=$("#"+t[3]).find("option:selected").text(),o=$("#"+t[4]).val(),s=$("#"+t[4]).find("option:selected").text(),i="Từ ngày: "+f+" - 00:00  &#x2192;  "+e+" - 23:59",h;r!=""&&(i="Tuyến: "+c+"<br />"+i);u!=""&&(i+="<br /> Chi nhánh: "+l);o!=""&&(i+="<br /> Nhân viên: "+s);h="('"+toFromDateDb(f)+"'<=PickupDate and PickupDate<='"+toToDateDb(e)+"')  and t.CompId = "+app.cid+(o!=""?" and (UserCharge = N'"+s+"') ":" and (UserCharge is not null)")+(r!=""?" and TripId = "+r:" ")+(u!=""?" and a.AgentId=N'"+u+"'":"")+" and ((Status = 2 and (SUBSTRING(PaymentInfo, 0, CHARINDEX(':', PaymentInfo)) = '1' or SUBSTRING(PaymentInfo, 0, CHARINDEX(':', PaymentInfo)) = '9')) or Status = 5 or (Status = 1 and Deposit is not null and Deposit != 0) or (Status = 3 and CancelFee is not null and CancelFee != 0))";n._a="rpStaffByPickupDate";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:4,mColMergForSubSubSumRow:4,mArrArgSumary:[4,6,7,8,9,10],reportId:103,strOrderBy:" order by UserCharge,TripIdName, PickupDate ",hdValue:i,bShowSubSumary:1,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-right"],[7,"text-right"],[8,"text-right"],[9,"text-right"],[10,"text-right"],],where:h,mMaxLevel:3}}function rpStaffBySoldDate(n,t){var r=$("#"+t[2]).val(),c=$("#"+t[2]).find('option[value="'+r+'"]').text(),u=$("#"+t[0]).val(),f=$("#"+t[1]).val(),e=$("#"+t[3]).val(),l=$("#"+t[3]).find("option:selected").text(),o=$("#"+t[4]).val(),s=$("#"+t[4]).find("option:selected").text(),i="Từ ngày: "+u+" - 00:00  &#x2192;  "+f+" - 23:59",h;r!=""&&(i="Tuyến: "+c+"<br />"+i);e!=""&&(i+="<br /> Chi nhánh: "+l);o!=""&&(i+="<br /> Nhân viên: "+s);h=" ((ChargeDate is null and '"+toFromDateDb(u)+"'<=IsPrgCreatedDate and IsPrgCreatedDate<='"+toToDateDb(f)+"') or ('"+toFromDateDb(u)+"'<=ChargeDate and ChargeDate<='"+toToDateDb(f)+"'))  and CompId = "+app.cid+(o!=""?" and (UserCharge = N'"+s+"') ":" and (UserCharge is not null)")+(r!=""?" and TripId = "+r:" ")+(e!=""?" and AgentIdCharge="+e+"":"")+" and ((Status = 2 and (SUBSTRING(PaymentInfo, 0, CHARINDEX(':', PaymentInfo)) = '1' or SUBSTRING(PaymentInfo, 0, CHARINDEX(':', PaymentInfo)) = '9')) or Status = 5 or (Status = 1 and Deposit is not null and Deposit != 0) or (Status = 3 and CancelFee is not null and CancelFee != 0))";n._a="rpStaffBySoldDate";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:5,mArrArgSumary:[5,7,8,9,10,11],reportId:104,strOrderBy:" order by UserCharge,TripIdName, PickupDate ",hdValue:i,bShowSubSumary:1,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-right"],[7,"text-right"],[8,"text-right"],[9,"text-right"],[10,"text-right"],[11,"text-right"]],where:h,mMaxLevel:3}}function rpAgentOrBranchBySoldDate(n,t){var r=$("#"+t[0]).val(),u=$("#"+t[1]).val(),f=$("#"+t[2]).val(),s=$("#"+t[2]).find("option:selected").text(),e=$("#"+t[3]).val(),h=$("#"+t[3]).find("option:selected").text(),c=$("#"+t[3]).find("option:selected").val(),i="Từ ngày: "+r+" - 00:00  &#x2192;  "+u+" - 23:59",o;f!=""&&(i="Tuyến: "+s+"<br />"+i);e!=""&&(i=h+"<br />"+i);o=" ((ChargeDate is null and '"+toFromDateDb(r)+"'<=IsPrgCreatedDate and IsPrgCreatedDate<='"+toToDateDb(u)+"') or ('"+toFromDateDb(r)+"'<=ChargeDate and ChargeDate<='"+toToDateDb(u)+"')) and CompId = "+app.cid+(f!=""?" and TripId = "+f:" ")+" and ((Status = 2 and (SUBSTRING(PaymentInfo, 0, CHARINDEX(':', PaymentInfo)) = '1' or SUBSTRING(PaymentInfo, 0, CHARINDEX(':', PaymentInfo)) = '6')))"+(e!=""?" and BranchChargeId = "+c+" ":" ");n._a="rpBranchBySoldDate";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:5,mArrArgSumary:[5,7,8],reportId:105,strOrderBy:" order by BranchChargeName, UserCharge, TripIdName, PickupDate ",hdValue:i,bShowSubSumary:1,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[7,"text-right"],[8,"text-right"]],where:o,mMaxLevel:3}}function rpAgentOrBranchByPickupDate(n,t){var u=$("#"+t[0]).val(),f=$("#"+t[1]).val(),r=$("#"+t[2]).val(),s=$("#"+t[2]).find("option:selected").text(),e=$("#"+t[3]).val(),h=$("#"+t[3]).find("option:selected").text(),c=$("#"+t[3]).find("option:selected").val(),i="Từ ngày: "+u+" - 00:00  &#x2192;  "+f+" - 23:59",o;r!=""&&(i="Tuyến: "+s+"<br />"+i);e!=""&&(i=h+"<br />"+i);o=" '"+toFromDateDb(u)+"'<=PickupDate and PickupDate<='"+toToDateDb(f)+"' and CompId = "+app.cid+(r!=""?" and TripId = "+r:" ")+" and Status = 2 "+(e!=""?" and BranchChargeId = "+c+" ":" ");n._a="rpBranchByPickupDate";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:5,mArrArgSumary:[5,7,8],reportId:106,strOrderBy:" order by BranchChargeName, UserCharge, TripIdName, PickupDate ",hdValue:i,bShowSubSumary:2,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[7,"text-right"],[8,"text-right"]],where:o,mMaxLevel:4}}function rpRevenueByTrip(n,t){var i=$("#"+t[0]).val(),u=$("#"+t[1]).val(),f=$("#"+t[1]).find("option:selected").text(),r=$("#"+t[2]).val(),e="",o;e=u!=""?r!=""?"Tuyến "+f+"<br />Ngày "+i+" lúc "+r:"Tuyến "+f+"<br />Ngày "+i:"Ngày "+i;o=(r==""?" '"+i.replace(/\//gi,"-")+"'=convert(nvarchar(10), TripDate, 105) ":" '"+vDtToStr("iso",vGtDptTm(i.replace(/\//gi,"-"),r))+"'=TripDate ")+"and CompId = "+app.cid+(u!=""?" and TripId = "+u:" ")+" and (Status = 2 or Status = 5 or (Status = 1 and Deposit is not null and Deposit != 0) or (Status = 3 and CancelFee is not null and CancelFee != 0))";n._a="rpRevenueByTrip";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:5,mArrArgSumary:[5,7,8,9,10,11],reportId:107,strOrderBy:" order by BranchChargeName, TripIdName, TripDate, PaymentTypeName",hdValue:e,bShowSubSumary:1,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-center"],[7,"text-right"],[8,"text-right"],[9,"text-right"],[10,"text-right"],[11,"text-right"],],where:o,mMaxLevel:4}}function rpRevenueByTrip5Rum(n,t){var i=$("#"+t[0]).val(),u=$("#"+t[1]).val(),f=$("#"+t[1]).find("option:selected").text(),r=$("#"+t[2]).val(),e="",o;e=u!=""?r!=""?"Tuyến "+f+"<br />Ngày "+i+" lúc "+r:"Tuyến "+f+"<br />Ngày "+i:"Ngày "+i;o=(r==""?" '"+i.replace(/\//gi,"-")+"'=convert(nvarchar(10), TripDate, 105) ":" '"+vDtToStr("iso",vGtDptTm(i.replace(/\//gi,"-"),r))+"'=TripDate ")+"and CompId = "+app.cid+(u!=""?" and TripId = "+u:" ")+" and (Status = 2 or Status = 5 or (Status = 1 and Deposit is not null and Deposit != 0) or (Status = 3 and CancelFee is not null and CancelFee != 0))";n._a="rpRevenueByTrip";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:6,mArrArgSumary:[6,8,9,10,11],reportId:161,strOrderBy:" order by FareFormatted, UserCharge, BranchChargeName, TripIdName, TripDate",hdValue:e,bShowSubSumary:1,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-center"],[7,"text-right"],[8,"text-right"],[9,"text-right"],[10,"text-right"],[11,"text-right"],],where:o,mMaxLevel:4}}function rpRevenueByRoute(n,t){var u=$("#"+t[0]).val(),f=$("#"+t[1]).val(),i=$("#"+t[2]).val(),o=$("#"+t[2]).find("option:selected").text(),r="Từ ngày "+u+" 00:00 đến "+f+" 23:59",e;i!=""&&(r="Tuyến: "+o+"<br />"+r);e=" '"+toFromDateDb(u)+"'<=TripDate and TripDate<='"+toToDateDb(f)+"' and CompId = "+app.cid+(i!=""?" and TripId = "+i:" ")+" AND Status != 1 AND Status != 8 and (Status <> 3 or (Status = 3 and CancelFee is not null and CancelFee > 0)) GROUP BY TripIdName, BranchChargeName";n._a="rpRevenueByRoute";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:3,mArrArgSumary:[3,4,5,6],reportId:108,strOrderBy:" order by TripIdName asc ",hdValue:r,classRowSumGobal:"danger-total text-right",classSubRowSumGobal:"danger-sub-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[1,"text-center"],[2,"text-right"],[3,"text-right"],[4,"text-right"],[5,"text-right"],[6,"text-right"],[7,"text-right"]],where:e,mMaxLevel:4}}function rpBranchByRoute(n,t){var f=$("#"+t[0]).val(),e=$("#"+t[1]).val(),r=$("#"+t[2]).val(),u=$("#"+t[3]).val(),s=$("#"+t[3]).find("option:selected").text(),h=$("#"+t[2]).find("option:selected").text(),i="Từ ngày "+f+" 00:00 đến "+e+" 23:59",o;r!=""&&(i="Chuyến: "+h+"<br />"+i);u!=""&&(i=s+"<br />"+i);o=" '"+toFromDateDb(f)+"'<=TripDate and TripDate<='"+toToDateDb(e)+"' and CompId = "+app.cid+(r!=""?" and TripId = "+r:" ")+(u!=""?" and BranchChargeId='"+u+"' ":" ")+" AND Status != 1 AND Status != 8 and (Status <> 3 or (Status = 3 and CancelFee is not null and CancelFee > 0)) GROUP BY TripIdName, BranchChargeName";n._a="rpRevenueByRoute";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:3,mArrArgSumary:[3,4,5,6],reportId:108,strOrderBy:" order by TripIdName, BranchChargeName asc ",hdValue:i,classRowSumGobal:"danger-total text-right",classSubRowSumGobal:"danger-sub-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[1,"text-center"],[2,"text-right"],[3,"text-right"],[4,"text-right"],[5,"text-right"],[6,"text-right"]],where:o,mMaxLevel:2}}function rpVexereRevenue(n,t){var u=$("#"+t[0]).val(),f=$("#"+t[1]).val(),i=$("#"+t[2]).val(),o=$("#"+t[2]).find("option:selected").text(),r="Từ ngày "+u+" 00:00 đến "+f+" 23:59",e;i!=""&&(r="Chuyến: "+o+"<br />"+r);e=" '"+toFromDateDb(u)+"'<=TripDate and TripDate<='"+toToDateDb(f)+"' and CompId = "+app.cid+(i!=""?" and TripId = "+i:" ")+" and AgentId in (74, 135) and (Status = 2 or (Status = 1 and ExpiredTime is null)) ";n._a="rpVexereRevenue";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:5,mArrArgSumary:[5,6,7],reportId:110,strOrderBy:" order by PaymentType desc, TripIdName asc, DepartureDate asc ",hdValue:r,bShowSubSumary:1,classRowSumGobal:"danger-total text-right",classSubRowSumGobal:"danger-sub-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[1,"text-right"],[2,"text-right"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-center"],[7,"text-right"]],where:e,mMaxLevel:4}}function rpVexere(n,t){var f=$("#"+t[0]).val(),e=$("#"+t[1]).val(),i=$("#"+t[2]).val(),s=$("#"+t[2]).find("option:selected").text(),r=$("#"+t[3]).val(),h=$("#"+t[3]).find("option:selected").text(),u="Từ ngày "+f+" 00:00 đến "+e+" 23:59",o;u+=i!=""?"<br />"+s:"";u+=r!=""?"<br />"+h:"";o=" '"+toFromDateDb(f)+"'<=TripDate and TripDate<='"+toToDateDb(e)+"' "+(i!=""?" and t.CompId = "+i:" ")+(r!=""?" and t.TripId = "+r:" ")+" and (t.Type=2 or t.Type=3) and Status=2 and (t.IsPrgStatus is null or t.IsPrgStatus != 3)";n._a="rpVexere";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:7,mArrArgSumary:[7,8],reportId:111,strOrderBy:" order by PaymentType desc, TripIdName asc ",hdValue:u,bShowSubSumary:1,classRowSumGobal:"danger-total text-right",classSubRowSumGobal:"danger-sub-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[1,"text-right"],[2,"text-right"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-center"],[7,"text-center"],[8,"text-right"],[10,"text-center"],[11,"text-center"]],where:o,mMaxLevel:4}}function rpRevenueByCreatedUser(n,t){var r=$("#"+t[2]).val(),l=$("#"+t[2]).find('option[value="'+r+'"]').text(),f=$("#"+t[0]).val(),e=$("#"+t[1]).val(),u=$("#"+t[3]).val(),a=$("#"+t[3]).find("option:selected").text(),o=$("#"+t[4]).val(),s=$("#"+t[4]).find("option:selected").text(),h=$("#"+t[5]).val(),i="Từ ngày: "+f+" - 00:00  &#x2192;  "+e+" - 23:59",c;r!=""&&(i="Tuyến: "+l+"<br />"+i);u!=""&&(i+="<br /> Chi nhánh: "+a);o!=""&&(i+="<br /> Nhân viên: "+s);c=" ('"+toFromDateDb(f)+"'<=PickupDate and PickupDate<='"+toToDateDb(e)+"')  and CompId = "+app.cid+(o!=""?" and (CreatedUser = N'"+s+"') ":" ")+(h!=""?" and (Status = "+h+") ":" ")+(r!=""?" and TripId = "+r:" ")+"  and AgentId<>135 and Status<>2 "+(u!=""?" and AgentId="+u+"":"");n._a="rpRevenueByCreatedUser";n._cf={bShowIndexRow:!1,mColMergForSubSumRow:6,mArrArgSumary:[6,10],reportId:112,strOrderBy:" order by CreatedUser,Status, CancelReason, TripIdName ",hdValue:i,bShowSubSumary:1,classSubRowSumGobal:"danger-sub-total text-right",classRowSumGobal:"danger-total text-right",classListItem:"success-total text-right",classCol:[[0,"text-center"],[3,"text-center"],[4,"text-center"],[5,"text-center"],[6,"text-right"],[7,"text-right"],[8,"text-right"],[9,"text-right"],[10,"text-right"],[11,"text-right"]],where:c,mMaxLevel:4}}function toFromDateDb(n){return vDtToStr("iso",vGtDptTm(n.replace(/\//gi,"-"),"00:00"))}function toToDateDb(n){return vDtToStr("iso",vGtDptTm(n.replace(/\//gi,"-"),"23:59"))}define({loadReport:function(){$("#bksContent").hide();$("#bTickets").hide();$("#cod").hide();$("#report").show();$("#product-content").hide();$("#busManager").hide();$("#report").report({});$("#report").report("load",opt);$('[data-toggle="popover"]').tooltip()},start:function(){try{var n=this;vRqs({_a:jVar.getAccountFunction,_c:jVar.getAccountCondition,_f:jVar.getAccountFields},function(t,i){i.length>0&&(accInfo.role=i[0][3]!=null?i[0][3]:-1,accInfo.agentId=i[0][2],accInfo.username=i[0][1],accInfo.id=i[0][0],n.loadReport())})}catch(t){console.error(t)}}});$.getRouteTime=function(n,t,i){vRqs({_a:"fGetTrip",_c:{CompId:"$x = "+app.cid+" and (Type = 1 or (Type = 2 and Time is not null and Date = '"+i+"'))"},_f:"Id, BaseId, Name, StatusInfo, Info, Time"},function(i,r,u,f){var s,o,f,c,e,h;for(n.empty(),s=[],o=0;o<u;o++)if(r[o][1]==null){for(f={Base:r[o],a:[]},c=r[o][4].split("~"),e=0;e<c.length;e++)f.a.push({Time:c[e],Status:r[o][3]});for(e=0;e<u;e++)if(r[e][1]==r[o][0])if(r[o][4].indexOf(r[e][5])>=0){for(h=0;h<f.a.length;h++)if(f.a[h].Time==r[e][5]){f.a[h].Status=r[e][3];break}}else f.a.push({Time:r[e][5],Status:r[e][3]});s.push(f);n.append('<option value="'+r[o][0]+'">'+r[o][2]+"<\/option>")}n.val(n.find("option:first").val());n.change(function(){var i,r;for(t.empty(),i=0;i<s.length;i++)if(s[i].Base[0]==n.val())for(r=0;r<s[i].a.length;r++)t.append('<option value="'+s[i].a[r].Time+'">'+s[i].a[r].Time+(s[i].a[r].Status==3?" - Hủy":s[i].a[r].Status==2?" - Thêm ":"")+"<\/option>")});n.trigger("change")})},function(n){n.widget("custom.report",{options:{},reportObj:{},filter:{},load:function(n){this.renderView(n)},renderView:function(t){this.options=t;this.element.html(jHtml.initHtml);this.renderReportTypes();this.reportObj=t.listReport[parseInt(n(jHtml.reportTypes).find("option:selected").attr("data-index"))];this.filter=this.reportObj.filter;this.initView();this.bindEvent()},renderReportTypes:function(){for(var r=n("<div />").addClass("pl0"),i=n(jHtml.reportTypesSelect),t=0;t<this.options.listReport.length;t++)typeof _dict._hasReportPermission!="undefined"&&_dict._hasReportPermission?app.rights.indexOf(n.rights.rAllRpt.val)!=-1?i.append(vtpl(jHtml.reportTypeOption,{index:t,value:this.options.listReport[t].value,text:this.options.viewNameReport==0?this.options.listReport[t].name:t+1+". "+this.options.listReport[t].name})):typeof this.options.listReport[t].rightId!="undefined"&&app.rights.indexOf(this.options.listReport[t].rightId)!=-1&&i.append(vtpl(jHtml.reportTypeOption,{index:t,value:this.options.listReport[t].value,text:this.options.viewNameReport==0?this.options.listReport[t].name:t+1+". "+this.options.listReport[t].name})):i.append(vtpl(jHtml.reportTypeOption,{index:t,value:this.options.listReport[t].value,text:this.options.viewNameReport==0?this.options.listReport[t].name:t+1+". "+this.options.listReport[t].name}));n(jHtml.reportTypesBox).append(r.append(i)).append(r.append(vtpl(jHtml.reportHelpHtml,{title:helps[0].ex})))},initView:function(t,i){for(var f,e,u,r=0;r<this.filter._v.length;r++)f=this.filter._d[r].split(","),n(jHtml.filterBox).append(vtpl(jHtml.filterHtml,{label:this.filter._v[r]+": ",labelDisplay:this.filter._v[r]==""?"none":"display",class1:f[0]+"-group",element:n("<"+f[0]+' id="'+f[7]+'"/>').addClass("form-control").clone().wrapAll("<div/>").parent().html(),spanDisplay:f[1]=="3"?"display":"none"}));for(n(jHtml.fromDate).length>0&&(n(jHtml.fromDate).unbind(),n(jHtml.fromDate).val(t==null?vGetNow().replace(/-/gi,"/"):t),n(jHtml.fromDate).datepicker({dateFormat:jVar.filterDateFormat}),n(jHtml.fromDate).next().click(function(){n(this).prev().datepicker("show")})),n(jHtml.toDate).length>0&&(n(jHtml.toDate).unbind(),n(jHtml.toDate).val(i==null?vGetNow().replace(/-/gi,"/"):i),n(jHtml.toDate).datepicker({dateFormat:jVar.filterDateFormat}),n(jHtml.toDate).next().click(function(){n(this).prev().datepicker("show")})),e=0;e<this.filter._v.length;e++)u=this.filter._d[e].split(","),typeof window[n.trim(u[3])]=="function"&&(u[4]==""?window[n.trim(u[3])]():window[n.trim(u[3])](u[4].split("~")))},bindEvent:function(){var t=this;n(jHtml.buttonCreateReport).click(function(){var r={},u=n(jHtml.reportTypes).val(),f,e,i;if(typeof window[u]=="function"){if(t.reportObj.typereport=="")window[u](r);else{for(f=t.reportObj.typereport.split(","),e=[],i=0;i<f.length;i++)e.push(t.filter._d[f[parseInt(i)]].split(",")[7]);window[u](r,e)}n(jHtml.contentBox).html(jHtml.loadingSpinner);vRqr(r,function(t){n(jHtml.contentBox).html(t).find(".rptTable").addClass("table table-bordered");var i=n(jHtml.excelLink).attr("href");n(jHtml.buttonExcel).prop("href",i);n(jHtml.excelLink).hasClass(jHtml.largeResult)&&n(jHtml.contentBox).html(vtpl(jHtml.largeResultHtml,{link:i}))})}else alert(jVar.errorMessage_LoadReport)});n(jHtml.buttonPrintReport).click(function(){var i="BookingSheet"+(new Date).getTime(),t=window.open("about:blank",i,"scrollbars=1");t.document.title=i;t.document.write(n(jHtml.printHtml).append(n(jHtml.contentBox).html()).html());t.document.close();t.focus();t.print()});n(jHtml.reportTypes).change(function(){var i=vGetNow().replace(/-/gi,"/"),u=i,r;n(jHtml.fromDate).length>0&&(i=n(jHtml.fromDate).val());n(jHtml.toDate).length>0&&(u=n(jHtml.toDate).val());n(jHtml.filterBox).html("");n(jHtml.contentBox).html("");r=parseInt(n(jHtml.reportTypes).find("option:selected").attr("data-index"));n(jHtml.reportTypes).parent().find(".explain-report").attr("data-original-title",helps[r].ex);t.reportObj=t.options.listReport[r];t.filter=t.reportObj.filter;t.initView(i,u)})}})}(jQuery);
//# sourceMappingURL=p.min.js.map
