var FlatObj={STBPhone:!1,FTripGetTrip:!1,RBePrint:!1,LDefTrip:!1,LFTime:!1},_dict={_lang:"vi",_tgF:["Id","TripId","AgentId","TripDate","SeatCode","IssueDate","PickupDate","CustomerInfo","Status","Fare","Note","PickupInfo","Serial","PaymentInfo","IsPrgHistoryInfo","Code","PassCode","FromValid","ToValid","IsPrgUpdatedDate","AgentInfo","Surcharge","TripAlias","CreatedUser","UserCharge","StageCode","Deposit","Discount","FromArea","ToArea","SeatType","Debt","CanceledDate","CancelInfo","Type","ChargeDate","SNote","ResponsibilityUser","PickOrReturnDate"],_tgF_B:["Id","TripId","AgentId","TripDate","SeatCode","IssueDate","PickupDate","CustomerInfo","Status","Fare","Note","PickupInfo","Serial","PaymentInfo","IsPrgHistoryInfo","Code","PassCode","FromValid","ToValid","IsPrgUpdatedDate","AgentInfo","Surcharge","TripAlias","CreatedUser","UserCharge","StageCode","Deposit","Discount","FromArea","ToArea","SeatType","Debt","CanceledDate","CancelInfo","Type","VexerePaymentInfo","VexerePaymentType","CompName","SNote"],_cc:["available","booking","paid","cancelled","notcome","pass","valid","open","keepOt"],_slc:["selected"],_g:["col-md-12","col-md-6","col-md-4","col-md-3","vcol-md-5","col-md-2","","col-md-spec"],_sg:["col-sm-4","col-sm-4","col-sm-4","col-sm-4","vcol-sm-5","col-sm-2"],_mg:["col-xs-12","col-xs-6","col-xs-6","col-xs-6","vcol-xs-5","col-xs-2"],_chcl:["coach-l","coach-r"],_ts:[1,2,3,6],_tks:[1,2,3,4,5,8],_tksUpSearch:[1,2,4,5,8],_mtks:[1,2,5,8],_at:[[1,"B",2,1,"btn btn-sm bg-none circle active","book"],[1,"C",2,1,"btn btn-sm bg-none circle active","cancel"],[1,"U",2,1,"btn btn-sm bg-none circle active","update"],[1,"M",2,1,"btn btn-sm bg-none circle active","move"],[1,"Q",2,1,"btn btn-sm bg-none circle active","quick-pay"],[1,"P",2,1,"btn btn-sm bg-none circle active","quick-book"]],_st:[[0],[2,3,5,4],[2,3],[2,3],[3],[2,3],[],[],[2,3]],_lst:[[0],[3],[3],[3],[],[3],[],[],[3]],_ft:[],_err:["Chỉ được đặt những ghế còn trống !","Chỉ được cập nhật những ghế đã đặt hoặc đã thanh toán !","Chỉ được thanh toán những ghế đã đặt !","Bạn đang thực hiện thao tác đổi vé, vui lòng không thực hiện thao tác khác hoặc bấm ESC để hủy thao tác đổi vé !","Ghế đã được đặt trước, vui lòng chọn ghế khác !","Bạn đang thực hiện thao tác đặt thêm vé, vui lòng không thực hiện thao tác khác hoặc bấm ESC để hủy thao tác đặt thêm vé !","Bạn đang thực hiện thao tác đặt vé khứ hồi, vui lòng không thực hiện thao tác khác hoặc bấm ESC để hủy thao tác đặt vé khứ hồi !"],_pm:[[1,{vi:"Tại văn phòng"},1,""],[2,{vi:"Chuyển khoản"},0,"CK"],[3,{vi:"Thu tiền tại nhà"},0,"TN"],[4,{vi:"Tài xế thu"},1,"TX"],[5,{vi:"123Pay"},0,"123Pay"],[6,{vi:"Đại lý"},1,"DL"],[7,{vi:"VeXeRe"},0,"VXR"],[8,{vi:"Chủ xe thu"},0,"CX"],[9,{vi:"Không thu tiền"},1,"VIP"]],_qBookPayment:[[1,{vi:"Tại văn phòng"},1,""],[2,{vi:"Chuyển khoản"},0,"CK"],[3,{vi:"Thu tiền tại nhà"},0,"TN"],[4,{vi:"Tài xế thu"},1,"TX"],[5,{vi:"123Pay"},0,"123Pay"],[6,{vi:"Đại lý"},0,"DL"],[7,{vi:"VeXeRe"},0,"VXR"],[8,{vi:"Chủ xe thu"},0,"CX"],[9,{vi:"Không thu tiền"},1,"VIP"]],_opm:[2,5],_vc:["vred","vblue","vgreen","vyellow"],_nOP:30,_dOW:["Thứ Hai","Thứ Ba","Thứ Tư","Thứ 5","Thứ 6","Thứ 7","Chủ Nhật"],_uForm:["UpdateForm",[[1,1,"","input","hidden","IdInfo","","","",{},[],""],[1,1,"","input","hidden","CustomerInfo","","",{},[],""],[1,1,"","input","hidden","StatusInfo","","",{},[],""],[1,1,"","input","hidden","CustomerId","","",{},[],""],[1,1,"","input","hidden","NumSeat","","",{},[],""],[1,1,"","input","hidden","pIndex","","",{},[],""],[1,1,"","input","hidden","PhoneNumbers","","",{},[],""],[1,1,"","input","hidden","CreatedUser","","",{},[],""],[1,1,"","input","hidden","NumClick","","",{},[],""],[2,1,"Ngày đi","input","text","PickupDate","form-control","",{readonly:!0},[],"<i class='glyphicon glyphicon-calendar'><\/i>"],[2,2,"Giờ","input","text","PickupTime","form-control","",{readonly:!0},[],"<i class='glyphicon glyphicon-time'><\/i>"],[4,1,"Di động","input","text","PhoneNumbers","form-control vblue fw700","",{},[],""],[4,2,"Tên","input","text","FullName","form-control vblue fw700","",{},[],""],[5,1,"Đón khách","input","text","PickupInfo","form-control","",{},[],""],[5,2,"T/C","input","text","TransferInfo","form-control","",{},[],""],[6,1,"Giá","input","text","Fare","form-control vblue fw700","",{},[],"đ"],[6,2,"Tổng tiền","input","text","ToTalFare","form-control vblue fw700","",{readonly:!0},[],"đ"],[9,1,"Thanh toán","select","Chọn hình thức","PaymentType","form-control","",{},[],""],[9,2,"Chọn VP","select","Chọn VP/CN","BranchName","form-control mpayment","",{"data-type":1},[],""],[9,2,"TK nhận","input","text","ChargeCode","form-control mpayment","",{"data-type":2,placeholder:"Số TK|Tên|Mã GD"},[],""],[9,2,"Địa chỉ thu","input","text","PayAddress","form-control mpayment","",{"data-type":3},[],""],[9,2,"Tên tài xế","input","text","DriverName","form-control mpayment","",{"data-type":4},[],""],[9,2,"Mã giao dịch","input","text","TransCode","form-control mpayment","",{"data-type":5},[],""],[9,2,"Chọn đại lý","select","------Chọn đại lý-----","AgentName","form-control mpayment","",{"data-type":6},[],""],[10,1,"Ghi chú","textarea","","Note","form-control","",{},[],""],[10,2,"Mã vé","label","","Code","form-control vblue fw700","",{readonly:!0},[],""],[12,1,"","button","button","Hủy vé","btn btn-danger btn-cancel pull-left","",{},[],"<span class='glyphicon glyphicon-remove'><\/span>&nbsp;",[1,2]],[12,1,"","button","button","Thêm vé","btn btn-success pull-left btn-add-more-ticket","",[],[],"",[1,2]],[12,1,"","button","button","Khứ hồi","btn btn-primary pull-left btn-return","",[],[],"",[1,2]],[12,1,"","button","button","Cập nhật","btn btn-primary btn-update","",[],[],"",[1,2]],[12,1,"","button","button","In vé","btn btn-warning btn-eprint","",[],[],"",[1,2]],[12,1,"","button","button","Đóng","btn btn-default  btn-close","",[],[],"",[1,2]]],"form-horizontal"],_uFormRequiredField:["PhoneNumbers"],_closedTripConf:{UpdateForm:["btn-cancel","btn-update","btn-eprint","btn-eprint-save","btn-add-more-ticket","btn-return"],ValidForm:[]},_hasWarningConflictUser:!0,_driverInfoRequired:!0,_fieldDriverInfoRequired:["VehicleNumber","DriverName"],_hasBlockFromPoint:!1,_hasMultiFare:!0,_hasReportPermission:!0,_qBookFormButton:[["Hủy","btn btn-danger hidden cancel-qBook"],["In vé","btn btn-warning print-qBook"],["Thanh toán","btn btn-success pay-qBook"]],_vForm:["ValidForm",[[1,1,"","input","hidden","IdInfo","","","",{},[],""],[2,1,"Open","input","radio","Status","",7,{},[],"",[],"col-md-4 col-xs-4 text-center"],[3,1,"Valid","input","radio","Status","",6,{},[],"",[],"col-md-4 col-xs-4 text-center"],[3,2,"","input","text","FromValid","form-control datepicker","",{placeholder:"Từ ngày"},[],"<i class='glyphicon glyphicon-calendar'><\/i>"],[3,3,"","input","text","ToValid","form-control datepicker","",{placeholder:"Đến ngày"},[],"<i class='glyphicon glyphicon-calendar'><\/i>"],[4,1,"Hủy vé","input","radio","Status","",3,{},[],"",[],"col-md-4 col-xs-4 text-center"],[4,2,"Phí","input","text","CancelFee","form-control","",{placeholder:0},[],"đ"],[4,3,"Tổng","input","text","ToTalCancelFee","form-control","",{placeholder:0,readonly:!0},[],"đ"],[5,1,"","p","","","","Nếu hành khách có vé mở. Vui lòng nhập mã vé vào ô bên dưới",{},[],"",[1,3]],[6,1,"Mã vé mở","input","text","PassCode","form-control","",{},[],"",[1,2]],[7,1,"","button","button","Xác nhận","btn btn-danger btn-confirm","",{},[],"<span class='glyphicon glyphicon-ok'><\/span>&nbsp;",[1,3]],[7,1,"","button","button","Đóng","btn btn-default  btn-close","",[],[],"",[1,3]]],"form-horizontal"],_fForm:["FilterForm",[[1,1,"","select","","TripId","form-control input-sm","",{},[],"<i class='glyphicon glyphicon-road'><\/i>",[]],[1,2,"","input","text","DepartureDate","form-control input-sm datepicker","",{},[],"<i class='glyphicon glyphicon-calendar'><\/i>",[]],[1,3,"","select","","TimeSlot","form-control input-sm","",{},[],"<i class='glyphicon glyphicon-time'><\/i>",[]],[1,4,"","select","","Bus","form-control input-sm","",{},[],"<i class='glyphicon glyphicon-th-list'><\/i>",[]],[1,5,"","input","","Keyword","form-control input-sm","",{placeholder:"Tìm số điện thoại..."},[],"<i class='glyphicon glyphicon-phone'><\/i>",[]],[1,6,"","button","button","<i class='glyphicon glyphicon-print'><\/i> In phơi","btn btn-sm btn-primary btn-print","",{},[],"",[]],[1,7,"","button","button","<i class='glyphicon glyphicon-refresh'><\/i> Làm mới","btn btn-sm btn-success btn-print","",{},[],"",[]]],"col-md-10 col-xs-12 form-inline"],_ofForm:["VOFilterForm",[[1,1,"","select","","TripId","form-control input-sm","",{},[],""]],"col-md-2 form-inline","form-group"],_vfForm:["VVFilterForm",[[1,1,"","select","","TripId","form-control input-sm","",{},[],""]],"col-md-2 form-inline","form-group"],_cfForm:["VCFilterForm",[[1,1,"","select","","TripId","form-control input-sm","",{},[],""]],"col-md-2 form-inline","form-group"],_hasSelectBranchPayment:!1,_frule:[[["UpdateForm",["RoundTripCode","FromArea","ToArea"]],["ValidForm",["PassCode"]]],[[1,[["UpdateForm",["Notcome"]],["ValidForm",["Status","FromValid","ToValid","CancelFee"]]]],[2,[["UpdateForm",["KeepOnTime","Fare","Deposit","Surcharge","Discount","PaymentType","BranchName","ChargeCode","DriverName","AgentName"]],["ValidForm",["PassCode"]]]],[3,[["UpdateForm",["PhoneNumbers","FullName","PickupInfo","TransferInfo","Fare","Deposit","Surcharge","Discount","PaymentType","Serial","Note","KeepOnTime","BranchName","ChargeCode","DriverName"]],["ValidForm",["PassCode"]]]],[5,[["UpdateForm",["KeepOnTime","PaymentType","Fare"]]]],[8,[["UpdateForm",["Notcome"]],["ValidForm",["Status","FromValid","ToValid","CancelFee"]]]]]],_trule:[["valid","history"],[[1,["valid"]],[2,["valid"]],[3,["valid"]],[5,["valid"]]]],_brule:[[],[[3,[["UpdateForm",["btn-cancel","btn-update","btn-eprint","btn-add-more-ticket","btn-return","btn-eprint-save"]]]]]],_historyKeys:{AgentInfo:{vi:"VP/CN"},TripDate:{vi:"Chuyến"},IssueDate:{vi:"Ngày đặt"},PickupDate:{vi:"Giờ đón"},Status:{vi:"Trạng thái"},Fare:{vi:"Giá"},CreatedUser:{vi:"Người đặt"},SeatCode:{vi:"Mã ghế"},CustomerInfo:{vi:"Hành khách"},PickupInfo:{vi:"Đón"},Serial:{vi:"Số seri"},PaymentInfo:{vi:"Thanh toán"},RoundTripCode:{vi:"Mã khứ hồi"},Note:{vi:"Ghi chú"},Surcharge:{vi:"Phụ thu"},Discount:{vi:"Giảm giá"},CancelFee:{vi:"Phí hủy vé"},FromArea:{vi:"Nơi đi"},ToArea:{vi:"Nơi đến"},Debt:{vi:"Nợ"},CancelType:{vi:"Lý do"},CancelInfo:{vi:"Ghi chú"},Code:{vi:"Mã vé"}},_stn:{1:{vi:"Đặt chỗ"},2:{vi:"Đã thanh toán"},3:{vi:"Đã hủy"},4:{vi:"HK không đến"},5:{vi:"Không thu tiền"},6:{vi:"Vé mở"},7:{vi:"Vé mở"},8:{vi:"Giữ chỗ đến giờ xe chạy"}},_pnp:{"10":["090","091","092","093","094","095","096","097","098","099","070","067","083","020","022","025","026","027","029","030","031","033","036","037","038","039","052","053","054","055","056","057","058","059","060","061","062","063","064","066","067","068","070","072","073","074","075","076","077","079"],"11":["0120","0121","0122","0123","0124","0125","0126","0127","0128","0129","0162","0163","0164","0165","0166","0167","0168","0169","0188","0186","0199","0210","0211","0218","0219","0230","0231","0240","0241","0280","0281","0320","0321","0350","0351","0500","0501","0510","0511","0650","0651","0710","0711","0780","0781"]},_arrows:[37,38,39,40],_cancelFeePercentDefault:0,_cancelFeeMoneyDefault:0,_hasQuickPrint:!1,_cancelReasonRequired:!1,_cancelType:["Khác","Nhà xe hủy","Khách hàng hủy","Đại lý hủy"],_pclTpl:"<div class='list'><h3>DANH SÁCH KHÁCH HÀNG<\/h3><table class='table table-bordered'><thead><tr><th>Số ghế<\/th><th>Tên HK<\/th><th>Code<\/th><th>Điểm đón<\/th><th>Số điện thoại<\/th><th>Trạng thái<\/th><th>N.Báo<\/th><th>Đại lý<\/th><th>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><\/table><\/div>",_ipcLTpl:"<tr class='{seat._class}'><td>{seat._seatCodes}<\/td><td>{seat._cname}<\/td><td>{seat._seri}<\/td><td>{seat._pText}<\/td><td>{seat._cphone}<\/td><td>{seat._status}<\/td><td>{seat._suser}<\/td><td>{seat._cuser}<\/td><td>{seat._note}<\/td><\/tr>",_psmTpl:"<div><p><strong>Trước chuyến:<\/strong>&nbsp;Tổng số ghế:&nbsp;{s._stotal} ghế&nbsp;|&nbsp;Đã thanh toán:&nbsp;{s._spaid} ghế<\/p><p><strong>Sau chuyến:<\/strong>&nbsp;Tổng số ghế:&nbsp;...... ghế&nbsp;|&nbsp;Đã thanh toán:&nbsp;...... ghế&nbsp;|&nbsp;Đã hủy:&nbsp;...... ghế<\/p><\/div>",_tplNumRow:7,_tplNumCol:3,_specialNumColBySeatTemplateId:{},_pStyleUrlDefault:"/Content/css/vbooking-print-default.css?v=1.0.1",_pStyleUrl:"/Content/css/vbooking-print.css?v=1.0.1",_pSpecialPos:{},_psTpl:"<li class='print-seat'><table class='table no-border table-condensed'><tbody><tr style='height: 22px;'><td><p class='pseat-code'>{pseat._label}<\/p><p class='ppayment {pseat._paid} {pseat._exported}'>{pseat._pmInfo}<\/p><\/td><\/tr><tr><td><p class='pcname'>{pseat._cname}&nbsp;<b class='ntk-pertrip'>{pseat._nTicketPerTrip}<\/b><\/p><p class='pcphone'>{pseat._cphone}<\/p><p class='pnote'>{pseat._note}<\/p><\/td><\/tr><\/tbody><\/table><\/li>",_psTpl_SeatGroup:'<li class="print-seat col-md-4" style="overflow:hidden;"><table><tbody><tr style="height: 22px"><td style="width:20%"><p class="pseat-code">{data.seatCode}<\/p><\/td><td style="font-size: small;width:80%;text-align:right"><p style="white-space: nowrap;overflow: hidden;"> {data.pInfo}<\/p><\/td><\/tr><tr><td colspan="2" style="text-align: center;font-size: 20px;" class="{data._paid}">{data.phone}<\/td><\/tr><tr><td style="font-size:small;" colspan=2><p style="white-space: nowrap;overflow: hidden;"> {data.note}<\/p><\/td><\/tr><\/tbody><\/table><\/li>',_pssTpl:"<li class='print-seat'><table class='table no-border table-condensed'><tbody><tr style='height: 20px;'><td><p class='pseat-code'>{pseat._label}<\/p><p class='ppayment {pseat._paid} {pseat._exported}'>{pseat._pmInfo}<\/p><\/td><\/tr><tr><td><p class='pcname'>{pseat._cname}&nbsp;<b class='ntk-pertrip'>{pseat._nTicketPerTrip}<\/b><\/p><p class='pcphone'>{pseat._cphone}<\/p><p class='pnote'>{pseat._note}<\/p><\/td><\/tr><tr><td class='{pseat._hidden}'>Đ/TC:&nbsp;{pseat._pInfo}<\/td><\/tr><\/tbody><\/table><\/li>",_pTitleTpl:"<table class='print-title'><tbody><tr><td><strong class='title'>{p._title}<\/strong><\/td><td colspan='2'><strong class='rname'>{p._rname}<\/strong><\/td><\/tr><tr><td>Chuyến:&nbsp;<strong class='time'>{p._time}<\/strong><\/td><td>Số xe:&nbsp{p._busNum}<\/td><td>Tài xế:&nbsp;{p._driverName}<\/td><\/tr><\/tbody><\/table>",_pNoSeat:!1,_pTplNumCoach:0,_pTplNumCol:0,_specialPos:{},_sTpl:"<li class='seat {seat._notallow} {seat._half}' data-position='{seat._coach}_{seat._row}_{seat._col}'><div class='{seat._class}'><div class='clearfix'><div class='seat-code'>{seat._label}<\/div><div class='pick'>{seat._pInfo}<\/div><\/div><div class='agentinfo clearfix'><p>{seat._suser}{seat._cuser}<\/p><p>{seat._note}<\/p><\/div><div class='clearfix'><div class='buttons'>{seat.buttons}<\/div><div class='cinfo'><p class='name'>{seat._cname}<span class='numT'>{seat._nTicketPerTrip}<\/span><span>{seat._pmInfo}<\/span><\/p><p class='phone'>{seat._cphone}<\/p><\/div><\/div><\/div><\/li>",_lksTpl:"<li class='seat'><div class='lock'><div class='clearfix'><div class='seat-code'>{seat._label}<\/div><\/div><\/div><\/li>",_svcTpl:"<li class='seat {seat._notallow} seat-chang {seat._half}' data-position='{seat._coach}_{seat._row}_{seat._col}'><div class='{seat._class}'><div class='chang'><span class='badge so-chang'>{seat._numStagetickets}<\/span><div class='chang-di'><ul>{seat._stageticketsTooltips}<\/ul><\/div><\/div><div class='clearfix'><div class='seat-code'>{seat._label}<\/div><div class='pick'><span>{seat._pInfo}<\/span><span><a href='#' title='{seat._seatStatusTooltips}'><\/a><\/span><\/div><\/div><div class='agentinfo clearfix'><p>{seat._suser}{seat._cuser}<\/p><p>{seat._note}<\/p><\/div><div class='clearfix'><div class='buttons'>{seat.buttons}<\/div><div class='cinfo'><p class='name'>{seat._cname}<span class='numT'>{seat._nTicketPerTrip}<\/span><span>{seat._pmInfo}<\/span><\/p><p class='phone'>{seat._cphone}<\/p><\/div><\/div><\/div><\/li>",_lksvcTpl:"<li class='seat {seat._notallow}'><div class='lock'><div class='chang'><span class='badge so-chang'>{seat._numStagetickets}<\/span><div class='chang-di'><ul>{seat._stageticketsTooltips}<\/ul><\/div><\/div><div class='clearfix'><div class='seat-code'>{seat._label}<\/div><\/div><\/div><\/li>",_vTpl:"<li class='ext-seat'><div class='voseat'><div class='vocode'>{ticket._code}<\/div><div class='vinfo'><p class='timeValid'>{ticket._fValid} → {ticket._tValid}<\/p><p>{ticket._cname}<\/p><p>{ticket._cphone}<\/p><\/div><\/div><\/li>",_oTpl:"<li class='ext-seat'><div class='voseat'><div class='vocode'>{ticket._code}<\/div><div class='vinfo'><p class='timeValid'>{ticket._fOpen}<\/p><p>{ticket._cname}<\/p><p>{ticket._cphone}<\/p><\/div><\/div><\/li>",_cTpl:"<li class='ext-seat'><div class='voseat vcseat'><div class='vocode'>{ticket._code}<\/div><div class='vinfo'><p class='timeValid'>{ticket._cDate}<\/p><p>{ticket._cname}<\/p><p>{ticket._cphone}<\/p><\/div><\/div><\/li>",_tInfoTpl:"<div class='bs-callout bs-callout-primary bg-danger clearfix'><div class='col-md-6 col-sm-6 col-xs-12 pl0 pr0'>Loại xe:&nbsp;{trip._vehicleName}&nbsp;-&nbsp;Số xe:&nbsp;{trip._vehicleNumber}&nbsp;-&nbsp;Tài:&nbsp;{trip._driverName}&nbsp;-&nbsp;Phụ xe:&nbsp;{trip._assistantName}&nbsp;-&nbsp;{trip._note}<\/div><div class='col-md-6 col-sm-6 col-xs-12 text-right-md text-right-sm pl0 pr0'>Tổng số vé đã đặt:&nbsp;{trip._total}.&nbsp;Số ghế trống:&nbsp;{trip._numAvail}<br/>Thanh toán:&nbsp;{trip._numPaid}{trip._numPaidPerType}, Đặt chỗ:&nbsp;{trip._numBooking}{trip._numBookingPerAgent}<\/div><\/div>",_tInfoClosedTpl:"<div class='bs-callout bs-callout-primary bg-danger clearfix'><div class='col-md-6 col-sm-6 col-xs-12 pl0 pr0'>Loại xe:&nbsp;{trip._vehicleName}&nbsp;-&nbsp;Số xe:&nbsp;{trip._vehicleNumber}&nbsp;-&nbsp;Tài:&nbsp;{trip._driverName}&nbsp;-&nbsp;Phụ xe:&nbsp;{trip._assistantName}{trip._note}<div><img src='http://nhaxe.vexere.com/Content/images/da-xuat-ben.png' style='position:absolute;z-index:10;right:-100px;top:-12px;'/><\/div><\/div><div class='col-md-6 col-sm-6 col-xs-12 text-right-md text-right-sm pl0 pr0'>Tổng số vé đã đặt:&nbsp;{trip._total}.&nbsp;Số ghế trống:&nbsp;{trip._numAvail}<br/>Thanh toán:&nbsp;{trip._numPaid}{trip._numPaidPerType}, Đặt chỗ:&nbsp;{trip._numBooking}{trip._numBookingPerAgent}<\/div><\/div>",_tInfoChotPhoiTpl:"<div class='bs-callout bs-callout-primary bg-danger clearfix'><div class='col-md-6 col-sm-6 col-xs-12 pl0 pr0'>Loại xe:&nbsp;{trip._vehicleName}&nbsp;-&nbsp;Số xe:&nbsp;{trip._vehicleNumber}&nbsp;-&nbsp;Tài:&nbsp;{trip._driverName}&nbsp;-&nbsp;Phụ xe:&nbsp;{trip._assistantName}{trip._note}<div><img src='http://nhaxe.vexere.com/Content/images/da-chot-phoi.png' style='position:absolute;z-index:10;right:-100px;top:-12px;'/><\/div><\/div><div class='col-md-6 col-sm-6 col-xs-12 text-right-md text-right-sm pl0 pr0'>Tổng số vé đã đặt:&nbsp;{trip._total}.&nbsp;Số ghế trống:&nbsp;{trip._numAvail}<br/>Thanh toán:&nbsp;{trip._numPaid}{trip._numPaidPerType}, Đặt chỗ:&nbsp;{trip._numBooking}{trip._numBookingPerAgent}<\/div><\/div>",_locationItemTpl:"<tr data-index='{pLoc._index}' data-name='{pLoc._name}' data-time='{pLoc._time}' data-order='{pLoc._order}' data-address='{pLoc._address}' data-nearby='{pLoc._nearby}' data-locationId='{pLoc._locationId}'><td>{pLoc._name}<\/td><td>{pLoc._time}<\/td><\/tr>",_locationHeaderTpl:"<div class='dropdown-menu search-result search-location'><div class='search-title'>Điểm đón tìm được<\/div>",_locationFooterTpl:"<div class='search-summary'>Tổng số {locCount} điểm<\/div><\/div>",_lTpl:"<table class='table table-bordered table-striped list-ticket'><thead><tr class='bg-primary'><th class='hidden-xs text-center'>STT<\/th><th>Số ghế<\/th><th>Tên HK<\/th><th>Số điện thoại<\/th><th>Chặng<\/th><th class='hidden-xs'>Ngày đặt<\/th><th class='hidden-xs'>Tổng tiền<\/th><th>Trạng thái<\/th><th class='hidden-xs'>Đón / trung chuyển<\/th><th class='hidden-xs'>Ghi chú<\/th><th class='hidden-xs text-center'>Tác vụ<\/th><\/tr><\/thead><tbody><\/tbody><tfoot class='hidden-xs'><tr><td colspan='10'><button class='btn btn-sm btn-warning btn-print-list'><i class='glyphicon glyphicon-print'><\/i>&nbsp;In danh sách<\/button><\/td><\/tr><\/tfoot><\/table>",_cancelListTpl:"<table class='table table-bordered table-striped list-ticket'><thead><tr class='bg-primary'><th class='hidden-xs text-center'>STT<\/th><th>Số ghế<\/th><th>Tên HK<\/th><th>Số điện thoại<\/th><th class='hidden-xs'>Ngày đặt<\/th><th class='hidden-xs'>Tổng tiền<\/th><th>Trạng thái<\/th><th class='hidden-xs'>Đón / trung chuyển<\/th><th class='hidden-xs'>Ghi chú<\/th><th class='hidden-xs text-center'>Tác vụ<\/th><\/tr><\/thead><tbody><\/tbody><\/table>",_ilTpl:"<tr class='lseat' data-position='{seat._coach}_{seat._row}_{seat._col}' data-issue='{seat._issue}'><td class='hidden-xs text-center index'>{seat._index}<\/td><td>{seat._label}<\/td><td>{seat._cname}&nbsp;<span class='numT'>{seat._nTicketPerTrip}<\/span><\/td><td>{seat._cphone}<\/td><td>{seat._stageName}<\/td><td class='hidden-xs'>{seat._idate}<br/>{seat._suser}<\/td><td class='hidden-xs'><strong>{seat._total}<\/strong><\/td><td>{seat._status}<br/>{seat._cuser}<br/>{seat._pmFullInfo}<\/td><td class='hidden-xs'>{seat._pInfo}<\/td><td class='hidden-xs'>{seat._note}<\/td><td class='hidden-xs text-center'>{seat._buttons}<\/td><\/tr>",_pvcTpl:"<div><div class='list plist' style='padding:5px 0 5px 0;clear:both;'><h4>DANH SÁCH VÉ CHẶNG<\/h4><\/div><div class='list'><table class='table table-bordered' width='100%'><thead><tr class='bg-primary'><th class=''>STT<\/th><th>Tên HK<\/th><th>Số điện thoại<\/th><th>Mã ghế<\/th><th>Tổng tiền<\/th><th>Nhân viên<\/th><th>Chặng đường<\/th><th>Đón/TC<\/th><th>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><\/table><\/div><\/div>",_pvcRTpl:"<tr><td class=''>{_stt}<\/td><td>{_cname}<\/td><td>{_cphone}<\/td><td>{seatLabel}<\/td><td>{_fare}<\/td><td><span class='{_hasPaid}'>{_user}<\/span><\/td><td>{_stageName}<\/td><td>{_pInfo}<\/td><td>{_note}<\/td><\/tr>",_puTpl:"<div class='plist'><h4>DANH SÁCH ĐÓN DỌC ĐƯỜNG&nbsp;<small>chuyến {t._timeSlots}<\/small><\/h4><table class='table table-bordered table-responsive list-ticket'><thead><tr class='bg-primary'><th class='col-md-1 hidden-xs'>STT<\/th><th>Địa chỉ đón<\/th><th>Số ghế<\/th><th class='hidden-xs'>Tên HK<\/th><th>Số điện thoại<\/th><th class='hidden-xs'>Tổng tiền<\/th><th class='hidden-xs'>Trạng thái<\/th><th class='hidden-xs'>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><tfoot class='hidden-xs'><tr><td colspan='5' style='text-align: right;'>Tổng cộng<\/td><td><strong class='vred'>{t._total}<\/strong><\/td><td colspan='2'>&nbsp;<\/td><\/tr><tr><td colspan='8'><button class='btn btn-sm btn-success btn-order'>Lưu sắp xếp<\/button>&nbsp;<button class='btn btn-sm btn-warning btn-print-list'><i class='glyphicon glyphicon-print'><\/i>&nbsp;In danh sách<\/button><\/td><\/tr><\/tfoot><\/table><\/div>",_ipuTpl:"<tr class='{seat._class}' data-code='{seat._code}' data-ids='{seat._tids}' data-pdate='{seat._pdate}' data-seatinfos='{seat._seatInfos}' data-pText='{seat._pText}'><td class='col-md-1 hidden-xs'><input class='form-control input-sm pIndex' type='text' value='{seat._index}' /><\/td><td>{seat._pText}<\/td><td>{seat._seatCodes}<\/td><td class='hidden-xs'>{seat._cname}<\/td><td>{seat._cphone}<\/td><td class='hidden-xs'><strong>{seat._total}<\/strong><\/td><td class='hidden-xs'>{seat._status}<\/td><td class='hidden-xs'>{seat._note}<\/td><\/tr>",_ppuTpl:"<div class='list plist'><h4 style='text-align: center;'>DANH SÁCH ĐÓN DỌC ĐƯỜNG<\/h4><table class='table table-bordered'><thead><tr><th>STT<\/th><th>Địa chỉ đón<\/th><th>Số ghế<\/th><th>Tên HK<\/th><th>Số điện thoại<\/th><th>Tổng tiền<\/th><th>Trạng thái<\/th><th>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><tfoot><tr><td colspan='2' style='text-align: right; padding-right: 5px;'>Tổng cộng<\/td><td>{t._totalSeat}<\/td><td colspan='2'><\/td><td><strong>{t._total}<\/strong><\/td><td colspan='2'>&nbsp;<\/td><\/tr><\/tfoot><\/table><\/div>",_ippuTpl:"<tr><td>{seat._index}<\/td><td>{seat._pText}<\/td><td>{seat._seatCodes}<\/td><td>{seat._cname}<\/td><td>{seat._cphone}<\/td><td><strong>{seat._total}<\/strong><\/td><td>{seat._status}<\/td><td>{seat._note}<\/td><\/tr>",_hasPickUpOnPrintBKS:!0,_pointType:["Chọn kiểu","Châu lục","Quốc gia","Tỉnh","Thành phố","Quận","Huyện","Đảo","Phường","Xã","Thị trấn","Tổ","Ấp","Thôn","Số nhà","Điểm dừng chung","Điểm dừng riêng"],_hasMergeTranfer:!1,_tsfTpl:"<div class='tlist'><h4>DANH SÁCH TRUNG CHUYỂN&nbsp;<small>chuyến {t._timeSlots}<\/small><\/h4><table class='table table-bordered table-responsive list-ticket'><thead><tr class='bg-primary'><th class='col-md-1 hidden-xs'>STT<\/th><th>Tài<\/th><th>Địa chỉ đón<\/th><th>Mã ghế<\/th><th>Số ghế<\/th><th class='hidden-xs'>Tên HK<\/th><th>Số điện thoại<\/th><th class='hidden-xs'>Tổng tiền<\/th><th class='hidden-xs'>Trạng thái<\/th><th class='hidden-xs'>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><tfoot class='hidden-xs'><tr><td colspan='7' style='text-align: right;'>Tổng cộng<\/td><td><strong class='vred'>{t._total}<\/strong><\/td><td colspan='2'>&nbsp;<\/td><\/tr><tr><td colspan='10'><button class='btn btn-sm btn-success btn-order'>Lưu sắp xếp<\/button>&nbsp;<button class='btn btn-sm btn-warning btn-print-list' data-group-index='{t._index}'><i class='glyphicon glyphicon-print'><\/i>&nbsp;In danh sách<\/button><\/td><\/tr><\/tfoot><\/table><\/div>",_itsfTpl:"<tr class='{seat._class}' data-ids='{seat._tids}' data-pdate='{seat._pdate}' data-seatinfos='{seat._seatInfos}' data-tText='{seat._pText}'><td class='col-md-1 hidden-xs'><input class='form-control input-sm tIndex' type='text' value='{seat._index}' /><\/td><td>{seat._driverName}<\/td><td>{seat._pText}<\/td><td>{seat._seatCodes}<\/td><td>{seat._numSeat}<\/td><td class='hidden-xs'>{seat._cname}<\/td><td>{seat._cphone}<\/td><td class='hidden-xs'><strong>{seat._total}<\/strong><\/td><td class='hidden-xs'>{seat._status}<\/td><td class='hidden-xs'>{seat._note}<\/td><\/tr>",_ptsfTpl:"<div class='list tlist {t._pageBreak}'><h4 style='text-align: center;'>DANH SÁCH TRUNG CHUYỂN<br/><small>{t._tName}&nbsp;chuyến {t._timeSlots}&nbsp;ngày&nbsp;{t._tDate}<\/small><\/h4><table class='table table-bordered'><thead><tr><th>STT<\/th><th>Tài<\/th><th>Địa chỉ đón<\/th><th>Mã ghế<\/th><th>Số ghế<\/th><th>Tên HK<\/th><th>Số điện thoại<\/th><th>Tổng tiền<\/th><th>Trạng thái<\/th><th>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><tfoot><tr><td colspan='7' style='text-align: right; padding-right: 5px;'>Tổng cộng<\/td><td><strong>{t._total}<\/strong><\/td><td colspan='2'>&nbsp;<\/td><\/tr><\/tfoot><\/table><\/div>",_ptsfTpl_NoSub:"<div class='list tlist {t._pageBreak}'><h4 style='text-align: center;'>DANH SÁCH TRUNG CHUYỂN<br/><\/h4><table class='table table-bordered'><thead><tr><th>STT<\/th><th>Tài<\/th><th>Địa chỉ đón<\/th><th>Mã ghế<\/th><th>Số ghế<\/th><th>Tên HK<\/th><th>Số điện thoại<\/th><th>Tổng tiền<\/th><th>Trạng thái<\/th><th>Ghi chú<\/th><\/tr><\/thead><tbody><\/tbody><tfoot><tr><td colspan='7' style='text-align: right; padding-right: 5px;'>Tổng cộng<\/td><td><strong>{t._total}<\/strong><\/td><td colspan='2'>&nbsp;<\/td><\/tr><\/tfoot><\/table><\/div>",_iptsfTpl:"<tr><td>{seat._index}<\/td><td>{seat._time}<\/td><td>{seat._pText}<\/td><td>{seat._seatCodes}<\/td><td>{seat._numSeat}<\/td><td>{seat._cname}<\/td><td>{seat._cphone}<\/td><td><strong>{seat._total}<\/strong><\/td><td>{seat._status}<\/td><td>{seat._note}<\/td><\/tr>",_multiSeatOnTicket:!0,_eTicket:{sm:"<div style='width:330px; margin: 0 auto; padding-left: 20px;'><div class='col-xs-12 text-center'><img class='img-responsive' src='http://nhaxe.vexere.com/Images/eticket/tienoanh.jpg' alt=''/><\/div><div class='row'><div class='col-xs-12'><p style='margin-top:5px;'>{ticket._phone}<br/>{ticket._address}<\/p><\/div><\/div><hr style='border:1px #000 solid; margin:0'/><div class='row'><div class='col-xs-5'><h5 style='margin-bottom:5px;'><span style='text-transform:uppercase; margin-bottom:5px;'>{ticket._fromArea}<\/span><\/h5><p>{ticket._from}<\/p><\/div><div class='col-xs-2'><h3 style='margin-top:10px;'>&#x2192;<\/h3><\/div><div class='col-xs-5 text-right'><h5 style='margin-bottom:5px;'><span style='text-transform:uppercase;'>{ticket._toArea}<\/span><\/h5><p>{ticket._to}<\/p><\/div><\/div><div class='row'><div class='col-xs-5' style='padding-right:0;'><p style='margin-bottom:0;'>Ngày đi: <span style='text-decoration:underline;'>{ticket._tripDate}<\/span><\/p><h3 style='margin:2px 0px; margin-bottom:10px;'>{ticket._tripHour}<\/h3><\/div><div class='col-xs-7 text-right' style='padding-left:0;'><p style='margin-bottom:0;'>Ghế ({ticket._numSeat}):<\/p><h3 style='margin:2px 0px; margin-bottom:10px;'>{ticket._seatCodes}<\/h3><\/div><\/div><div class='row'><div class='col-xs-5' style='padding-right:0;'><p>Giá: {ticket._fare}/vé<\/p><\/div> <div class='col-xs-7 text-right' style='padding-left:0;'><p>Tổng tiền: <b>{ticket._total}<\/b> đ<\/p><\/div><\/div><hr style='border:1px #000 solid; margin:0'/><div class='row'><div class='col-xs-12'><h5 style='text-transform: uppercase;'>{ticket._cname} &nbsp; {ticket._cphone}<\/h5><p>{ticket._note}<\/p><p>Đón: {ticket._pick}<\/p><p>Nhân viên: {ticket._user}<\/p><p>Vé mua rồi miễn trả. Quý khách vui lòng có mặt trước giờ khởi hành 15 phút. <\/p><\/div><div class='col-xs-9 text-center' style='margin-top:5px;'><img class='img-responsive' src='http://nhaxe.vexere.com/Images/eticket/vxr-ve.jpg' alt=''/><\/div><\/div><\/div>",lg:"<div style='width:330px; margin: 0 auto; padding-left: 20px;'><div class='col-xs-12 text-center'><img class='img-responsive' src=http://nhaxe.vexere.com/Images/eticket/tienoanh.jpg' alt=''/><\/div><div class='row'><div class='col-xs-12'><p style='margin-top:5px;'>{ticket._phone}<br/>{ticket._address}<\/p><\/div><\/div><hr style='border:1px #000 solid; margin:0'/><div class='row'><div class='col-xs-5'><h5 style='margin-bottom:5px;'><span style='text-transform:uppercase; margin-bottom:5px;'>{ticket._fromArea}<\/span><\/h5><p>{ticket._from}<\/p><\/div><div class='col-xs-2'><h3 style='margin-top:10px;'>&#x2192;<\/h3><\/div><div class='col-xs-5 text-right'><h5 style='margin-bottom:5px;'><span style='text-transform:uppercase;'>{ticket._toArea}<\/span><\/h5><p>{ticket._to}<\/p><\/div><\/div><div class='row'><div class='col-xs-12'><h3 style='margin:2px 0px; margin-bottom:5px;font-size: 18px;'><small>Ngày đi: <span style='text-decoration:underline;'>{ticket._tripDate}<\/span><\/small>&nbsp;{ticket._tripHour}<\/h3><\/div><\/div><div class='row'><div class='col-xs-12'><h3 style='margin:2px 0px; margin-bottom:10px; font-size: 18px; line-height: 24px;'><small>Ghế ({ticket._numSeat}):<\/small>&nbsp;{ticket._seatCodes}<\/h3><\/div><\/div><div class='row'><div class='col-xs-5' style='padding-right:0;'><p>Giá: {ticket._fare}/vé<\/p><\/div> <div class='col-xs-7 text-right' style='padding-left:0;'><p>Tổng tiền: <b>{ticket._total}<\/b> đ<\/p><\/div><\/div><hr style='border:1px #000 solid; margin:0'/><div class='row'><div class='col-xs-12'><h5 style='text-transform: uppercase;'>{ticket._cname} &nbsp; {ticket._cphone}<\/h5><p>Đón: {ticket._pick}<\/p><p>Nhân viên: {ticket._user}<\/p><p>Vé mua rồi miễn trả. Quý khách vui lòng có mặt trước giờ khởi hành 15 phút. <\/p><\/div><div class='col-xs-9 text-center' style='margin-top:5px;'><img class='img-responsive' src='http://nhaxe.vexere.com/Images/eticket/vxr-ve.jpg' alt=''/><\/div><\/div><\/div>"},_eStyleUrl:"/Base/bootstrap-3.2.0/css/bootstrap.min.css",_pBreak:"<br />",_multiBarTpl:"<div class='chang-bottom'><nav class='navbar navbar-inverse navbar-fixed-bottom ghe-chang' role='navigation'><\/nav><a href='#' class='chang-di-close'><i class='glyphicon glyphicon-remove'><\/i> Đóng<\/a><div class='them-chang'><a href='#' class='btn-them-chang'><i class='glyphicon glyphicon-plus'><\/i><\/a><\/div><\/div>",_msTpl:"<li class='seat m-seat col-md-2 col-sm-4 col-xs-12' data-position='{seat._coach}_{seat._row}_{seat._col}'><div class='{seat._class}'><div class='clearfix'><div class='s-route-info'><small><i class='glyphicon glyphicon-record'><\/i><\/small>&nbsp;{seat._fromAreaCode}<br><small><i class='glyphicon glyphicon-map-marker'><\/i><\/small>&nbsp;{seat._toAreaCode}<\/div><div class='pick'>{seat._pInfo}<\/div><div class='note'>{seat._note}<\/div><\/div><div class='clearfix'><div class='buttons'>{seat.buttons}<\/div><div class='cinfo'><p class='name'>{seat._cname}<span class='numT'>{seat._nTicketPerTrip}<\/span><span>{seat._pmInfo}<\/span><\/p><p class='phone'>{seat._cphone}<\/p><\/div><\/div><\/div><\/li>",_isFBooking:["_cphone|_note"],_allowGroupByCode:!1,_hasBTWarning:!0,_wTpl:'<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;<\/span><span class="sr-only">Close<\/span><\/button>Lưu ý: hành khách <strong>{m._cname} - <span class="vred">{m._cphone}<\/span><\/strong>{m._content}<\/div>',_btwarningTpl:"<li>{t._sText} - <strong><span class='vred'>{t._numS}<\/span><\/strong> vé <strong><span class='vred'>{t._sCodes}<\/span><\/strong> / {t._total} / {t._tname} / <strong><span class='vred'>{t._time}<\/span><\/strong> ngày <strong><span class='vred'>{t._date}<\/span><\/strong><\/li>",_limitedDateBefore:1,_limitedMinuteBefore:1440,_copyField:["FullName","PhoneNumbers","PickupInfo","TransferInfo","Note","Fare","Code","FromArea","ToArea","TripDetailId","pIndex"],_copyFieldRequired:["PhoneNumbers","Note","Code"],_returnField:["FullName","PhoneNumbers"],_returnFieldRequired:["PhoneNumbers"],_sBar:'<div class="status-bar"><h6><span class="latest-act">Xem lịch sử thao tác<\/span><a class="btn-log slideout-menu-toggle" href="#"><i class="glyphicon glyphicon-align-justify"><\/i><\/a><\/h6><\/div>',_hLog:'<div class="list-log slideout-menu"><div class="log-content"><table class="table table-hover table-striped"><tbody><\/tbody><\/table><\/div><div class="form-group has-feedback search-log"><label class="control-label" for="hsearch">&nbsp;<\/label><input type="text" class="form-control input-sm" placeholder="Tìm" id="hsearch"><span class="glyphicon glyphicon-search form-control-feedback"><\/span> <\/div><\/div>',_hAct:{book:{vi:"Đặt vé"},update:{vi:"Cập nhật vé"},move:{vi:"Đổi vé"},cancel:{vi:"Hủy vé"},"print-ticket":{vi:"In vé"}},_lhTpl:"<span type='{h._type}' tid='{h._tid}' tdate='{h._tdate}' ttime='{h._ttime}' slabel='{h._s}'>{h._a}&nbsp;<strong class='vred'>{h._s}<\/strong>&nbsp;({h._tname}&nbsp;-&nbsp;{h._tdate}&nbsp;{h._ttime})&nbsp;lúc&nbsp;<strong>{h._t}&nbsp;ngày&nbsp;{h._d}<\/strong><\/span>",_mlhTpl:"<span tid='{h._ttid}' tdate='{h._ttdate}' ttime='{h._tttime}' slabel='{h._ts}'>{h._a}&nbsp;<strong class='vred'>{h._fs}&#8594;{h._ts}<\/strong>&nbsp;({h._ttname}&nbsp;-&nbsp;<strong>{h._ftdate}&nbsp;{h._fttime}&#8594;{h._ttdate}&nbsp;{h._tttime}<\/strong>)&nbsp;lúc&nbsp;<strong>{h._t}&nbsp;ngày&nbsp;{h._d}<\/strong><\/span>",_ihTpl:"<tr type='{h._type}' tid='{h._tid}' tdate='{h._tdate}' ttime='{h._ttime}' slabel='{h._s}'><td><h5><a href=''>{h._a}&nbsp;{h._s}<br/><small>{h._tname}&nbsp;chuyến&nbsp;{h._tdate} {h._ttime}<\/small><br/><small>Lúc {h._t} ngày {h._d}<\/small><\/a><\/h5><\/td><\/tr>",_mihTpl:"<tr tid='{h._ttid}' tdate='{h._ttdate}' ttime='{h._tttime}' slabel='{h._ts}'><td><h5><a href=''>{h._a}&nbsp;{h._fs}&#8594;{h._ts}<br/><small>{h._ftname}&nbsp;chuyến&nbsp;{h._ftdate} {h._fttime} &#8594; {h._ttdate} {h._tttime}<\/small><br/><small>Lúc {h._t} ngày {h._d}<\/small><\/a><\/h5><\/td><\/tr>",_hckKey:"Bl4rxRnk8x",_hlL:100,_ckExp:365,_stageTicketshowMButton:!1,_stageTicketLable:"VC",_fullStageTicketLable:"VTC",_hasNotification:!1,_nBar:'<div class="notice-bar"><h6><span class="notice"><\/span><\/h6><\/div>',_pSummaryTripInfo:!1,_pSummaryTripInfoPageBreak:!1,_tripInfo:"",_pSummaryPickupInfo:!1,_pSummaryPickupInfoPageBreak:!1,_sumPickupInfo:"",_pSNote:!1,_pSNoteCoachEffective:{},_pSNoteInfo:{},_tienKhachTitle:"<table class='table table-bordered table-striped list-ticket thong-ke tien-khach'><thead><tr class='bg-primary'><th>Văn phòng<\/th><th>Số lượng<\/th><th>Tổng tiền<\/th><\/tr><\/thead><tbody><\/tbody><\/table>",_tienKhachInput:"<tr><td>{_branchCode}<\/td><td>{_numTic}<\/td><td>{_totalFare}<\/td><\/tr>",_tienHangTitle:"<table class='table table-bordered table-striped list-ticket thong-ke tien-hang'><thead><tr class='bg-primary'><th style='width:94px;'>Văn phòng<\/th><th colspan='2'>Đã TT <span class='fr'>(SL)<\/span><\/th><th colspan='2'>Chưa TT <span class='fr'>(SL)<\/span><\/th><th style='width:140x;'>Tổng tiền<\/th><\/tr><\/thead><tbody><\/tbody><\/table>",_tienHangInput:'<tr class=\'branch-pro\'><td style=\'line-height:30px;\' name=\'BranchCode\' data-branch-code=\'{_branchCode}\'>{_branchCode}<\/td><td><div class="input-group col-md-12"><input name="BranchPaid" type="text" placeholder="Đã TT" class="form-control input-bd0 input-sm" value="{_moneyBranchProPaid}"><div class="input-group-addon">đ<\/div><\/div><\/td><td style="width:60px;"><input name="NumBranchPaid" type="text" placeholder="SL" class="form-control input-bd0 input-sm" value="{_numBranchProPaid}"><\/td><td><div class=\'input-group col-md-12\'><input name=\'BranchNotPaid\' type=\'text\' placeholder=\'Chưa TT\' class=\'form-control input-bd0 input-sm\' value=\'{_moneyBranchProNotPaid}\'><div class=\'input-group-addon\'>đ<\/div><\/div><\/td><td style="width:60px;"><input name="NumBranchNotPaid" type="text" placeholder="SL" class="form-control input-bd0 input-sm" value="{_numBranchProNotPaid}"><\/td><td name="TotalFareBranch" style="line-height:30px;">{_totalMoneyBranchFormat} đ<\/td><\/tr>',_availableSeatOn:!0,_updateFormValidatingConditions:["phone","note","payment&fare[>0]"],_updateFormValidatingErrorMessage:"Thông tin cập nhật chưa đúng! Vui lòng kiểm tra lại."},_bkDict=$.extend({},_dict);$.widget("custom.vbooking",{options:{cid:0,aid:0,uid:0,un:"",serviceUrl:null,backupBaseUrl:null,baseUrl:null,sTimeZoneOffset:0,cite:"",cice:"",cifne:"",cisne:"",pilne:"",aite:"",aice:"",aisne:"",aifne:"",rights:""},_$container:null,_$toolbar:null,_$tripInfo:null,_$sheet:null,_$notComeSheet:null,_$cancelSheet:null,_numCoach:1,_numRow:7,_numCol:5,_info:null,_data:null,_cTripIndex:0,_cTripId:0,_cFromId:0,_cToId:0,_cDefaultFromId:0,_cDefaultToId:0,_cTripDate:null,_cTripTime:null,_cTripBus:0,_cStageBinary:"",_cStageCode:0,_cMaxStageCode:0,_m:null,_nc:null,_c:null,_cphoneSt:null,_cCodeSt:null,_sOffsetMinute:0,_grid:!0,_rBookingOnPast:!1,_create:function(){FlatObj.W=this;this._initializeFields();this._createContainer();this._createToolBar();this._createSheet()},_initializeFields:function(){this._data=[];this._info=[];this._m=[];this._nc=[];this._c=[];this._cphoneSt={};this._cCodeSt={};this._cFromId=0;this._cToId=0;var n=new Date,t=n.getTimezoneOffset(),i=vPrsDt(this.options.sTime),r=Math.floor((i-n)/6e4);n.setHours(0);n.setMinutes(0);n.setSeconds(0);this._cTripDate=n;$("body").trigger("changeCTripDate",n);this._sOffsetMinute=parseInt(this.options.sTimeZoneOffset)+t+r},_createContainer:function(){this._$container=$(".vbooking-container")},_createToolBar:function(){this._$toolbar=$(".vbooking-toolbar")},_createSheet:function(){this._$tripInfo=$("<div />").addClass("vbooking-info col-md-12 col-sm-12 col-xs-12 clearfix").appendTo(this._$container);this._$sheet=$("<div />").addClass("vbooking-sheet col-md-12 col-sm-12 col-xs-12 clearfix").appendTo(this._$container);this._$notComeSheet=$("<div />").addClass("vbooking-ncsheet col-md-12 col-sm-12 col-xs-12 clearfix").appendTo(this._$container);this._$cancelSheet=$("<div />").addClass("vbooking-csheet col-md-12 col-sm-12 col-xs-12 clearfix").appendTo(this._$container)},load:function(){return this._beginEvent(),this._initializeFields(),this.reload(),this._reloadInfo(),this._endEvent(),{x:this}},startNotification:function(){this._startNotification()},autoRefresh:function(){var n=this;$("body").on("click",function(){})},reload:function(){var n=this,t,i;$(".select-layout > button").removeClass("active");t=$(".select-layout > button.btn-grid");t.length>0&&(t.hasClass("active")||(t.addClass("active"),n._grid=!0));typeof n.options.rid!="undefined"&&(n._cTripId=n.options.rid);n._reloadTrigger();n._reloadData(function(){(n.allowCompEvent||n.allowAgentTripEvent)&&(alert("Không tìm thấy chuyến, vui lòng chọn Company khác"),$("body").trigger("tripNotFound"))});i=function(){FlatObj.LFTime=!1};typeof n._reloadFilter=="function"?(n._reloadFilter(),n._reloadFrame(),n._reloadAllowedSeats(),n._isOrderring=!1,n._reloadSheet(i),$('ul.vbooking-list a[data-tab="bks"]').trigger("click"),FlatObj.LDefTrip=!1):(console.error("BKS load fail. Trying again...."),location.reload())},_reloadFlatObj:function(){var n=this;return(FlatObj.W=this,n._data[n._cTripIndex]||(n._cTripIndex=0),FlatObj.cRoute=n._data[n._cTripIndex],!FlatObj.cRoute)?!1:(FlatObj.cTrip=FlatObj.cRoute.Ts[FlatObj.W._cTripTime][0],FlatObj.SP=n._data[n._cTripIndex].StopPoints,!0)},destroy:function(){this.element.empty();$.Widget.prototype.destroy.call(this)},_reloadTrigger:function(){$("body").trigger("applyBooking",this.options)},_beginEvent:function(){var n=this;$("#agtTrips").find(".jtable").on("mouseenter",function(){});$("body").on("compChanged",function(t,i){n.allowCompEvent&&typeof i!="undefined"&&i!=null&&(FlatObj.LFTime=!0,FlatObj.FTripGetTrip=!1,FlatObj.LDefTrip=!0,n._clearSelectedItem(),n._resetSeatStack())});$("body").on("tripChanged",function(t,i){n.allowAgentTripEvent&&(n._setOption("cid",i.CompId),n._setOption("rid",i.Id),n.reload(),$("body").find("select[name=TripId]").trigger("change"))});$("body").on("fTripReady",function(t){t.cb!=undefined?n._mapData(t.r,t.cb):n._mapData(t.r);n._data[n._cTripIndex]&&(FlatObj.SP=n._data[n._cTripIndex].StopPoints);FlatObj.cRoute=n._data[n._cTripIndex];FlatObj.FTripGetTrip=!0});$("body").on("fTripChange",function(n){console.log(n)})},_endEvent:function(){this.allowCompEvent=!0;this.allowAgentTripEvent=!0},_setOption:function(n,t){this.options[n]=t},_submitAction:function(n,t){vRqs(n,t,{async:!1})},_submitAsyncAction:function(n,t){vRqs(n,t)},_reloadInfo:function(){var n=this,t=n._createGetInfoObj(),i=function(t,i,r){t!=1||r<=0||n._mapInfo(i)};n._submitAction(t,i)},_createGetInfoObj:function(){var t=this,n={};return n._a="fGetCompany",n._c={BaseId:t.options.cid,Type:"($x = 2 OR $x = 3)",IsPrgStatus:1},n._f="Id, Type, Code, Name, AddressInfo, PhoneInfo",n},_mapInfo:function(n){var i=this,r,u,t,f;i._info=n;r=[];u=[];$.each(n,function(n,t){var i={value:t[0],text:$.trim(t[3])};t[1]==2?r.push(i):t[1]==3&&u.push(i)});r.sort(function(n,t){return n.text.localeCompare(t.text)});u.sort(function(n,t){return n.text.localeCompare(t.text)});$.each(r,function(n,t){i._$updateForm.find("select[name=BranchName]").append($("<option />",{value:t.value}).text(t.text))});t=i._$updateForm.find("select[name=AgentName]");f=t.find("option:first-child");t.empty();t.append(f);$.each(u,function(n,i){t.append($("<option />",{value:i.value}).text(i.text))});i._$updateForm.find("select[name=AgentName]").chosen({width:"100%",search_contains:!0})},_reloadData:function(n){var t=this,r=t._createGetFrameObj(),u=function(i,r,u){if(i!=1||u<=0){t._clearSheet();t._notFoundResult();n!=null&&n.call(t);return}t._mapData(r);t._data[t._cTripIndex]&&(FlatObj.SP=t._data[t._cTripIndex].StopPoints);FlatObj.cRoute=t._data[t._cTripIndex]},i;FlatObj.FTripGetTrip||(i=jQuery.Event("fTripGetTrip"),i.in=t._cTripDate,typeof n=="function"&&FlatObj.RBePrint&&(i.cb=n),$("body").trigger(i))},_createGetFrameObj:function(){var n=this,i,t;return n._cTripDate.setHours(0),n._cTripDate.setMinutes(0),n._cTripDate.setSeconds(0),i="(type = 1 or (type = 2 and Time is not null and $x = N'"+n._cTripDate.toFormatString("iso")+"')) order by type,name asc",t={},t._a="fGetTrip",t._c={CompId:n.options.cid,IsPrgStatus:"$x != 3",Date:i},t._f="Id, Name, Info, SeatTemplateInfo, FareInfo, StatusInfo, BaseId, Type, Time, Alias, TeamInfo, VehicleInfo, FromArea, ToArea, Note, RouteInfo, SeatSummaryInfo, TotalSeats, ClosedStatus, PassengerMoney, ProductMoney, FeeMoney, BranchReceiveProduct, RealDepartureTime, PickedPointsInfo, TransferPointsInfo, NewFare",t},_parseStopPoints:function(n){var i={idx:{},data:[]},t=0;return $.each(n,function(n,r){if(t==0){t++;return}r=r.split("|");i.idx[r[0]]=t-1;i.data.push({Id:r[0],Type:r[1],Code:r[2],Name:r[3],Address:r[4],Distance:r[5],Hour:parseInt(r[6]),Minute:parseInt(r[7]),Order:typeof r[8]=="undefined"?0:r[8]});t++}),i},_mapData:function(n,t){var i=this,r;i._data=[];i._points=[];r=[];$.each(n,function(n,t){var o=parseInt(t[6]),f=parseInt(t[0]),a,e,c,l,w;if(isNaN(o)||o==0||(f=o),typeof _dict._hasBlockTripByBranch=="undefined"||!_dict._hasBlockTripByBranch||typeof _dict._blockTripByBranch=="undefined"||typeof _dict._blockTripByBranch[app.aid]=="undefined"||_dict._blockTripByBranch[app.aid].indexOf(f)==-1){a=parseInt(t[5]);e=parseInt(t[9]);isNaN(e)&&(e=0);var v=a,y=parseInt(t[7]),u=r.indexOf(f);u==-1&&(u=r.push(f)-1,i._data[u]={Id:f,Name:t[1],FromArea:t[12],ToArea:t[13],StopPoints:t[15]?i._parseStopPoints(t[15].split("~")):i._parseStopPoints([]),FareInfo:t[4],Ts:{},BranchReceiveProduct:t[22],PickedPointsInfo:t[24],TransferPointsInfo:t[25]});var s=0,h=t[3].split("~")[1],p=t[3].split("~")[0];typeof h!="undefined"&&h!=null&&(s=parseInt(h.split("|")[2]));c=t[17];l=t[16];1==y?t[2]!=null&&(w=t[2].split("~"),$.each(w,function(n,r){var f=r.split("|")[0];typeof i._data[u].Ts[f]=="undefined"&&(i._data[u].Ts[f]=[]);i._data[u].Ts[f][e]={T:t[3],SeatTemplateId:p,F:t[4],S:v,NS:s,BS:l,TS:c,ClosedStatus:t[18],RealDepartureTime:t[23]}})):2==y&&t[8]!=null&&t[8]!=""&&(typeof i._data[u].Ts[t[8]]=="undefined"&&(i._data[u].Ts[t[8]]=[]),i._data[u].Ts[t[8]][e]={T:t[3],SeatTemplateId:p,F:vIsEstStr(t[26])?t[26]:t[4],S:v,NS:s,Dr:t[10],V:t[11],N:t[14],BS:l,TS:c,TeamInfo:t[10],TripDetailId:t[0],ClosedStatus:t[18],PassengerMoney:t[19],ProductMoney:t[20],FeeMoney:t[21],RealDepartureTime:t[23]})}});t!=undefined&&t.call()},_reloadFrame:function(){var n=this;n._data[n._cTripIndex]&&n._mapSeatToMatrix(n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].T)},_mapSeatToMatrix:function(n){var t=this,i,f,e,r,o;for(t._m=[],i=n.split("~"),t._numCoach=parseInt(i[1].split("|")[1]),f=2;f<4;f++){var h=i[f].split("|"),c=parseInt(h[1]),l=parseInt(h[2]);t._numRow<c&&(t._numRow=c);t._numCol<l&&(t._numCol=l)}for(e=t._numCoach+1;e<i.length;e++)if(r=i[e].split("|"),o=t._createSeatFromRecord(r),!$.isEmptyObject(o)){var u=parseInt(r[5]),s=parseInt(r[6]),a=parseInt(r[7]);typeof t._m[u-1]=="undefined"&&(t._m[u-1]=[]);typeof t._m[u-1][s-1]=="undefined"&&(t._m[u-1][s-1]=[]);t._m[u-1][s-1][a-1]=o}app.sheetMatrix=t._m},_reloadSheet:function(n){var t=this,r,i,u;return(FlatObj.FTripGetTrip=!1,t._$cancelSheet.show(),$("button.btn-thong-ke").removeClass("active"),t._$sheet.removeClass("thong-ke-tb"),r=t._reloadFlatObj(),!r)?!1:(i=t._createGetSeatObj(),u=function(i,r,u){i==1&&(t._clearTicket(),t._clearCancelled(),t._clearNotCome(),t._checkAllowedSeats(),u>0&&t._mapTicketToSeat(r),t._renderTripInfo(),t._isOrderring?(t._renderPickupTicket(),t._hasMergeTransfer()&&t._reloadMergeTransferTicket(),t._renderTransferTicket()):t._grid?(t._renderSeatTemplate(),t._renderCancelledTicket(),t._renderNotComeTicket()):(t._lrenderSeatTemplate(),t._lrenderCancelledTicket()),typeof n!="undefined"&&typeof n=="function"&&n.call(),oRq.iAc&&t._resetAjaxRequest())},$.isEmptyObject(i)?t._reloadFrame():vRqu(i,u),!0)},_createGetSeatObj:function(){var t=this,i=t._getDepartureTime(),n={};return $.isEmptyObject(i)?($("body").trigger("timeNotFound"),{}):(n._a="fGetTicket",n._c={TripId:t._cTripId,TripDate:i.toFormatString("iso"),Status:"(($x) IN("+_dict._tks.join()+"))"},n._f=_dict._tgF.join(),n)},_clearTicket:function(){var n=this;n._cphoneSt=[];n._cCodeSt=[];$.each(n._m,function(n,t){typeof t!="undefined"&&$.each(t,function(n,t){typeof t!="undefined"&&$.each(t,function(n,t){typeof t!="undefined"&&t!=null&&(t._tickets=[])})})})},_clearCancelled:function(){var n=this;n._c=[];n._$cancelSheet.empty()},_clearNotCome:function(){var n=this;n._nc=[];n._$notComeSheet.empty()},_reloadAllowedSeats:function(){var n=this,t,i;n._allowedSeats=[];n._allAllowedSeats=[];t=n._createAllowedSeatObj();i=function(t,i,r){if(t!=1){n._allowBookAllSeat=!0;return}r>=1?n._mapDataAllowedSeat(i):n._allowBookAllSeat=!0};this._submitAction(t,i)},_createAllowedSeatObj:function(){var n=this;return{_a:"fGetBus_Tickets_Status",_c:{XTypeId:"($x in (2,5))",XTripId:n._cTripId,XStatus:1,IsPrgStatus:"($x is null or $x != 3)"},_f:"Id,XTypeId,XAgentId,XBranchId,XOperatorId,XCompanyId,XRouteId,XTripId,XDate,XTime,XStatus,Info,TimeLimit"}},_mapDataAllowedSeat:function(n){var t=this;t._allAllowedSeats=[];$.each(n,function(n,i){var e=vIsEstStr(i[8])?vGtDtObj(i[8]):null,r=i[9],o=i[11],s=i[12],u="",f;u=vIsEstStr(r)?vPrsTm(r):"";f={Date:e,Time:u,Info:o,TimeLimit:parseInt(i[12])};t._allAllowedSeats.push(f)})},_checkAllowedSeats:function(){var n=this,t=!1,r=!1,i,u;if($.each(n._allAllowedSeats,function(i,u){r||($.isEmptyObject(u.Date)?vIsEstStr(u.Time)&&u.Time!=n._cTripTime||(t=n._getAllowedSeats(u)):vGetDateOnly(u.Date)==vDtToStr("dd-mm-yyyy",n._cTripDate)&&(vIsEstStr(u.Time)&&u.Time!=n._cTripTime||(t=n._getAllowedSeats(u),u.Time==n._cTripTime&&(r=!0))))}),t){i=new Date;i.addMinutes(app.onlineTimeLimit);u=n._cTripDate;u<i&&(n._allowBookAllSeat=!0,n._allowedSeats=[]);return}n._allowBookAllSeat=!0;n._allowedSeats=[];return},_getAllowedSeats:function(n){var t=this,e=n.Info,u;if(t._allowBookAllSeat=!0,t._allowedSeats=[],vIsEstStr(e)&&e.indexOf("~")>0){var r=e.split("~"),s=parseInt(r[0]),h=parseInt(r[1]);if(s==1&&h<1e3){for(u=2;u<r.length;u++){var f=r[u].split("|"),i=parseInt(f[1]),o=parseInt(f[2]),c=parseInt(f[3]);typeof t._allowedSeats[i]=="undefined"&&(t._allowedSeats[i]=[]);typeof t._allowedSeats[i][o]=="undefined"&&(t._allowedSeats[i][o]=[]);t._allowedSeats[i][o][c]=f[0]}return t._allowBookAllSeat=!1,app.onlineTimeLimit=n.TimeLimit,!0}}return!1},_mapTicketToSeat:function(n){var t=this;$.each(n,function(n,i){var r=t._createTicketFromRecord(i),f,o,s;if(!$.isEmptyObject(r)){var h=i[4].split("|"),u=parseInt(h[1]),e=parseInt(h[2]),c=parseInt(h[3]);isNaN(u)||isNaN(e)||isNaN(c)||typeof t._m[u-1]!="undefined"&&typeof t._m[u-1][e-1]!="undefined"&&typeof t._m[u-1][e-1][c-1]!="undefined"&&(f=t._m[u-1][e-1][c-1],r._isNotCome()?(o=f._clone(),o._tickets=[],o._addTicket(r,t._cStageCode),typeof t._nc[u-1]=="undefined"&&(t._nc[u-1]=[]),t._nc[u-1].push(o)):r._isCancelled()?(r._pcode==null||r._pcode=="")&&(s=f._clone(),s._tickets=[],s._addTicket(r,t._cStageCode),typeof t._c[u-1]=="undefined"&&(t._c[u-1]=[]),t._c[u-1].push(s)):r._isValid()||r._isOpen()||f._isAvailable()&&(f._addTicket(r,t._cStageCode),t._updateCPhoneSt(f,r),t._updateCCodeSt(f,r)))}})},_getCurrentTripInfo:function(){var w,s,h,it,rt,ut,c,ft,l,ht,a,ct,lt;if(FlatObj.cTripInfo!=null)return FlatObj.cTripInfo;var f=this,n={_vehicleNumber:"",_driverName:"",_assistantName:"",_guideName:""},t=f._data[f._cTripIndex].Ts[f._cTripTime][f._cTripBus];if(vIsEstStr(t.T)&&(n._vehicleName=vIsEstStr(t.V)&&!vIsEstStr(t.V.split("~")[1].split("|")[3])?t.V.split("~")[1].split("|")[3]:t.T.split("~")[1].split("|")[5]),vIsEstStr(t.V)&&(n._vehicleNumber=t.V.split("~")[1].split("|")[2]),vIsEstStr(t.Dr)){w=t.Dr.split("~");w.shift();var b=[],k=[],d=[];$.each(w,function(n,t){if(typeof t!="undefined"&&t!=null){var i=t.split("|");switch(parseInt(i[0])){case 2:b.push(i[2]);break;case 4:k.push(i[2]);break;case 5:d.push(i[2])}}});n._driverName=b.length>0?b.join(", "):"";n._assistantName=k.length>0?k.join(", "):"";n._guideName=d.length>0?d.join(", "):""}vIsEstStr(t.N)&&(n._note='<br/><strong class="vred">Chú ý:&nbsp;'+t.N+"<\/strong>");var v=0,o=0,nt=0,i={},y={},r={},g={},e=0,u=0;if($.each(f._m,function(n,t){typeof t!="undefined"&&$.each(t,function(n,t){typeof t!="undefined"&&$.each(t,function(n,t){typeof t!="undefined"&&t!=null&&t._isAvailable()&&(t._hasTicket()?$.each(t._tickets,function(n,t){var f,h,c,l,a,s;if(t._isPaid()||t._isPass()){if(f=t._getPaymentInfo(),!$.isEmptyObject(f))switch(f.type){case 1:case 6:typeof f.info!="undefined"&&(h=f.info._code,typeof i[h]=="undefined"&&(i[h]=0,r[h]=0),i[h]++,r[h]+=t._fare,u+=t._fare,e+=t._fare);break;case 2:case 3:case 4:c=f.sname;typeof i[c]=="undefined"&&(i[c]=0,r[c]=0);i[c]++;r[c]+=t._fare;e+=t._fare;u+=t._fare;break;case 5:case 7:l=f.sname;typeof i[l]=="undefined"&&(i[l]=0,r[l]=0);i[l]++;r[l]+=t._fare;e+=t._fare;u+=t._fare;break;case 8:case 9:a=f.sname;typeof i[a]=="undefined"&&(i[a]=0,r[a]=0);i[a]++;r[a]+=0;u+=0;break;case 10:typeof i[f.sname]=="undefined"&&(i[f.sname]=0,r[f.sname]=0);i[f.sname]++;r[f.sname]+=t._fare;u+=t._fare;e+=t._fare}v++}else t._isBooking()&&(s=t._getAgentInfo(),$.isEmptyObject(s)||(typeof y[s._code]=="undefined"&&(y[s._code]=0,g[s._code]=0),y[s._code]++,g[s._code]+=t._fare,u+=t._fare),o++)}):nt++)})})}),n._numPaid=v,n._numBooking=o,n._numAvail=nt,v>0&&(n._numPaidPerType=[],n._totalPaidPerType=[],n._tkNumPaidPerType=[],$.each(i,function(t,i){typeof i!="undefined"&&($.each(r,function(r,u){r==t&&(n._totalPaidPerType.push(t+":&nbsp;"+i+"&nbsp;-&nbsp;"+u.toMn()+" đ"),n._tkNumPaidPerType.push(t+"|"+i+"|"+u))}),n._numPaidPerType.push(t+":&nbsp;"+i))}),n._numPaidPerType="&nbsp;("+n._numPaidPerType.join()+")",n._totalPaidPerType=n._totalPaidPerType.join(", &nbsp;")),o>0&&(n._numBookingPerAgent=[],n._totalBookingPerAgent=[],$.each(y,function(t,i){typeof i!="undefined"&&($.each(g,function(r,u){r==t&&n._totalBookingPerAgent.push(t+":&nbsp;"+i+"&nbsp;-&nbsp;"+u.toMn()+"đ")}),n._numBookingPerAgent.push(t+":&nbsp;"+i))}),n._numBookingPerAgent="&nbsp;("+n._numBookingPerAgent.join()+")",n._totalBookingPerAgent=n._totalBookingPerAgent.join(", ")),n._total=v+o,n._totalPaid=e,n._numBooking=o,n._totalMoney=u!=0?u.toMn()+" đ":"",n._mainFareTienKhach=e,n._anotherFareTienKhach=0,n._nameAnotherFareTienKhach="",n._feeTienKhach=0,n._nameFeeTienKhach="",t.PassengerMoney!=null){var at=t.PassengerMoney.indexOf("~"),tt=t.PassengerMoney.substr(at,t.PassengerMoney.length).split("|"),p=tt[1].split("##");n._nameAnotherFareTienKhach=p[0]!=null?p[0]:"";n._anotherFareTienKhach=p[1]!=null?p[1].toNum():0;s=tt[2].split("##");n._nameFeeTienKhach=s[0]!=null?s[0]:"";n._feeTienKhach=s[1]!=null?s[1].toNum():0}if(n._branchReceiveProduct=[],h=f._data[f._cTripIndex].BranchReceiveProduct,h!=null&&(it=h.indexOf("~"),rt=h.substr(it+1,h.length).split("~"),$.each(rt,function(t,i){var r=i.split("|"),u={_id:r[0],_code:r[2]};n._branchReceiveProduct.push(u)})),n._numPickedProPaid=0,n._moneyPickedProPaid=0,n._numPickedProNotPaid=0,n._moneyPickedProNotPaid=0,n._branchProduct=[],n._totalMoneyBranchNotPaid=0,n._totalMoneyBranchPaid=0,n._totalNumBranchNotPaid=0,n._totalNumBranchPaid=0,n._feeTienHang=0,n._nameFeeTienHang="",t.ProductMoney!=null){ut=t.ProductMoney.indexOf("~");c=t.ProductMoney.substr(ut+1,t.ProductMoney.length).split("~");vIsEstStr(c[0])&&(ft=c[0].split(","),$.each(ft,function(t,i){var e=i.substr(0,i.indexOf(":")),o=i.substr(i.indexOf(":")+1,i.length),f=o.split("##"),r=f[0].split("|"),u=f[1].split("|"),s={_branchCode:e,_numBranchProPaid:r[0].toNum(),_moneyBranchProPaid:r[1].toNum(),_numBranchProNotPaid:u[0].toNum(),_moneyBranchProNotPaid:u[1].toNum()};n._branchProduct.push(s);n._totalMoneyBranchNotPaid+=u[1].toNum();n._totalMoneyBranchPaid+=r[1].toNum();n._totalNumBranchNotPaid+=u[0].toNum();n._totalNumBranchPaid+=r[0].toNum()}));var et=c[1].split("##"),ot=et[0].split("|"),st=et[1].split("|");n._numPickedProPaid=ot[0].toNum();n._moneyPickedProPaid=ot[1].toNum();n._numPickedProNotPaid=st[0].toNum();n._moneyPickedProNotPaid=st[1].toNum();l=c[2].split("##");n._nameFeeTienHang=l[0]!=null?l[0]:"";n._feeTienHang=l[1]!=null?l[1].toNum():0}return n._tollFee=0,n._washFee=0,n._eatFee=0,n._anotherFee=[],t.FeeMoney!=null&&(ht=t.FeeMoney.indexOf("~"),a=t.FeeMoney.substr(ht+1,t.FeeMoney.length).split("~"),n._tollFee=a[0].toNum(),n._washFee=a[1].toNum(),n._eatFee=a[2].toNum(),ct=a[3],lt=ct.split("##"),$.each(lt,function(t,i){var r=i.split("|"),u={_index:r[0],_name:r[1]==null?"":r[1],_money:r[2]==null?0:r[2]};n._anotherFee.push(u)})),n},_resetAjaxRequest:function(){vRqz()},_renderSeatTemplate:function(){var n=this,s=n._data[n._cTripIndex].Ts[n._cTripTime][0].ClosedStatus,h=n._data[n._cTripIndex].Ts[n._cTripTime][0].TripDetailId,f="",i=n._data[n._cTripIndex].Ts[n._cTripTime][0].V,e,r,u;typeof i!="undefined"&&i!=null&&(e=i.substr(i.indexOf("~")+1,i.length).split("|"),f=e[2]);n._clearSheet();r=n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].NS;u=null;typeof _dict._specialPos!="undefined"&&typeof _dict._specialPos[r]!="undefined"&&(u=_dict._specialPos[r]);var c=n._transformSeatMatrix(u),o=0,l=n._hasBookingPermission(),t=!0;$.each(c,function(i,r){if(typeof r!="undefined"){var u=n._createCoach(n._$sheet).addClass(_dict._g[n._numCoach-1]);n._numCoach>1&&u.addClass(_dict._chcl[o%2]);$.each(r,function(i,r){typeof r!="undefined"&&$.each(r,function(i,r){var e,a,y,p,o,v,c;typeof r!="undefined"&&r!=null&&(e=r._getCurrentTicket(),a=0,$.isEmptyObject(e)||(_dict._allowGroupByCode?typeof n._cCodeSt[e._getTicketCode()]!="undefined"&&(a=n._cCodeSt[e._getTicketCode()].length):typeof n._cphoneSt[e._getDefaultPhoneNumber()]!="undefined"&&(a=n._cphoneSt[e._getDefaultPhoneNumber()].length)),y=n._data[n._cTripIndex].StopPoints.data.length,p=n._isStageBooking(),n._allowBookAllSeat?t=!1:(t=typeof n._allowedSeats[r._coach]!="undefined"&&typeof n._allowedSeats[r._coach][r._row]!="undefined"&&typeof n._allowedSeats[r._coach][r._row][r._col]!="undefined"?!1:!0,app.cid!=app.vid&&(t=!t)),o=r._renderSeat(a,l,n._cStageCode,y,n._data[n._cTripIndex].StopPoints,p,n._cMaxStageCode,s,"",h,f,t,n._cTripId),n._fMoving?(v=!1,$.each(n._movingStack,function(n,t){if(!v){var i=t._getCurrentTicket();i._id==e._id&&(v=!0)}}),v&&o.addClass(_dict._slc[0])):n._existingSeatStack(r)&&o.addClass("selected"),r._isAvailable()&&(e._type!=2||e._type==2&&app.rights.indexOf($.rights.bEdtOnlTic.val)>=0)&&n._bindEventOnSeat(o,r),c=n._data[n._cTripIndex].Ts[n._cTripTime][0].SeatTemplateId,_dict._specialNumColBySeatTemplateId!=undefined&&_dict._specialNumColBySeatTemplateId[c]!=undefined?o.addClass(_dict._g[_dict._specialNumColBySeatTemplateId[c]-1]).addClass(_dict._sg[_dict._specialNumColBySeatTemplateId[c]-1]).addClass(_dict._mg[_dict._specialNumColBySeatTemplateId[c]-1]):o.addClass(_dict._g[_dict._tplNumCol-1]).addClass(_dict._sg[_dict._tplNumCol-1]).addClass(_dict._mg[_dict._tplNumCol-1]),u.append(o))})});o++}});n._bindNumStageTicketsTooltips();n._fMoving?n._bindEventMoving():n._hasCopyTicket?n._bindEventCopying():n._hasBookReturnTicket&&n._bindEventBookReturnTicket()},_renderTripInfo:function(){var n=this;FlatObj.LFTime&&(FlatObj.FTripGetTrip=!0);n._reloadData();n._$tripInfo.empty();FlatObj.cTripInfo=null;FlatObj.cTripInfo=n._getCurrentTripInfo();var i=FlatObj.cTripInfo,t={trip:i},r=n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].ClosedStatus,u=n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].TripDetailId;if(u)switch(r){case 1:n._hideXuatBenButton();n._$tripInfo.html(vtpl(_dict._tInfoClosedTpl,t));break;case 2:n._hideXuatBenButton();n._$tripInfo.html(vtpl(_dict._tInfoChotPhoiTpl,t));break;default:n._showXuatBenButton();n._$tripInfo.html(vtpl(_dict._tInfoTpl,t))}else n._showXuatBenButton(),n._$tripInfo.html(vtpl(_dict._tInfoTpl,t))},_clearSheet:function(){this._$sheet.empty()},_createNoSeat:function(){return $("<li />").addClass("seat noseat")},_createSeatFromRecord:function(n){var t={};return _dict._ts.indexOf(parseInt(n[2]))!=-1&&(t=new S(parseInt(n[5]),parseInt(n[6]),parseInt(n[7]),parseInt(n[0]),"seat",n[3],parseInt(n[2]))),t},_createTicketFromRecord:function(n){var v=this,y=parseInt(n[8]),p=parseInt(n[22]),i,r,u;if(p==v._cTripBus){var w=parseInt(n[0]),b=vPrsDt(n[5]),k=vPrsDt(n[6]),f=parseInt(n[9]);isNaN(f)&&(f=0);var d=n[10],g=n[11],nt=n[12],e=n[13];null==e&&(e="");var tt=n[14],it=n[15],rt=n[16],ut=vPrsDt(n[17]),ft=vPrsDt(n[18]),et=vPrsDt(n[19]),ot=n[20],o=parseInt(n[21]);isNaN(o)&&(o=0);i=parseInt(n[26]);isNaN(i)&&(i=0);r=parseInt(n[27]);isNaN(r)&&(r=0);u=parseInt(n[29]);isNaN(u)&&(u=0);var st=n[23],ht=n[24],ct=parseInt(n[25]),lt=parseInt(n[1]),at=vPrsDt(n[3]),h=0,c="",l="",t=n[7];t!=null&&(t=t.split("|"),h=parseInt(t[2]),c=t[3],l=t[4]);var vt=n[28],yt=n[29],s=parseInt(n[30]);isNaN(s)&&(s=1);var pt=n[32],wt=n[33],bt=n[34],kt=n[35],dt=n[36],gt=n[37],ni=n[38],a=new T(w,at,h,c,l,y,b,k,f,d,g,nt,e,tt,it,rt,ut,ft,et,ot,o,st,ht,ct,lt,i,r,vt,yt,s,u,pt,wt,bt,kt,dt);return a.agentId=n[2],a}return{}},_createCoach:function(n){return $("<ul />").addClass("coach vbooking-coach").appendTo(n)},_notFoundResult:function(){var n=this;$("<div />").addClass(_dict._g[n._numCoach-1]).append($("<div />").addClass("alert alert-danger").html("<strong>Không tìm thấy chuyến.<\/strong>  Vui lòng chọn ngày giờ khác")).appendTo(n._$sheet)},_renderCancelledTicket:function(){var n=this,t,i;n._c.length>0&&(n._$cancelSheet.append($("<h4 />").addClass("sheet-title").html("Vé đã hủy")),t=0,i=n._hasBookingPermission(),$.each(n._c,function(r,u){var e,f;typeof u!="undefined"&&u!=null&&(e=n._createCoach(n._$cancelSheet).addClass(_dict._g[n._numCoach-1]),n._numCoach>1&&e.addClass(_dict._chcl[t%2]),f=_dict._tplNumCol,$.each(u,function(t,r){var o,u;if(typeof r!="undefined"&&r!=null&&(o=r._getCurrentTicket(),o._type!=2)){var h=n._data[n._cTripIndex].StopPoints.data.length,c=n._isStageBooking(),l=n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].ClosedStatus,a=n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].RealDepartureTime,s=r._renderSeat(0,i,n._cStageCode,h,n._data[n._cTripIndex].StopPoints,c,n._cMaxStageCode,l,a).addClass(_dict._g[f-1]).addClass(_dict._sg[f-1]).addClass(_dict._mg[f-1]);n._fMoving&&(u=!1,$.each(n._movingStack,function(n,t){if(!u){var i=t._getCurrentTicket();i._id==o._id&&(u=!0)}}),u&&s.addClass(_dict._slc[0]));n._bindEventOnSeat(s,r);e.append(s)}}),t++)}))},_renderNotComeTicket:function(){var n=this,t,i;n._nc.length>0&&(n._$notComeSheet.append($("<h4 />").addClass("sheet-title").html("Hành khách không đến")),t=0,i=n._hasBookingPermission(),$.each(n._nc,function(r,u){var e,f;typeof u!="undefined"&&u!=null&&(e=n._createCoach(n._$notComeSheet).addClass(_dict._g[n._numCoach-1]),n._numCoach>1&&e.addClass(_dict._chcl[t%2]),f=_dict._tplNumCol,$.each(u,function(t,r){if(typeof r!="undefined"&&r!=null){var o=n._data[n._cTripIndex].StopPoints.data.length,s=n._isStageBooking(),u=r._renderSeat(0,i,n._cStageCode,o,n._data[n._cTripIndex].StopPoints,s,n._cMaxStageCode).addClass(_dict._g[f-1]).addClass(_dict._sg[f-1]).addClass(_dict._mg[f-1]);n._bindEventOnSeat(u,r);e.append(u)}}),t++)}))},_createForm:function(n,t,i){var r=this,c=$("<form />").attr("id",n).attr("role","form"),h,o,a,s,u,v;typeof i!="undefined"&&c.addClass(i);var f=[],y=[],l=0,e=0;for($.each(t,function(n,t){var i=t[0],r=t[1];t[4]=="hidden"?y.push(t):(typeof f[i-1]=="undefined"&&(f[i-1]=[]),typeof f[i-1][r-1]=="undefined"&&(f[i-1][r-1]=[]),f[i-1][r-1].push(t));l<i&&(l=i);e<r&&(e=r)}),$.each(y,function(n,t){if(typeof t!="undefined"){var i=r._createFormInput(t[4],t[5],t[7]).addClass(t[6]);$.isEmptyObject(t[8])||$.each(t[8],function(n,t){i.attr(n,t)});c.append(i)}}),h=r._createFormContainer(),h.append($('<div class="alert alert-danger message-error" role="alert" style="margin:5px 0 0 0;display:none;" />')),h.append($('<div class="row" />').css("margin-top","0").append($('<div class="col-md-12 checkbox-route-point" />'))),o=0;o<l;o++)if(typeof f[o]!="undefined"){for(a=r._createFormRow(),s=0;s<e;s++)u=r._createFormCol(),typeof f[o][s]!="undefined"&&(v=!1,$.each(f[o][s],function(n,t){var i=r._createFormLabel(t[2]),f,c,l,o,a,y,p,w,h;i.length>0&&i.addClass("col-md-4 col-sm-4 col-xs-12 pl0");f=r._createFormInputGroup().addClass("col-md-8 col-sm-8 col-xs-12");switch(t[3]){case"input":c=r._createFormInput(t[4],t[5],t[7],t[8]).addClass(t[6]);l=r._createFormInputAddon(t[10]);switch(t[4]){case"checkbox":case"radio":c.append("&nbsp; "+t[2]);f.addClass("col-md-offset-4 col-sm-offset-4");break;default:u.append(i)}u.append(f.append(c).append(l));break;case"select":o=t[9];t[5]=="PaymentType"&&(o=[],$.each(_dict._pm,function(n,t){if(t[2]==1){var i=t[0],r=t[1][_dict._lang];o.push({Value:i,Text:r})}}));a=r._createFormSelect(t[5],o,t[7],t[4],t[8]).addClass(t[6]);u.append(i).append(f.append(a));break;case"textarea":y=r._createFormTextArea(t[5],t[7],t[8]).addClass(t[6]);u.append(i).append(f.append(y));break;case"p":p=r._createFormText(t[7],t[8]).addClass(t[6]);u.append(p);break;case"button":w=r._createFormButton(t[4],t[8]).addClass(t[6]).append(t[10]).append(t[5]);u.append(w)}typeof t[11]!="undefined"&&t[11].length>0&&(h=t[11][1]-t[11][0],u.addClass(_dict._g[e-h-1]).addClass(_dict._mg[e-h-1]),v=!0,s+=h)}),v||u.addClass(_dict._g[e-1]).addClass(_dict._sg[e-1]).addClass(_dict._mg[e-1])),a.append(u);h.append(a)}return c.append(h)},_createFormContainer:function(){return $("<div />").addClass("container-fluid")},_createFormRow:function(){return $("<div />").addClass("row")},_createFormCol:function(){return $("<div />")},_createFormLabel:function(n){return""!=n?$("<label />").addClass("col-sm-4 control-label").text(n):""},_createFormInputGroup:function(){return $("<div />").addClass("input-group")},_createFormInput:function(n,t,i,r){var u=$();switch(n){case"checkbox":case"radio":u=$("<label />").append($("<input />",{type:n,name:t,value:i}));break;default:u=$("<input />",{type:n,name:t,value:i})}return $.isEmptyObject(u)||typeof r=="undefined"||r==null||$.isEmptyObject(r)||$.each(r,function(n,t){u.attr(n,t)}),u},_createFormInputAddon:function(n){return""!=n?$("<div />").addClass("input-group-addon").append(n):""},_createFormSelect:function(n,t,i,r,u){var f=$("<select />",{name:n});return f.append($("<option />",{value:""}).text(r)),$.each(t,function(n,t){f.append($("<option />",{value:t.Value}).text(t.Text))}),typeof u!="undefined"&&u!=null&&($.isEmptyObject(u)||$.each(u,function(n,t){f.attr(n,t)})),f},_createFormTextArea:function(n,t,i){var r=$("<textarea />",{name:n}).val(t);return typeof i!="undefined"&&i!=null&&($.isEmptyObject(i)||$.each(i,function(n,t){r.attr(n,t)})),r},_createFormButton:function(n,t){var i=$("<button />",{type:n});return typeof t!="undefined"&&t!=null&&($.isEmptyObject(t)||$.each(t,function(n,t){i.attr(n,t)})),i},_createFormText:function(n,t){var i=$("<p />").text(n);return typeof t!="undefined"&&t!=null&&($.isEmptyObject(t)||$.each(t,function(n,t){i.attr(n,t)})),i},_resetForm:function(n){n.find("input[type=hidden]").val("");n.find("input[type=text], textarea, select").val("");n.find("input[type=checkbox]").prop("checked",!1);n.find("input[type=radio]").prop("checked",!1);n.find("div.has-error").removeClass("has-error");n.find("div.search-result").remove()},_convertFormDataToObj:function(n){var t=this,r={},i=null;return(t._hasCopyTicket||t._hasBookReturnTicket)&&(i=$(n).find(":input:disabled").removeAttr("disabled")),$.each($(n).serializeArray(),function(n,t){r[t.name]=t.value}),(t._hasCopyTicket||t._hasBookReturnTicket)&&i&&i.attr("disabled","disabled"),r},_getDepartureTime:function(){var i=this,t=i._cTripDate,n=i._cTripTime.split(":");return isNaN(parseInt(n[0]))||isNaN(parseInt(n[1]))?{}:(t.setHours(parseInt(n[0])),t.setMinutes(parseInt(n[1])),t)},_getCustomer:function(n,t,i){return $.trim("1|1|"+n+"|"+t+"|"+i)},_getPayment:function(n,t,i){return $.trim(n+":"+t+":"+i)},_getHistory:function(n,t){var i=this,r=[i.options.cid,i.options.aid,i.options.uid,i.options.un,(new Date).addMinutes(i._sOffsetMinute).toFormatString("iso"),n];return r.push(JSON.stringify(t)),r.join("##")},_getCurrentFareById:function(n,t){var r=this,u=r._parseFares(),f=n+"|"+t,i=u[f];return typeof i=="undefined"?0:i},_getFareQuickBook:function(n,t){var r=this,u=r._parseFares(),f=n+"|"+t,i=u[f];return typeof i=="undefined"?0:i},_parseFares:function(){var t=this,f="",e="",u=0,i=t._data[t._cTripIndex].Ts[t._cTripTime][t._cTripBus].F,n;if(typeof i!="undefined"&&vIsEstStr(i)&&i.length>1){var r=i.split("~"),s=r.length,o=[];for(n=1;n<s;n++)f=r[n].split("|")[0],e=r[n].split("|")[1],u=parseInt(r[n].split("|")[2]),o[f+"|"+e]=isNaN(u)?0:u;return o}return[]},_getCurrentFare:function(){var n=this,t=0,i=n._data[n._cTripIndex].Ts[n._cTripTime][n._cTripBus].F.split("~");return i.length>0&&(t=parseInt(i[1].split("|")[2]),isNaN(t)&&(t=0)),t},_getBranchInfo:function(n){var i=this,t="";return $.each(i._info,function(i,r){t==""&&n==r[0]&&(t=r.join("|"))}),t==""&&(t=[app.aid,app.aite,app.aice,app.aisne,"",""].join("|")),t},_getAgentInfo:function(){var n=this;return $.trim(n.options.aid+"|"+n.options.aite+"|"+n.options.aice+"|"+n.options.aisne)},_getPickupInfo:function(n,t,i){return typeof n=="undefined"&&(n=""),typeof t=="undefined"&&(t=""),typeof i=="undefined"&&(t=""),$.trim(n+"|"+t+"|"+i)},_createHistoryForm:function(){var n=this;return $("<div />").addClass("container-fluid").append($("<div />").addClass("row history-row").append($("<div />").addClass("col-sm-12").append($("<table />").addClass("table table-striped table-hover table-condensed").append($("<thead>").append($("<tr />").append($("<th />").text("NV")).append($("<th />").text("Tác vụ")).append($("<th />").text("Ngày")).append($("<th />").text("Cập nhật")))).append($("<tbody />"))))).append($("<div />").addClass("row action-row").append($("<div />").addClass("col-md-12 list-btn").append(n._createFormButton("button").addClass("btn btn-default btn-close").text("Đóng"))))},_getTripById:function(n){var i=this,t=null;return $.each(i._data,function(i,r){t==null&&n==r.Id&&(t=r)}),t},_createTable:function(){return $("<table />")},_createTableRow:function(){return $("<tr />")},_createTableCol:function(n){var t=$("<td />");return n>1&&t.attr("colspan",n),t},_createTableHead:function(){return $("<thead />")},_createTableBody:function(){return $("<tbody />")},_createTableHeadCol:function(n){var t=$("<th />");return n>1&&t.attr("colspan",n),t},_transformSeatMatrix:function(n){var i=this,t=[];return i._printStageTickets=[],$.each(i._m,function(r,u){typeof u!="undefined"&&$.each(u,function(u,f){typeof f!="undefined"&&$.each(f,function(f,e){var c,s,h,o;if(typeof e!="undefined"&&e!=null&&_dict._ts.indexOf(e._type)!=-1){if(e._tickets&&e._tickets.length>=1)for(c=e._tickets.length,s=0;s<c;s++)e._tickets[s].seatLabel=e._label,i._printStageTickets.push(e._tickets[s]);h=e._coach+"_"+e._row+"_"+e._col;n!=null&&n.hasOwnProperty(h)?(o=n[h],typeof t[o[0]-1]=="undefined"&&(t[o[0]-1]=[]),typeof t[o[0]-1][o[1]-1]=="undefined"&&(t[o[0]-1][o[1]-1]=[]),t[o[0]-1][o[1]-1][o[2]-1]=e):(typeof t[r]=="undefined"&&(t[r]=[]),typeof t[r][u]=="undefined"&&(t[r][u]=[]),t[r][u][f]=e)}})})}),t},_responsiveDevice:function(){var n=this;n.adjustStyle($(window).width());$(window).resize(function(){n.adjustStyle($(window).width())})},adjustStyle:function(n){n=parseInt(n);n<=480?($(".vbooking-sheet .seat").removeClass("col-xs-6").addClass("col-xs-12"),$(".vbooking-csheet .seat").removeClass("col-xs-6").addClass("col-xs-12")):($(".vbooking-sheet .seat").removeClass("col-xs-12").addClass("col-xs-6"),$(".vbooking-csheet .seat").removeClass("col-xs-12").addClass("col-xs-6"))},_resetAll:function(n){var t=this,i;t._resetSeatStack();t._resetMovingStack();t._unbindEventMoving();t._clearSelectedItem();t._closeUpdateDialog();t._closeCancelDialog();t._closeQuickBookForm();t._closeErrorDialog();t._clearSearchResult();t._clearSuggestCustomer();t._selectedPhone="";t._selectedCode="";t._ctrlOn=!1;t._closeHistoryLog();t._resetCopyInfo();t._unbindEventCopying();t._resetBookReturnInfo();t._unbindEventBookReturnTicket();i=function(){n!=undefined&&n.call()};t._reloadSheet(i)},_bindEventOnSeat:function(n,t){var i=this,r;if(i._hasBookingPermission()){if(r=t._getCurrentTicket(),!$.isEmptyObject(r)&&r._canceledDate!=null){$(n).on("mouseenter",function(){r._status==3&&$(n).attr("data-original-title",r._cancelInfo).attr("data-toggle","tooltip").attr("data-placement","top").tooltip("show")});$(n).on("mouseleave",function(){r._status==3&&$(n).attr("data-original-title","").attr("data-toggle","").attr("data-placement","").tooltip("hide")})}$(n).on("click",function(r){var o,u,f,e;t.disableClickEvent||(r.preventDefault(),r.stopPropagation(),t._isAvailable()&&(t._hasTicket()?i._fMoving||(r.ctrlKey?(i._updateSeatStack(n,t),i._ctrlOn=!0):(o=i._seatStack.indexOf(t),o!=-1?i._removeFromSeatStack(n,t,o):(u=t._getCurrentTicket(),_dict._allowGroupByCode?(e=u._getTicketCode()?u._getTicketCode():"",i._selectedCode!=e&&(i._resetSeatStack(),i._clearSelectedItem()),!vIsEstStr(e)||u._isNotCome()||u._isCancelled()?i._updateSeatStack(n,t):i._search(e,!0),i._selectedCode=e):(f=u._getDefaultPhoneNumber?u._getDefaultPhoneNumber():"",i._selectedPhone!=f&&(i._resetSeatStack(),i._clearSelectedItem()),!vIsEstStr(f)||u._isNotCome()||u._isCancelled()?i._updateSeatStack(n,t):i._search(f),i._selectedPhone=f)),i._ctrlOn=!1)):i._fMoving&&i._moveTicket(n,t)))});$.each(n.find("button"),function(r,u){var f=$(u).attr("data-type");switch(f){case"book":$(u).on("click",function(r){i._fMoving||(r.preventDefault(),r.stopPropagation(),_dict._allowGroupByCode?i._selectedCode!=""&&(i._resetSeatStack(),i._clearSelectedItem(),i._selectedCode="",i._ctrlOn=!1):i._selectedPhone!=""&&(i._resetSeatStack(),i._clearSelectedItem(),i._selectedPhone="",i._ctrlOn=!1),oRq.cEl=$(this),oRq.cLType=1,oRq.cKey=t._label,oRq.cAType=2,oRq.iAc=!0,i._fakeBookedSeat(this,t),i._bookSeat(n,t))});break;case"move":$(u).on("click",function(r){var u,f;i._hasCopyTicket?(r.preventDefault(),r.stopPropagation(),i._clearSelectedItem(),i._showError(_dict._err[5])):i._hasBookReturnTicket?(r.preventDefault(),r.stopPropagation(),i._clearSelectedItem(),i._showError(_dict._err[6])):(i._isBooking=!1,i._fMoving?i._isInMovingStack(t)||i._showError(_dict._err[3]):(r.preventDefault(),r.stopPropagation(),u=t._getCurrentTicket(),_dict._allowGroupByCode?(f=u._code==null?"":u._code,i._selectedCode==f||i._ctrlOn||(i._resetSeatStack(),i._clearSelectedItem())):i._selectedPhone==u._cphone||i._ctrlOn||(i._resetSeatStack(),i._clearSelectedItem()),i._seatStack.indexOf(t)==-1&&i._addToSeatStack(n,t),i._maskMoveTicket()))});break;case"update":$(u).on("click",function(r){var e=i._seatStack,u,f;i._reloadSheet();i._isBooking=!1;i._seatStack=e;i._fMoving?i._isInMovingStack(t)?(r.preventDefault(),r.stopPropagation(),i._resetSeatStack(),$.each(i._movingStack,function(n,t){i._seatStack.push(t)}),i._resetMovingStack(),i._showUpdateForm(n,t)):i._showError(_dict._err[3]):(r.preventDefault(),r.stopPropagation(),u=t._getCurrentTicket(),_dict._allowGroupByCode?(f=u._code==null?"":u._code,i._selectedCode==f||i._ctrlOn||(i._resetSeatStack(),i._clearSelectedItem())):i._selectedPhone==u._cphone||i._ctrlOn||(i._resetSeatStack(),i._clearSelectedItem()),i._seatStack.indexOf(t)==-1&&i._addToSeatStack(n,t),i._showUpdateForm(n,t))});break;case"quick-pay":$(u).on("click",function(r){i._hasCopyTicket?i._showError(_dict._err[5]):(r.preventDefault(),r.stopPropagation(),i._seatStack.length==0&&i._updateSeatStack(n,t),i._quickPay())});break;case"quick-book":$(u).on("click",function(r){var f,u,e;i._hasCopyTicket?i._showError(_dict._err[5]):(f=i._seatStack,i._reloadSheet(),i._isBooking=!1,i._seatStack=f,i._fMoving?i._isInMovingStack(t)?(r.preventDefault(),r.stopPropagation(),i._resetSeatStack(),$.each(i._movingStack,function(n,t){i._seatStack.push(t)}),i._resetMovingStack(),i._showQuickBookForm(n,t)):i._showError(_dict._err[3]):(r.preventDefault(),r.stopPropagation(),u=t._getCurrentTicket(),_dict._allowGroupByCode?(e=u._code==null?"":u._code,i._selectedCode==e||i._ctrlOn||(i._resetSeatStack(),i._clearSelectedItem())):i._selectedPhone==u._cphone||i._ctrlOn||(i._resetSeatStack(),i._clearSelectedItem()),i._seatStack.indexOf(t)==-1&&i._addToSeatStack(n,t),i._showQuickBookForm(n,t)))})}})}},_bindEventOnSheet:function(){var n=this;$(document).keyup(function(t){t.keyCode==27&&n._resetAll()});$("ul.vbooking-list a").click(function(t){t.preventDefault();$("ul.vbooking-list a").closest("li").removeClass("active");var i=$(this).attr("data-tab");$("ul.vbooking-list").closest("div.danhsach").find("button").html($(this).text()+'&nbsp;<span class="caret"><\/span>');$(this).tab("show");switch(i){case"bks":$("#bksContent").css("display","");$("#report").css("display","none");$("#product-content").css("display","none");break;case"vopen":n._reloadVO();break;case"vvalid":n._reloadVV();break;case"vcancelled":n._reloadVC()}});$(".select-layout > button").on("click",function(){$(".select-layout > button").removeClass("active");$("button.btn-thong-ke").removeClass("active");$(this).addClass("active");n._grid=$(this).hasClass("btn-grid")?!0:!1;n._isOrderring=!1;n._reloadSheet()})},_bindArrowEventList:function(n){var t,i=n.parent(),r=i.height(),u=i.prop("scrollHeight"),f=1,e=Math.round(u/r)-1;$(window).keydown(function(o){var s,c,h,l;o.which===40?(t?(n.removeClass("selected"),s=t.next(),t=s.length>0?s.addClass("selected"):n.eq(0).addClass("selected")):t=n.eq(0).addClass("selected"),t.position().top<0?(i.animate({scrollTop:0},500),f=1):t.position().top>r&&(c=Math.floor(r*f)-35,i.animate({scrollTop:c},500),f++)):o.which===38&&(t?(n.removeClass("selected"),h=t.prev(),t=h.length>0?h.addClass("selected"):n.last().addClass("selected")):t=n.last().addClass("selected"),t.position().top<=0?(l=Math.floor(u-r*e)+35,i.animate({scrollTop:l},500),e++):t.position().top>r&&(i.animate({scrollTop:u},500),e=Math.round(u/r)-1))})},_updateCPhoneSt:function(n,t){var r=this,i=t._getDefaultPhoneNumber();vIsEstStr(i)&&(typeof r._cphoneSt[i]=="undefined"&&(r._cphoneSt[i]=[]),r._cphoneSt[i].push(n))},_updateCCodeSt:function(n,t){var r=this,i=t._getTicketCode();vIsEstStr(i)&&(typeof r._cCodeSt[i]=="undefined"&&(r._cCodeSt[i]=[]),r._cCodeSt[i].push(n))},_getLimitedDate:function(){var n=this,t=new Date;return new Date(t.getTime()-_dict._limitedMinuteBefore*6e4).addMinutes(n._sOffsetMinute)},_hasBookingPermission:function(){var n=this,t=!0;return n._getDepartureTime().getTime()<n._getLimitedDate().getTime()&&app.rights.indexOf($.rights.bBookPastTk.val)==-1&&(t=n._rBookingOnPast),t},_bindEventMoving:function(){var n=this;n._$sheet.find("ul.vbooking-coach li.seat.selected").addClass("dotted-background");n._$sheet.find("ul.vbooking-coach li.seat div.available").unbind().on("mouseenter",function(){$(this).addClass("cursor-moving")})},_unbindEventMoving:function(){var n=this;n._$sheet.find("ul.vbooking-coach li.seat").removeClass("dotted-background");n._$sheet.find("ul.vbooking-coach li.seat div.available").removeClass("cursor-moving");n._$sheet.find("ul.vbooking-coach li.seat div.available").unbind("mouseenter")},_bindEventCopying:function(){var n=this;n._$sheet.find("ul.vbooking-coach li.seat div.available, ul.vbooking-coach li.seat div.booking").not("ul.vbooking-coach li.seat div.fbooking").unbind().on("mouseenter",function(){$(this).addClass("cursor-them-ve")});n._$sheet.find("ul.vbooking-coach li.seat div.paid, ul.vbooking-coach li.seat div.fbooking").closest("li.seat").unbind("click");n._$sheet.find("ul.vbooking-coach li.seat div.paid button, ul.vbooking-coach li.seat div.fbooking button").prop("disabled",!0)},_unbindEventCopying:function(){var n=this;n._$sheet.find("ul.vbooking-coach li.seat div.available, ul.vbooking-coach li.seat div.booking").removeClass("cursor-them-ve");n._$sheet.find("ul.vbooking-coach li.seat div.available, ul.vbooking-coach li.seat div.booking").unbind("mouseenter")},_bindEventBookReturnTicket:function(){var n=this,u=n._getCTripId(),t=n._$filterForm.find("select[name=TripId]"),i=n._$filterForm.find("input[name=DepartureDate]"),r=n._$filterForm.find("select[name=TimeSlot]");n._$sheet.find("ul.vbooking-coach li.seat div.available, ul.vbooking-coach li.seat div.booking").not("ul.vbooking-coach li.seat div.fbooking").unbind().on("mouseenter",function(){$(this).addClass("cursor-khu-hoi")});n._$sheet.find("ul.vbooking-coach li.seat div.paid button, ul.vbooking-coach li.seat div.fbooking button").prop("disabled",!0);u==n._cBookReturnTripId?(n._$sheet.find("ul.vbooking-coach li.seat").unbind("click"),n._$sheet.find("ul.vbooking-coach li.seat button").prop("disabled",!0),i.prop("disabled",!0),n._$filterForm.find(".glyphicon-calendar").parent().unbind("click"),r.prop("disabled",!0),n._hasBookReturnTicket&&(t.hasClass("book-return")||t.addClass("book-return"))):(n._$sheet.find("ul.vbooking-coach li.seat div.paid, ul.vbooking-coach li.seat div.fbooking").closest("li.seat").unbind("click"),n._$sheet.find("ul.vbooking-coach li.seat div.available button").prop("disabled",!1),t.removeClass("book-return"),i.prop("disabled",!1),r.prop("disabled",!1),n._bindEventOnCalendarIcon())},_unbindEventBookReturnTicket:function(){var n=this;n._$sheet.find("ul.vbooking-coach li.seat div.available").removeClass("cursor-khu-hoi");n._$sheet.find("ul.vbooking-coach li.seat div.available").unbind("mouseenter");n._$sheet.find("ul.vbooking-coach li.seat div.available button").prop("disabled",!1)},_showError:function(n){var t=this;t._$emodal.find(".message").html(n);t._showEModal()},backupBKS:function(n){var t=this,i=t._createBackUpBKSObj(),r=function(t,i,r){t!=1||r<=0||(window.location.href=i,n.removeAttr("disabled"))};t._submitAsyncAction(i,r)},_createBackUpBKSObj:function(){var t=this,i=new Date,n={};return n._a="bBackUpCustomerPerTrip",n._c={CompId:t.options.cid,UserId:t.options.uid,FromDate:i.toFormatString("iso")},n},_bindNumStageTicketsTooltips:function(){var n=this;$(".so-chang,.chang-di").unbind().hover(function(){$(this).closest(".seat").find(".chang-di").css("display","block")},function(){$(this).closest(".seat").find(".chang-di").css("display","none")});$(".stage-ticket-context").on("click",function(){var t=$(this).attr("data-fromId"),i=$(this).attr("data-toId");n.selectStage(t,i)})},_closedTrip:function(){var n=this,r=n._data[n._cTripIndex].Ts[n._cTripTime][0].TripDetailId,i=n._getCurrentTripInfo(),t,u,f;if(typeof r=="undefined"){n._showPopModal("Chuyến chưa đặt vé, vui lòng kiểm tra lại.");return}if(typeof _dict._driverInfoRequired!="undefined"&&_dict._driverInfoRequired){if(typeof _dict._fieldDriverInfoRequired!="undefined"&&_dict._fieldDriverInfoRequired.indexOf("VehicleNumber")!=-1&&i._vehicleNumber==""){n._showPopModal("Vui lòng điền thông tin xe trước khi xuất bến.");return}if(typeof _dict._fieldDriverInfoRequired!="undefined"&&_dict._fieldDriverInfoRequired.indexOf("DriverName")!=-1&&i._driverName==""){n._showPopModal("Vui lòng điền thông tin tài trước khi xuất bến.");return}if(typeof _dict._fieldDriverInfoRequired!="undefined"&&_dict._fieldDriverInfoRequired.indexOf("AssistantName")!=-1&&i._assistantName==""){n._showPopModal("Vui lòng điền thông tin phục vụ trước khi xuất bến.");return}}t={};u=new Date($.now());t._a="UpTrip";t._c={Id:r};t._d={ClosedStatus:1,RealDepartureTime:u};f=function(t){t==1&&(n._data[n._cTripIndex].Ts[n._cTripTime][0].ClosedStatus=1,n._hideXuatBenButton(),n._reloadSheet())};n._submitAction(t,f)}});
//# sourceMappingURL=z.min.js.map
