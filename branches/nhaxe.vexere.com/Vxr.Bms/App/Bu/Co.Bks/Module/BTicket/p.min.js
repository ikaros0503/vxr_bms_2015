define({start:function(){$("#bksContent").hide();$("#report").hide();$("#product-content").hide();$(jHtml.mainContainer).show();this.initView();this.getTickets()},test:function(){vRqs({_a:jVar.getTicketFunction,_c:{Type:" ($x=2 or $x=3) ",IsPrgCreatedDate:" ($x >='2015-02-01' and $x<'2015-05-01' )"},_f:jVar.fieldsToGet.join()},function(){})},initView:function(){var n=this,i=$(jHtml.mainContainer),t,r;i.hide();i.html("").append(jHtml.headerTpl);i.fadeIn(500);i.append($(jHtml.tableContainerHtml)).append(jHtml.pageNav);$("body").append(jHtml.modals);$(jHtml.filterDate).datepicker({dateFormat:"dd-mm-yy"});$(jHtml.filterDate).datepicker("setDate",new Date);$(jHtml.filterToDate).datepicker({dateFormat:"dd-mm-yy"});$(jHtml.filterToDate).datepicker("setDate",new Date);$(jHtml.filterTripDate).datepicker({dateFormat:"dd-mm-yy"});$(jHtml.filterTripDate).focus(function(){$(this).select()});t=function(){var t="",c=$(jHtml.mnuSource).attr("data-type"),o,u,s,h,f,r,e,i;t+=c==-1?" ($x=2 or $x=3) ":" $x= "+c;o=$(jHtml.filterCode).val();t+=o!=""?" and Code like '%"+o+"%' ":"";u=n.replaceUnicodeCharacter($(jHtml.filterCompName).val());t+=u!=""?" and ([dbo].ConvertToUnsignWithBlank(CompName) like N'%"+u+"%' or SeatCode like N'%"+u+"%')":"";s=n.replaceUnicodeCharacter($(jHtml.filterCustomer).val());t+=s!=""?" and [dbo].ConvertToUnsignWithBlank(CustomerInfo) like N'%"+s+"%'":"";h=n.replaceUnicodeCharacter($(jHtml.filterAccount).val());t+=h!=""?" and [dbo].ConvertToUnsignWithBlank(CreatedUser) like N'%"+h+"%'":"";f=new Date($(jHtml.filterToDate).datepicker("getDate"));f.setDate(f.getDate()+1);t+=" and IsPrgCreatedDate>='"+n.toDbDateString(new Date($(jHtml.filterDate).datepicker("getDate")))+"' and IsPrgCreatedDate<'"+n.toDbDateString(f)+"'";r=$(jHtml.filterTripDate).datepicker("getDate");r!=null&&(r=new Date(r),e=new Date($(jHtml.filterTripDate).datepicker("getDate")),e.setDate(e.getDate()+1),t+=" and TripDate>='"+n.toDbDateString(r)+"' and TripDate<'"+n.toDbDateString(e)+"' ");i=$(jHtml.mnuStatus).attr("data-status");i==-1||(i<3?t+=" and Status= "+i:i==30?t+=" and Status=3 and CanceledUser='server' ":i==31?t+=" and Status=3 and CancelType=4 ":i==32?t+=" and Status=3 and CancelType=5 ":i==33&&(t+=" and Status=3 and CancelType=6 "));t=t+" order by IsPrgCreatedDate desc ";filter.Type=t};t();r=function(){var n;if(tickets.length<=0)return[];for(n=0;n<tickets.length;n++);};$(jHtml.allTextFilter).change(function(){t();n.getTickets()});$(jHtml.filterTripDate).keypress(function(i){i.keyCode==13&&(t(),n.getTickets())});$(jHtml.mnuSourceItems).click(function(){$(jHtml.mnuSourceItems).removeClass("selected");$(this).addClass("selected");var i=$(this).attr("data-type");$(jHtml.mnuSource).attr("data-type",i);i==-1?$(jHtml.mnuSource).html('Nguồn&nbsp;<span class="caret"><\/span>'):$(jHtml.mnuSource).html($(this).text()+'&nbsp;<span class="caret"><\/span>');t();n.getTickets()});$(jHtml.mnuStatusItems).click(function(){$(jHtml.mnuStatusItems).removeClass("selected");$(this).addClass("selected");var i=$(this).attr("data-status");$(jHtml.mnuStatus).attr("data-status",i);i==-1?$(jHtml.mnuStatus).html('Trạng thái&nbsp;<span class="caret"><\/span>'):$(jHtml.mnuStatus).html($(this).text()+'&nbsp;<span class="caret"><\/span>');t();n.getTickets()})},updateVisible:function(){$(jHtml.refreshButton).prop("disabled",jVar.isLoading);$(jHtml.mainContainer+" input").prop("disabled",jVar.isLoading);$(jHtml.pagingContainer+" a").prop("disabled",jVar.isLoading);$(jHtml.pagingContainer+" select").prop("disabled",jVar.isLoading);$(jHtml.mnuSource).prop("disabled",jVar.isLoading);$(jHtml.mnuStatus).prop("disabled",jVar.isLoading)},getItemFromRecord:function(n,t){var i=this,e=function(n){return n!=null?new Date(parseInt(n.substring(n.indexOf("(")+1).replace(")/",""))):""},o,y,u,s,c;if(typeof n!="undefined"&&n!=null){var k=e(n[4]),d=e(n[23]),g=e(n[30]),nt=n[5].split(","),r="",tt=nt.length;for(o=0;o<tt;o++)y=nt[o].split("|"),y.length>0&&(r=r+y[0]+(o!=tt-1?",":""));r[r.length-1]==","&&(r=r.substr(0,r.length-1));u="";s=i.getSubItem(n[12],1,":");n[2]=="2"&&(s=i.getSubItem(n[18],1,":"));c="";s!=""&&n[2]!="2"&&(c=i.getSubItem(i.getSubItem(n[12],2,":"),3,"|"));var l="",f="",p="",a="";n[3]==1?(l="Đặt chỗ",u="",a="bookedTicket"):n[3]==2?(l="Đã thanh toán",f=s,p=c,u=e(n[27]),a="paidTicket"):(u=e(n[17]),l="Đã hủy",a="cancelledTicket",n[21]=="server"?f="Tự động":n[24]==4?f="Khi chọn ghế":n[24]==5?f="Ngân Lượng":n[24]==6&&(f="123Pay"));var w=i.getSubItem(n[11],0,"|"),v=i.getSubItem(n[8],3,"|"),b=i.getSubItem(n[8],4,"|"),h={statusClass:a,transactionId:n[26],transactionIdDisplay:n[26]!=null?"display":"none",tripName:n[25],fromArea:i.getSubItem(n[15],3,"|"),toArea:i.getSubItem(n[16],3,"|"),note:n[10],noteDisplay:n[10]!=null?"display":"none",money:n[9]==undefined?"0":n[9],tripDate:i.toDateString(k,jVar.dateDisplayFormat),tripTime:i.toDateString(k,"hh:mm"),createdDate:i.toDateString(d,jVar.dateDisplayFormat),createdTime:i.toDateString(d,"hh:mm"),seat:r,pickupInfo:w,pickupInfoDisplay:w!=""?"display":"none",customerDisplay:v!=""||b!=""||w!=""?"display":"none",customerName:v,customerNameSub:v!=""?v:"Khách hàng",customerPhone:b,customerPhoneDisplay:b!=""?"display":"none",statusDate:i.toDateString(u,jVar.dateDisplayFormat),statusTime:i.toDateString(u,"hh:mm"),statusDateDisplay:u!=null?"display":"none",chargedUser:n[14],chargedUserDisplay:n[14]!=null?"display":"none",code:n[1],companyName:n[20],paymentType:s,paymentLoc:c,createdUser:n[13],source:n[2]=="2"?"Online":n[2]=="3"?"VMS":"",isConfirmed:n[22]!=null&&n[22]==1?jHtml.isConfirmed:jHtml.notConfirmed,index:t,status:status,status1:l,status2:f,status2Display:f!=""?"display":"none",status3:p,status3Display:p!=""?"display":"none",id:n[28],transactionGateway:n[29],transactionDate:i.toDateString(g,jVar.dateDisplayFormat),transactionTime:i.toDateString(g,"hh:mm"),transactionStatus:n[31],transactionNLPaymentType:n[32],transactionBankCode:n[33],transactionDescription:n[34],transactionChecksum:n[35]};return h.isConfirmed=vtpl(h.isConfirmed,{code:h.code,id:h.id,index:t}),h}return{}},getItemFromRecord1:function(n,t){var i=this,o=function(n){return n!=null?new Date(parseInt(n.substring(n.indexOf("(")+1).replace(")/",""))):""},u,s,h;if(typeof n!="undefined"&&n!=null){var w=o(n[3]),b=o(n[22]),k=o(n[29]),d=n[4],e=d.split("|")[0];e[e.length-1]==","&&(e=e.substr(0,e.length-1));u="";s=i.getSubItem(n[11],1,":");n[1]=="2"&&(s=i.getSubItem(n[17],1,":"));h="";s!=""&&n[1]!="2"&&(h=i.getSubItem(i.getSubItem(n[11],2,":"),3,"|"));var c="",f="",v="",l="";n[2]==1?(c="Đặt chỗ",u="",l="bookedTicket"):n[2]==2?(c="Đã thanh toán",f=s,v=h,u=o(n[26]),l="paidTicket"):(u=o(n[16]),c="Đã hủy",l="cancelledTicket",n[20]=="server"?f="Tự động":n[23]==4?f="Khi chọn ghế":n[23]==5?f="Ngân Lượng":n[23]==6&&(f="123Pay"));var y=i.getSubItem(n[10],0,"|"),a=i.getSubItem(n[7],3,"|"),p=i.getSubItem(n[7],4,"|"),r={type:n[1],statusClass:l,transactionId:n[25],transactionIdDisplay:n[25]!=null?"display":"none",tripName:n[24],fromArea:i.getSubItem(n[14],3,"|"),toArea:i.getSubItem(n[15],3,"|"),note:n[9],noteDisplay:n[9]!=null?"display":"none",money:n[8]==undefined?"0":n[8],fare:n[8]==undefined?"0":n[8],tripDate:i.toDateString(w,jVar.dateDisplayFormat),tripTime:i.toDateString(w,"hh:mm"),createdDate:i.toDateString(b,jVar.dateDisplayFormat),createdTime:i.toDateString(b,"hh:mm"),seat:e,pickupInfo:y,pickupInfoDisplay:y!=""?"display":"none",customerDisplay:a!=""||p!=""||y!=""?"display":"none",customerName:a,customerNameSub:a!=""?a:"Khách hàng",customerPhone:p,customerPhoneDisplay:p!=""?"display":"none",statusDate:i.toDateString(u,jVar.dateDisplayFormat),statusTime:i.toDateString(u,"hh:mm"),statusDateDisplay:u!=null?"display":"none",chargedUser:n[13],chargedUserDisplay:n[13]!=null?"display":"none",code:n[0],companyName:n[19],paymentType:s,paymentLoc:h,createdUser:n[12],source:n[1]=="2"?"Online":n[1]=="3"?"VMS":"",isConfirmed:n[21]!=null&&n[21]==1?jHtml.isConfirmed:jHtml.notConfirmed,index:t,status:status,status1:c,status2:f,status2Display:f!=""?"display":"none",status3:v,status3Display:v!=""?"display":"none",id:n[27],transactionGateway:n[28],transactionDate:i.toDateString(k,jVar.dateDisplayFormat),transactionTime:i.toDateString(k,"hh:mm"),transactionStatus:n[30],transactionNLPaymentType:n[31],transactionBankCode:n[32],transactionDescription:n[33],transactionChecksum:n[34],totalSeats:1};return r.moneyFormatted=vToMn(r.money),r.fareFormatted=vToMn(r.fare),r.isConfirmed=vtpl(r.isConfirmed,{code:r.code,id:r.id,index:t}),r}return{}},getTickets:function(){var n=this;$(jHtml.tableBody).html(jHtml.loadingAnimation);$(jHtml.pagingContainer).html("");jVar.isLoading=!0;n.updateVisible();vRqs({_a:jVar.getTicketFunction,_c:filter,_f:jVar.fieldsToGet.join()},function(t,i){var e=$(jHtml.tableBody),r,u,f;if(e.html(""),i!=null&&i.length>0){for(r=n.getItemFromRecord1(i[0],0),tickets=[],u=1;u<i.length;u++)f=n.getItemFromRecord1(i[u],u),f.code!=r.code?(tickets.push(r),r=f):(r.money+=f.fare,r.totalSeats+=1,r.seat+=", "+f.seat,r.moneyFormatted=vToMn(r.money));tickets.push(r);n.changePage()}$(jHtml.tableBody).hide();$(jHtml.tableBody).fadeIn("slow");paging.total=Math.ceil((tickets.length==0?1:tickets.length)/paging.itemsPerPage);n.updatePage(tickets.length);jVar.isLoading=!1;n.updateVisible()})},updatePage:function(n){var t=this,r,u,i;if($(jHtml.pagingContainer).html(""),n<=0){$(jHtml.pagingContainer).hide();$(jHtml.pagingContainer).html(jHtml.noTicketAlert);$(jHtml.pagingContainer).fadeIn("slow");return}for($(jHtml.pagingContainer).hide(),r="",u="",i=1;i<=paging.total;i++)u+=vtpl(jHtml.selectPagesOption,{value:i}),r+=i==paging.current?vtpl(jHtml.selectedPageButton,{value:i}):vtpl(jHtml.pageButton,{value:i});$(jHtml.pagingContainer).html(vtpl(jHtml.paging,{previous:paging.current-1,next:paging.current+1,total:paging.total,allPages:r,selectPageNumbers:u}));$(jHtml.selectPages).val(paging.current);$(jHtml.selectItemsPerPage).val(paging.itemsPerPage);t.setElementVisibility(jHtml.firstPageButton,paging.total>1&&paging.current>1);t.setElementVisibility(jHtml.previousPageButton,paging.total>1&&paging.current>1);t.setElementVisibility(jHtml.nextPageButton,paging.total>1&&paging.current<paging.total);t.setElementVisibility(jHtml.lastPageButton,paging.total>1&&paging.current<paging.total);t.setElementVisibility(jHtml.selectPages,paging.total>1);$(jHtml.pagingContainer).fadeIn(500);$(jHtml.allPageButtons).click(function(){$(this).parent().hasClass("disabled")||(paging.current=parseInt($(this).attr("data-index")),t.changePage())});$(jHtml.selectPages).on("change",function(){paging.current=parseInt($(jHtml.selectPages).val());t.changePage()});$(jHtml.selectItemsPerPage).on("change",function(){paging.current=1;paging.itemsPerPage=parseInt($(jHtml.selectItemsPerPage).val());t.changePage()})},changePage:function(){var f=this,r=$(jHtml.tableBody),u,n,t,i;for(r.html(""),u=(paging.current-1)*paging.itemsPerPage,n=paging.current*paging.itemsPerPage,n>tickets.length&&(n=tickets.length),t=u;t<n;t++)i=tickets[t],i.money=vToMn(i.money),r.append(vtpl(jHtml.itemTpl,i));this.updatePage();$(jHtml.mnuCommandsItems).unbind().click(function(){$(this).hasClass("sendEmail")?$("#dlgSendEmail").modal():$(this).hasClass("sendSms")?$("#dlgSendSms").modal():$(this).hasClass("printTicket")||$(this).hasClass("cancelTicket")&&$("#dlgCancelTicketWarning").modal()});$(".chkConfirm").unbind().click(function(){var n=this,t=parseInt($(this).attr("data-id")),i=parseInt($(this).attr("data-code")),r=$(n).parent();vRqs({_a:jVar.updateTicketFunction,_c:{Id:t},_d:{IsConfirmed:$(this).is(":checked")==!0?1:0}},function(t,i){t==1&&i.length>0&&i[0].length>0&&i[0][0]==1?$("#confirmStatus"+$(n).attr("data-index")).html(""):($(n).attr("checked",!$(n).is(":checked")),$("#confirmStatus"+$(n).attr("data-index")).html("da co loi"))})});$(jHtml.refreshButton).unbind().click(function(){f.getTickets()});$("a.transactionDetail").click(function(){$("#dlgPaymentInfo").modal("show");$("#transactionId").html($(this).attr("data-transactionId"));$("#transactionDate").html($(this).attr("data-transactionDate")+" "+$(this).attr("data-transactionTime"));$("#transactionStatus").html($(this).attr("data-transactionStatus"));$("#transactionNLPaymentType").html($(this).attr("data-transactionNLPaymentType"));$("#transactionBankCode").html($(this).attr("data-transactionBankCode"));$("#transactionDescription").html($(this).attr("data-transactionDescription"));$("#transactionTs").html($(this).attr("data-transactionTs"));$("#transactionChecksum").html($(this).attr("data-transactionChecksum"))});$(jHtml.showMoreButton).unbind().click(function(){var t=$(this).attr("data-index"),n=this;$("#hiddenRow"+t).is(":hidden")?($("#hiddenRow"+t).show("slow"),$(n).css("-webkit-animation","rotateShow 0.5s ease-in-out"),$(n).css("animation","rotateShow 0.5s ease-in-out"),$(jHtml.showMoreButton).css("-webkit-animation-fill-mode","forwards"),$(jHtml.showMoreButton).css("animation-fill-mode","forwards")):($("#hiddenRow"+t).hide("slow"),$(n).css("-webkit-animation","rotateHide 0.5s ease-in-out"),$(n).css("animation","rotateHide 0.5s ease-in-out"),$(jHtml.showMoreButton).css("-webkit-animation-fill-mode","forwards"),$(jHtml.showMoreButton).css("animation-fill-mode","forwards"))});$(jHtml.ticketCodeButtons).unbind().click(function(){$("a[data-tab=bks]","ul.vbooking-list").trigger("click");$("body").trigger("updateFilters",{compId:$(this).attr("data-compId"),tripId:$(this).attr("data-tripId"),tripDate:$(this).attr("data-tripDate"),tripTime:$(this).attr("data-tripTime")})})},setElementVisibility:function(n,t){return t?$(n).removeClass("disabled"):$(n).addClass("disabled"),$(n)},getSubItem:function(n,t,i){if(n==undefined)return"";var r=n.split(i);return r!=null&&r.length>=t?r[t]:""},commaSeparateNumber:function(n){while(/(\d+)(\d{3})/.test(String(n)))n=n.toString().replace(/(\d+)(\d{3})/,"$1,$2");return n},replaceUnicodeCharacter:function(n){return n.toLowerCase().replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a").replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e").replace(/ì|í|ị|ỉ|ĩ/g,"i").replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o").replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u").replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y").replace(/đ/g,"d").replace(/^\-+|\-+$/g,"")},toDbDateString:function(n){return n.getFullYear()+(n.getMonth()<=8?"-0":"-")+(n.getMonth()+1)+(n.getDate()<=9?"-0":"-")+n.getDate()},toMDateString:function(n){return(n.getDate()<=9?"0":"")+n.getDate()+(n.getMonth()<=8?"-0":"-")+(n.getMonth()+1)+"-"+n.getFullYear()},toDateString:function(n,t){try{return n.toFormatString(t)}catch(i){return""}}});
//# sourceMappingURL=p.min.js.map
