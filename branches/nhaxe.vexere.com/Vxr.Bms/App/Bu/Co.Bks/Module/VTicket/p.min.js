(function(n){var t={_create:n.custom.vbooking.prototype._create};n.extend(!0,n.custom.vbooking.prototype,{options:{},_$printETicketContainer:null,_$printETicketBody:null,_create:function(){(t._create.apply(this,arguments),this.options.serviceUrl)&&(this._creatPrintETicketContainer(),this._creatPrintETicketBody())},_creatPrintETicketContainer:function(){this._$printETicketContainer=n("<div />").addClass("print-container")},_creatPrintETicketBody:function(){this._$printETicketBody=n("<div />").addClass("row").appendTo(this._$printETicketContainer)},_printETicket:function(){var i=this;i._resetETicket();i._renderETicket();var u=n("<div />").append(i._$printETicketContainer).html(),f=new Date,r="ETicket"+f.getTime(),t=window.open("about:blank",r,"width="+screen.width+", height="+screen.height+", scrollbars=1");t.document.write("<html><head><title>"+r+"<\/title>");t.document.write('<link rel="stylesheet" href="'+i.options.baseUrl+_dict._eStyleUrl+'" type="text/css" />');t.document.write("<\/head><body>");t.document.write(u);t.document.write("<\/body><\/html>");t.focus();setTimeout(function(){t.print()},500);typeof _dict._hasQuickPrint!="undefined"&&_dict._hasQuickPrint&&setTimeout(function(){t.close()},1e3)},_renderETicket:function(){var t=this,a=t._getCurrentTripInfo(),i=[],e=t._data[t._cTripIndex],o=e.Name.split("-"),s="",h="",u="",f="",v=e.FromArea.split("~"),c,r,l;v.length>1&&(s=v[1].split("|")[3]);c=e.ToArea.split("~");c.length>1&&(h=c[1].split("|")[3]);r={};n.each(t._info,function(i,u){n.isEmptyObject(r)&&u[0]==t.options.aid&&(r=u)});_dict._multiSeatOnTicket?(l=[],n.each(t._seatStack,function(e,c){var v=c._getCurrentTicket(),w,p,b,y;v.fromArea&&(u=v.fromArea.split("|")[3]);v.toArea&&(f=v.toArea.split("|")[3]);n.isEmptyObject(v)||(w=v._getPickupInfo(),p="",n.isEmptyObject(w)||(p=w.text),b=(v._cname+v._cphone+p).hashCode(),y=l.indexOf(b),y==-1&&(y=l.push(b)-1),typeof i[y]=="undefined"&&(i[y]={ticket:{_phone:n.trim(r[5]),_address:n.trim(r[4]),_from:n.trim(o[0]),_to:n.trim(o[1]),_fromArea:u!=""?u:s,_toArea:f!=""?f:h,_tripDate:v._pdate.toFormatString("dd/mm/yyyy"),_tripHour:v._pdate.toFormatString("hh:mm"),_numSeat:0,_seatCodes:[],_fare:v._fare,_total:0,_cname:v._cname,_cphone:v._getDefaultPhoneNumber(),_pick:p,_user:t.options.un,_note:v._note,_deposit:v._deposit.toMn()+" đ",_vehicleNumber:a._vehicleNumber}}),i[y].ticket._seatCodes.push(c._label),i[y].ticket._total+=v._fare,i[y].ticket._numSeat++,typeof i[y].ticket._deposit!="undefined"&&typeof v._deposit!="undefined"&&v._deposit!=0&&(i[y].ticket._fare=0,i[y].ticket._total=0))})):n.each(t._seatStack,function(e,c){var l=c._getCurrentTicket(),v,y,p,w;l.fromArea&&(u=l.fromArea.split("|")[3]);l.toArea&&(f=l.toArea.split("|")[3]);n.isEmptyObject(l)||(v=l._getPickupInfo(),y="",n.isEmptyObject(v)||(y=v.text),p=n.trim(o[0]),w=n.trim(o[1]),l.stage_point1!=null&&(p=l.stage_point1.Name,w=l.stage_point2.Name),i.push({ticket:{_phone:n.trim(r[5]),_address:n.trim(r[4]),_from:p,_to:w,_fromArea:u!=""?u:s,_toArea:f!=""?f:h,_tripDate:l._pdate.toFormatString("dd/mm/yyyy"),_tripHour:l._pdate.toFormatString("hh:mm"),_numSeat:1,_seatCodes:[c._label],_fare:l._fare,_total:l._fare,_cname:l._cname,_cphone:l._getDefaultPhoneNumber(),_pick:y,_user:t.options.un,_note:l._note,_deposit:l._deposit.toMn()+" đ",_vehicleNumber:a._vehicleNumber}}))});n.each(i,function(n,i){t._storeHistory(t.options.un,"print-ticket",{_tid:t._cTripId,_tname:t._data[t._cTripIndex].Name,_tdate:t._getDepartureTime(),_s:i.ticket._seatCodes});i.ticket._seatCodes=i.ticket._seatCodes.join(", ");i.ticket._fare=i.ticket._fare.toMn();i.ticket._total=i.ticket._total.toMn();i.ticket._numSeat>4?typeof _dict._eTicket.custom!="undefined"?t._$printETicketBody.append(vtpl(_dict._eTicket.custom[e.Id].lg,i)):t._$printETicketBody.append(vtpl(_dict._eTicket.lg,i)):typeof _dict._eTicket.custom!="undefined"?t._$printETicketBody.append(vtpl(_dict._eTicket.custom[e.Id].sm,i)):t._$printETicketBody.append(vtpl(_dict._eTicket.sm,i))})},_resetETicket:function(){this._$printETicketBody.empty()}})})(jQuery);
//# sourceMappingURL=p.min.js.map
