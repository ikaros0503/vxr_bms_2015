var H=function(n,t,i,r){this._u=n;this._a=t;this._d=i;this._dt=r};(function(){H.prototype._renderLatestHistory=function(){var n=this,t="",i,r,u,f;return typeof _dict._hAct[n._a]!="undefined"&&(t=_dict._hAct[n._a][_dict._lang]),i=n._d.toFormatString("dd-mm-yyyy"),r=n._d.toFormatString("hh:mm:ss"),n._a!="move"?(u={h:{_u:n._u,_a:t,_tid:n._dt._tid,_tname:n._dt._tname,_tdate:n._dt._tdate.toFormatString("dd-mm-yyyy"),_ttime:n._dt._tdate.toFormatString("hh:mm"),_d:i,_t:r,_s:n._dt._s.join(", ")}},vtpl(_dict._lhTpl,u)):(f={h:{_u:n._u,_a:t,_ftid:n._dt._ftid,_ftname:n._dt._ftname,_ftdate:n._dt._ftdate.toFormatString("dd-mm-yyyy"),_fttime:n._dt._ftdate.toFormatString("hh:mm"),_fs:n._dt._fs.join(", "),_ttid:n._dt._ttid,_ttname:n._dt._ttname,_ttdate:n._dt._ttdate.toFormatString("dd-mm-yyyy"),_tttime:n._dt._ttdate.toFormatString("hh:mm"),_ts:n._dt._ts.join(", "),_d:i,_t:r}},vtpl(_dict._mlhTpl,f))};H.prototype._renderHistory=function(){var n=this,t="",i,r;return typeof _dict._hAct[n._a]!="undefined"&&(t=_dict._hAct[n._a][_dict._lang]),n._a!="move"?(i={h:{_u:n._u,_a:t,_tid:n._dt._tid,_tname:n._dt._tname,_tdate:n._dt._tdate.toFormatString("dd-mm-yyyy"),_ttime:n._dt._tdate.toFormatString("hh:mm"),_d:n._d.toFormatString("dd-mm-yyyy"),_t:n._d.toFormatString("hh:mm:ss"),_s:n._dt._s.join(", ")}},n._a=="cancel"&&(i.h._type="isCancelled"),vtpl(_dict._ihTpl,i)):(r={h:{_u:n._u,_a:t,_ftid:n._dt._ftid,_ftname:n._dt._ftname,_ftdate:n._dt._ftdate.toFormatString("dd-mm-yyyy"),_fttime:n._dt._ftdate.toFormatString("hh:mm"),_fs:n._dt._fs.join(", "),_ttid:n._dt._ttid,_ttname:n._dt._ttname,_ttdate:n._dt._ttdate.toFormatString("dd-mm-yyyy"),_tttime:n._dt._ttdate.toFormatString("hh:mm"),_ts:n._dt._ts.join(", "),_d:n._d.toFormatString("dd-mm-yyyy"),_t:n._d.toFormatString("hh:mm:ss")}},vtpl(_dict._mihTpl,r))};H.prototype._getStoreValue=function(){var n=this,t=[n._u,n._a,n._d.toFormatString("iso"),JSON.stringify(n._dt)];return t.join("|")}})(jQuery),function(n){var t={_create:n.custom.vbooking.prototype._create};n.extend(!0,n.custom.vbooking.prototype,{options:{},_$statusBar:null,_$historyLog:null,_historyStack:[],_latestHistory:null,_$latestSpan:null,_$log:null,_create:function(){(t._create.apply(this,arguments),this.options.serviceUrl)&&(this._initializeHistoryFields(),this._createStatusBar())},_initializeHistoryFields:function(){var n=this;n._transformCookieToStorage();n._historyStack=n._getStoreHistory();n._historyStack.length>0&&(n._latestHistory=n._historyStack[n._historyStack.length-1])},_createStatusBar:function(){var t=this;t._$statusBar=n(_dict._sBar).appendTo(n("body"));t._$historyLog=n(_dict._hLog).appendTo(n("body"));t._$latestSpan=t._$statusBar.find("span.latest-act");t._$log=t._$historyLog.find("tbody");t._bindEventOnStatusBar();t._reloadLatestHistory();t._reloadHistoryLog()},_bindEventOnStatusBar:function(){var n=this;n._$statusBar.find("a.slideout-menu-toggle").on("click",function(t){t.preventDefault();var i=n._$historyLog,r=n._$historyLog.width();i.toggleClass("open");i.hasClass("open")?i.animate({right:"0px"}):i.animate({right:-r},250)});n._$historyLog.find("input#hsearch").keyup(function(t){this.value.length>0?(t.preventDefault(),t.stopPropagation(),n._filterHistoryLog(this.value)):n._normalizeHistoryLog()});n._$latestSpan.on("click",function(t){t.preventDefault();t.stopPropagation();n._navigateToAction(n._$latestSpan.find("span"))})},_storeHistory:function(n,t,i){var r=this,u=r._createHistory(n,t,i);r._addHistory(u);r._latestHistory=u;r._reloadLatestHistory();r._reloadHistoryLog();r._setHistoryStore()},_createHistory:function(n,t,i){return new H(n,t,new Date,i)},_addHistory:function(n){var t=this;t._historyStack.length>=_dict._hlL&&t._historyStack.shift();t._historyStack.push(n)},_setHistoryStore:function(){for(var t=this,u=t._getStoreKey(),r=[],i=0;i<t._historyStack.length;i++)r.push(t._historyStack[i]._getStoreValue());n.jStorage.set(u,r.join("~"))},_getStoreHistory:function(){var i=this,f=[],e=i._getStoreKey(),r=n.jStorage.get(e),u,t;if(vIsEstStr(r))if(i._checkHistoryFormat(r))for(u=r.split("~"),t=0;t<u.length;t++)f.push(i._createHistoryFromString(u[t]));else n.jStorage.set(e,"");return f},_getStoreKey:function(){var n=this;return _dict._hckKey+n.options.un},_createHistoryFromString:function(n){var i=n.split("|"),t=JSON.parse(i[3]);return typeof t._tdate!="undefined"&&(t._tdate=new Date(t._tdate)),typeof t._ftdate!="undefined"&&(t._ftdate=new Date(t._ftdate)),typeof t._ttdate!="undefined"&&(t._ttdate=new Date(t._ttdate)),new H(i[0],i[1],vPrsDt(i[2]),t)},_transformCookieToStorage:function(){var i=this,r=n.jStorage.index(),t=i._getStoreKey();n.cookie(t)!=null&&r.indexOf(t)==-1&&(n.jStorage.set(t,n.cookie(t)),n.removeCookie(t,{path:"/"}))},_checkHistoryFormat:function(n){return/[^\|]*\|[^\|]*\|[^\|]*\|[^\|]*/.test(n)?!0:!1},_reloadHistoryLog:function(){var n=this,t,i;for(n._clearHistoryLog(),t=n._historyStack.length-1;t>=0;t--)i=n._historyStack[t]._renderHistory(),n._$log.append(i);n._bindEventOnHistoryLog()},_reloadLatestHistory:function(){var n=this,t;n._latestHistory!=null&&(t=n._latestHistory._renderLatestHistory(),n._$latestSpan.html(t))},_clearHistoryLog:function(){var n=this;n._$log.empty()},_bindEventOnHistoryLog:function(){var n=this;n._$log.find("tr").on("click",function(t){t.preventDefault();t.stopPropagation();n._navigateToAction(this)})},_navigateToAction:function(t){var i=this,r;i._changeCTripId(parseInt(n(t).attr("tid")));i._changeCTripDate(vPrsDt(n(t).attr("tdate")));i._changeCTripTime(n(t).attr("ttime"));r=n(t).attr("slabel").split(", ");n("a[data-tab=bks]","ul.vbooking-list").trigger("click");i._$filterForm.find("input[name=DepartureDate]").val(i._cTripDate.toFormatString("DD dd-mm-yyyy")).trigger("change");n(t).attr("type")=="isCancelled"?(n("html, body").animate({scrollTop:i._$cancelSheet.offset().top},500),i._findCancelledSeat(r)):(n("html, body").animate({scrollTop:n("body").offset().top},500),i._findSeat(r));i._closeHistoryLog()},_closeHistoryLog:function(){var n=this;n._$historyLog.addClass("open");n._$statusBar.find("a.slideout-menu-toggle").trigger("click")},_findSeat:function(t){var i=this;n.each(i._m,function(r,u){typeof u!="undefined"&&u!=null&&n.each(u,function(r,u){typeof u!="undefined"&&u!=null&&n.each(u,function(n,r){if(typeof r!="undefined"&&r!=null&&r._isAvailable()&&r._hasTicket()&&t.indexOf(r._label)!=-1){var u=i._$sheet.find('.seat[data-position="'+r._coach+"_"+r._row+"_"+r._col+'"]');i._grid||(u=i._$sheet.find('.lseat[data-position="'+r._coach+"_"+r._row+"_"+r._col+'"]'));i._updateSeatStack(u,r)}})})})},_findCancelledSeat:function(t){var i=this;n.each(i._c,function(r,u){typeof u!="undefined"&&u!=null&&n.each(u,function(n,r){if(typeof r!="undefined"&&r!=null&&t.indexOf(r._label)!=-1){var u=i._$cancelSheet.find('.seat[data-position="'+r._coach+"_"+r._row+"_"+r._col+'"]');i._grid||(u=i._$cancelSheet.find('.lseat[data-position="'+r._coach+"_"+r._row+"_"+r._col+'"]'));i._updateSeatStack(u,r)}})})},_normalizeHistoryLog:function(){var n=this;n._$log.find("tr").removeClass("hidden")},_filterHistoryLog:function(t){var i=this;t=vRdm(t);i._normalizeHistoryLog();i._$log.find("tr").each(function(i,r){var u=vRdm(n(r).text());u.indexOf(t)==-1&&n(r).addClass("hidden")})}})}(jQuery);
//# sourceMappingURL=z.min.js.map
