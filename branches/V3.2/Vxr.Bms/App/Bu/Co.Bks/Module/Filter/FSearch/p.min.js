define({x:null,_$filterSearchResult:null,start:function(n){try{this.o=n;this.x=$(n.x);$(".HomeTopSearch").html($("#HomeTopSearch").html());this._bindFilterEvents(n);this._bindBodyEvents(n)}catch(t){console.error(t)}},_bindBodyEvents:function(){var n=this;vbv("doSetSearchBox",function(t){n.x.val(t.d.value)})},_bindFilterEvents:function(n){var i=this.x,t=this;i?(vev(n.x,"keyup",function(n){i.val().length==6?(n.preventDefault(),n.stopPropagation(),t._searchTicket(this.value,!0)):vIsNumKey(n)?this.value.length==3||this.value.length>=6?(n.preventDefault(),n.stopPropagation(),t._searchTicket(this.value)):(n.preventDefault(),n.stopPropagation(),t._clearSearchResult()):_dict._arrows.indexOf(n.keyCode)==-1&&(n.preventDefault(),n.stopPropagation(),t._clearSearchResult())}),vev(n.x,"paste",function(n){i.val(n.originalEvent.clipboardData.getData("Text"));$(".searchInput").val(i.val());this.value.length==6||this.value.length==10||this.value.length==11?(n.preventDefault(),n.stopPropagation(),this.value.length==6?t._searchTicket(this.value,!0):isNaN(this.value)||t._searchTicket(this.value)):(n.preventDefault(),n.stopPropagation(),t._clearSearchResult());t.x.blur()}),vev(n.x,"focus",function(){vbf("onSearchBoxFocused")})):setTimeout(t._bindFilterEvents,50)},_searchTicket:function(n,t){var i=this,e,o,s,h,f;if(app.module.toLowerCase()=="bks")i._clearSearchResult(),i._renderSearchResult(null,"start"),e=i._createSearchTicketObj(n,t),o=function(n,r){n==1&&(i._clearSearchResult(),r&&r.length>0&&(i._searchResult=r,i._totalSearchResult=r.length),i._renderSearchResult(t),FlatObj.HScrolled=!1,FlatObj.STBPhone=!0)},vRqs(e,o);else{var r={},u=[],c=i._crProOrderObj(n);i._clearSearchResult();i._renderSearchResult(null,"start");s=function(t,f,e){e>0&&$.each(f,function(t,r){var f=i._convertDbIntoSearchPhone(r,n);u.push(f)});r.listResult=u;r.totalItems=u.length};vRqs(c,s);h=$.getHtml("search-phone",r);i._clearSearchResult();i._$searchTicketFilter.parent().append(h);f=i._$searchTicketFilter.parent().find("li");f.on("click",function(n){n.preventDefault();n.stopPropagation();var t=$(this).attr("data-proid"),r=$(this).attr("data-tripid"),u=$(this).attr("data-triptime"),f=$(this).attr("data-tripdate"),e=$(this).attr("data-typeofview");$("#product-content").product("load",{proId:t,pIndex:1,pSize:10,tId:r,tTime:u,tDate:f,tOView:e});i._clearSearchResult();i._$searchTicketFilter.val("")}).hover(function(){f.removeClass("selected");$(this).addClass("selected")})}},_createSearchTicketObj:function(n,t){var s=this,h=$("input[name=type_filterdate]").val(),f=s._getLimitedSDate(),c=$(".BSFilterForm"),i={},r,u,o;if(typeof t!="undefined"&&t)i._a="fGetCustomerTripTicket",i._c={Code:$.trim(n).toUpperCase()},i._f="Id, TripId, AgentId, SeatCode, PickupDate, CustomerInfo, Status, Fare, Note, PickupInfo, Code, TripDate, CustomerNote";else{i._a="fGetCustomerTripDetail";r="($x like N'%"+n+"%')";switch(n.length){case 3:r="($x like N'%"+n+"')";break;case 4:case 5:r="($x like N'%"+n+"%')";break;case 6:r="($x like N'"+n+"%')"}u="$x >= '"+f.toFormatString("iso")+"'";switch(parseInt(h)){case 1:u=_dict._allowSearchBefore!=undefined?"$x >= '"+f.addMinutes(_dict._allowSearchBefore).toFormatString("iso")+"'":"$x >= '"+f.toFormatString("iso")+"'";break;case 2:u="$x is not null";break;case 3:var l=c.find("button").html(),a=new Date(vPrsDt(l).getTime()),e=new Date;e.setDate(a.getDate()-1);o=new Date;o.setDate(e.getDate()+2);u="$x > '"+e.toFormatString("iso")+"' and $x < '"+o.toFormatString("iso")+"'"}i._c=[{CompId:parseInt(app.cid),Phone:r,IsPrgStatus:"(ISNULL($x, -1) != 3)"},{CustomerTripIdIsPrgStatus:"(ISNULL($x, -1) != 3)",CustomerTripIdTripDate:u}];i._f="Id, Name, Note, Phone, BookingTicket, TotalBooking, PaidTicket, TotalPaid, CancelTicket, TotalCancel, NotComeTicket, TotalNotCome, PassTicket, TotalPass, KeepOnTimeTicket, TotalKeepOnTime, CustomerTripIdTripId, CustomerTripIdTripDate, CustomerTripIdBookingTicket, CustomerTripIdTotalBooking, CustomerTripIdListSeatBooking, CustomerTripIdPaidTicket, CustomerTripIdTotalPaid, CustomerTripIdListSeatPaid, CustomerTripIdCancelTicket, CustomerTripIdTotalCancel, CustomerTripIdListSeatCancel, CustomerTripIdNotComeTicket, CustomerTripIdTotalNotCome, CustomerTripIdListSeatNotCome, CustomerTripIdPassTicket, CustomerTripIdTotalPass, CustomerTripIdListSeatPass, CustomerTripIdKeepOnTimeTicket, CustomerTripIdTotalKeepOnTime, CustomerTripIdListSeatKeepOnTime, CustomerTripIdTripName, CustomerTripIdNote, CustomerTripIdPickupInfo"}return i},_crProOrderObj:function(n){var t={};return t._a="fGetProductOrder",t._c={PickupInfo:"($x like N'%"+n+"%' or DropOffInfo like N'%"+n+"%') order by IsPrgCreatedDate desc"},t._f="Id,TripTime,TripDate,PickupInfo,DropOffInfo,Fare,Status,TripId,AgentInfo,ReceivedAgentInfo",t},_convertDbIntoSearchPhone:function(n,t){var i={},u=n[3].split("|"),r,f,e;i.senderName=u[3].length>10?vGln(u[3]):u[3];i.senderPhone=u[4];i.keySender=u[4].indexOf(t)==0?"vred":"";r=n[4].split("|");i.receiverName=r[3].length>10?vGln(r[3]):r[3];i.receiverPhone=r[4];i.keyReceiver=r[4].indexOf(t)==0?"vred":"";f=n[8].split("|");i.fromName=f[2];e=n[9].split("|");i.toName=e[2];i.fare=vToMn(n[5]);i.proId=n[0];i.tripId=n[7];i.tripTime=n[1];i.tripDate=vPrsDt(n[2]).toFormatString("dd-mm-yyyy");vIsEstStr(i.tripTime)&&vIsEstStr(i.tripDate)&&(i.tripDepartureDate="/ "+i.tripTime+" ngày "+i.tripDate);switch(parseInt(n[6])){case 1:i.status="Chưa nhận";i.typeOfView="kho-hang-di";break;case 2:i.status="Chưa nhận";i.typeOfView="kho-hang-di";break;case 3:i.status="Chưa nhận";i.typeOfView="xem-chuyen";break;case 4:i.status="Đã nhận";i.typeOfView="xem-chuyen";break;case 5:i.status="Chưa nhận";i.typeOfView="xem-chuyen";break;case 6:i.status="Đã nhận";i.typeOfView="xem-chuyen";break;case 7:i.status="Chưa giao";i.typeOfView="kho-hang-ve";break;case 8:i.status="Chưa giao";i.typeOfView="kho-hang-ve";break;case 9:i.status="Đã giao";i.typeOfView="kho-hang-ve";break;default:i.status="";i.typeOfView=""}return i},_getLimitedSDate:function(){var n=new Date;return typeof _dict._limitedMinuteBefore!="undefined"?new Date(n.getTime()).addMinutes(app.sOffsetMinute):new Date(n.getTime()).addMinutes(app.sOffsetMinute)},_clearSearchResult:function(){var n=this;n._searchResult=[];n._totalSearchResult=0;n._hasSearchPhone=!1},_renderSearchResult:function(n,t){var o=this,h,f=$("<tbody><\/tbody>"),i,w,u,b;if(h=$("<table><\/table>").addClass("search-items"),i=0,t=="start")f.html($("#startSearchTemplate").html());else if(o._totalSearchResult>0)if(typeof n!="undefined"&&n){var c=[],l=[],k="",d="",r="",s=null,tt="",a="",it=[],rt=0,g="",ut=null,ft=0,e={},nt="",v="",y="",p={};$.each(o._searchResult,function(n,t){var i,f,o,h,et,ot;if(typeof t!="undefined"&&t!=null){var w=[],b="",u="";vIsEstStr(t[5])&&(i=t[5].split("|"),vIsEstStr(i[3])&&c.indexOf(i[3])<0&&c.push(i[3]),vIsEstStr(i[4])&&l.indexOf(i[4])<0&&l.push(i[4]));d=t[10];k=t[12];r=t[9];ft+=parseInt(t[7]);vIsEstStr(r)?(f=r.split("|"),r=f[0]?"&nbsp;/&nbsp;Đón:&nbsp;"+f[0]:f[1]?"&nbsp;/&nbsp;T.C:&nbsp;"+f[1]:""):r="";ut=t[2];s=parseInt(t[1]);tt=vPrsDt(t[4]);o=t[3].split("|");it.push(o[0]);rt++;h=parseInt(t[6]);g=_dict._stn[h].vi;h==3&&(b="isCancelled");p.hasOwnProperty(s)?a=p[s]:(et=function(n,t,i){n!=1||i<=0||(p[s]=t[0][0],a=t[0][0])},ot={_a:"fGetTrip",_c:{Id:s},_f:"Name"},vRqs(ot,et));y=vPrsDt(t[11]).toFormatString("hh:mm");v=vPrsDt(t[11]).toFormatString("dd-mm-yyyy");nt=y+" "+v;u=nt+" "+h;w.push(o[0]);typeof e[u]!="undefined"?(e[u][3].push(o[0]),e[u][4]+=parseInt(t[7])):e[u]={code:d,name:c,phone:l,seatCodes:w,4:parseInt(t[7]),tripName:a,tripDate:v,tripTime:y,status:g,pickup:r,note:k,tId:s,isCancelled:b}}});for(w in e)e.hasOwnProperty(w)&&(u=e[w],u.money=u[4].toMn(0,",","."),u.totalSeats=u.seatCodes.length,u.seatCodes=u.seatCodes.join(","),f.append(vtpl($("#searchTicketResultItemTemplate").html(),u)),i++);i==0&&f.append($(vtpl($("#noResultItemTemplate").html())))}else $.each(o._searchResult,function(n,t){var r,u;typeof t!="undefined"&&t!=null&&(r={cname:t[1],cphone:t[3],cnote:"",cpickup:"",type:""},vIsEstStr(t[38])&&(u=t[38].split("|"),u[0]?r.cpickup="&nbsp;/&nbsp;Đón:&nbsp;"+u[0]:u[1]&&(r.cpickup="&nbsp;/T.C:&nbsp;"+u[1])),vIsEstStr(t[37])&&(r.cnote="&nbsp;/&nbsp;"+t[37]),r.cbooked=parseInt(t[4]+t[6]+t[12]+t[14]),r.ccancelled=parseInt(t[8]+t[10]),r.tid=parseInt(t[16]),r.tdate=vPrsDt(t[17]),r.tname=t[36],r.nbooked=parseInt(t[18]+t[21]+t[30]+t[33]),r.tbooked=parseInt(t[19]+t[22]+t[31]+t[34]),r.lbooked=[t[20],t[23],t[32],t[35]],r.ncancelled=parseInt(t[24]+t[27]),r.tcancelled=parseInt(t[25]+t[28]),r.lcancelled=[t[26],t[29]],r.ttime=moment(r.tdate).format("HH:mm"),r.tdate=moment(r.tdate).format("DD-MM-YYYY"),r.nbooked>0&&(r.status="Đã đặt",r.totalTickets=r.nbooked,r.tickets=r.lbooked.filter(function(n){return vIsEstStr(n)}).join(", "),r.money=r.tbooked.toMn(),f.append($(vtpl($("#searchResultItemTemplate").html(),r))),i++),r.ncancelled>0&&(r.status="Đã hủy",r.type="isCancelled",r.totalTickets=r.ncancelled,r.tickets=r.lcancelled.filter(function(n){return vIsEstStr(n)}).join(", "),r.money=r.tcancelled.toMn(),f.append($(vtpl($("#searchResultItemTemplate").html(),r))),i++))}),i==0&&f.append($(vtpl($("#noResultItemTemplate").html())));h.append(f);o._$filterSearchResult=$("<div />").addClass("dropdown-menu search-result").append($("<div />").addClass("search-title").append(t=="start"?"Đang tìm":i>0?"Tìm được "+i+" kết quả":"Kết quả")).append(h);b=$(".searchContainer").find("div.dropdown-menu.search-result");b.length>0&&b.remove();$(".searchContainer").append(o._$filterSearchResult);$(".customer-profile-item").unbind().click(function(n){n.stopPropagation();n.preventDefault();app.cusphone=$(this).parent().parent().attr("phone");$("#showCustomerProfile").trigger("click")});i>0&&o._bindEventOnSearchResult()},_bindEventOnSearchResult:function(){var t=this,n;t._totalSearchResult>0&&(n=$("div.searchContainer table.search-items tr"),n.length>0&&(n.unbind("click").on("click",function(n){n.preventDefault();n.stopPropagation();var i=parseInt($(this).attr("tid")),r=$(this).attr("tdate"),u=$(this).attr("ttime"),f=$(this).attr("phone"),e=$(this).attr("code"),o=$(this).attr("type");vbf("onSearchResultSelected",{tId:i,tDate:r,tTime:u,phone:f,code:e,isCanceled:o});t._clearSearchResult()}).hover(function(){n.removeClass("selected");$(this).addClass("selected")}),t._bindArrowEventList(n)))},_bindArrowEventList:function(n){var t,i=n.parent(),r=i.height(),u=i.prop("scrollHeight"),f=1,e=Math.round(u/r)-1;$(window).keydown(function(o){var s,c,h,l;o.which===40?(t?(n.removeClass("selected"),s=t.next(),t=s.length>0?s.addClass("selected"):n.eq(0).addClass("selected")):t=n.eq(0).addClass("selected"),t.position().top<0?(i.animate({scrollTop:0},500),f=1):t.position().top>r&&(c=Math.floor(r*f)-35,i.animate({scrollTop:c},500),f++)):o.which===38&&(t?(n.removeClass("selected"),h=t.prev(),t=h.length>0?h.addClass("selected"):n.last().addClass("selected")):t=n.last().addClass("selected"),t.position().top<=0?(l=Math.floor(u-r*e)+35,i.animate({scrollTop:l},500),e++):t.position().top>r&&(i.animate({scrollTop:u},500),e=Math.round(u/r)-1))})}});
//# sourceMappingURL=p.min.js.map
