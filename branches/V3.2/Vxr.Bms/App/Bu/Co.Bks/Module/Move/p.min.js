define({start:function(){var n=this;vbv("doMaskMovingTicket",function(t){t.d&&n._maskMoveTicket(t.d.tId,t.d.tName,t.d.tDate)});vbv("doMovingTicket",function(t){t.d&&n._moveTicket(t.d.seat,t.d.tId,t.d.tName,t.d.tDate,t.d.tBus,t.d.tStage,t.d.fromId,t.d.toId,t.d.stopPoints)});vbv("doResetMovingStack",function(){n._resetMovingStack()});vbv("doUnbindEventMoving",function(){n._unbindEventMoving()})},_maskMoveTicket:function(n,t,i){var r=this;app.movingStack=[];app.fMoving=!0;$.each(app.seatStack,function(n,t){var r=t._clone(),i=r._getCurrentTicket();i._isNotCome()?i._status=2:i._isCancelled()&&(i._status=1,i._pmInfo=null,i._cuser=null,i._canceledDate=null,i._cancelInfo=null,i._cancelType=null,i._canceledUser=null,i._canceledAgentId=null);app.movingStack.push(r)});app.cMovingTrip={_tid:n,_tname:t,_tdate:i};vbf("resetSeatStack");r._toggleFilterWhenMoving();r._bindEventMoving()},_moveTicket:function(n,t,i,r,u,f,e,o,s){var h=this,c,l;if(app.movingStack.length<=0)return app.fMoving=!1,app.cMovingSeat=null,app.cMovingTrip=null,h._unbindEventMoving(),!1;c=h._createMovedTicketObj(n,t,r,u,app.cMovingTrip._tid,f,e,o,s);l=function(u){if(u==1){var f={_ftid:app.cMovingTrip._tid,_ftname:app.cMovingTrip._tname,_ftdate:app.cMovingTrip._tdate,_fs:[app.cMovingSeat._label],_ttid:t,_ttname:i,_ttdate:r,_ts:[n._label]};vbf("onStoreHistory",{un:app.un,key:"move",his:f});app.movingStack.length<=0&&(app.fMoving=!1,app.movingStack=[],app.cMovingSeat=null,app.cMovingTrip=null,h._unbindEventMoving(),h._toggleFilterWhenMoving());vbf("reloadBookingSheet")}};vRqs(c,l)},_createMovedTicketObj:function(n,t,i,r,u,f,e,o,s){var v=app.movingStack.shift(),l,c,k;app.cMovingSeat=v;var h=v._getCurrentTicket(),y=i,p=y,d=y,w="",b="",a=s.data[s.idx[e]];return $.isEmptyObject(a)||(w="1~"+a.Id+"|"+a.Type+"|"+a.Code+"|"+a.Name),l=s.data[s.idx[o]],$.isEmptyObject(l)||(b="1~"+l.Id+"|"+l.Type+"|"+l.Code+"|"+l.Name),c={},c._a="UpdateBookTicket",c._c=[],c._d=[],c._c.push({Id:h._id,TripId:u,SeatCode:n._getSeatInfo(),PickupDate:p.toFormatString("iso"),Bus:r}),k={TripId:t,SeatCode:n._getSeatInfo(),TripDate:d.toFormatString("iso"),PickupDate:p.toFormatString("iso"),TripAlias:r,Status:parseInt(h._status),PaymentInfo:h._pmInfo,SeatType:n._getSeatType(),Code:h._code,LastMovedDate:h._dept.toFormatString("iso"),LastMovedTrip:app.cMovingTrip?app.cMovingTrip._tid:0,ChargeDate:new Date,StageCode:f,FromArea:w,ToArea:b,UserCharge:h._cuser,CanceledUser:h._canceledUser,CanceledDate:h._canceledDate,CancelInfo:h._cancelInfo,CancelType:h._cancelType,CanceledAgentId:h._canceledAgentId},c._d.push(k),c},_toggleFilterWhenMoving:function(){var n=$("#FilterForm").find("select[name=TripId]");app.fMoving?_dict._hasMoveSeatToOtherTrip!=undefined&&_dict._hasMoveSeatToOtherTrip?n.prop("disabled",!1):n.prop("disabled",!0):app.hasCopyTicket?n.prop("disabled",!0):n.prop("disabled",!1)},_bindEventMoving:function(){$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat.selected").addClass("dotted-background");$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat div.available").unbind().on("mouseenter",function(){$(this).addClass("cursor-moving")})},_unbindEventMoving:function(){$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat").removeClass("dotted-background");$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat div.available").removeClass("cursor-moving");$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat div.available").unbind("mouseenter")},_resetMovingStack:function(){var n=this;app.movingStack=[];app.fMoving=!1;n._toggleFilterWhenMoving()}});$(document).ready(function(){$._isInMovingStack=function(n){var t=!1;return $.each(app.movingStack,function(i,r){if(t==!1){var u=r._getCurrentTicket(),f=n._getCurrentTicket();(r._coach=n._coach&&r._row==n._row&&r._col==n._col&&u._id==f._id)&&(t=!0)}}),t}});
//# sourceMappingURL=p.min.js.map
