define({$lstDisTrip:null,listTrip:[],onBeginSelectionChange:function(n,t){vv.enableItem(n,"button.delete",t!=null)},onVMLoaded:function(){var t=this,n=!1;$(document).ajaxStop(function(){n||(t._loadDiscount(),n=!0)})},lstDisTripReder:function(){var n=$('<h3 class="text-center" />').html("Quản lý chiết khấu theo chuyến"),t=$('<table id="tblLstDisTrip" class="col-md-12 table-responsive table table-qlvt table-striped"/>').append($("<thead />").append($("<tr />").html('<th class="bg-thead">STT<\/th><th class="bg-thead" style="width:20%">Chuyến<\/th><th class="bg-thead" style="width:35%">Chiết khấu theo %<\/th><th class="bg-thead" style="width:35%">Chiết khấu theo số tiền<\/th>'))).append($("<tbody />"));this.$lstDisTrip=$('<div id="lstRoleBox" />').append(n).append(t)},onComSelectionChange:function(){var n=this,t=n.o,i=t.view,r=$(i).find("input[name=discount]:radio");r.each(function(){var t=$(this).prop("checked");t===!0&&$(this).val()==="3"&&n._loadDiscount()})},onRadioSelectionChange:function(){var n=this,t=n.o,i=t.view,r=$(i).find("input[name=discount]:radio");r.each(function(){n.disable_by_rad($(this))})},disable_by_rad:function(n){var t=this,i=t.o,u=i.view,r=n.prop("checked");r===!0?n.val()!=3?(n.closest("span").next("input[type=text]").prop("disabled",!1),$("#discount-trip").css("display","none")):$("#discount-trip").css("display","block"):n.closest("span").next("input[type=text]").prop("disabled",!0)},disable_by_rad_row:function(n){var t=this,i=t.o,u=i.view,r=n.prop("checked");r===!0?n.closest("span").next("input[type=text]").prop("disabled",!1):n.closest("span").next("input[type=text]").prop("disabled",!0)},_loadDiscount:function(){var n=this,t,i;o=n.o;view=o.view;n.listTrip=[];t=view.find("select.company-id").val();i={_a:"fGetDiscount",compId:t};vRql(i,{a:function(t,i){var r,u,f;if(n.listTrip.push(i[0]),n.lstDisTripReder(),n.renderLstDiscountTripData(),n._onClickDiscountTrip(),n._onLoadDiscountTripData(),r=n.listTrip[0],$(".fromdate").datepicker("setDate",vPrsDt(r[0][6])),u=new Date(vPrsDt(r[0][7])),u.getFullYear()!="1970"&&$(".todate").datepicker("setDate",u),r[0][5]!=null){f=parseInt(r[0][5]);switch(f){case 1:$(".txt_chietkhau1").prop("disabled",!1).val(parseInt(r[0][8])/100);$('input:radio[name="discount"][value="1"]').prop("checked",!0);$(".txt_chietkhau2").prop("disabled",!0).val("");$('input:radio[name="discount"][value="2"]').prop("checked",!1);break;case 2:$(".txt_chietkhau2").prop("disabled",!1).val(r[0][8]);$('input:radio[name="discount"][value="2"]').prop("checked",!0);$(".txt_chietkhau1").prop("disabled",!0).val("");$('input:radio[name="discount"][value="1"]').prop("checked",!1);break;case 3:$(".txt_chietkhau2").prop("disabled",!0).val("");$('input:radio[name="discount"][value="1"]').prop("checked",!1);$(".txt_chietkhau1").prop("disabled",!0).val("");$('input:radio[name="discount"][value="2"]').prop("checked",!1);$('input:radio[name="discount"][value="3"]').prop("checked",!0);$("#discount-trip").css("display","block")}}else $(".txt_chietkhau1").prop("disabled",!1).val(""),$('input:radio[name="discount"][value="1"]').prop("checked",!0),$(".txt_chietkhau2").prop("disabled",!0).val("")}})},renderLstDiscountTripData:function(){var i=this,n,t;o=i.o;view=o.view;n="";t=this.$lstDisTrip.find("#tblLstDisTrip tbody");t.empty();$.each(i.listTrip[0],function(i,r){n=$("<tr />").attr("data-tripId",r[0]).append($("<td />").html(i+1)).append($("<td />").html(r[1])).append($("<td />").append($("<div />").addClass("input-group").attr("data-original-title","Chiết khấu theo %").attr("data-toggle","tooltip").attr("data-placement","top").append($("<span />").addClass("input-group-addon").append($("<input />").addClass("discount1").attr("type","radio").attr("name","discount"+i).attr("value",r[0]+","+r[2]).attr("checked","checked"))).append($("<input />").addClass("form-control txt_discount"+i+1+" rights R").attr("type","text").attr("placeholder","Chiết khấu theo %")).append($("<span />").addClass("input-group-addon").html("%")))).append($("<td />").append($("<div />").addClass("input-group").attr("data-original-title","Chiết khấu theo số tiền").attr("data-toggle","tooltip").attr("data-placement","top").append($("<span />").addClass("input-group-addon").append($("<input />").addClass("discount2").attr("type","radio").attr("name","discount"+i).attr("value",r[0]+","+r[2]))).append($("<input />").addClass("form-control txt_discount"+i+1+" rights R").attr("type","text").attr("placeholder","Chiết khấu theo số tiền").attr("disabled","disabled")).append($("<span />").addClass("input-group-addon").html("VND"))));t.append(n)});$("#discount-trip").html(this.$lstDisTrip.html()).css("display","none")},_onClickDiscountTrip:function(){var n=this;o=n.o;view=o.view;$(view).find("#tblLstDisTrip input[type=radio]").on("click",function(){var t=$(this).attr("name"),i=$(view).find("input[name="+t+"]:radio");i.each(function(){n.disable_by_rad_row($(this))})})},_onLoadDiscountTripData:function(){var n=this;o=n.o;view=o.view;$.each(n.listTrip[0],function(n,t){if(t[9]!=0){var i=parseInt(t[9]),r=parseInt(t[8])/100;switch(i){case 1:$("#tblLstDisTrip").find('tr[data-tripId="'+t[0]+'"]').find('input:radio[class="discount1"]').prop("checked",!0).closest("span").next("input[type=text]").prop("disabled",!1).val(r);$("#tblLstDisTrip").find('tr[data-tripId="'+t[0]+'"]').find('input:radio[class="discount2"]').prop("checked",!1).closest("span").next("input[type=text]").prop("disabled",!0).val("");break;case 2:$("#tblLstDisTrip").find('tr[data-tripId="'+t[0]+'"]').find('input:radio[class="discount2"]').prop("checked",!0).closest("span").next("input[type=text]").prop("disabled",!1).val(t[8]);$("#tblLstDisTrip").find('tr[data-tripId="'+t[0]+'"]').find('input:radio[class="discount1"]').prop("checked",!1).closest("span").next("input[type=text]").prop("disabled",!0).val("")}}})},onSaveDisTrip:function(){var i=this,g=i.o,r=g.view,n=!1,t="",nt=$(r).find("#tblLstDisTrip tbody tr input[type=radio]:checked"),p=$(r).find("select.company-id").val(),v=i.toDbDateString(new Date($(".fromdate").datepicker("getDate"))),w=i.toDbDateString(new Date($(".todate").datepicker("getDate"))),s=$(r).find(".txt_chietkhau1"),b=$(r).find(".txt_chietkhau2"),y=null,u=null,f=null,h=[],c=[],l=[],k=[],d=$(r).find("input[name=discount]:radio:checked").val(),e,o;if(v==""&&(n=!0,t+="Vui lòng nhập ngày bắt đầu. \n"),d!=3)d==="1"?s.val()==""?(n=!0,t+="Vui lòng nhập % chiết khấu. \n"):vIsPNum(s.val())?(y=s.val()*100,u=1):(n=!0,t+="\n% chiết khấu không hợp lệ."):b.val()==""?(n=!0,t+="Vui lòng nhập số tiền chiết khấu. \n"):vIsCurrency(s.val())?(y=b.val(),u=2):(n=!0,t+="\n% chiết khấu không hợp lệ."),n?vv.showMessage({element:r.find(".alert.message"),type:"alert-danger",content:t}):(e=0,o=0,$.each(i.listTrip[0],function(n,t){var b=y,s,i,r,a;f=0;s=t[0];i=t[2];r={XCompanyId:""+p+"",XTypeId:"16",XTripId:""+s+"",XStatus:""+u+"",XDate:""+v+"",ZDate:""+w+"",XValue:""+b+"",IsPrgStatus:""+f+""};a={Id:i};i!=null?(o+=1,h.push(r),c.push(a)):(e+=1,l.push(r))}),e>0&&i._saveData(l,k,"InDiscount"),o>0&&i._saveData(h,c,"UpDiscount"));else{u=3;var a=!1,e=0,o=0;nt.each(function(){var i=$(this).closest("span").next("input[type=text]").val(),k,s,d,g;if(i=="")return n=!0,t+="Vui lòng nhập chiết khấu đã chọn. \n",a=!1,!1;if(!vIsPNum(i))return n=!0,t+="\nChiết khấu không hợp lệ.",a=!1,!1;if(n)vv.showMessage({element:r.find(".alert.message"),type:"alert-danger",content:t});else{var tt=$(this).prop("checked"),nt=$(this).attr("class"),y=$(this).val().split(","),b=null;nt==="discount1"?(f=1,b=i*100):(f=2,b=i);k=null;s=null;y.length>0&&(k=y[0],s=y[1]);d={XCompanyId:""+p+"",XTripId:""+k+"",XTypeId:"16",XStatus:""+u+"",XDate:""+v+"",ZDate:""+w+"",XValue:""+b+"",IsPrgStatus:""+f+""};g={Id:s};s!=null?(o+=1,h.push(d),c.push(g)):(e+=1,l.push(d));a=!0}});a&&(e>0&&i._saveData(l,k,"InDiscount"),o>0&&i._saveData(h,c,"UpDiscount"));n&&vv.showMessage({element:r.find(".alert.message"),type:"alert-danger",content:t})}},_saveData:function(n,t,i){var r=this,e=r.o,u=e.view,f;f={_a:i,_c:t,_d:n};vRqs(f,function(n){n?(r.onActionComplete&&r.onActionComplete.call(r),vv.showMessage({element:u.find(".alert.message"),type:"alert-success",content:"Thao tác thành công."}),r._loadDiscount()):vv.showMessage({element:u.find(".alert.message"),type:"alert-danger",content:"Thao tác thất bại, vui lòng thử lại sau."})})},onClear:function(){var n=this;n.model=null;view.find("input").each(function(){$(this).hasClass("noCls")||$(this).val("")});o.defaultFocusRef&&view.find(o.defaultFocusRef).trigger("focus")},toDbDateString:function(n){return n.getFullYear()+(n.getMonth()<=8?"-0":"-")+(n.getMonth()+1)+(n.getDate()<=9?"-0":"-")+n.getDate()}});
//# sourceMappingURL=p.min.js.map
