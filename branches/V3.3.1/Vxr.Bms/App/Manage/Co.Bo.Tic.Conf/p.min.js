define({start:function(n,t){try{var i=n.data;console.log(i);i&&i.CompId&&(n.queryConditions.XCompanyId=i.CompId);t&&t.call(this)}catch(r){}},onBeginSelectionChange:function(n,t){vv.enableItem(n,"button.delete",t!=null)},gDisDate:function(n){return n.record.XDate},gDisTime:function(n){return vIsEstStr(n.record.XTime)?vPrsTm(n.record.XTime):"--:--"},gDisType:function(n){return $.isEmptyObject(n.record.XTypeId)?"---":oTkt[parseInt(n.record.XTypeId)].v},gDisFromId:function(n){return n.record.XFromName},gDisToId:function(n){return n.record.XToName},gDisInfo:function(n){var r=n.record.Info,i,u,t;if(!vIsEstStr(r))return"";if(n.record.XTypeId!=2&&n.record.XTypeId!=5)return r;if(r=="---")return"Tùy chỉnh";if(i=r.split("~"),parseInt(i[1])>=1e3)return"Tất cả ghế";for(u="",t=2;t<i.length;t++)u+=t==2?i[t].split("|")[0]:", "+i[t].split("|")[0];return u},onTimeChange:function(){},rvcXTime:function(n,t){return vPrsTm(t)},afterViewReady:function(){var n=this,r=n.o.view,t={_a:"fGetCompany",_c:{Type:"($x IN (1,2))",IsPrgStatus:1},_f:"Id, Type, Name, BaseId, BusOperatorId"},i;n._listComp=[];i=t._f.split(",");vRql(t,{a:function(){},m:function(t,r){var u={};$.each(i,function(n,t){t=t.trim();u[t]=r[n]});n._listComp.push(u)},z:function(){n._listComp=vSort("Name",!1,n._listComp);n._initOptionComp();n._initOptionAgent()}},n)},afterReload:function(n){var t=this,r=t.o.view,i,u;$(r).find('[data-toggle="toggle"]').bootstrapToggle("destroy").bootstrapToggle();$(r).find(".cbEnBms").bootstrapToggle("on");t.listTrip=[];t.listTime=[];t._resetLstPair();t._resetOptions();t._initOptionType();t._renderTreeData(n);t._applyGrid();i={_a:"fGetTrip",_c:{CompId:t.o.queryConditions.XCompanyId,IsPrgStatus:"$x != 3",Type:"1"},_f:"Id, Name, Info, RouteId, RouteInfo, SeatTemplateInfo"};u=i._f.split(",");vRql(i,{a:function(){},m:function(n,i){var r={};$.each(u,function(n,t){t=t.trim();r[t]=i[n]});t.listTrip.push(r)},z:function(){t.listTrip=vSort("Name",!0,t.listTrip);t._initOptionTrip();t._renderSeatsData();t._bindEvent()}},t)},_applyGrid:function(){var n=this,i=n.o,t=[];$.each(n._treeData,function(n,i){typeof i!="undefined"&&$.each(i,function(i,r){if(typeof r!="undefined"){var u={XTripId:n,XTypeId:i,XTripName:r[0].XTripName,XDate:r[0].XDate,XDateStop:r[0].XDate,Info:r[0].Info};$.each(r,function(f,e){if(u.XDateStop!=e.XDate){var o=moment(u.XDateStop,"DD-MM-YYYY"),s=moment(e.XDate,"DD-MM-YYYY");o.isValid()&&s.isValid()&&o.add(1,"d").isSame(s)?(u.XDateStop=e.XDate,u.Info!=e.Info&&(u.Info="---")):(t.push(u),u={XTripId:n,XTypeId:i,XTripName:r[0].XTripName,XDate:e.XDate,XDateStop:e.XDate,Info:e.Info})}});t.push(u)}})});$("#"+i.gId).jtable("removeAllRows");$("#"+i.gId).jtable("addLocalRecords",function(i,r){return n._listAction(t,r)})},_renderTreeData:function(n){var t=this;t._treeData=[];$.each(n,function(n,i){typeof t._treeData!="undefined"&&t._treeData.length>0&&typeof t._treeData[i.XTripId]!="undefined"?typeof t._treeData[i.XTripId][i.XTypeId]!="undefined"?t._treeData[i.XTripId][i.XTypeId].push(i):t._treeData[i.XTripId][i.XTypeId]=[i]:(t._treeData[i.XTripId]=[],t._treeData[i.XTripId][i.XTypeId]=[i])})},_bindEvent:function(){var t=this,r=t.o,n=r.view,i=!1;$(n).find("select.xLstTime").unbind("change").on("change",function(){var t=$(this).val();t&&t.indexOf("0")>=0?($(n).find("input.eLstTime").parent().removeClass("hidden"),$(n).find("select.xLstTime").parent().addClass("po-re").addClass("wid75")):($(n).find("input.eLstTime").parent().addClass("hidden"),$(n).find("select.xLstTime").parent().removeClass("po-re").removeClass("wid75"))});$(n).find("input.seatTpl").unbind().on("focus",function(){i=!0;$(n).find("div.seatTpl").removeClass("hideSeats")}).on("blur",function(){i=!1});$(n).find(".xDate").unbind("change").change(function(){t.onDateChange()});$(n).find(".xDateStop").unbind("change").change(function(){t.onDateChange()});$(".ticketConf").on("click",function(t){t.preventDefault();var r=$(n).find("div.seatTpl");r.is(t.target)||r.has(t.target).length!==0||(i?r.removeClass("hideSeats"):r.addClass("hideSeats"))});$(n).find("button.sltAllRoute").unbind().on("click",function(){$(n).find("table.tblRoute").find("input:checkbox").each(function(n,t){$(t).prop("checked",!0);$(t).parent().addClass("checked")})}).on("contextmenu",function(t){return t.preventDefault(),$(n).find("table.tblRoute").find("input:checkbox").each(function(n,t){$(t).prop("checked",!1);$(t).parent().removeClass("checked")}),!1});$(n).find("button.pushAllSeat").unbind().on("click",function(){$(n).find("div.seatTpl").find("div.seatSymbol").addClass("seatChecked");t._updateSeatTemplate()}).on("contextmenu",function(){return $(n).find("div.seatTpl").find("div.seatSymbol").removeClass("seatChecked"),t._updateSeatTemplate(),!1})},_getAreaPairs:function(){var n=this,t=n.view,i=$(t).find(".tblRoute input:checkbox");n.listAreaPair=[];$.each(i,function(t,i){$(i).prop("checked")&&n.listAreaPair.push({FrId:$(i).attr("from-id"),ToId:$(i).attr("to-id")})})},_getShortName:function(n){var t="";return $.each(n.trim().split(" "),function(n,i){i.length>0&&(t+=i[0].toUpperCase())}),t},_resetOptions:function(){var r=this,i=r.o,t=i.view,n;i.gId=="rightsTableContainer"&&(n=$(t).find(".xTrip"),n.empty(),n=$(t).find("select.eLstTime"),n.empty(),n=$(t).find("input.xLstTime"),n.val(""),n=$(t).find(".xType"),n.empty(),n=$(t).find(".xFromId"),n.empty(),n=$(t).find(".xToId"),n.empty())},_initSeatTpl:function(){var t=this,i=t.o.view,r=$(i).find("div.seatTpl");r.empty();var f=$(i).find("select.xTrip").val(),e=vGetArr({Id:parseInt(f)},!1,t._arrSeats),n=[],u=0;$.each(e[0].ArrSeat,function(t,i){typeof n[i.r]=="undefined"?(n[i.r]=[],n[i.r][i.f]=[],n[i.r][i.f][i.c]=i.n):typeof n[i.r][i.f]=="undefined"?(n[i.r][i.f]=[],n[i.r][i.f][i.c]=i.n):n[i.r][i.f][i.c]=i.n;i.c>u&&(u=i.c)});$.each(n,function(i,u){if(!$.isEmptyObject(u)){var f=$("<div />").css("display","flex").css("height","40px");$.each(u,function(r,e){if(!$.isEmptyObject(e)){var o=$("<div />");r==u.length-1&&i==n.length-1&&o.addClass("lastRow");r==u.length-1&&o.addClass("aboveFloor");$.each(e,function(n,u){vIsEstStr(u)&&o.append($("<div />").attr("r",i).attr("f",r).attr("c",n).on("click",function(){$(this).hasClass("seatChecked")?$(this).removeClass("seatChecked"):$(this).addClass("seatChecked");t._updateSeatTemplate()}).addClass("seatSymbol ").html(u))});f.append(o)}});r.append(f)}});t._mapSeatInfo()},_initOptionComp:function(n){var r=this,u=r.o,t,i,f;(n||(n=u.view),u.gId=="rightsTableContainer")&&(t=$(n).find(".xCompId"),t.empty(),i=vGetArr({Type:1},!1,r._listComp),i=[{Id:-1,Type:"",Name:"Chọn nhà xe",BusOperatorId:"",BaseId:""}].concat(i),$.each(i,function(n,i){$.vCheckAndAppendOptions(t,i.Id,i.Name,"R",!1,{busoprid:i.BusOperatorId})}),t.val(r.o.queryConditions.XCompanyId),f=$(n).find('select.xCompId option[value="'+t.val()+'"]').attr("busoprid"),$(n).find("input.xOperatorId").val(f))},_initOptionAgent:function(n){var r=this,u=r.o,i,f,t;(n||(n=u.view),u.gId=="rightsTableContainer")&&(i=$(n).find(".xAgentId"),f=$(n).find(".xCompId").val(),i.empty(),t=vGetArr({Type:2,BaseId:parseInt(f)},!1,r._listComp),t=[{Id:1,Type:2,Name:"Vexere",BusOperatorId:1,BaseId:1}].concat(t),t=[{Id:"",Type:"",Name:"Chọn đại lý",BusOperatorId:"",BaseId:""}].concat(t),$.each(t,function(n,t){$.vCheckAndAppendOptions(i,t.Id,t.Name,"R")}))},_initOptionTrip:function(n){var r=this,u=r.o,f,t,i;(n||(n=u.view),u.gId=="rightsTableContainer")&&(f=$(n).find(".xTrip"),t=vGetArr({},!1,r.listTrip),t=vSort("Name",!0,t),t=[{Id:-1,Name:"Chọn chuyến",Info:""}].concat(t),$.each(t,function(n,t){$.vCheckAndAppendOptions(f,t.Id,t.Name,"R")}),i=u.data,i&&i.BaseId&&(f.val(i.BaseId),window.setTimeout(function(){if(r.onTripChange(),i.Time){var t=n.find("select.xLstTime");t&&t.val(i.Time);t&&t.trigger("change").trigger("chosen:updated")}},100)))},_initOptionType:function(n){var r=this,i=r.o,t;(n||(n=i.view),i.gId=="rightsTableContainer")&&(t=$(n).find(".xType"),t.empty(),$.each(oTkt,function(n,i){n==0?$.vCheckAndAppendOptions(t,n,i.v,"R"):app.rights.indexOf(i.r)!=-1&&$.vCheckAndAppendOptions(t,n,i.v,"R")}))},_initTblRoute:function(n){var e=this,f=e.view,i=$(f).find(".tblRoute"),r,t,u;i.empty();r=$("<thead />");t=$("<tr />").append($("<th />"));$.each(n,function(n,r){var u=r.split("|");n!=0&&t.append($("<th />").attr("col-idx",u[0]).append($("<label />").on("click",function(){var n=$(this).parent().attr("col-idx");$(i).find('input[to-id="'+n+'"]').each(function(n,t){$(t).prop("checked",!0);$(t).parent().addClass("checked")})}).css("cursor","pointer").html(u[3])))});r.append(t);u=$("<tbody />");$.each(n,function(r,f){var e=f.split("|");r!=n.length-1&&(t=$("<tr />").append($("<th />").attr("row-idx",e[0]).append($("<label />").on("click",function(){var n=$(this).parent().attr("row-idx");$(i).find('input[from-id="'+n+'"]').each(function(n,t){$(t).prop("checked",!0);$(t).parent().addClass("checked")})}).css("cursor","pointer").html(e[3]))),r%2==0&&t.addClass("even"),$.each(n,function(n,i){var u=i.split("|");n!=0&&(r<n?t.append($("<td />").append($('<input type="checkbox" />').attr("from-id",e[0]).attr("to-id",u[0])).on("click",function(){$(this).hasClass("checked")?($(this).removeClass("checked"),$(this).find("input:checkbox").prop("checked",!1)):($(this).addClass("checked"),$(this).find("input:checkbox").prop("checked",!0))})):t.append($("<td />").addClass("block")))}),u.append(t))});i.append(r).append(u);$(f).find(".sltAllRoute").removeClass("hidden")},_initOptionSeats:function(){var n=this,i=n.o.view,t=$(i).find("select.seats"),r,u;t.empty();r=$(i).find("select.xTrip").val();u=vGetArr({Id:parseInt(r)},!1,n._arrSeats);$.each(u[0].ArrSeat,function(n,i){var r={f:i.f,r:i.r,c:i.c};$.vCheckAndAppendOptions(t,i.n,i.n,"R",!1,r)});n._mapSeatInfo();t.trigger("chosen:updated")},_mapSeatInfo:function(){var f=this,t=f.o.view,e=$(t).find("input.info").val(),n,u,i,r;if(vIsEstStr(e)){if(n=e.split("~"),u=$(t).find(".cbEnBms"),n[0]=="1"?u.bootstrapToggle("off"):u.bootstrapToggle("on"),$(t).find("div.seatTpl").find("div.seatSymbol").removeClass("seatChecked"),parseInt(n[1])<1e3)for(i=2;i<n.length;i++)r=n[i].split("|"),$(t).find("div.seatTpl").find('div.seatSymbol[f="'+r[1]+'"][c="'+r[3]+'"][r="'+r[2]+'"]').addClass("seatChecked");f._updateSeatTemplate()}},_updateSeatTemplate:function(){var n=[],t=this.view;$(t).find("div.seatTpl").find("div.seatChecked").each(function(t,i){n.push($(i).text())});$(t).find("input.seatTpl").val(n.join(", "))},_renderSeatsData:function(){var n=this,t=n.o.view;n._arrSeats=[];$.each(n.listTrip,function(t,i){for(var r,o,e=i.SeatTemplateInfo.split("~"),u=[],f=1;f<e.length;f++)r=e[f].split("|"),r.length>11&&(r[2]==1||r[2]==2||r[2]==3)&&(o={n:r[4],f:r[5],r:r[6],c:r[7]},u.push(o));u=vSort("n",!1,u);n._arrSeats.push({Id:i.Id,ArrSeat:u})})},onCompChange:function(){var t=this,r=t.o.view,i=$(r).find("select.xCompId").val(),u,n,f;console.log("onCompChange",i);i!="-1"&&(t.o.queryConditions.XCompanyId=i,t._reloadTable());u=$(r).find(".xAgentId");u.empty();n=vGetArr({Type:2,BaseId:parseInt(i)},!1,t._listComp);n=[{Id:1,Type:2,Name:"Vexere",BusOperatorId:1,BaseId:1}].concat(n);n=[{Id:"",Name:"Chọn đại lý",BusOperatorId:"",Type:2}].concat(n);$.each(n,function(n,t){$.vCheckAndAppendOptions(u,t.Id,t.Name,"R",!1)});f=$(r).find('select.xCompId option[value="'+i+'"]').attr("busoprid");$(r).find("input.xOperatorId").val(f);t._unloadTable()},onTripChange:function(){var t=this,n=t.o.view,r=$(n).find("select.xLstTime"),e,u,i,o,f;r.empty();t.arrRoutes=[];e=parseInt($(n).find(".xTrip").val());e!=-1?(u=vGetArr({Id:e},!1,t.listTrip),i=u[0].Info.split("~"),i=i.concat(["Khác"]),$.each(i,function(n,t){n==i.length-1?$.vCheckAndAppendOptions(r,"0",t,"R"):$.vCheckAndAppendOptions(r,t,t,"R")}),o=u[0].RouteId,$(n).find("input.xRouteId").val(o),f=u[0].RouteInfo.split("~"),f=f.slice(1),t._initSeatTpl(),t._initTblRoute(f)):($(n).find(".tblRoute").empty(),$(n).find("select.seat").empty().trigger("chosen:updated"),$(n).find(".sltAllRoute").addClass("hidden"));r.trigger("change").trigger("chosen:updated")},onTypeChange:function(){},onDateChange:function(){var n=this,i=n.view;if(typeof n.model!="undefined"&&!$.isEmptyObject(n.model)){var t=$(i).find(".xDate").val(),r=$(i).find(".xDateStop").val(),u=parseInt($(i).find(".xTrip").val()),f=parseInt($(i).find(".xType").val());moment(t,"DD-MM-YYYY").isValid()?moment(r,"DD-MM-YYYY").isValid()?(moment(t,"DD-MM-YYYY").isAfter(moment(r,"DD-MM-YYYY"))&&$(i).find(".xDateStop").datepicker("setDate",vPrsDt(t)),n._renderData(u,f,t,r)):n._renderData(u,f,t,t):n._renderData(u,f,"","")}},onDateStopChange:function(){var n=this,t=n.view},onItemLoaded:function(n){var t=this,e=t.o,i=e.view,u=n.XTripId,f=n.XTypeId,o=n.XStatus,s=n.XDate,r=n.XDateStop;t._resetLstPair();$(i).find(".xTrip").val(u);$(i).find(".xType").val(f);$(i).find(".status").val(o);t.onTripChange();t._renderData(u,f,s,r);setTimeout(function(){moment(r,"DD-MM-YYYY").isValid()&&$(i).find(".xDateStop").datepicker("setDate",vPrsDt(r))},0)},onAfterUnloadItem:function(){var n=this,t=n.o.view;n._unloadTable()},_renderData:function(n,t,i,r){var e=this,u=e.view,o=$(u).find(".tblRoute"),f=$(u).find(".xLstTime");$(u).find("input.eLstTime").val("");f.val("");$(o).find("input:checkbox").each(function(n,t){$(t).prop("checked",!1);$(t).parent().removeClass("checked")});e._treeData[n]&&e._treeData[n][t]&&$.each(e._treeData[n][t],function(n,t){var c=moment(i,"DD-MM-YYYY"),l=moment(r,"DD-MM-YYYY"),s=moment(t.XDate,"DD-MM-YYYY"),h,a,e;if(t.XDate==i||c.isValid()&&l.isValid()&&s.isValid()&&(c.isBefore(s)||c.isSame(s))&&(l.isAfter(s)||l.isSame(s)))try{$(o).find('input:checkbox[from-id="'+t.XFromId+'"][to-id="'+t.XToId+'"]').each(function(n,t){$(t).prop("checked",!0);$(t).parent().addClass("checked")});$.isEmptyObject(t.XTime)||(h=vPrsTm(t.XTime),a=f.find('option[value="'+h+'"]'),a.length>0?a.prop("selected",!0):(f.find('option[value="0"]').prop("selected",!0),f.trigger("change"),e=$(u).find("input.eLstTime").val(),vIsEstStr(e)?e.indexOf(h)<0&&(e=e+","+h):e=h,$(u).find("input.eLstTime").val(e)));$(u).find(".timeLimit").val(t.TimeLimit)}catch(v){console.log(v)}});f.trigger("chosen:updated")},_unloadTable:function(){var n=this.o.view;$(n).find(".xTrip").val(-1);$(n).find(".info").val("");$(n).find(".xLstTime").val("").trigger("change").trigger("chosen:updated");$(n).find(".xType").val("0").trigger("change");$(n).find(".xDateStop").datepicker("enable");$(n).find(".xToId").empty();$(n).find(".xFromId").empty();$(n).find("select.seats").empty().trigger("chosen:updated");$(n).find("button.pushAreaPair").attr("disabled",!1);$(n).find(".cbEnBms").bootstrapToggle("on");$(n).find(".tblRoute").empty();$(n).find("div.seatTpl").empty();$(n).find("input.seatTpl").val("");$(n).find(".sltAllRoute").addClass("hidden");setTimeout(function(){$(n).find(".xDate").datepicker("setDate",new Date)},0);this._resetLstPair()},_resetLstPair:function(){var n=this;n.listAreaPair=[];n._bindEvent()},onRightSave:function(){this._checkDataValid()&&(this._onSave(),$(this.view).find("select.seats").empty().trigger("chosen:updated"))},_checkDataValid:function(){var e=this,i=e.o.view,r=!1,f="",s=$(i).find(".xType").val(),c,h,o,l,t,y;if(s=="0"&&(r=!0,f+="Vui lòng chọn kiểu cấu hình."),c=$(i).find(".xAgentId").val(),s==5&(!c||c=="")&&(r=!0,f+="Vui lòng chọn đại lý."),h=$(i).find(".xTrip").val(),h&&h!=-1?$(i).find(".xTripId").val(h):(r=!0,f+="Vui lòng chọn chuyến."),o=$(i).find("select.xLstTime").val(),!$.isEmptyObject(o)&&o.length>1&&e.model&&e.model.Id&&(r=!0,f+="Không thể cập nhật nhiều giờ."),!$.isEmptyObject(o)&&o.length>0&&o.indexOf("0")>=0&&(l=$(i).find("input.eLstTime").val(),vIsEstStr(l)?$.each(l.split(","),function(n,t){r||moment(t.trim(),"HH:mm").isValid()||(r=!0,f+="Thời gian bạn nhập không đúng.")}):(r=!0,f+="Vui lòng thêm giờ khác.")),s==5||s==2){var n=$(i).find("div.seatTpl").find("div.seatChecked"),u="",a=!1,v=0;if(a=$(i).find(".cbEnBms").prop("checked")?!0:!1,n&&n.length>0){for(t=0;t<n.length;t++){var p=$(n[t]).attr("f"),w=$(n[t]).attr("r"),b=$(n[t]).attr("c");u+="~"+$(n[t]).text()+"|"+p+"|"+w+"|"+b}u=a?"2~"+n.length+u:"1~"+n.length+u}else{for(n=$(i).find("div.seatTpl").find("div.seatSymbol"),t=0;t<n.length;t++){var p=$(n[t]).attr("f"),w=$(n[t]).attr("r"),b=$(n[t]).attr("c");u+="~"+$(n[t]).text()+"|"+p+"|"+w+"|"+b}v=1e3+n.length;u=a?"2~"+v+u:"1~"+v+u}$(i).find("input.info").val(u)}return y=$(i).find(".timeLimit").val(),(!vIsEstStr(y)||isNaN(y))&&$(i).find(".timeLimit").val(0),e._getAreaPairs(),(!e.listAreaPair||e.listAreaPair.length<=0)&&(r=!0,f+="Vui lòng chọn chặng đường."),r?(vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:f}),!1):!0},_onSave:function(){var t=this,n=t.o.view,r=$(n).find(".xTrip").val(),c=$(n).find(".xRouteId").val(),l=$(n).find(".xOperatorId").val(),a=$(n).find(".xAgentId").val(),u=$(n).find(".xType").val(),i=$(n).find("select.xLstTime").val(),p=$(n).find("input.eLstTime").val(),v=$(n).find("input.info").val(),o=$(n).find(".xDate").val(),s=$(n).find(".xDateStop").val(),y=$(n).find(".timeLimit").val(),f=[],e=[],h;!$.isEmptyObject(i)&&i.length>0?(h=i.indexOf("0"),h>=0&&(i.splice(h,1),$.each(p.split(","),function(n,t){i.indexOf(t.trim())<0&&i.push(t.trim())}))):i=[""];$.each(i,function(n,i){$.each(t.listAreaPair,function(n,h){var w={XTypeId:u,XStatus:1,XOperatorId:l,XCompanyId:t.o.queryConditions.XCompanyId,XRouteId:c,XTripId:r,XDate:"",XTime:i,Info:v,XFromId:h.FrId,XToId:h.ToId,TimeLimit:y,IsPrgStatus:1},b={XTypeId:u,XCompanyId:t.o.queryConditions.XCompanyId,XTripId:r,XDate:"",XTime:i,XFromId:h.FrId,XToId:h.ToId},k,d,g,nt,p;if(typeof o!="undefined"&&vIsEstStr(o))if(k=o.split("-"),d=new Date(k[2],k[1]-1,k[0]),typeof s!="undefined"&&vIsEstStr(s))for(g=s.split("-"),nt=new Date(g[2],g[1]-1,g[0]),p=d;p<=nt;p.setDate(p.getDate()+1))w={XTypeId:u,XStatus:1,XOperatorId:l,XCompanyId:t.o.queryConditions.XCompanyId,XAgentId:a,XRouteId:c,XTripId:r,XDate:vDtToStr("iso",p),XTime:i,Info:v,XFromId:h.FrId,XToId:h.ToId,TimeLimit:y,IsPrgStatus:1},b={XTypeId:u,XCompanyId:t.o.queryConditions.XCompanyId,XAgentId:a,XTripId:r,XDate:vDtToStr("iso",p),XTime:i,XFromId:h.FrId,XToId:h.ToId},f.push(w),e.push(b);else w.XDate=vDtToStr("iso",d),b.XDate=vDtToStr("iso",d),f.push(w),e.push(b);else f.push(w),e.push(b)})});t._saveData(f,e,t.o.updateAction)},_saveData:function(n,t,i){var r=this,u=r.o,f=u.view,e,o=parseInt($("#"+u.gId+" .jtable-page-size-change select").val());e={_a:i,_c:t,_d:n};vRqs(e,function(n){n?(r.onActionComplete&&r.onActionComplete.call(r),vv.showMessage({element:f.find(".alert.message"),type:"alert-success",content:"Thao tác thành công."}),r.onUpdateSuccess?r.onUpdateSuccess.call():r._reloadTable(null,function(){vv.clearFormAndGrid(f);r._unloadTable();$("#"+u.gId+" .jtable-page-size-change select").val(o)},null)):vv.showMessage({element:f.find(".alert.message"),type:"alert-danger",content:"Thao tác thất bại, vui lòng thử lại sau."})})},_onDelete:function(){var i=this,t=i.o.view,s=$(t).find(".xTrip").val(),l=$(t).find(".xAgentId").val(),h=$(t).find(".xType").val(),n=$(t).find("select.xLstTime").val(),c=$(t).find("input.eLstTime").val(),f=$(t).find(".xDate").val(),e=$(t).find(".xDateStop").val(),r=[],u=[],o;!$.isEmptyObject(n)&&n.length>0?(o=n.indexOf("0"),o>=0&&(n.splice(o,1),$.each(c.split(","),function(t,i){n.indexOf(i.trim())<0&&n.push(i.trim())}))):n=[""];$.each(n,function(n,t){$.each(i.listAreaPair,function(n,o){var y={XStatus:0,IsPrgStatus:3},c={XTypeId:h,XCompanyId:i.o.queryConditions.XCompanyId,XTripId:s,XDate:"",XTime:t,XFromId:o.FrId,XToId:o.ToId},a,p,v,w,l;if(typeof f!="undefined"&&vIsEstStr(f))if(a=f.split("-"),p=new Date(a[2],a[1]-1,a[0]),typeof e!="undefined"&&vIsEstStr(e))for(v=e.split("-"),w=new Date(v[2],v[1]-1,v[0]),l=p;l<=w;l.setDate(l.getDate()+1))c={XTypeId:h,XCompanyId:i.o.queryConditions.XCompanyId,XTripId:s,XDate:vDtToStr("iso",l),XTime:t,XFromId:o.FrId,XToId:o.ToId},r.push(y),u.push(c);else c.XDate=vDtToStr("iso",p),r.push(y),u.push(c);else r.push(y),u.push(c)})});i._saveData(r,u,i.o.removeAction)},onRightDelete:function(){this._checkDataValid()&&this._onDelete()},onRightClear:function(){this.onBasicClear();this._unloadTable()},onVMLoaded:function(){var t=this,i=t.o.view,n=t.o.data;n&&n.Date&&i.find(".xDate").val(n.Date)}});
//# sourceMappingURL=p.min.js.map
