(function(n){var t={_create:n.custom.vbooking.prototype._create};n.extend(!0,n.custom.vbooking.prototype,{options:{operatorName:""},_create:function(){t._create.apply(this,arguments);!this.options.serviceUrl},_printByTemplate:function(t){var u=n("<div />").addClass("phoi"),r="Print",i=window.open("about:blank",r,"width="+screen.width+", height="+screen.height+", scrollbars=1");i.document.write("<html><head><title>"+r+'<\/title><link rel="stylesheet" href="/Content/css/print_'+t.orientation+'.css" type="text/css" /><\/head><body>'+t.html+"<\/body><\/html>");i.focus();setTimeout(function(){i.print()},2500)},getInfoObject:function(){var r=this,e,t,i,a,et,u,f;if(r._phoiTemplates==null||(e=r._phoiTemplates[r._data[r._cTripIndex].Ts[r._cTripTime][r._cTripBus].SeatTemplateId],e==null))return null;t=r._getCurrentTripInfo();i={};i.phoi={};i.seats={};i.phoi.title=n.trim(r.options.cifne);i.phoi.routeName=n.trim(r._data[r._cTripIndex].Name);i.phoi.tripTime=n.trim(r._cTripTime);i.phoi.tripDate=n.trim(r._cTripDate.toFormatString("dd-mm-yyyy"));i.phoi.busNumber=t._vehicleNumber;i.phoi.driverName=t._driverName;i.phoi.assistantName=t._assistantName;var ot=r._data[r._cTripIndex].Ts[r._cTripTime][0].ClosedStatus,o=t._anotherFareTienKhach,st=t._mainFareTienKhach,s=t._feeTienKhach,l=t._feeTienHang,v=o+st-s,y=t._totalMoneyBranchNotPaid+t._totalMoneyBranchPaid+t._moneyPickedProNotPaid+t._moneyPickedProPaid-l,p=0;t._anotherFee.length>0&&n.each(t._anotherFee,function(n,t){p+=t._money.toNum()});var w=t._tollFee+t._washFee+t._eatFee+p,ht=v+y-w,b=[];t._branchProduct.length>0&&n.each(t._branchProduct,function(n,t){var i=".................",r=".................",u;t._moneyBranchProPaid>0&&(i=t._moneyBranchProPaid.toMn());t._moneyBranchProNotPaid>0&&(r=t._moneyBranchProNotPaid.toMn());u=t._branchCode+": Đã T<sup>2<\/sup>-"+i+"đ, Chưa T<sup>2<\/sup>-"+r+"đ";b.push(u)});var k="",d="..................................",g="..................................";d=t._moneyPickedProPaid>0?"Đã T<sup>2<\/sup>-"+t._moneyPickedProPaid.toMn()+"đ, ":"Đã T<sup>2<\/sup>-..................đ, ";g=t._moneyPickedProNotPaid>0?"Chưa T<sup>2<\/sup>-"+t._moneyPickedProNotPaid.toMn()+"đ":"Chưa T<sup>2<\/sup>-.................đ";k=d+g;a=[];t._anotherFee.length>0&&n.each(t._anotherFee,function(n,t){t._name!=""&&t._money>0&&a.push(t._name+" - "+t._money.toNum().toMn()+" đ")});var nt="",h="",tt="",it="";ot==2&&(nt=v.toMn()+" đ",h=y.toMn()+" đ",tt=w.toMn()+" đ",it=ht.toMn()+" đ");var rt="",ut="",ft="";s>0&&(rt="Chi phí VP:&nbsp;&nbsp;"+s.toMn()+" đ",ut="Còn:&nbsp;&nbsp;"+(t._totalPaid+o-s).toMn()+" đ");ft=l>0?"CP hàng:&nbsp;"+l.toMn()+" đ&nbsp;&nbsp;&#x21d2;&nbsp;&nbsp;Còn:&nbsp;&nbsp;"+h:"&#x21d2;&nbsp;&nbsp;Tổng:&nbsp;&nbsp;"+h;i.phoi.totalPaidPerType=t._totalPaidPerType;i.phoi.totalBookingPerAgent=t._totalBookingPerAgent;i.phoi.totalPaid=t._totalPaid>0?t._totalPaid.toMn()+" đ":"";i.phoi.totalMoney=t._totalMoney;i.phoi.tollFee=t._tollFee!=0?t._tollFee.toMn()+" đ":"..................đ";i.phoi.washFee=t._washFee!=0?t._washFee.toMn()+" đ":".......................đ";i.phoi.eatFee=t._eatFee!=0?t._eatFee.toMn()+" đ":"........................đ";i.phoi.feeTienHang=t._feeTienHang!=0?t._feeTienHang.toMn()+" đ":".....................đ";i.phoi.moneyBranchProduct=b.join("<br />");i.phoi.anotherFee=a.join("<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");i.phoi.totalTienKhach=nt;i.phoi.totalTienHang=h;i.phoi.totalFee=tt;i.phoi.totalTotal=it;i.phoi.feeTienKhachFormat=rt;i.phoi.totalTienKhachFormat=ut;i.phoi.anotherFareTienKhachFormat=o>0?"(DT khác: "+o.toMn()+" đ)":"";i.phoi.totalTienHangFormat=ft;i.phoi.pickedProductFormat=k;var ct=r._data[r._cTripIndex].Ts[r._cTripTime][r._cTripBus].NS,f=[],c=0;return n.each(r._m,function(t,i){n.each(i,function(n,t){typeof t!="undefined"&&t!=null&&c<t.length&&(c=t.length)})}),et=r._m.length,_dict._pTplNumCoach!=0&&(et=_dict._pTplNumCoach),_dict._pTplNumCol!=0&&(c=_dict._pTplNumCol),u=function(n,t,i){if(n==null||n=="")return"";var r=n.split(t);return r.length>i?r[i]:""},f=[],n.each(r._m,function(t,e){typeof e!="undefined"&&e!=null&&n.each(e,function(t,e){var p,h,y,v,l,a;if(typeof e!="undefined"&&e!=null)for(p=e.numEstIt(),h=0;h<c;h++)if(typeof e[h]!="undefined"&&e[h]!=null){var w=e[h]._getSeatId(),s=e[h]._getCurrentTicket(),o={};if(o.floorIndex=e[h]._coach,o.label=e[h]._label,o.rowIndex=e[h]._row,o.columnIndex=e[h]._col,o.groupSeatDisplay="hide",o.seatDisplay="",o.isPaid="",!n.isEmptyObject(s)&&(o.t=s,o.customerPhone=s._cphone,o.createdUser=s._cuser,o.customerName=s._cname,o.fare=s._fare.toMn(),o.note=s._note,o.pickupInfo=u(s._pInfo,"|",0),o.paymentType=u(s._pmInfo,":",1),o.fromArea=u(s.fromArea,"|",3),o.fromAreaShort=u(s.fromArea,"|",2),o.toArea=u(s.toArea,"|",3),o.toAreaShort=u(s.toArea,"|",2),o.ticketsCount=1,o.groupPhone=s._cphone,o.createdUser=s._cuser!=null?s._cuser:"",o.chargedUser=s._suser!=null?s._suser:"",n.isEmptyObject(s)||typeof r._cphoneSt[s._getDefaultPhoneNumber()]=="undefined"||(o.ticketsCount=r._cphoneSt[s._getDefaultPhoneNumber()].length),(s._status==2||s._status==5)&&(o.isPaid="isPaid"),typeof _dict.groupSeat!="undefined"&&!n.isEmptyObject(s))){if(y=!1,f.length>0)for(v=0;v<f.length;v++)if(r.isTwoSeatPerfectTogether(s,f[v],_dict.groupSeat.groupFields)){if(y=!0,o.originalSeatCode=f[v].seatLabel,o.groupSeatDisplay="",o.seatDisplay="hide",l=_dict.groupSeat.displayFields.split(","),l.length>0)for(a=0;a<l.length;a++)l[a].indexOf("phone")>=0&&l[a].indexOf("|")>=0&&(o.groupPhone=s._cphone.substring(s._cphone.length-parseInt(l[a].split("|")[1])));break}y||f.push(s)}o.ticketsCountGtZero=o.ticketsCount>1?o.ticketsCount:"";i.seats[w]=o}})}),{html:vtpl(e.html,i),orientation:e.orientation}},_printBKS:function(t){var i=n("<div />").addClass("print-container"),u,f,r;if(i.append(this._renderBKSTitle()),vIsEstStr(t)&&t=="in-danh-sach")i.append(this._inDanhSach());else{if(u=this.getInfoObject(),u!=null){this._printByTemplate(u);return}i.append(this._renderPrintSeatTemplate())}app.oRights.StageEnable&&_dict._pStageTicket&&i.append(this._renderStageTicketsTemplate());_dict._hasPickUpOnPrintBKS&&i.append(this._renderPrintPickupTemplate().addClass("list").css("page-break-before","always"));typeof _dict._pSummaryTripInfo!="undefined"&&_dict._pSummaryTripInfo&&i.append(this._renderPrintTripInfo());FlatObj.RBePrint=!1;f="BookingSheet"+(new Date).getTime();r=window.open("about:blank",f,"width="+screen.width+", height="+screen.height+", scrollbars=1");r.document.write("<html><head><title>"+f+'<\/title><link rel="stylesheet" href="'+_dict._pStyleUrlDefault+'" type="text/css" /><link rel="stylesheet" href="'+_dict._pStyleUrl+'" type="text/css" /><\/head><body>'+i.html()+"<\/body><\/html>");r.focus();setTimeout(function(){r.print()},2500)},_renderBKSTitle:function(){var t=this,h=n("<div />").addClass("row"),u=t._getCurrentTripInfo(),r=n.trim(t._cTripTime),i=null,f,e,o,s,c;if(t._data[t._cTripIndex].Ts[t._cTripTime][0].TripDriver!=null)if(i=t._data[t._cTripIndex].Ts[t._cTripTime][0].TripDriver.split("~"),i.length>1){for(f=0;f<i.length;f++)if(e=i[f].split("|"),e[0]===n.trim(t._cTripTime)&&e[1]!=""){r+=" / "+e[1];break}}else i[0]!=""&&(r=" / "+i[0]);else if(t._data[t._cTripIndex].TripDriver!=null)if(i=t._data[t._cTripIndex].TripDriver.split("~"),i.length>1){for(o=0;o<i.length;o++)if(s=i[o].split("|"),s[0]===n.trim(t._cTripTime)&&s[1]!=""){r+=s[1];break}}else i[0]!=""&&(r+=i[0]);return r+=" - &nbsp;ngày&nbsp;"+n.trim(t._cTripDate.toFormatString("dd-mm-yyyy")),c={p:{_title:n.trim(t.options.cifne),_rname:n.trim(t._data[t._cTripIndex].Name),_time:r,_busNum:u._vehicleNumber,_driverName:u._driverName,_assistantName:u._assistantName,_note:u._note}},h.append(n(vtpl(_dict._pTitleTpl,c))),h},_renderStageName:function(n,t){if(t){var r=t.data.length-1,u=n.toString(2),f=r-u.length,i=u.indexOf("0");return i=i==-1?r:f+i,t.data[f].Name+" - "+t.data[i].Name}return""},_renderStageNameShort:function(n,t){if(t){var r=t.data.length-1,u=n.toString(2),f=r-u.length,i=u.indexOf("0");return i=i==-1?r:f+i,t.data[f].Code+" - "+t.data[i].Code}return""},_renderStageTicketsTemplate:function(){var t=this,i=t._data[t._cTripIndex].StopPoints,r=n(vtpl(_dict._pvcTpl,{})),u=r.find("tbody"),f=1,e=["Avaliable","Đặt chỗ","Đã TT","Đã hủy","Passed","Không đến","PainNotPrint "];return n.each(t._printStageTickets,function(r,o){o._pInfo=o._getPickupInfo().text;o._stt=f;o._statusLabel=e[o._status];o._stageName=t._renderStageName(o.stageCode,i);o._stageNameShort=t._renderStageNameShort(o.stageCode,i);o._fare=o._fare.toString().indexOf(".")==-1?o._fare!=0?o._fare.toMn()+"đ":"":o._fare;o._hasPaid=o._status==1?"chua-thanh-toan":"da-thanh-toan";o._user=o._cuser!=null?o._cuser:o._suser;var s=n(vtpl(_dict._pvcRTpl,o));u.append(s);f++}),typeof _dict._pSummaryTripInfo!="undefined"&&_dict._pSummaryTripInfo&&u.closest("body").append(t._renderPrintTripInfo()),r.html()},_renderPrintSeatTemplate:function(){var t=this,i=t._data[t._cTripIndex].Ts[t._cTripTime][t._cTripBus].NS,s=n("<div />").addClass("row"),h=null,e,r,o,f,u;return typeof _dict._pSpecialPos!="undefined"&&typeof _dict._pSpecialPos[i]!="undefined"&&(h=_dict._pSpecialPos[i]),e=t._transformSeatMatrix(h),r=0,n.each(e,function(t,i){n.each(i,function(n,t){typeof t!="undefined"&&t!=null&&r<t.length&&(r=t.length)})}),o=e.length,_dict._pTplNumCoach!=0&&(o=_dict._pTplNumCoach),_dict._pTplNumCol!=0&&(r=_dict._pTplNumCol),f=[],u=1,n.each(e,function(e,h){var c,a,l;typeof h!="undefined"&&h!=null&&(c=t._createCoach(s).addClass(_dict._g[o-1]).addClass("SeatTemp"+i),n.each(h,function(i,u){var k,w,o,e,v,s,b,p,y,l,a;if(typeof u!="undefined"&&u!=null){for(k=u.numEstIt(),w=null,o=0;o<r;o++)if(typeof u[o]!="undefined"&&u[o]!=null){if(e=u[o]._getCurrentTicket(),v=0,n.isEmptyObject(e)||typeof t._cphoneSt[e._getDefaultPhoneNumber()]=="undefined"||(v=t._cphoneSt[e._getDefaultPhoneNumber()].length),e.isStageSeat)s=u[o]._renderPrintStageSeat(v);else if(s=u[o]._renderPrintSeat(v,t._data[t._cTripIndex].StopPoints),typeof _dict.groupSeat!="undefined"&&!n.isEmptyObject(e)){if(b=!1,f.length>0)for(p=0;p<f.length;p++)if(t.isTwoSeatPerfectTogether(e,f[p],_dict.groupSeat.groupFields)){if(b=!0,y={data:{seatCode:e.seatLabel,originalSeatCode:f[p].seatLabel,nTk:v}},l=_dict.groupSeat.displayFields.split(","),l.length>0){for(a=0;a<l.length;a++)l[a].indexOf("phone")>=0?y.data.phone=l[a].indexOf("|")>=0?e._cphone.substring(e._cphone.length-parseInt(l[a].split("|")[1])):e._cphone:l[a].indexOf("note")>=0?y.data.note=e._note:l[a].indexOf("pInfo")>=0&&(y.data.pInfo=e._pInfo.split("|")[0]),y.data._paid=e._status==2||e._status==5?"da-thanh-toan":"";s=u[o]._renderPrintSeat(v,t._data[t._cTripIndex].StopPoints,y.data)}break}b||f.push(e)}_dict._pNoSeat?s.addClass(_dict._g[r-1]):s.addClass(_dict._g[k-1]);o==r-1&&s.find("table").addClass("br");i==h.length-1&&s.find("table").addClass("bb");c.append(s);w=s}else _dict._pNoSeat&&c.append(t._renderPrintNoSeat().addClass(_dict._g[r-1]));w!=null&&w.find("table").addClass("br")}}),_dict._pSNote!=undefined&&_dict._pSNote&&(a={},l=null,_dict._pSNoteCoachEffective!=undefined&&(_dict._pSNoteCoachEffective[i]!=undefined?_dict._pSNoteCoachEffective[i]==u&&_dict._pSNoteInfo!=undefined&&_dict._pSNoteInfo[i]!=undefined&&_dict._pSNoteInfo[i][u]!=undefined&&(l=n(vtpl(_dict._pSNoteInfo[i][u],a)),c.append(l)):_dict._pSNoteInfo!=undefined&&_dict._pSNoteInfo[i]!=undefined&&_dict._pSNoteInfo[i][u]!=undefined&&(l=n(vtpl(_dict._pSNoteInfo[i][u],a)),c.append(l)))));u++}),s},_renderPrintNoSeat:function(){return n("<li />").addClass("print-noseat").html("&nbsp;")},_renderPrintTripInfo:function(){var i=this,e=null,s,it;e=typeof _dict._pSummaryTripInfoPageBreak!="undefined"&&_dict._pSummaryTripInfoPageBreak?n('<div class="row" />').css("page-break-before","always"):n('<div class="row" />');var t=i._getCurrentTripInfo(),rt=i._data[i._cTripIndex].Ts[i._cTripTime][0].ClosedStatus,r=t._anotherFareTienKhach,ut=t._mainFareTienKhach,u=t._feeTienKhach,o=t._feeTienHang,h=r+ut-u,c=t._totalMoneyBranchNotPaid+t._totalMoneyBranchPaid+t._moneyPickedProNotPaid+t._moneyPickedProPaid-o,l=0;t._anotherFee.length>0&&n.each(t._anotherFee,function(n,t){l+=t._money.toNum()});var a=t._tollFee+t._washFee+t._eatFee+l,ft=h+c-a,v=[];t._branchProduct.length>0&&n.each(t._branchProduct,function(n,t){var i=".................",r=".................",u;t._moneyBranchProPaid>0&&(i=t._moneyBranchProPaid.toMn());t._moneyBranchProNotPaid>0&&(r=t._moneyBranchProNotPaid.toMn());u=t._branchCode+": Đã T<sup>2<\/sup>-"+i+"đ, Chưa T<sup>2<\/sup>-"+r+"đ";v.push(u)});var y="",p="..................................",w="..................................";p=t._moneyPickedProPaid>0?"Đã T<sup>2<\/sup>-"+t._moneyPickedProPaid.toMn()+"đ, ":"Đã T<sup>2<\/sup>-..................đ, ";w=t._moneyPickedProNotPaid>0?"Chưa T<sup>2<\/sup>-"+t._moneyPickedProNotPaid.toMn()+"đ":"Chưa T<sup>2<\/sup>-.................đ";y=p+w;s=[];t._anotherFee.length>0&&n.each(t._anotherFee,function(n,t){t._name!=""&&t._money>0&&s.push(t._name+" - "+t._money.toNum().toMn()+" đ")});var b="",f="",k="",d="";rt==2&&(b=h.toMn()+" đ",f=c.toMn()+" đ",k=a.toMn()+" đ",d=ft.toMn()+" đ");var g="",nt="",tt="";return u>0&&(g="Chi phí VP:&nbsp;&nbsp;"+u.toMn()+" đ",nt="Còn:&nbsp;&nbsp;"+(t._totalPaid+r-u).toMn()+" đ"),tt=o>0?"CP hàng:&nbsp;"+o.toMn()+" đ&nbsp;&nbsp;&#x21d2;&nbsp;&nbsp;Còn:&nbsp;&nbsp;"+f:"&#x21d2;&nbsp;&nbsp;Tổng:&nbsp;&nbsp;"+f,it={p:{_title:n.trim(i.options.cifne),_rname:n.trim(i._data[i._cTripIndex].Name),_time:n.trim(i._cTripTime)+"&nbsp;ngày&nbsp;"+n.trim(i._cTripDate.toFormatString("dd-mm-yyyy")),_busNum:t._vehicleNumber,_driverName:t._driverName,_assistantName:t._assistantName,_totalPaidPerType:t._totalPaidPerType,_totalBookingPerAgent:t._totalBookingPerAgent,_totalPaid:t._totalPaid>0?t._totalPaid.toMn()+" đ":"",_totalMoney:t._totalMoney,_tollFee:t._tollFee!=0?t._tollFee.toMn()+" đ":"..................đ",_washFee:t._washFee!=0?t._washFee.toMn()+" đ":".......................đ",_eatFee:t._eatFee!=0?t._eatFee.toMn()+" đ":"........................đ",_feeTienHang:t._feeTienHang!=0?t._feeTienHang.toMn()+" đ":".....................đ",_moneyBranchProduct:v.join("<br />"),_anotherFee:s.join("<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),_totalTienKhach:b,_totalTienHang:f,_totalFee:k,_totalTotal:d,_feeTienKhachFormat:g,_totalTienKhachFormat:nt,_anotherFareTienKhachFormat:r>0?"(DT khác: "+r.toMn()+" đ)":"",_totalTienHangFormat:tt,_pickedProductFormat:y}},e.append(n(vtpl(_dict._tripInfo,it))),e},_renderPrintTripInfo:function(){var i=this,e=null,s,it;e=typeof _dict._pSummaryTripInfoPageBreak!="undefined"&&_dict._pSummaryTripInfoPageBreak?n('<div class="row" />').css("page-break-before","always"):n('<div class="row" />');var t=i._getCurrentTripInfo(),rt=i._data[i._cTripIndex].Ts[i._cTripTime][0].ClosedStatus,r=t._anotherFareTienKhach,ut=t._mainFareTienKhach,u=t._feeTienKhach,o=t._feeTienHang,h=r+ut-u,c=t._totalMoneyBranchNotPaid+t._totalMoneyBranchPaid+t._moneyPickedProNotPaid+t._moneyPickedProPaid-o,l=0;t._anotherFee.length>0&&n.each(t._anotherFee,function(n,t){l+=t._money.toNum()});var a=t._tollFee+t._washFee+t._eatFee+l,ft=h+c-a,v=[];t._branchProduct.length>0&&n.each(t._branchProduct,function(n,t){var i=".................",r=".................",u;t._moneyBranchProPaid>0&&(i=t._moneyBranchProPaid.toMn());t._moneyBranchProNotPaid>0&&(r=t._moneyBranchProNotPaid.toMn());u=t._branchCode+": Đã T<sup>2<\/sup>-"+i+"đ, Chưa T<sup>2<\/sup>-"+r+"đ";v.push(u)});var y="",p="..................................",w="..................................";p=t._moneyPickedProPaid>0?"Đã T<sup>2<\/sup>-"+t._moneyPickedProPaid.toMn()+"đ, ":"Đã T<sup>2<\/sup>-..................đ, ";w=t._moneyPickedProNotPaid>0?"Chưa T<sup>2<\/sup>-"+t._moneyPickedProNotPaid.toMn()+"đ":"Chưa T<sup>2<\/sup>-.................đ";y=p+w;s=[];t._anotherFee.length>0&&n.each(t._anotherFee,function(n,t){t._name!=""&&t._money>0&&s.push(t._name+" - "+t._money.toNum().toMn()+" đ")});var b="",f="",k="",d="";rt==2&&(b=h.toMn()+" đ",f=c.toMn()+" đ",k=a.toMn()+" đ",d=ft.toMn()+" đ");var g="",nt="",tt="";return u>0&&(g="Chi phí VP:&nbsp;&nbsp;"+u.toMn()+" đ",nt="Còn:&nbsp;&nbsp;"+(t._totalPaid+r-u).toMn()+" đ"),tt=o>0?"CP hàng:&nbsp;"+o.toMn()+" đ&nbsp;&nbsp;&#x21d2;&nbsp;&nbsp;Còn:&nbsp;&nbsp;"+f:"&#x21d2;&nbsp;&nbsp;Tổng:&nbsp;&nbsp;"+f,it={p:{_title:n.trim(i.options.cifne),_rname:n.trim(i._data[i._cTripIndex].Name),_time:n.trim(i._cTripTime)+"&nbsp;ngày&nbsp;"+n.trim(i._cTripDate.toFormatString("dd-mm-yyyy")),_busNum:t._vehicleNumber,_driverName:t._driverName,_assistantName:t._assistantName,_totalPaidPerType:t._totalPaidPerType,_totalBookingPerAgent:t._totalBookingPerAgent,_totalPaid:t._totalPaid>0?t._totalPaid.toMn()+" đ":"",_totalMoney:t._totalMoney,_tollFee:t._tollFee!=0?t._tollFee.toMn()+" đ":"..................đ",_washFee:t._washFee!=0?t._washFee.toMn()+" đ":".......................đ",_eatFee:t._eatFee!=0?t._eatFee.toMn()+" đ":"........................đ",_feeTienHang:t._feeTienHang!=0?t._feeTienHang.toMn()+" đ":".....................đ",_moneyBranchProduct:v.join("<br />"),_anotherFee:s.join("<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),_totalTienKhach:b,_totalTienHang:f,_totalFee:k,_totalTotal:d,_feeTienKhachFormat:g,_totalTienKhachFormat:nt,_anotherFareTienKhachFormat:r>0?"(DT khác: "+r.toMn()+" đ)":"",_totalTienHangFormat:tt,_pickedProductFormat:y}},e.append(n(vtpl(_dict._tripInfo,it))),e},_inDanhSach:function(){var u=this,f="",e="",o="",s="",t,r,i,y;if(app.oRights.StageEnable)return u._renderStageTicketsTemplate();var h=n(_dict._pclTpl),c=h.find("tbody"),l=[],a=0,v=0;return n.each(u._m,function(t,i){typeof i!="undefined"&&n.each(i,function(t,i){typeof i!="undefined"&&n.each(i,function(t,i){var r,u,h,c,y,p,w;typeof i!="undefined"&&i!=null&&(r=i._getCurrentTicket(),n.isEmptyObject(r)||(r.fromArea!=undefined&&r.fromArea!=null&&(u=r.fromArea.split("|"),f=u[2],e=u[3]),r.toArea!=undefined&&r.toArea!=null&&(h=r.toArea.split("|"),o=h[2],s=h[3]),r.isStageSeat&&console.log(r),c=r._getPickupInfo(),y="",n.isEmptyObject(c)||(y=c.text),p=r._cname,w=r._getDefaultPhoneNumber(),l.push({_seatCodes:[i._label],_cname:p,_cphone:w,_pText:y,_note:r._note,_status:r._status,_class:"",_seri:r._seri,_cuser:r._cuser,_suser:r._suser,_fare:r._fare,_fromCode:f,_fromName:e,_toCode:o,_toName:s}),(r._isPaid()||r._isPass())&&a++,v++))})})}),t=[].concat([]),t[t.length]=[].concat(l),t.length>0?(r=1,n.each(t,function(t,i){typeof i!="undefined"&&i!=null&&n.each(i,function(t,i){if(typeof i!="undefined"&&i!=null){var u={seat:{_index:r,_cname:i._cname,_cphone:i._cphone,_pText:i._pText,_note:i._note,_seatCodes:i._seatCodes.join(", "),_status:i._status==1?"Đặt chỗ":"Đã TT",_class:i._class,_seri:i._seri,_cuser:i._cuser,_suser:i._suser,_fare:i._fare.toMn()+" đ",_fromCode:i._fromCode,_fromName:i._fromName,_toCode:i._toCode,_toName:i._toName}},f=n(vtpl(_dict._ipcLTpl,u));c.append(f);r++}})})):c.append(n("<tr />").append(n("<td />").attr("colspan","6").text("Chưa có hành khách đặt vé chuyến xe này"))),i=n("<div />").addClass("row"),i.append(h),y={s:{_stotal:v,_spaid:a}},i.append(vtpl(_dict._psmTpl,y)),i},_renderPickupBKSTitle:function(){var t=this,r=n("<div />").addClass("row"),i=t._getCurrentTripInfo(),u={p:{_title:n.trim(t.options.cifne),_rname:n.trim(t._data[t._cTripIndex].Name),_time:n.trim(t._cTripTime)+"&nbsp;ngày&nbsp;"+n.trim(t._cTripDate.toFormatString("dd-mm-yyyy")),_busNum:i._vehicleNumber,_driverName:i._driverName,_assistantName:i._assistantName}};return r.append(n(vtpl(_dict._pPickupTitleTpl,u))),r},_printPickupTicket:function(){var i=this,u=n("<div />").addClass("print-container").append(i._renderPickupBKSTitle()).append(i._renderPrintPickupTemplate()),r,t;typeof _dict._pSummaryPickupInfo!="undefined"&&_dict._pSummaryPickupInfo&&u.append(i._renderPrintPickupInfo());r="PickupList"+(new Date).getTime();t=window.open("about:blank",r,"width="+screen.width+", height="+screen.height+", scrollbars=1");t.document.write("<html><head><title>"+r+'<\/title><link rel="stylesheet" href="'+_dict._pStyleUrl+'" type="text/css" /><\/head><body onload="window.top.print()" >'+u.html()+"<\/body><\/html>");t.document.close();t.focus()},_renderPrintPickupTemplate:function(){var c=this,t=[],i=[],o=[],r=[],s=0,h=0,f,e,u;return n.each(c._m,function(u,f){typeof f!="undefined"&&n.each(f,function(u,f){typeof f!="undefined"&&n.each(f,function(u,f){var e,d,g,a,nt,b,tt,v,it,k;if(typeof f!="undefined"&&f!=null&&f._hasTicket()&&(e=f._getCurrentTicket(),!n.isEmptyObject(e)&&(d=e._getPickupInfo(),!n.isEmptyObject(d)&&vIsEstStr(d.text)&&d.type=="P"))){var w=e._code,y=e._cname,l=e._getDefaultPhoneNumber(),c=parseInt(d.pIndex),p=d.text;isNaN(c)&&(c=0);typeof t[c]=="undefined"&&(t[c]=[]);c==0?typeof _dict._allowGroupByCode!="undefined"&&_dict._allowGroupByCode?(g=(w+"|"+p+"|"+y+"|"+l+"|"+e._note+"|"+e._status).hashCode(),a=r.indexOf(g),a==-1&&(a=r.push(g)-1),typeof i[a]=="undefined"&&(i[a]={_pIndex:c,_seatCodes:[],_seatInfos:[],_tids:[],_cname:y,_cphone:l,_code:w,_pText:p,_note:e._note,_pdate:[],_status:e._status,_cuser:e._cuser,_total:0}),i[a]._seatCodes.push(f._label),i[a]._seatInfos.push(f._getSeatInfo()),i[a]._tids.push(e._id),i[a]._pdate.push(e._pdate.toFormatString("iso")),i[a]._total+=e._fare):vIsEstStr(l)?(nt=(p+"|"+y+"|"+l+"|"+e._note+"|"+e._status).hashCode(),b=r.indexOf(nt),b==-1&&(b=r.push(nt)-1),typeof i[b]=="undefined"&&(i[b]={_seatCodes:[],_cname:y,_code:w,_cphone:l,_pText:p,_note:e._note,_status:e._status,_total:0}),i[b]._seatCodes.push(f._label),i[b]._total+=e._fare):o.push({_seatCodes:[f._label],_cname:y,_cphone:l,_code:w,_pText:p,_note:e._note,_status:e._status,_total:e._fare}):(typeof t[c]=="undefined"&&(t[c]=[]),typeof _dict._allowGroupByCode!="undefined"&&_dict._allowGroupByCode?(tt=(w+"|"+p+"|"+y+"|"+l+"|"+e._note+"|"+e._status).hashCode(),v=r.indexOf(tt),v==-1&&(v=r.push(tt)-1),typeof t[c][v]=="undefined"&&(t[c][v]={_pIndex:c,_seatCodes:[],_seatInfos:[],_tids:[],_cname:y,_cphone:l,_code:w,_pText:p,_note:e._note,_pdate:[],_status:e._status,_cuser:e._cuser,_total:0}),t[c][v]._seatCodes.push(f._label),t[c][v]._seatInfos.push(f._getSeatInfo()),t[c][v]._tids.push(e._id),t[c][v]._pdate.push(e._pdate.toFormatString("iso")),t[c][v]._total+=e._fare):(it=(p+"|"+y+"|"+l+"|"+e._note+"|"+e._status).hashCode(),k=r.indexOf(it),k==-1&&(k=r.push(it)-1),typeof t[c][k]=="undefined"&&(t[c][k]={_seatCodes:[],_cname:y,_cphone:l,_code:w,_pText:p,_note:e._note,_status:e._status,_total:0}),t[c][k]._seatCodes.push(f._label),t[c][k]._total+=e._fare));s+=e._fare;h++}})})}),t[t.length]=_dict._allowGroupByCode!=undefined&&_dict._allowGroupByCode?i:i.concat(o),f=n(vtpl(_dict._ppuTpl,{t:{_total:s.toMn()+"đ",_totalSeat:h}})),e=f.find("tbody"),t.length>0&&(u=1,n.each(t,function(t,i){typeof i!="undefined"&&i!=null&&(_dict._allowGroupByCode!=undefined&&_dict._allowGroupByCode?Object.keys(i).forEach(function(t){var r=i[t],f={seat:{_index:u,_cname:r._cname,_cphone:r._cphone,_code:r._code,_pText:r._pText,_note:r._note,_seatCodes:r._seatCodes.join(", "),_numSeat:r._seatCodes.length,_status:r._status==1?"Đặt chỗ":"Đã thanh toán",_total:r._total.toMn()+"đ"}},o=n(vtpl(_dict._ippuTpl,f));e.append(o);u++}):n.each(i,function(t,i){if(typeof i!="undefined"&&i!=null){var r={seat:{_index:u,_cname:i._cname,_cphone:i._cphone,_code:i._code,_pText:i._pText,_note:i._note,_seatCodes:i._seatCodes.join(", "),_numSeat:i._seatCodes.length,_status:i._status==1?"Đặt chỗ":"Đã thanh toán",_total:i._total.toMn()+"đ"}},f=n(vtpl(_dict._ippuTpl,r));e.append(f);u++}}))})),f},_renderPrintPickupInfo:function(){var t=this,r=null,i,u;return r=_dict._pSummaryPickupInfoPageBreak!=undefined&&_dict._pSummaryPickupInfoPageBreak?n('<div class="row" />').css("page-break-before","always"):n('<div class="row" />'),i=t._getCurrentTripInfo(),u={p:{_title:n.trim(t.options.cifne),_rname:n.trim(t._data[t._cTripIndex].Name),_time:n.trim(t._cTripTime)+"&nbsp;ngày&nbsp;"+n.trim(t._cTripDate.toFormatString("dd-mm-yyyy")),_busNum:i._vehicleNumber,_driverName:i._driverName,_assistantName:i._assistantName}},r.append(n(vtpl(_dict._sumPickupInfo,u))),r},_renderTransferTitle:function(t){var i=this,u=n("<div />").addClass("row"),r=i._getCurrentTripInfo(),f={p:{_title:n.trim(i.options.cifne),_rname:n.trim(i._data[i._cTripIndex].Name),_time:n.trim(t.join(", "))+"&nbsp;ngày&nbsp;"+n.trim(i._cTripDate.toFormatString("dd-mm-yyyy")),_busNum:r._vehicleNumber,_driverName:r._driverName,_assistantName:r._assistantName}};return u.append(n(vtpl(_dict._pTransferTitleTpl,f))),u},_printTransferTicket:function(t){var f=this,r=f._$transfer[t],e=n("<div />").addClass("print-container").append(this._renderTransferTitle(r._times)).append(this._renderPrintTransferTemplate(r)),u="TransferList"+(new Date).getTime(),i=window.open("about:blank",u,"width="+screen.width+", height="+screen.height+", scrollbars=1");i.document.write("<html><head><title>"+u+'<\/title><link rel="stylesheet" href="'+_dict._pStyleUrl+'" type="text/css" /><\/head><body onload="window.top.print()" >'+e.html()+"<\/body><\/html>");i.document.close();i.focus()},_renderPrintTransferTemplate:function(t){var e=this,u=0,i,f,r;return(t._items.length>0&&n.each(t._items,function(n,t){typeof t!="undefined"&&t!=null&&t._seatCodes.length>0&&(u+=t._seatCodes.length)}),i=n(vtpl(_dict._ptsfTpl_NoSub,{t:{_total:t._total.toMn()+"đ",_totalSeat:u}})),f=i.find("tbody"),t._items.length>0)?(r=1,n.each(t._items,function(t,i){if(typeof i!="undefined"&&i!=null){var u={seat:{_index:r,_cname:i._cname,_cphone:i._cphone,_pText:i._pText,_note:i._note,_seatCodes:i._seatCodes.join(", "),_status:i._status==1?"Đặt chỗ":"Đã thanh toán",_total:i._total.toMn()+"đ",_time:i._time,_numSeat:i._seatCodes.length,_driverName:i._driverName!=""?i._driverName:i._time}},e=n(vtpl(_dict._iptsfTpl,u));f.append(e);r++}}),i):n()},isNullOrEmptyString:function(n){return!(typeof n!="undefined"&&n!=null&&n!="")},isTwoSeatPerfectTogether:function(n,t,i){var r=this,f,u;if(typeof i!="undefined"&&i!=null){for(f=i.split("->"),u=0;u<f.length;u++)if(f[u]=="phone")if(r.isNullOrEmptyString(n._cphone)&&r.isNullOrEmptyString(t._cphone))continue;else return r.isNullOrEmptyString(n._cphone)||r.isNullOrEmptyString(t._cphone)?!1:n._cphone==t._cphone;else if(f[u]=="ticketCode")return r.isNullOrEmptyString(n._code)||r.isNullOrEmptyString(t._code)?!1:n._code==t._code}else return!1}})})(jQuery);
//# sourceMappingURL=p.min.js.map
