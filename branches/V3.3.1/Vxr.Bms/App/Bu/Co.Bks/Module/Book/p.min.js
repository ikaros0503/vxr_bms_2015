define({start:function(n){try{this.o=n;this._bindBookEvent()}catch(t){console.log("(E) Module/Book",t)}},_bindBookEvent:function(){var n=this;vbv("doBookTicket",function(t){n._bookTicket(t.d.seat,t.d.tData)})},_bookTicket:function(n,t){var i=this,r,u;try{r=i._createBookTicketObj(n,t);u=function(r,u,f){if(oRq.cAType=1,r!=1||f<=0){vbf("showErrorForm",{message:_dict._err[4]});vbf("reloadBookingSheet",{});return}$.each(app.seatStack,function(n,t){var i=t._getCurrentTicket();i&&i._status!=1&&(app.seatStack=[])});i._estStStk(n)||app.seatStack.push(n);vbf("reloadBookingSheet",{},function(){vbf("doGetTotalSeats")});vbf("onStoreHistory",{un:app.un,key:"book",his:{_tid:t.cTripId,_tname:t.data[t.cTripIndex].Name,_tdate:i._getDptrTime(t),_s:[n._label]}})};oRq.cEl.length>0&&vRqu(r,u)}catch(f){vbf("showErrorForm",{message:f})}},_estStStk:function(n){try{var t=-1,i=n._getCurrentTicket();return $.each(app.seatStack,function(r,u){if(-1==t){var f=u._getCurrentTicket();u._coach==n._coach&&u._row==n._row&&u._col==n._col&&f._id==i._id&&(t=r)}}),!(-1==t)}catch(r){return console.log("(E) Module.Book.p._estStStk",r),!1}},_createBookTicketObj:function(n,t){var r,u,f,l,e,a,h;try{var c=this,s=c._getDptrTime(t),i=0,o={};return o._a="BookTicket",o._c=[{TripId:t.cTripId,SeatCode:n._getSeatInfo(),PickupDate:s.toFormatString("iso"),Bus:t.cTripBus,StageCode:t.cStageCode}],r=0,u=0,app.oRights.StageEnable?(r=typeof t.cFromId!="undefined"&&t.cFromId>0?t.cFromId:t.cDefaultFromId,u=typeof t.cToId!="undefined"&&t.cToId>0?t.cToId:t.cDefaultToId):(r=typeof t.cDefaultFromId!="undefined"&&t.cDefaultFromId>0?t.cDefaultFromId:t.cFromId,u=typeof t.cDefaultToId!="undefined"&&t.cDefaultToId>0?t.cDefaultToId:t.cToId),f=t.data[t.cTripIndex].StopPoints.data[t.data[t.cTripIndex].StopPoints.idx[r]],typeof f!="undefined"&&(l="1~"+f.Id+"|"+f.Type+"|"+f.Code+"|"+f.Name),e=t.data[t.cTripIndex].StopPoints.data[t.data[t.cTripIndex].StopPoints.idx[u]],typeof e!="undefined"&&(a="1~"+e.Id+"|"+e.Type+"|"+e.Code+"|"+e.Name),typeof _dict._hasMultiFare=="undefined"||_dict._hasMultiFare?i=c._getCurrentFareById(t,r,u):(i=0,h=t.data[t.cTripIndex].Ts[t.cTripTime][t.cTripBus].F.split("~"),h.length>0&&(i=parseInt(h[1].split("|")[2]),isNaN(i)&&(i=0))),o._d=[{CompId:app.cid,TripId:t.cTripId,AgentId:parseInt(app.aid),AgentInfo:$.trim(app.aid+"|"+app.aite+"|"+app.aice+"|"+app.aisne),TripDate:s.toFormatString("iso"),SeatCode:n._getSeatInfo(),PickupDate:s.toFormatString("iso"),TripAlias:parseInt(t.cTripBus),Status:1,Fare:i,CreatedUser:app.un,StageCode:t.cStageCode,SeatType:n._getSeatType(),FromArea:l,ToArea:a,FromId:r,ToId:u,Type:app.aid==135?3:1}],o}catch(v){return console.log("(E) Module.Book.p._createBookTicketObj",v),{_a:"BookTicket",_c:[],_d:[]}}},_getDptrTime:function(n){try{var i=n.cTripDate,t=n.cTripTime.split(":");return isNaN(parseInt(t[0]))||isNaN(parseInt(t[1]))?{}:(i.setHours(parseInt(t[0])),i.setMinutes(parseInt(t[1])),i)}catch(r){return console.log("(E) Module.Book.p._getDptrTime",r),{}}},_getCurrentFareById:function(n,t,i){var u=this,f=u._parseFares(n),e=t+"|"+i,r=f[e];return typeof r=="undefined"?0:r},_parseFares:function(n){var f,e,u,i=n.data[n.cTripIndex].Ts[n.cTripTime][n.cTripBus].F,t;if(typeof i!="undefined"&&vIsEstStr(i)&&i.length>1){var r=i.split("~"),s=r.length,o=[];for(t=1;t<s;t++)f=r[t].split("|")[0],e=r[t].split("|")[1],u=parseInt(r[t].split("|")[2]),o[f+"|"+e]=isNaN(u)?0:u;return o}return[]}});
//# sourceMappingURL=p.min.js.map
