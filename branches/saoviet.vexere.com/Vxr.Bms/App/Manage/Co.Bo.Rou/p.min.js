define({_loadUtility:function(n){var e=this,r,u,f,t,i;if(e._unloadUtility(),vIsEstStr(n)&&(r=n.indexOf("~"),r>=0))for(n=n.substring(r+1),u=n.split("~"),i=0;i<u.length;i++){f=parseInt(u[i]);switch(f){case 1:t="input.water";break;case 2:t="input.towel";break;case 3:t="input.toilet";break;case 4:t="input.dvd";break;case 5:t="input.condition";break;case 6:t="input.rug";break;case 7:t="input.food";break;case 8:t="input.wifi";break;default:t=""}f>0&&$(t).prop("checked",!0)}},_unloadUtility:function(){var n=$("#utility-form input");$.each(n,function(n,t){$(t).prop("checked",!1)})},_unloadRouteTable:function(){var u=this,r=document.getElementById("route-table"),n,i,t;if(r){for(n=r.rows,i=n.length-2;i>1;i--)r.deleteRow(i);for(t=1;t<n.length;t++)cell=$(n[t]).find(".city").find("option"),cell.find(":selected").prop("selected",!1),cell.filter('[value="-1"]').prop("selected",!0),$(n[t]).find("input.point-code").val("");u.onCityChange()}},_getRouteStopItems:function(n,t,i){var u=this,f=[],r={items:[]};return $.each(u.o.routeStopRow,function(n,t){r[n]=t}),$.each(u.o.routeStopItems,function(n,u){i.push(u.items[0]);(u.items[0].name=="btnAddRouteStop"||u.items[0].name=="btnDelRouteStop")&&(u.row=t);typeof u.items[1]!="undefined"&&u.items[1].name=="btnDelRouteStop"&&(u.row=t,i.push(u.items[1]));r.items.push(u)}),f.push(r),f},_getNewRow:function(n,t){var i=this,r={cols:12,items:i._getRouteStopItems(i.o.routeStopItems,n,t)};return vv.initObjs(r),vv.getBodyHtml(r)},_initOptionCity:function(n){var i=this,r=i.o,u,t;(n||(n=r.view),r.gId=="routeTableContainer")&&(u=n.find(".city"),t=vGetArr({Type:3},!1,i.listArea),t=vSort("Name",!0,t),t=[{Id:-1,Name:"Chọn thành phố"}].concat(t),$.each(t,function(n,t){$.vCheckAndAppendOptions(u,t.Id,t.Name,"R")}))},_initListArea:function(n){var i=this,u=i.o,r,t;(n||(n=u.view),u.gId=="routeTableContainer")&&(r=n.find(".lstArea"),t=vGetArr({Type:3},!1,i.listArea),t=vSort("Name",!1,t),t=[{Id:0,Name:"Chọn"}].concat(t),$.each(t,function(n,t){var u=$("<optgroup />").attr("label",t.Name),f=vGetArr({BaseId:t.Id},!1,i.listArea);$.each(f,function(n,t){var r=vGetArr({BaseId:t.Id},!1,i.listArea);$.each(r,function(n,t){var i;i=t.Type==16?$("<option />").val(t.Id).text("(*) "+t.Name):$("<option />").val(t.Id).text(t.Name);u.append(i)})});r.append(u)}),r.val(""),r.chosen({width:"100%"}))},_loadRouteTable:function(n,t){var o,u,r,s,f,a,h,e,i;if(t){o=this;o._unloadRouteTable();var v=document.getElementById(n),c=v.rows,l=t.indexOf("~");if(l>=0){for(t=t.substring(l+1),u=t.split("~"),i=1;i<u.length-1;i++)o.onAddRouteStop(null,null,null,null,i);for(i=0;i<u.length;i++)s=c[i+1],f=parseInt(vGvl(u[i],"|",0)),e=vGetObj({Id:f},o.listArea),e&&(h=e.BaseId,e=vGetObj({Id:h},o.listArea),e&&(a=e.BaseId)),r=$(s).find(".city").find("option"),r.find(":selected").prop("selected",!1),r.filter('[value="'+a+'"]').prop("selected",!0);for(o.onCityChange(),i=0;i<u.length;i++)s=c[i+1],f=parseInt(vGvl(u[i],"|",0)),e=vGetObj({Id:f},o.listArea),e&&(h=e.BaseId),r=$(s).find(".ward").find("option"),r.find(":selected").prop("selected",!1),r.filter('[value="'+h+'"]').prop("selected",!0);for(o.onWardChange(),i=0;i<u.length;i++)s=c[i+1],f=parseInt(vGvl(u[i],"|",0)),r=$(s).find(".stop-area").find("option"),r.find(":selected").prop("selected",!1),r.filter('[value="'+f+'"]').prop("selected",!0),f=parseInt(vGvl(u[i],"|",5)),r=$(s).find("input.distance"),r.val(f),f=vGvl(u[i],"|",6)+":"+vGvl(u[i],"|",7),r=$(s).find("input.hour"),r.val(f)}}},onBeginSelectionChange:function(n,t){vv.enableItem(n,"button.delete",t!=null)},onLoadingField:function(n,t){var i=this;n.tableContent?i._loadRouteTable(n.id,t[n.name]):n.isUtility&&i._loadUtility(t[n.name])},onAfterUnloadItem:function(){var n=this;n._unloadRouteTable();n._unloadUtility();$("select.lstArea").val("").trigger("chosen:updated")},onEndloadBaseData:function(n,t){var i=this,r;n.extCf&&n.gId=="routeTableContainer"&&(r=n.extCf._f.split(","),vRql(n.extCf,{a:function(){},m:function(n,t){var u={};$.each(r,function(n,i){i=i.trim();u[i]=t[n]});i.listArea.push(u)},z:function(){i.listArea=vSort("Name",!0,i.listArea);i._initOptionCity();i._initListArea();t&&t.call(i)}},i))},afterReload:function(){var t=this,n=t.o.view;n.find("button.genTime").unbind().on("click",function(){var r=n.find("input.genTime").val(),u=n.find("input.genTimeStop").val(),f=parseInt(n.find("input.frequence").val());if(moment(r,"HH:mm").isValid()&&moment(u,"HH:mm").isValid()&&!isNaN(f)){for(var t="",i=moment(r,"HH:mm"),e=moment(u,"HH:mm");e.isAfter(i)||i.isSame(e);)t+=""+i.format("HH:mm")+"~",i.add(f,"minutes");t=t.substring(0,t.length-1);n.find("input.info").val(t)}else alert("Nhập sai thông tin. Vui lòng kiểm tra lại!")});n.find("button.addTime").unbind().on("click",function(){var r=n.find("input.addDelTime").val(),t,i;moment(r,"HH:mm").isValid()?(t=n.find("input.info").val(),i=moment(r,"HH:mm").format("HH:mm"),t.length==0?n.find("input.info").val(i):t.indexOf(i)==-1?(t+="~"+i,n.find("input.info").val(t)):alert("Giờ đã tồn tại! Không thể thêm!")):alert("Nhập sai thông tin. Vui lòng kiểm tra lại!")});n.find("button.delTime").unbind().on("click",function(){var i=n.find("input.addDelTime").val(),t,r;moment(i,"HH:mm").isValid()?(t=n.find("input.info").val(),r=moment(i,"HH:mm").format("HH:mm"),t=t.replace(r,""),t=t.replace("~~","~"),t[t.length-1]=="~"&&(t=t.substring(0,t.length-1)),t[0]=="~"&&(t=t.substring(1,t.length)),n.find("input.info").val(t)):alert("Nhập sai thông tin. Vui lòng kiểm tra lại!")})},onItemLoaded:function(){var n=this,t=n.o.view;t.find(".lstArea").trigger("chosen:updated")},onCityChange:function(n,t,i){var r=this,o,s,h;if(i){var f={target:null},e=$(i.target).parent().parent(),c=parseInt($(e).find(".city").val()),u=$(e).find(".ward");u.empty();f.target=u;o=vGetArr({BaseId:c},!1,r.listArea);$.each(o,function(n,t){var i=vGetArr({BaseId:t.Id,Type:15},!1,r.listArea).concat(vGetArr({BaseId:t.Id,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));i.length>0&&$.vCheckAndAppendOptions(u,t.Id,t.Name,"R")});r.onWardChange(n,t,f)}else s=$("#route-table"),h=s.find("tbody").find("tr"),$.each(h,function(n,t){var f=parseInt($(t).find(".city").val()),i=$(t).find(".ward"),u;i.empty();u=vGetArr({BaseId:f},!1,r.listArea);$.each(u,function(n,t){var u=vGetArr({BaseId:t.Id,Type:15},!1,r.listArea).concat(vGetArr({BaseId:t.Id,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));u.length>0&&$.vCheckAndAppendOptions(i,t.Id,t.Name,"R")})}),r.onWardChange()},onAddRouteStop:function(n,t,i,r,u){var e=this,f,c;r?(f=parseInt($(r).attr("row")),isNaN(f)&&(f=1)):f=u;f++;var o=document.getElementById("route-table"),h=o.insertRow(f),s=[];h.innerHTML=e._getNewRow(-1,s);s.length>0&&e._applyListeners(s);e._initOptionCity($(h));o=$("#route-table");c=o.find("tbody").find("tr");$.each(c,function(n,t){var r=$(t).find(".addRouteStop"),u=$(t).find(".delRouteStop"),i=parseInt(r.attr("row"));i==-1||isNaN(i)?(r.attr("row",f),u.attr("row",f)):i>=f&&(r.attr("row",i+1),u.attr("row",i+1))})},onDelRouteStop:function(n,t,i,r,u){var y=this,s,e,l,p,f,h,a,c,o,v;if(s=r?parseInt($(r).attr("row")):u,e=document.getElementById("route-table"),l=$(e.rows[s]).find(".stop-area").find("option:selected").val(),e.deleteRow(s),e=$("#route-table"),p=e.find("tbody").find("tr"),$.each(p,function(n,t){var r=$(t).find(".addRouteStop"),u=$(t).find(".delRouteStop"),i=parseInt(r.attr("row"));i>=s&&(r.attr("row",i-1),u.attr("row",i-1))}),y.model&&(f=y.model.FareInfo,vIsEstStr(f)))try{if(h=f.indexOf("~"),h>=0){for(a=f.substring(0,h),f=f.substring(h+1),c=f.split("~"),o=0;o<c.length;o++)v=c[o].split("|"),v[0]!=l&&v[1]!=l&&(a+="~"+c[o]);$("input.fare-info").val(a)}}catch(w){console.log("Catched",w)}},onWardChange:function(n,t,i){var r=this,u,f,h;if(i){var e=$(i.target).parent().parent(),o=parseInt($(e).find(".ward").val()),s=$(e).find(".stop-area");s.empty();h=vGetArr({BaseId:o,Type:15},!1,r.listArea).concat(vGetArr({BaseId:o,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));$.each(h,function(n,t){$.vCheckAndAppendOptions(s,t.Id,t.Code+" ~ "+t.Name,"R")})}else u=$("#route-table"),f=u.find("tbody").find("tr"),$.each(f,function(n,t){var i=parseInt($(t).find(".ward").val()),u=$(t).find(".stop-area"),f;u.empty();f=vGetArr({BaseId:i,Type:15},!1,r.listArea).concat(vGetArr({BaseId:i,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));$.each(f,function(n,t){$.vCheckAndAppendOptions(u,t.Id,t.Code+" ~ "+t.Name,"R")})})},onRouteSave:function(){var s=this,g=this.view,nt=document.getElementById("route-table"),a=nt.rows,v="1",t=!1,i="",r,e,u,y,p,h=0,w=0,b=0,tt=$(g).find(".info").val(),f,n,c,o,k,d,l;for(tt.match(/^([0-9]|[01]?[0-9]|2[0-3]):([0-9]|[0-5][0-9])(|(~([0-9]|[01]?[0-9]|2[0-3]):([0-9]|[0-5][0-9])))+$/g)||(t=!0,i="Lịch chạy không đúng, vui lòng kiểm tra lại!"),f=1;f<a.length;f++)if(r=a[f],n="",c=$(r).find(".stop-area").find("option:selected"),c.length>0){if(u=parseInt(c.val()),f==1&&(w=u),b=u,o=vGetObj({Id:u},s.listArea),y=o.Name,p=o.Code,e=$(r).find("input.hour").val(),!e.match(/^([0-9]|[01]?[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/g)){t=!0;i="Thời gian điểm dừng không đúng!";break}if(k=$(r).find("input.distance").val(),isNaN(k)){t=!0;i="Khoảng cách điểm dừng không đúng!";break}n+=u;n+="|"+o.Type;n+="|"+p;n+="|"+y;n+="|";n+="|"+$(r).find("input.distance").val();n+="|"+moment(e,"HH:mm").format("H");n+="|"+moment(e,"HH:mm").format("m");v+="~"+n;h+=1}else t=!0,i="Vui lòng cập nhật thông tin điểm dừng!";t?vv.showMessage({element:s.view.find(".alert.message"),type:"alert-danger",content:i}):($("input.route-info").val(v),$("input.total-stage").val(h>1?h-1:0),$("input.fromId").val(w),$("input.toId").val(b),d=$("#utility-form input"),l="1",$.each(d,function(n,t){$(t).prop("checked")&&(l+="~"+$(t).attr("code"))}),$("input.facility-info").val(l),s.onBasicSave(),$("select.lstArea").val("").trigger("chosen:updated"))},gDisToArea:function(n){var t=n.record.ToArea;try{return t.split("|")[3]}catch(i){return""}},gDisFromArea:function(n){var t=n.record.FromArea;try{return t.split("|")[3]}catch(i){return""}},gDisStpl:function(n){return vGvo(n.record.SeatTemplateInfo,1,5)},gDisDptTime:function(n){for(var r=n.record.Info.split("~"),i="",t=0;t<r.length;t++)t==5&&(i+="\n"),t==0?i=r[t]:i+=", "+r[t];return i},svcStpl:function(n,t){return t+"~"+vFindById(t,n.options).Info},svcArea:function(n,t){var r=this,i=vGetArr({Id:parseInt(t)},!1,r.listArea);return i.length>0?"1~"+[i[0].Id,i[0].Type,i[0].Code,i[0].Name].join("|"):""},rvcStpl:function(n,t){return vGtp(t,"Id")},rvcArea:function(n,t){var i;return vIsEstStr(t)?(i=t.split("~"),i.length>1)?parseInt(i[1].split("|")[0]):"":""}});
//# sourceMappingURL=p.min.js.map
