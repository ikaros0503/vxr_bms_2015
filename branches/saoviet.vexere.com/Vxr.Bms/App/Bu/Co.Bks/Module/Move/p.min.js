define({start:function(){var n=this;vbv("doMaskMovingTicket",function(t){t.d&&n._maskMoveTicket(t.d.tId,t.d.tName,t.d.tDate)});vbv("doMovingTicket",function(t){t.d&&n._moveTicket(t.d.seat,t.d.tId,t.d.tName,t.d.tDate,t.d.tBus)});vbv("doResetMovingStack",function(){n._resetMovingStack()});vbv("doUnbindEventMoving",function(){n._unbindEventMoving()})},_maskMoveTicket:function(n,t,i){var r=this;app.movingStack=[];app.fMoving=!0;$.each(app.seatStack,function(n,t){var r=t._clone(),i=r._getCurrentTicket();i._isNotCome()?i._status=2:i._isCancelled()&&(i._status=1,i._pmInfo=null);app.movingStack.push(r)});app.cMovingTrip={_tid:n,_tname:t,_tdate:i};vbf("resetSeatStack");r._toggleFilterWhenMoving();r._bindEventMoving()},_moveTicket:function(n,t,i,r,u){var f=this,e,o;if(app.movingStack.length<=0)return app.fMoving=!1,app.cMovingSeat=null,app.cMovingTrip=null,f._unbindEventMoving(),!1;e=f._createMovedTicketObj(n,t,r,u);o=function(u){if(u==1){var e={_ftid:app.cMovingTrip._tid,_ftname:app.cMovingTrip._tname,_ftdate:app.cMovingTrip._tdate,_fs:[app.cMovingSeat._label],_ttid:t,_ttname:i,_ttdate:r,_ts:[n._label]};vbf("onStoreHistory",{un:app.un,key:"move",his:e});app.movingStack.length<=0&&(app.fMoving=!1,app.movingStack=[],app.cMovingSeat=null,app.cMovingTrip=null,f._unbindEventMoving(),f._toggleFilterWhenMoving());vbf("reloadBookingSheet")}};vRqs(e,o)},_createMovedTicketObj:function(n,t,i,r){var e=app.movingStack.shift(),h;app.cMovingSeat=e;var f=e._getCurrentTicket(),o=i,s=o,c=o,u={};return u._a="UpdateBookTicket",u._c=[],u._d=[],u._c.push({Id:f._id,TripId:t,SeatCode:n._getSeatInfo(),PickupDate:s.toFormatString("iso"),Bus:r}),h={SeatCode:n._getSeatInfo(),TripDate:c.toFormatString("iso"),PickupDate:s.toFormatString("iso"),TripAlias:r,Status:parseInt(f._status),PaymentInfo:f._pmInfo,SeatType:n._getSeatType(),Code:f._code,LastMovedDate:f._dept.toFormatString("iso"),ChargeDate:new Date},u._d.push(h),u},_toggleFilterWhenMoving:function(){var n=$("#FilterForm").find("select[name=TripId]");app.fMoving||app.hasCopyTicket?n.prop("disabled",!0):n.prop("disabled",!1)},_bindEventMoving:function(){$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat.selected").addClass("dotted-background");$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat div.available").unbind().on("mouseenter",function(){$(this).addClass("cursor-moving")})},_unbindEventMoving:function(){$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat").removeClass("dotted-background");$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat div.available").removeClass("cursor-moving");$("#bksContent div.vbooking-sheet").find("ul.vbooking-coach li.seat div.available").unbind("mouseenter")},_resetMovingStack:function(){var n=this;app.movingStack=[];app.fMoving=!1;n._toggleFilterWhenMoving()}});$(document).ready(function(){$._isInMovingStack=function(n){var t=!1;return $.each(app.movingStack,function(i,r){if(t==!1){var u=r._getCurrentTicket(),f=n._getCurrentTicket();(r._coach=n._coach&&r._row==n._row&&r._col==n._col&&u._id==f._id)&&(t=!0)}}),t}});
//# sourceMappingURL=p.min.js.map
