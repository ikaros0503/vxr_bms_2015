define({x:null,_$filterSearchResult:null,start:function(n){this.o=n;this.x=$(n.x);this._bindFilterEvents(n);this._bindBodyEvents(n)},_bindBodyEvents:function(){var n=this;vbv("doSetSearchBox",function(t){n.x.val(t.d.value)})},_bindFilterEvents:function(n){var i=this.x,t=this;i?(vev(n.x,"keyup",function(n){i.val().length==6?(n.preventDefault(),n.stopPropagation(),t._searchTicket(this.value,!0)):vIsNumKey(n)?this.value.length==3||this.value.length>=6?(n.preventDefault(),n.stopPropagation(),t._searchTicket(this.value)):(n.preventDefault(),n.stopPropagation(),t._clearSearchResult()):_dict._arrows.indexOf(n.keyCode)==-1&&(n.preventDefault(),n.stopPropagation(),t._clearSearchResult())}),vev(n.x,"paste",function(n){i.val(n.originalEvent.clipboardData.getData("Text"));this.value.length==6||this.value.length==10||this.value.length==11?(n.preventDefault(),n.stopPropagation(),this.value.length==6?t._searchTicket(this.value,!0):isNaN(this.value)||t._searchTicket(this.value)):(n.preventDefault(),n.stopPropagation(),t._clearSearchResult());t.x.blur()}),vev(n.x,"focus",function(){vbf("onSearchBoxFocused")})):setTimeout(t._bindFilterEvents,50)},_searchTicket:function(n,t){var i=this,e,o,s,f;if(app.module.toLowerCase()=="bks")e=i._createSearchTicketObj(n,t),o=function(n,r,u,f){n==1&&(i._clearSearchResult(),u>0&&(i._searchResult=r,i._totalSearchResult=f),i._renderSearchResult(t),i._bindEventOnSearchResult(),FlatObj.HScrolled=!1,FlatObj.STBPhone=!0)},vRqs(e,o);else{var r={},u=[],h=i._crProOrderObj(n),c=function(t,f,e){e>0&&$.each(f,function(t,r){var f=i._convertDbIntoSearchPhone(r,n);u.push(f)});r.listResult=u;r.totalItems=u.length};vRqs(h,c);s=$.getHtml("search-phone",r);i._clearSearchResult();i._$searchTicketFilter.parent().append(s);f=i._$searchTicketFilter.parent().find("li");f.on("click",function(n){n.preventDefault();n.stopPropagation();var t=$(this).attr("data-proid"),r=$(this).attr("data-tripid"),u=$(this).attr("data-triptime"),f=$(this).attr("data-tripdate"),e=$(this).attr("data-typeofview");$("#product-content").product("load",{proId:t,pIndex:1,pSize:10,tId:r,tTime:u,tDate:f,tOView:e});i._clearSearchResult();i._$searchTicketFilter.val("")}).hover(function(){f.removeClass("selected");$(this).addClass("selected")})}},_createSearchTicketObj:function(n,t){var s=this,h=$("input[name=type_filterdate]").val(),o=s._getLimitedDate(),c=$("#BSFilterForm"),i={},r,u,e;if(typeof t!="undefined"&&t)i._a="fGetCustomerTripTicket",i._c={Code:$.trim(n).toUpperCase()},i._f="Id, TripId, AgentId, SeatCode, PickupDate, CustomerInfo, Status, Fare, Note, PickupInfo, Code, TripDate, CustomerNote";else{i._a="fGetCustomerTripDetail";r="($x like N'%"+n+"%')";switch(n.length){case 3:r="($x like N'%"+n+"')";break;case 4:case 5:r="($x like N'%"+n+"%')";break;case 6:r="($x like N'"+n+"%')"}u="$x >= '"+o.toFormatString("iso")+"'";switch(parseInt(h)){case 1:u="$x >= '"+o.toFormatString("iso")+"'";break;case 2:u="$x is not null";break;case 3:var l=c.find("button").html(),a=new Date(vPrsDt(l).getTime()),f=new Date;f.setDate(a.getDate()-1);e=new Date;e.setDate(f.getDate()+2);u="$x > '"+f.toFormatString("iso")+"' and $x < '"+e.toFormatString("iso")+"'"}i._c=[{CompId:parseInt(app.cid),Phone:r,IsPrgStatus:"$x != 3"},{CustomerTripIdTripDate:u}];i._f="Id, Name, Note, Phone, BookingTicket, TotalBooking, PaidTicket, TotalPaid, CancelTicket, TotalCancel, NotComeTicket, TotalNotCome, PassTicket, TotalPass, KeepOnTimeTicket, TotalKeepOnTime, CustomerTripIdTripId, CustomerTripIdTripDate, CustomerTripIdBookingTicket, CustomerTripIdTotalBooking, CustomerTripIdListSeatBooking, CustomerTripIdPaidTicket, CustomerTripIdTotalPaid, CustomerTripIdListSeatPaid, CustomerTripIdCancelTicket, CustomerTripIdTotalCancel, CustomerTripIdListSeatCancel, CustomerTripIdNotComeTicket, CustomerTripIdTotalNotCome, CustomerTripIdListSeatNotCome, CustomerTripIdPassTicket, CustomerTripIdTotalPass, CustomerTripIdListSeatPass, CustomerTripIdKeepOnTimeTicket, CustomerTripIdTotalKeepOnTime, CustomerTripIdListSeatKeepOnTime, CustomerTripIdTripName, CustomerTripIdNote, CustomerTripIdPickupInfo"}return i},_crProOrderObj:function(n){var t={};return t._a="fGetProductOrder",t._c={PickupInfo:"($x like N'%"+n+"%' or DropOffInfo like N'%"+n+"%') order by IsPrgCreatedDate desc"},t._f="Id,TripTime,TripDate,PickupInfo,DropOffInfo,Fare,Status,TripId,AgentInfo,ReceivedAgentInfo",t},_convertDbIntoSearchPhone:function(n,t){var i={},u=n[3].split("|"),r,f,e;i.senderName=u[3].length>10?vGln(u[3]):u[3];i.senderPhone=u[4];i.keySender=u[4].indexOf(t)==0?"vred":"";r=n[4].split("|");i.receiverName=r[3].length>10?vGln(r[3]):r[3];i.receiverPhone=r[4];i.keyReceiver=r[4].indexOf(t)==0?"vred":"";f=n[8].split("|");i.fromName=f[2];e=n[9].split("|");i.toName=e[2];i.fare=vToMn(n[5]);i.proId=n[0];i.tripId=n[7];i.tripTime=n[1];i.tripDate=vPrsDt(n[2]).toFormatString("dd-mm-yyyy");vIsEstStr(i.tripTime)&&vIsEstStr(i.tripDate)&&(i.tripDepartureDate="/ "+i.tripTime+" ngày "+i.tripDate);switch(parseInt(n[6])){case 1:i.status="Chưa nhận";i.typeOfView="kho-hang-di";break;case 2:i.status="Chưa nhận";i.typeOfView="kho-hang-di";break;case 3:i.status="Chưa nhận";i.typeOfView="xem-chuyen";break;case 4:i.status="Đã nhận";i.typeOfView="xem-chuyen";break;case 5:i.status="Chưa nhận";i.typeOfView="xem-chuyen";break;case 6:i.status="Đã nhận";i.typeOfView="xem-chuyen";break;case 7:i.status="Chưa giao";i.typeOfView="kho-hang-ve";break;case 8:i.status="Chưa giao";i.typeOfView="kho-hang-ve";break;case 9:i.status="Đã giao";i.typeOfView="kho-hang-ve";break;default:i.status="";i.typeOfView=""}return i},_getLimitedDate:function(){var n=new Date;return new Date(n.getTime()-_dict._limitedMinuteBefore*6e4).addMinutes(app.sOffsetMinute)},_clearSearchResult:function(){var n=this;n._searchResult=[];n._totalSearchResult=0;n.x.parent().find("div.search-result").remove();n._hasSearchPhone=!1},_renderSearchResult:function(n){var r=this,f,o=0,y,i;if(r._totalSearchResult>0)if(f=$("<ul />").addClass("search-items"),typeof n!="undefined"&&n){var h=[],s=[],p="",w="",u="",e=null,d="",c="",g=[],nt=0,b="",tt=null,it=0,t={},k="",l="",a="",v={};$.each(r._searchResult,function(n,i){var f,o,y,rt,et,ot;if(typeof i!="undefined"&&i!=null){var ut=[],ft="",r="";vIsEstStr(i[5])&&(f=i[5].split("|"),vIsEstStr(f[3])&&h.indexOf(f[3])<0&&h.push(f[3]),vIsEstStr(f[4])&&s.indexOf(f[4])<0&&s.push(f[4]));w=i[10];p=i[12];u=i[9];it+=parseInt(i[7]);vIsEstStr(u)?(o=u.split("|"),u=o[0]?"&nbsp/Đón:&nbsp"+o[0]:o[1]?"&nbsp/T.C:&nbsp"+o[1]:""):u="";tt=i[2];e=parseInt(i[1]);d=vPrsDt(i[4]);y=i[3].split("|");g.push(y[0]);nt++;rt=parseInt(i[6]);b=_dict._stn[rt].vi;rt==3&&(ft="isCancelled");v.hasOwnProperty(e)?c=v[e]:(et=function(n,t,i){n!=1||i<=0||(v[e]=t[0][0],c=t[0][0])},ot={_a:"fGetTrip",_c:{Id:e},_f:"Name"},vRqs(ot,et));a=vPrsDt(i[11]).toFormatString("hh:mm");l=vPrsDt(i[11]).toFormatString("dd-mm-yyyy");k=a+" "+l;r=k+" "+rt;ut.push(y[0]);typeof t[r]!="undefined"?(t[r][3].push(y[0]),t[r][4]+=parseInt(i[7])):(t[r]={},t[r][0]=w,t[r][1]=h,t[r][2]=s,t[r][3]=ut,t[r][4]=parseInt(i[7]),t[r][5]=c,t[r][6]=l,t[r][7]=a,t[r][8]=b,t[r][9]=u,t[r][10]=p,t[r][11]=e,t[r][12]=ft)}});for(y in t)t.hasOwnProperty(y)&&(i=t[y],f.append($('<li style="overflow: hidden;  white-space: nowrap;" />').attr("tid",i[11]).attr("type",i[12]).attr("tdate",i[6]).attr("ttime",i[7]).attr("code",i[0]).html("Mã vé:&nbsp<span class='vred'>"+i[0]+"<\/span> - "+i[1].join(",")+'<span style="color: gray;font-size: smaller;font-weight: lighter;">&nbsp;'+(i[10]==null?"":"("+i[10]+")")+"&nbsp;<\/span>(<span class='vred'>"+i[2].join(" ,")+"<\/span>) / <span class='vred'>"+i[3].length+"<\/span> vé "+i[3].join(",")+" / <span class='vred'>"+i[4].toMn(0,",",".")+"₫<\/span> / "+i[5]+" /  ngày <span class='vred'>"+i[6]+"<\/span> lúc <span class='vred'>"+i[7]+"<\/span> / "+i[8]+i[9]+'<button class="customer-profile customer-profile-item btn btn-sm btn-primary" title="Chỉnh sửa thông tin khách hàng" style="position: absolute;right: 20px;margin:2px;" data-phone="'+s+'"><i class="glyphicon glyphicon-edit"><\/i> Edit<\/button>')),o++)}else $.each(r._searchResult,function(n,t){var s;if(typeof t!="undefined"&&t!=null){var h=t[1],r=t[3],e=t[37],u=t[38];vIsEstStr(u)?(s=u.split("|"),u=s[0]?"&nbsp/Đón:&nbsp"+s[0]:s[1]?"&nbsp/T.C:&nbsp"+s[1]:""):u="";e=vIsEstStr(e)?"&nbsp;/&nbsp;"+e:"";var c=parseInt(t[4]+t[6]+t[12]+t[14]),l=parseInt(t[8]+t[10]),g=parseInt(t[5]+t[7]+t[13]+t[15]),a=parseInt(t[16]),i=vPrsDt(t[17]),v=t[36],y=parseInt(t[18]+t[21]+t[30]+t[33]),w=parseInt(t[19]+t[22]+t[31]+t[34]),b=[t[20],t[23],t[32],t[35]],p=parseInt(t[24]+t[27]),k=parseInt(t[25]+t[28]),d=[t[26],t[29]];y>0&&(f.append($('<li style="overflow: hidden;  white-space: nowrap;" />').attr("tid",a).attr("tdate",i.toFormatString("dd-mm-yyyy")).attr("ttime",i.toFormatString("hh:mm")).attr("phone",r).html(h+" <span class='vred'>("+r+')<\/span><span style="color: gray;font-size: smaller;font-weight: lighter;">&nbsp;'+(t[2]==null?"":"("+t[2]+")")+"&nbsp;<\/span>- Đặt:&nbsp;<span class='vred'>"+c+"<\/span> - Hủy:&nbsp;<span class='vred'>"+l+"<\/span> / Đã đặt - <span class='vred'>"+y+"<\/span> vé "+b.filter(function(n){return n!==null}).join(", ")+" / <span class='vred'>"+w.toMn()+"₫<\/span> / "+v+" / ngày <span class='vred'>"+i.toFormatString("dd-mm-yyyy")+"<\/span> lúc <span class='vred'>"+i.toFormatString("hh:mm")+"<\/span> "+u+e+'<button class="customer-profile customer-profile-item btn btn-sm btn-primary" title="Chỉnh sửa thông tin khách hàng" data-phone="'+r+'"><i class="glyphicon glyphicon-edit"><\/i> Edit<\/button>')),o++);p>0&&(f.append($('<li style="overflow: hidden;  white-space: nowrap;" />').attr("tid",a).attr("type","isCancelled").attr("tdate",i.toFormatString("dd-mm-yyyy")).attr("ttime",i.toFormatString("hh:mm")).attr("phone",r).html(h+" <span class='vred'>("+r+')<\/span><span style="color: gray;font-size: smaller;font-weight: lighter;">&nbsp;'+(t[2]==null?"":"("+t[2]+")")+"&nbsp;<\/span>- Đặt:&nbsp;<span class='vred'>"+c+"<\/span> - Hủy:&nbsp;<span class='vred'>"+l+"<\/span> / Đã hủy - <span class='vred'>"+p+"<\/span> vé "+d.filter(function(n){return n!==null}).join(", ")+" / <span class='vred'>"+k.toMn()+"₫<\/span> / "+v+" / ngày <span class='vred'>"+i.toFormatString("dd-mm-yyyy")+"<\/span> lúc <span class='vred'>"+i.toFormatString("hh:mm")+"<\/span> "+u+e+'<button class="customer-profile customer-profile-item btn btn-sm btn-primary" title="Chỉnh sửa thông tin khách hàng" data-phone="'+r+'"><i class="glyphicon glyphicon-edit"><\/i> Edit<\/button>')),o++)}});else f=$("<div />").html('<p class="not-found">Không tìm thấy số điện thoại hoặc mã vé<\/p>');r._$filterSearchResult=$("<div />").addClass("dropdown-menu search-result").append($("<div />").addClass("search-title").append("Kết quả tìm kiếm").append($("<span />").append("X").on("click",function(){r._clearSearchResult();r.x.val("")}))).append(f).append($("<div />").addClass("search-summary").append("Tổng số ("+o+" phần tử)"));r.x.parent().append(r._$filterSearchResult);$(".customer-profile-item").unbind().click(function(n){n.stopPropagation();n.preventDefault();app.cusphone=$(this).attr("data-phone");$("#showCustomerProfile").trigger("click")})},_bindEventOnSearchResult:function(){var n=this,t;n._totalSearchResult>0&&(t=n._$filterSearchResult.find("li"),t.on("click",function(t){t.preventDefault();t.stopPropagation();var i=parseInt($(this).attr("tid")),r=$(this).attr("tdate"),u=$(this).attr("ttime"),f=$(this).attr("phone"),e=$(this).attr("code"),o=$(this).attr("type");vbf("onSearchResultSelected",{tId:i,tDate:r,tTime:u,phone:f,code:e,isCanceled:o});n._clearSearchResult()}).hover(function(){t.removeClass("selected");$(this).addClass("selected")}),n._bindArrowEventList(t))},_bindArrowEventList:function(n){var t,i=n.parent(),r=i.height(),u=i.prop("scrollHeight"),f=1,e=Math.round(u/r)-1;$(window).keydown(function(o){var s,c,h,l;o.which===40?(t?(n.removeClass("selected"),s=t.next(),t=s.length>0?s.addClass("selected"):n.eq(0).addClass("selected")):t=n.eq(0).addClass("selected"),t.position().top<0?(i.animate({scrollTop:0},500),f=1):t.position().top>r&&(c=Math.floor(r*f)-35,i.animate({scrollTop:c},500),f++)):o.which===38&&(t?(n.removeClass("selected"),h=t.prev(),t=h.length>0?h.addClass("selected"):n.last().addClass("selected")):t=n.last().addClass("selected"),t.position().top<=0?(l=Math.floor(u-r*e)+35,i.animate({scrollTop:l},500),e++):t.position().top>r&&(i.animate({scrollTop:u},500),e=Math.round(u/r)-1))})}});
//# sourceMappingURL=p.min.js.map
