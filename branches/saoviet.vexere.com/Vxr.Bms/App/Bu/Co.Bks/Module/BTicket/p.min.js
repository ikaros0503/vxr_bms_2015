define({pager:null,tickets:[],start:function(){$("#bksContent").hide();$("#report").hide();$("#product-content").hide();$("#cod").hide();$(jHtml.mainContainer).show();this.init();this.getTickets()},test:function(){vRqs({_a:jVar.getTicketFunction,_c:{Type:" ($x=2 or $x=3) ",IsPrgCreatedDate:" ($x >='2015-02-01' and $x<'2015-05-01' )"},_f:jVar.fieldsToGet.join()},function(){})},renderTickets:function(){var n=this,i,r,t;if($(jHtml.tableBody).html(""),n.tickets.length!=0){for(i=(n.pager.currentPage-1)*n.pager.itemsPerPage,r=Math.min(n.pager.currentPage*n.pager.itemsPerPage,n.tickets.length)-1,t=i;t<=r;t++)$(jHtml.tableBody).append(vtpl(jHtml.itemTpl,n.tickets[t]));$(jHtml.mnuCommandsItems).unbind().click(function(){$(this).hasClass("sendEmail")?$("#dlgSendEmail").modal():$(this).hasClass("sendSms")?$("#dlgSendSms").modal():$(this).hasClass("printTicket")||$(this).hasClass("cancelTicket")&&$("#dlgCancelTicketWarning").modal()});$(".chkConfirm").unbind().click(function(){var n=this,t=parseInt($(n).attr("data-id"));vRqs({_a:jVar.updateTicketFunction,_c:{Id:t},_d:{IsConfirmed:$(this).is(":checked")==!0?1:0}},function(t,i){t==1&&i.length>0&&i[0].length>0&&i[0][0]==1?$("#confirmStatus"+$(n).attr("data-index")).html(""):($(n).attr("checked",!$(n).is(":checked")),$("#confirmStatus"+$(n).attr("data-index")).html("da co loi"))})});$(jHtml.refreshButton).unbind().click(function(){n.getTickets()});$("a.transactionDetail").click(function(){$("#dlgPaymentInfo").modal("show");$("#transactionId").html($(this).attr("data-transactionId"));$("#transactionDate").html($(this).attr("data-transactionDate")+" "+$(this).attr("data-transactionTime"));$("#transactionStatus").html($(this).attr("data-transactionStatus"));$("#transactionNLPaymentType").html($(this).attr("data-transactionNLPaymentType"));$("#transactionBankCode").html($(this).attr("data-transactionBankCode"));$("#transactionDescription").html($(this).attr("data-transactionDescription"));$("#transactionTs").html($(this).attr("data-transactionTs"));$("#transactionChecksum").html($(this).attr("data-transactionChecksum"))});$(jHtml.showMoreButton).unbind().click(function(){var t=$(this).attr("data-index"),n=this;$("#hiddenRow"+t).is(":hidden")?($("#hiddenRow"+t).show("slow"),$(n).css("-webkit-animation","rotateShow 0.5s ease-in-out"),$(n).css("animation","rotateShow 0.5s ease-in-out"),$(jHtml.showMoreButton).css("-webkit-animation-fill-mode","forwards"),$(jHtml.showMoreButton).css("animation-fill-mode","forwards")):($("#hiddenRow"+t).hide("slow"),$(n).css("-webkit-animation","rotateHide 0.5s ease-in-out"),$(n).css("animation","rotateHide 0.5s ease-in-out"),$(jHtml.showMoreButton).css("-webkit-animation-fill-mode","forwards"),$(jHtml.showMoreButton).css("animation-fill-mode","forwards"))});$(jHtml.ticketCodeButtons).unbind().click(function(){$("a[data-tab=bks]","ul.vbooking-list").trigger("click");$("body").trigger("updateFilters",{compId:$(this).attr("data-compId"),tripId:$(this).attr("data-tripId"),tripDate:$(this).attr("data-tripDate"),tripTime:$(this).attr("data-tripTime")})})}},init:function(){var n=this,t=function(){var n="",t={type:$(jHtml.mnuSource).attr("data-type"),code:$(jHtml.filterCode).val(),comp:replaceUnicodeCharacter($(jHtml.filterCompName).val()),customer:replaceUnicodeCharacter($(jHtml.filterCustomer).val()),account:replaceUnicodeCharacter($(jHtml.filterAccount).val()),createdDateStart:formatDatepicker($(jHtml.filterDate),"YYYY-MM-DD 00:00:00"),createdDateEnd:formatDatepicker($(jHtml.filterDate),"YYYY-MM-DD 23:59:59"),tripDateStart:formatDatepicker($(jHtml.filterTripDate),"YYYY-MM-DD 00:00:00"),tripDateEnd:formatDatepicker($(jHtml.filterTripDate),"YYYY-MM-DD 23:59:59"),status:$(jHtml.mnuStatus).attr("data-status")};n+=t.type==-1?" ($x=2 or $x=3) ":" $x={type}";n+=t.code!=""?" and Code like '%{code}%' ":"";n+=t.comp!=""?" and ([dbo].ConvertToUnsignWithBlank(CompName) like N'%{comp}%' or SeatCode like N'%comp%') ":"";n+=t.customer!=""?" and ([dbo].ConvertToUnsignWithBlank(CustomerInfo) like N'%{customer}%' or CustomerInfo like N'%customer%') ":"";n+=t.account!=""?" and [dbo].ConvertToUnsignWithBlank(CreatedUser) like N'%{account}%'":"";n+=t.createdDateStart!=""?" and IsPrgCreatedDate>='{createdDateStart}' and IsPrgCreatedDate<='{createdDateEnd}'":"";n+=t.tripDateStart!=""?" and TripDate>='{tripDateStart}' and TripDate<='{tripDateEnd}'":"";t.status!="-1"&&(status<=3?n+=" and Status= {status}":status==30?n+=" and Status=3 and CanceledUser='server' ":status==31?n+=" and Status=3 and CancelType=4 ":status==32?n+=" and Status=3 and CancelType=5 ":status==33&&(n+=" and Status=3 and CancelType=6 "));n=n+" order by IsPrgCreatedDate desc ";filter.Type=vtpl(n,t)},i=function(){$(jHtml.filterDate).datepicker({dateFormat:"dd-mm-yy"});$(jHtml.filterDate).datepicker("setDate",new Date);$(jHtml.filterToDate).datepicker({dateFormat:"dd-mm-yy"});$(jHtml.filterToDate).datepicker("setDate",new Date);$(jHtml.filterTripDate).datepicker({dateFormat:"dd-mm-yy"});$(jHtml.filterTripDate).focus(function(){$(this).select()});$(jHtml.allTextFilter).change(function(){t();n.getTickets()});$(jHtml.filterTripDate).keypress(function(i){i.keyCode==13&&(t(),n.getTickets())});$(jHtml.mnuSourceItems).click(function(){$(jHtml.mnuSourceItems).removeClass("selected");$(this).addClass("selected");var i=$(this).attr("data-type");$(jHtml.mnuSource).attr("data-type",i);i==-1?$(jHtml.mnuSource).html('Nguồn&nbsp;<span class="caret"><\/span>'):$(jHtml.mnuSource).html($(this).text()+'&nbsp;<span class="caret"><\/span>');t();n.getTickets()});$(jHtml.mnuStatusItems).click(function(){$(jHtml.mnuStatusItems).removeClass("selected");$(this).addClass("selected");var i=$(this).attr("data-status");$(jHtml.mnuStatus).attr("data-status",i);i==-1?$(jHtml.mnuStatus).html('Trạng thái&nbsp;<span class="caret"><\/span>'):$(jHtml.mnuStatus).html($(this).text()+'&nbsp;<span class="caret"><\/span>');t();n.getTickets()})};$.getScript("App/Core/UI/pager.js",function(){n.pager=new Pager(1,10,"#divPaging",5,function(){n.renderTickets()})});$("body").append(jHtml.modals);$(jHtml.mainContainer).html("").append(jHtml.headerTpl).append($(jHtml.tableContainerHtml)).append(jHtml.pageNav);i();t()},updateVisible:function(n){$(jHtml.refreshButton).prop("disabled",n=="loading");$(jHtml.mainContainer+" input").prop("disabled",n=="loading");$(jHtml.pagingContainer+" a").prop("disabled",n=="loading");$(jHtml.pagingContainer+" select").prop("disabled",n=="loading");$(jHtml.mnuSource).prop("disabled",n=="loading");$(jHtml.mnuStatus).prop("disabled",n=="loading")},getItemFromRecord1:function(n,t){var d=this,e=function(n){return n!=null?new Date(parseInt(n.substring(n.indexOf("(")+1).replace(")/",""))):""},r,o,s;if(typeof n!="undefined"&&n!=null){var p=e(n[3]),w=e(n[22]),b=e(n[29]),k=n[4],f=k.split("|")[0];f[f.length-1]==","&&(f=f.substr(0,f.length-1));r="";o=getSubItem(n[11],":",1);n[1]=="2"&&(o=getSubItem(n[17],":",1));s="";o!=""&&n[1]!="2"&&(s=getSubItem(getSubItem(n[11],":",2),"|",3));var h="",u="",a="",c="";n[2]==1?(h="Đặt chỗ",r="",c="bookedTicket"):n[2]==2?(h="Đã thanh toán",u=o,a=s,r=e(n[26]),c="paidTicket"):(r=e(n[16]),h="Đã hủy",c="cancelledTicket",n[20]=="server"?u="Tự động":n[23]==4?u="Khi chọn ghế":n[23]==5?u="Ngân Lượng":n[23]==6&&(u="123Pay"));var v=getSubItem(n[10],"|",0),l=getSubItem(n[7],"|",3),y=getSubItem(n[7],"|",4),i={type:n[1],statusClass:c,transactionId:n[25],transactionIdDisplay:n[25]!=null?"display":"none",tripName:n[24],fromArea:getSubItem(n[14],"|",3),toArea:getSubItem(n[15],"|",3),note:n[9],noteDisplay:n[9]!=null?"display":"none",money:n[8]==undefined?"0":n[8],fare:n[8]==undefined?"0":n[8],tripDate:moment(p).format(jVar.dateDisplayFormat),tripTime:moment(p).format("hh:mm"),createdDate:moment(w).format(jVar.dateDisplayFormat),createdTime:moment(w).format("hh:mm"),seat:f,pickupInfo:v,pickupInfoDisplay:v!=""?"display":"none",customerDisplay:l!=""||y!=""||v!=""?"display":"none",customerName:l,customerNameSub:l!=""?l:"Khách hàng",customerPhone:y,customerPhoneDisplay:y!=""?"display":"none",statusDate:moment(r).format(jVar.dateDisplayFormat),statusTime:moment(r).format("hh:mm"),statusDateDisplay:r!=null?"display":"none",chargedUser:n[13],chargedUserDisplay:n[13]!=null?"display":"none",code:n[0],companyName:n[19],paymentType:o,paymentLoc:s,createdUser:n[12],source:n[1]=="2"?"Online":n[1]=="3"?"VMS":"",isConfirmed:n[21]!=null&&n[21]==1?jHtml.isConfirmed:jHtml.notConfirmed,index:t,status:status,status1:h,status2:u,status2Display:u!=""?"display":"none",status3:a,status3Display:a!=""?"display":"none",id:n[27],transactionGateway:n[28],transactionDate:moment(b).format(jVar.dateDisplayFormat),transactionTime:moment(b).format("hh:mm"),transactionStatus:n[30],transactionNLPaymentType:n[31],transactionBankCode:n[32],transactionDescription:n[33],transactionChecksum:n[34],totalSeats:1};return i.moneyFormatted=vToMn(i.money),i.fareFormatted=vToMn(i.fare),i.isConfirmed=vtpl(i.isConfirmed,{code:i.code,id:i.id,index:t}),i}return{}},getTickets:function(){var t=function(t){for(var r,f=[],i=n.getItemFromRecord1(t[0],0),u=1;u<t.length;u++)r=n.getItemFromRecord1(t[u],u),r.code!=i.code?(f.push(i),i=r):(i.money+=r.fare,i.totalSeats+=1,i.seat+=", "+r.seat,i.moneyFormatted=vToMn(i.money));return f.push(i),f},n=this;$(jHtml.tableBody).html(jHtml.loadingAnimation);$(jHtml.pagingContainer).html("");n.updateVisible("loading");n.tickets=[];$(jHtml.tableBody).html("");vRqs({_a:jVar.getTicketFunction,_c:filter,_f:jVar.fieldsToGet.join()},function(i,r){i==1&&r.length>0&&(n.tickets=t(r));n.pager.updateInfo(n.tickets.length,1).render();n.updateVisible("loaded")})}});
//# sourceMappingURL=p.min.js.map
