var I=function(n,t,i,r,u,f){this._coach=parseInt(n);this._row=parseInt(t);this._col=parseInt(i);this._status=parseInt(r);this._class=u;this._label=f},S=function(n,t,i,r,u,f,e){I.call(this,n,t,i,r,u,f);this._type=parseInt(e);this._tickets=[];this._tickets_idxMaxStageCode=0;this._currentTicketIndex=-1;this._seatStatus=0};S.prototype._renderSeat=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var w=this,y=w._getCurrentTicket(i),ct=w._coach+"|"+w._row+"|"+w._col,pt,ni,ft,b,ti,et,k,ot,p,st,ht,nt,g,rt,bt,kt,tt,ri,dt;y._status!=3&&(typeof _dict._blockSeatByVehicle!="undefined"&&$.each(_dict._blockSeatByVehicle,function(n,t){ct==t&&(w._status=2)}),typeof _dict._blockSeatByTrip!="undefined"&&typeof _dict._blockSeatByTrip[a]!="undefined"&&$.each(_dict._blockSeatByTrip[a],function(n,t){ct==t&&(w._status=2)}),typeof _dict._unblockSeatByVehicle!="undefined"&&c!=""&&typeof _dict._unblockSeatByVehicle[c]!="undefined"&&_dict._unblockSeatByVehicle[c].indexOf(ct)!=-1&&(w._status=1),vIsEstStr(app.agentBlockSeats)&&$.each(app.agentBlockSeats.split(","),function(n,t){w._label==t.trim()&&(w._status=2)}));var d=$(),it=null,lt="",ut=null,at="",gt="",vt=0,yt=0;if(typeof _dict._hasDefaultStagePerTrip!="undefined"&&_dict._hasDefaultStagePerTrip&&typeof _dict._defaultStagePerTrip[a]!="undefined"&&(pt=_dict._defaultStagePerTrip[a].split(","),vt=parseInt(pt[0]),yt=parseInt(pt[1])),vIsEstStr(y.fromArea)?(ni=y.fromArea.indexOf("~"),ft=y.fromArea.substr(ni+1,y.fromArea.length).split("|"),it={Id:ft[0],Type:ft[1],Code:ft[2],Name:ft[3]}):(b=null,typeof u.idx[vt]!="undefined"?(b=u.data[u.idx[vt]],it={Id:b.Id,Type:b.Type,Code:b.Code,Name:b.Name}):(b=u.data[0],it={Id:b.Id,Type:b.Type,Code:b.Code,Name:b.Name})),vIsEstStr(y.toArea)?(ti=y.toArea.indexOf("~"),et=y.toArea.substr(ti+1,y.toArea.length).split("|"),ut={Id:et[0],Type:et[1],Code:et[2],Name:et[3]}):(k=null,typeof u.idx[yt]!="undefined"?(k=u.data[u.idx[yt]],ut={Id:k.Id,Type:k.Type,Code:k.Code,Name:k.Name}):(k=u.data[u.data.length-1],ut={Id:k.Id,Type:k.Type,Code:k.Code,Name:k.Name})),it&&it.Id!=u.data[0].Id&&(lt=it.Code),ut&&(at=ut.Code),gt=vIsEstStr(lt)?lt+" - "+at:at,w._isAvailable()){if(ot=y._fare,vIsEstStr(y._surCharge)&&(ot+=parseInt(y._surCharge)),vIsEstStr(y._discount)&&(ot-=parseInt(y._discount)),p={seat:{_coach:w._coach,_row:w._row,_col:w._col,_class:"available",_label:w._label,_pInfo:"",_numStagetickets:"",_stageticketsTooltips:"",_note:y._note,_cname:vGln(y._cname),_cphone:"",_nTicketPerTrip:n>1?" "+n+"G":"",_pmInfo:"",_suser:"",_cuser:"",_fare:vIsEstStr(ot)?ot.toMn()+"đ":"",_code:"",_notallow:""}},v){var wt="",ui=!0,ii=w._renderStageTicketsInfo_Tooltips(w._tickets,u);$.isEmptyObject(y)||(p.seat._stageticketsTooltips=ii,p.seat._numStagetickets=w._tickets.length,p.seat._stageName=gt,st=y._getPickupInfo(),wt=st.type,p.seat._class=_dict._cc[y._status],p.seat._pInfo=$.isEmptyObject(st)?"":st.text,p.seat._cphone=y._getDefaultPhoneNumber(),p.seat._code=y._getTicketCode(),ui=!1,vIsEstStr(y._suser)&&(p.seat._suser="B:&nbsp;"+y._suser),w._updatePaymentInfo_AgentInfo_ToSeat(p,y),p.seat._pmInfo.indexOf("VXR")>0&&(p.seat._class+=" vxr"),ht=!0,nt=[],_dict._isFBooking.length>0&&$.each(_dict._isFBooking,function(n,t){var u,i,r;if(typeof t!="undefined"&&t!=null)for(u=t.split("|"),typeof nt[n]=="undefined"&&(nt[n]=!1),i=0;i<u.length;i++){r=y[u[i]];switch(typeof r){case"string":nt[n]=nt[n]||vIsEstStr(r);break;case"object":nt[n]=nt[n]||!$.isEmptyObject(r)}}}),$.each(nt,function(n,t){ht=ht&&t}),ht&&(p.seat._class+=" fbooking"),y._isCancelled()&&(p.seat._cuser="&nbsp;/&nbsp;C:&nbsp;"+y._getLastUpdateUser(),o==1&&y._canceledDate>s&&(p.seat._class="booking"),(y._cuser!=null||vIsEstStr(y._cuser))&&(p.seat._class="paid",p.seat._pmInfo==" - VXR"&&(p.seat._class+=" vxr"))));w._tickets.length>=1&&(g=y.stageCode,t=!1,g||(g=0),(g&i)==0?(p.seat._numStagetickets=w._tickets.length,p.seat._stageticketsTooltips=ii,p.seat._class=p.seat._class.replace("booking","").replace("fbooking",""),t=!0):g==i||g==1?t=!0:g&i&&g!=i&&(w.disableClickEvent=!0,p.seat._class="",rt=w._getFirstStageTicketInSeat(),p.seat._cphone=rt._getDefaultPhoneNumber(),bt=y._getPickupInfo(),wt=st.type,p.seat._pInfo=$.isEmptyObject(bt)?"":bt.text,p.seat._cphone=rt._getDefaultPhoneNumber(),p.seat._cname=vGln(rt._cname),p.seat._note=rt._note,w._updatePaymentInfo_AgentInfo_ToSeat(p,rt),vIsEstStr(y._suser)&&(p.seat._suser="B:&nbsp;"+y._suser),p.seat._numStagetickets=w._tickets.length,p.seat._label=e==g?_dict._fullStageTicketLable:_dict._stageTicketLable,y.isStageSeat=!0));w._tickets.length!=1||f||y.stageCode!=i&&i!=0||(p.seat._numStagetickets="");t&&(kt=$("<div />"),tt=0,$.isEmptyObject(y)||(tt=y._status),ri=_dict._st[tt],(y._type!=2||y._type==2&&app.rights.indexOf($.rights.bEdtOnlTic.val)>=0)&&($.each(_dict._at,function(n,t){if(ri.indexOf(n)!=-1){var i=!0;o==2?i=!1:(t[1]=="B"&&(app.rights.indexOf($.rights.bBook.val)==-1||o==1&&_dict._disallowBkAtrDpt&&app.rights.indexOf($.rights.bBkAtDpt.val)==-1)&&(i=!1),t[1]=="U"&&app.rights.indexOf($.rights.bUpdate.val)==-1&&(i=!1),t[1]=="M"&&!_dict._stageTicketshowMButton&&f&&(i=!1),app.rights.indexOf($.rights.bEnBtnAtDpt.val)==-1&&t[1]=="M"&&(tt==2||tt==5)&&o==1&&h&&(i=!1),t[1]=="M"&&app.rights.indexOf($.rights.bMove.val)==-1&&(i=!1),app.rights.indexOf($.rights.bQBook.val)==-1?t[1]=="P"&&(i=!1):t[1]=="P"&&tt!=1&&(i=!1),app.rights.indexOf($.rights.bQPay.val)==-1?t[1]=="Q"&&(i=!1):t[1]=="Q"&&tt!=1&&(i=!1));l||i&&kt.append($("<button />",{text:t[1],type:"button"}).addClass(t[4]).attr("data-type",t[5]))}}),p.seat._notallow=typeof l!="undefined"&&l?"notallow":""),p.seat.buttons=kt.html())}$.isEmptyObject(y)&&w._tickets.length<=0?d=$(vtpl(_dict._sTpl,p)):$.isEmptyObject(y)&&w._tickets.length>=1?d=$(vtpl(_dict._svcTpl,p)):y.stageCode>=e||y.stageCode==1?v&&(d=$(vtpl(_dict._sTpl,p))):d=$(vtpl(_dict._svcTpl,p));wt=="T"&&d.find(".pick").addClass("transfer");p.seat._pInfo==""&&d.find(".pick").css("background","none");y._seri!=null&&y._seri!=""&&d.find(".seat-code").addClass("exported")}else dt={seat:{_label:w._label}},d=y.stageCode>=e?$(vtpl(_dict._lksvcTpl,dt)):$(vtpl(_dict._lksTpl,dt));return d};S.prototype._updatePaymentInfo_AgentInfo_ToSeat=function(n,t){var i=t._getPaymentInfo(),r=t._getAgentInfo();if($.isEmptyObject(i))$.isEmptyObject(r)||(n.seat._pmInfo=r._code,n.seat._pmFullInfo="CN/ĐL:&nbsp;"+r._name);else{switch(i.type){case 1:case 6:typeof i.info!="undefined"&&(n.seat._pmInfo=i.info._code,n.seat._pmFullInfo="CN/ĐL:&nbsp;"+i.info._name);break;case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:n.seat._pmInfo=i.sname;n.seat._pmFullInfo="CN/ĐL:&nbsp;"+i.name}vIsEstStr(t._cuser)&&!t._isCancelled()&&(n.seat._cuser="&nbsp;/&nbsp;P:&nbsp;"+t._cuser)}typeof n.seat._pmInfo!="undefined"&&n.seat._pmInfo.length>0&&(n.seat._pmInfo=" - "+n.seat._pmInfo)};S.prototype._getFirstStageTicketInSeat=function(){var n=this,t;return n._tickets_idxMaxStageCode==-1?{}:(t=n._tickets[n._tickets_idxMaxStageCode],t?t:{})};S.prototype._renderStageTicketsInfo_Tooltips=function(n,t){var i="",r;return t&&(r=t.data.length-1,$.each(n,function(n,u){var a="T"+u._id,o=u.stageCode.toString(2),e=r-o.length,f=o.indexOf("0");f=f==-1?r:e+f;u.stage_Idx1=e;u.stage_Idx2=f;var h=u._cphone?u._cphone:"",c=u._cname?u._cname:"",l="<p class='nhieu-chang-ng-dat'><small>"+c+" "+h+"<\/small><\/p>",s="";t.data[e]!=null&&(u.stage_point1=t.data[e],u.stage_point2=t.data[f],s="<a href='#' data-fromId='"+u.stage_point1.Id+"' data-toId='"+u.stage_point2.Id+"' class='stage-ticket-context'>"+u.stage_point1.Code+" - "+u.stage_point2.Code+"<\/a>");i=i+"<li>"+s+l+"<\/li>"})),i};S.prototype._renderPrintStageSeat=function(){var n=this,t={pseat:{_label:n._label,_pmInfo:"",_cname:"",_cphone:"",_note:"VÉ CHẶNG",_nTicketPerTrip:"",_hidden:"hidden",_seri:n._code}};return $(vtpl(_dict._pssTpl,t))};S.prototype._renderPrintSeat=function(n,t,i){var b=this,u=b._getCurrentTicket(),h=null,a="",v=null,y="",k="",d,c,g,l,r,f,o,nt,e,s,p,w;if(vIsEstStr(u.fromArea)&&(d=u.fromArea.indexOf("~"),c=u.fromArea.substr(d+1,u.fromArea.length).split("|"),h={Id:c[0],Type:c[1],Code:c[2],Name:c[3]}),vIsEstStr(u.toArea)&&(g=u.toArea.indexOf("~"),l=u.toArea.substr(g+1,u.toArea.length).split("|"),v={Id:l[0],Type:l[1],Code:l[2],Name:l[3]}),h&&(t?h.Id!=t.data[0].Id&&(a=h.Code):a=h.Code),v&&(y=v.Code),k=vIsEstStr(a)?a+" - "+y:y,r={pseat:{_label:b._label,_pmInfo:"",_cname:vGln(u._cname),_cphone:"",_note:u._note,_nTicketPerTrip:n>1?"-"+n+"G":"",_cFullName:u._cname,_stageName:k}},$.isEmptyObject(u))r.pseat._hidden="hidden";else{if(u._status!=1&&(r.pseat._dathanhtoan="da-thanh-toan"),r.pseat._cphone=u._getDefaultPhoneNumber(),r.pseat._fare=u._fare.toMn()+"đ",r.pseat._cuser=u._cuser,r.pseat._suser=u._suser,typeof _dict._onlyPaidBackGround!="undefined"&&_dict._onlyPaidBackGround&&u._status==1&&(r.pseat._onlyPaidBackGround="no-background"),f=u._getPaymentInfo(),o=u._getAgentInfo(),$.isEmptyObject(f))$.isEmptyObject(o)||(typeof _dict._noShowAgentInfo!="undefined"&&_dict._noShowAgentInfo?(r.pseat._pmInfo="",r.pseat._pmFullInfo=""):(r.pseat._pmInfo=o._code,r.pseat._pmFullInfo=o._name));else{r.pseat._paid="paid";switch(f.type){case 1:typeof _dict._showUCharge!="undefined"&&_dict._showUCharge?u._cuser!=""?(nt=u._cuser.split("."),r.pseat._pmInfo=nt[0]):r.pseat._pmInfo="":$.isEmptyObject(f.info)?(r.pseat._pmInfo=o._code,r.pseat._pmFullInfo=o._name):(r.pseat._pmInfo=f.info._code,r.pseat._pmFullInfo=f.info._name);break;case 6:r.pseat._pmInfo=f.info._code;r.pseat._pmFullInfo=f.info._name;break;case 2:case 3:case 4:typeof _dict._noBackground!="undefined"&&_dict._noBackground&&(r.pseat._nobackground="no-background");r.pseat._pmInfo=f.sname;r.pseat._pmFullInfo=f.name;break;case 5:case 7:case 8:case 9:case 10:r.pseat._pmInfo=f.sname;r.pseat._pmFullInfo=f.name}}if(vIsEstStr(u._seri)&&(r.pseat._exported="exported"),e=u._getPickupInfo(),$.isEmptyObject(e)?r.pseat._hidden="hidden":_dict._hasTransferOnPST?(e.type=="P"&&(r.pseat._pInfo=e.text),e.type=="T"&&_dict._disTransferOnPST!=undefined&&(r.pseat._pInfo=_dict._disTransferOnPST=="default"?e.text:_dict._disTransferOnPST)):e.type=="P"&&(r.pseat._pInfo=e.text),s="",u._status==1)s="CTiền";else if(u._status!=2||$.isEmptyObject(f))u._status==5&&(s="KoThu");else switch(f.type){case 1:vIsEstStr(u._staffName)&&(p=u._staffName.split(" "),s=p[p.length-1]);break;case 6:s=f.info._code}r.pseat._ttPayment=s}return w=$(vtpl(_dict._psTpl,r)),i!=null&&(r.data=i,w=$(vtpl(_dict._psTpl_SeatGroup,r))),w};S.prototype._renderCustomData=function(n){return $(vtpl(_dict._psTpl_SeatGroup,n))};S.prototype._renderLSeat=function(n,t,i,r,u){var s=this,a=$(),f=null,e,h,o,c,l,p;if(s._isAvailable()){if(f=typeof r!="undefined"?r:s._getCurrentTicket(),e={seat:{_index:t,_coach:s._coach,_row:s._row,_col:s._col,_class:"available",_pInfo:"",_label:s._label,_cname:vGln(f._cname),_nTicketPerTrip:n>1?"("+n+"G)":"",_cphone:"",_idate:"",_total:0,_status:"",_pmInfo:"",_pmFullInfo:"",_suser:"",_cuser:"",_note:f._note,_stageName:u,_fromCode:"",_fromName:"",_toCode:"",_toName:""}},!$.isEmptyObject(f)){if(f.fromArea!=undefined&&f.fromArea!=null){var v=f.fromArea.split("|"),w=v[2],b=v[3];e.seat._fromCode=w;e.seat._fromName=b}if(f.toArea!=undefined&&f.toArea!=null){var y=f.toArea.split("|"),k=y[2],d=y[3];e.seat._toCode=k;e.seat._toName=d}if(h=f._getPickupInfo(),$.isEmptyObject(h)||(e.seat._pInfo=h.text),e.seat._cphone=f._getDefaultPhoneNumber(),e.seat._idate=f._issue.toFormatString("dd-mm-yyyy hh:ii"),e.seat._total=f._fare.toMn()+"đ",e.seat._status=f._getStatusText(),e.seat._suser=f._suser,f._isPaid()||f._isPass()){if(o=f._getPaymentInfo(),!$.isEmptyObject(o)){switch(o.type){case 1:case 6:typeof o.info!="undefined"&&(e.seat._pmInfo=o.info._code,e.seat._pmFullInfo="CN/ĐL:&nbsp;"+o.info._name);break;case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:e.seat._pmInfo=o.sname;e.seat._pmFullInfo=o.name}vIsEstStr(f._cuser)&&(e.seat._cuser=f._cuser)}}else f._isCancelled()&&(e.seat._cuser=f._getLastUpdateUser());e.seat._issue=f._issue.getTime()}i&&!app.oRights.StageEnable&&(c=$("<div />"),l=0,$.isEmptyObject(f)||(l=f._status),p=_dict._lst[l],$.each(_dict._at,function(n,t){p.indexOf(n)!=-1&&c.append($("<button />",{text:t[1],type:"button"}).addClass(t[4]).attr("data-type",t[5]))}),e.seat._buttons=c.html());a=$(vtpl(_dict._ilTpl,e))}return a};S.prototype._getSeatInfo=function(){var n=this;return n._label+"|"+n._coach+"|"+n._row+"|"+n._col};S.prototype._getSeatType=function(){return this._type};S.prototype._addTicket=function(n,t,i){var r=this,u=r._tickets.push(n)-1,f=i?i:r._tickets[u].stageCode;f&t&&(r._currentTicketIndex=u);isNaN(f)||(r._seatStatus=r._seatStatus|f,(u==0||f>=r._tickets[r._tickets_idxMaxStageCode].stageCode)&&(r._tickets_idxMaxStageCode=u))};S.prototype._getCurrentTicket=function(n){var i=this,t;return i._currentTicketIndex==-1?{}:(t=i._tickets[i._currentTicketIndex],t&&t.stageCode&&n&&n>=1&&(n&t.stageCode)==0)?{}:t?t:{}};S.prototype._getTicketById=function(n){var i=this,t={};return $.each(i._tickets,function(i,r){$.isEmptyObject(t)&&r._id==n&&(t=r)}),t};S.prototype._changeStatus=function(n){this._status=n};S.prototype._isAvailable=function(){return this._status==1};S.prototype._isLock=function(){return this._status==2};S.prototype._hasTicket=function(){return this._tickets.length>0};S.prototype._clone=function(){var n=this;return $.extend({},n)};
//# sourceMappingURL=z.min.js.map
