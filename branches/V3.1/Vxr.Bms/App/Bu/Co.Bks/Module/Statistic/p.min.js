define({start:function(){var n=this;vbv("doShowStatistic",function(t){n._statisticByTrip(t.d)})},_statisticByTrip:function(n){var h=this,nt=$.trim(n.tDate.toFormatString("dd-mm-yyyy")),tt=$.trim(n.tTime),it=$.trim(n.tData.Name),r=$(".vbooking-sheet").empty(),i,g;$(".vbooking-csheet").hide();$(".vbooking-info").append('<h4 style="font-size: 24px;text-align: center;">Thống kê theo chuyến '+it+" ngày "+nt+" lúc "+tt+"<\/h4>");var t=FlatObj.cTripInfo,o=t._anotherFareTienKhach,rt=t._nameAnotherFareTienKhach,ut=t._mainFareTienKhach,s=t._feeTienKhach,ft=t._nameFeeTienKhach,et=o+ut-s,ot=t._totalNumBranchNotPaid+t._numPickedProNotPaid,st=t._totalNumBranchPaid+t._numPickedProPaid,p=t._totalMoneyBranchNotPaid+t._moneyPickedProNotPaid,w=t._totalMoneyBranchPaid+t._moneyPickedProPaid,c=t._totalMoneyBranchNotPaid+t._totalMoneyBranchPaid+t._moneyPickedProNotPaid+t._moneyPickedProPaid,b=t._feeTienHang,ht=t._nameFeeTienHang,l=c-b,k=t._anotherFee,u=[],a=[],v=0;k.length>0?$.each(k,function(n,t){u.length==0?u.push(t):a.push(t);v+=t._money.toNum()}):u.push({_index:0,_name:"",_money:""});var y=t._tollFee+t._washFee+t._eatFee+v,ct=et+l-y,lt=$('<div class="col-md-6 col-sm-12 col-xs-12 pl0"/>').append("<h4>TIỀN KHÁCH<\/h4>").append(_dict._tienKhachTitle),at=$('<div class="col-md-6 col-sm-12 col-xs-12 pr0 pl0"/>').append("<h4>TIỀN HÀNG<\/h4>").append(_dict._tienHangTitle),vt=$('<div class="col-md-12 col-sm-12 col-xs-12 clearfix pl0 pr0 thong-ke-tb" />').append("<h4>CHI PHÍ<\/h4>").append('<table class="table table-bordered list-ticket thong-ke chi-phi"><tbody><tr><td style="width:22%;height:30px;"><div class="form-group col-md-12" style="margin:0;padding:0;"><label class="col-md-4 col-sm-4 control-label pl0 pr0" style="line-height:30px;" for="inputEmail3">Cầu đường:<\/label><div class="col-md-8 col-sm-7 pl0 pr0 input-group"><input name="TollFee" placeholder="" class="form-control input-sm" value="'+t._tollFee.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/div><\/td><td style="width:22%;"><div class="form-group col-md-12" style="margin:0;padding:0;"><label class="col-md-4 col-sm-4 control-label pr0" style="line-height:30px;" for="inputEmail3">Rửa xe:<\/label><div class="col-md-8 col-sm-7 pl0 pr0 input-group"><input name="WashFee" placeholder="" class="form-control input-sm" value="'+t._washFee.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/div><\/td><td colspan="2"><div class="form-group"><label class="col-sm-5 control-label" style="line-height:30px;" for="inputEmail3">Chi phí khác: <span name="TotalAnotherFee" data-total-another-fee="0">'+v.toMn()+' đ<\/span><\/label><\/div><\/td><\/tr><tr><td style="width:22%;"><div class="form-group col-md-12" style="margin:0;padding:0;"><label class="col-md-4 col-sm-4 control-label pl0 pr0" style="line-height:30px;" for="inputEmail3">Tiền ăn:<\/label><div class="col-md-8 col-sm-7 pl0 pr0 input-group"><input name="EatFee" placeholder="" class="form-control input-sm" value="'+t._eatFee.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/div><\/td><td><\/td><td class="another-fee"><div class="form-group col-md-6 pl0"><label class="col-sm-5 control-label pr0" style="line-height:30px;" for="inputEmail3">Tên chi phí:<\/label><div class="col-sm-7 pl0 pr0"><input name="NameAnotherFee" placeholder="" class="form-control input-sm" value="'+u[0]._name+'"><\/div><\/div><div class="form-group col-md-5"><label class="col-sm-5 control-label pr0" style="line-height:30px;" for="inputEmail3">Số tiền:<\/label><div class="col-sm-7 pl0 pr0 input-group"><input name="MoneyAnotherFee" placeholder="" class="form-control input-sm" value="'+u[0]._money.toNum().toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/div><div class="col-md-1 pr0 pl0"><button name="AddMoreFee" type="button" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-plus"><\/i><\/button><\/div><\/td><\/tr><tr><td colspan="4"><h4>TỔNG CHÍ PHÍ: <span name="TotalFee" data-total-fee="'+y+'">'+y.toMn()+' đ<\/span><\/h4><\/td><\/tr><tr><td colspan="4"><h3>TỔNG CỘNG: <span name="TotalTotal">'+ct.toMn()+' đ<\/span><\/h3><button type="button" class="btn btn-md btn-success tk-save-trip"><i class="glyphicon glyphicon-save"><\/i>&nbsp;LƯU<\/button>&nbsp;<button type="button" class="btn btn-md btn-primary btn-chot-phoi">CHỐT PHƠI<\/button><\/td><\/tr><\/tbody><\/table>');r.addClass("thong-ke-tb").append(lt).append(at).append(vt);var d=0,f=0,e=r.find("table.tien-khach tbody");typeof t._tkNumPaidPerType!="undefined"&&$.each(t._tkNumPaidPerType,function(n,t){var i=t.split("|"),r="",u,o;r=i[0]=="TX"?"Tài xế thu":i[0]=="VXR"?"VeXeRe":i[0];u={_branchCode:r,_numTic:i[1]+" vé",_totalFare:parseInt(i[2]).toMn()+" đ"};o=$(vtpl(_dict._tienKhachInput,u));e.append(o);d+=parseInt(i[1]);f+=parseInt(i[2])});e.append("<tr><td><h4>Tổng cộng<\/h4><\/td><td><h4>"+d+' vé<\/h4><\/td><td name="TotalFareTicket" data-fare="'+f+'"><h4>'+f.toMn()+" đ<\/h4><\/td><\/tr>");e.append('<tr><td style="line-height:30px;">Doanh thu khác <\/td><td><input type="text" name="NameAnotherFareTienKhach" placeholder="Tên doanh thu" class="form-control input-bd0 input-sm" value="'+rt+'"/><\/td><td class="col-md-4"><div class="input-group"><input type="text" placeholder="Tổng tiền doanh thu khác" class="form-control input-bd0 input-sm" name="AnotherFareTienKhach" value="'+o.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/td><\/tr>');e.append('<tr><td style="line-height:30px;">Chi phí văn phòng <\/td><td><input type="text" name="NameFeeTienKhach" placeholder="Tên chi phí" class="form-control input-bd0 input-sm" value="'+ft+'"/><\/td><td class="col-md-4"><div class="input-group"><input type="text" placeholder="Chi phí văn phòng" class="form-control input-bd0 input-sm" name="FeeTienKhach" value="'+s.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/td><\/tr>');e.append('<tr><td colspan="2"><h4><b>Tổng<\/b><\/h4><\/td><td><h4 class="totalTienKhach" data-total-tien-khach="'+(f+o-s)+'" style="font-weight:bold;"><b>'+(f+o-s).toMn()+" đ<\/b><\/h4><\/td><\/tr>");i=r.find("table.tien-hang tbody");typeof t._branchProduct!="undefined"&&t._branchProduct.length>0?$.each(t._branchProduct,function(n,t){var r={_branchCode:t._branchCode,_numBranchProPaid:t._numBranchProPaid,_moneyBranchProPaid:t._moneyBranchProPaid.toMn(),_numBranchProNotPaid:t._numBranchProNotPaid,_moneyBranchProNotPaid:t._moneyBranchProNotPaid.toMn(),_totalMoneyBranchFormat:(t._moneyBranchProPaid+t._moneyBranchProNotPaid).toMn()},u=$(vtpl(_dict._tienHangInput,r));i.append(u)}):typeof t._branchReceiveProduct!="undefined"&&$.each(t._branchReceiveProduct,function(n,t){var r={_branchCode:t._code,_numBranchProPaid:0,_moneyBranchProPaid:0,_numBranchProNotPaid:0,_moneyBranchProNotPaid:0,_totalMoneyBranchFormat:0},u=$(vtpl(_dict._tienHangInput,r));i.append(u)});i.append('<tr><td style="line-height:30px;">Dọc đường<\/td><td><div class="input-group col-md-12"><input name="PickedPaid" type="text" placeholder="Đã TT" class="form-control input-bd0 input-sm" value="'+t._moneyPickedProPaid.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/td><td style="width:60px;"><input name="NumPickedPaid" type="text" placeholder="SL" class="form-control input-bd0 input-sm" value="'+t._numPickedProPaid+'"><\/td><td><div class="input-group col-md-12"><input name="PickedNotPaid" type="text" placeholder="Chưa TT" class="form-control input-bd0 input-sm" value="'+t._moneyPickedProNotPaid.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/td><td style="width:60px;"><input name="NumPickedNotPaid" type="text" placeholder="SL" class="form-control input-bd0 input-sm" value="'+t._numPickedProNotPaid+'"><\/td><td name="TotalFarePicked" style="line-height:30px;">'+(t._moneyPickedProNotPaid+t._moneyPickedProPaid).toMn()+" đ<\/td><\/tr>");i.append('<tr><td><h4>Tổng cộng<\/h4><\/td><td><h4 data-total-paid="'+w+'" class="totalPaid">'+w.toMn()+' đ<\/h4><\/td><td><h4 class="totalCountPaid">'+st+'<\/h4><\/td><td><h4 data-total-not-paid="'+p+'" class="totalNotPaid">'+p.toMn()+' đ<\/h4><\/td><td><h4 class="totalCountNotPaid">'+ot+'<\/h4><\/td><td><h4 class="totalTienHangNotFee" data-total-tien-hang-not-fee="'+c+'">'+c.toMn()+" đ<\/h4><\/td><\/tr>");i.append('<tr><td style="line-height:30px;">Chi phí hàng<\/td><td colspan="4"><input name="NameFeeTienHang" type="text" class="form-control input-bd0 input-sm" placeholder="Tên chi phí" value="'+ht+'"/><\/td><td><div class="input-group"><input name="FeeTienHang" type="text" class="form-control input-bd0 input-sm" value="'+b.toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/td><\/tr>');i.append('<tr><td colspan="5" style="line-height:30px;"><h4 style="font-weight:bold;">Tổng<\/h4><\/td><td><h4 style="font-weight:bold;" class="totalTienHang" data-total-tien-hang="'+l+'">'+l.toMn()+" đ<\/h4><\/td><\/tr>");a.length>0&&$.each(a,function(n,t){r.find("td.another-fee").append('<div class="form-group col-md-6 pl0 mt10"><label class="col-sm-5 control-label pr0" style="line-height:30px;" for="inputEmail3">Tên chi phí:<\/label><div class="col-sm-7 pl0 pr0"><input name="NameAnotherFee" placeholder="" class="form-control input-sm" value="'+t._name+'"><\/div><\/div><div class="form-group col-md-5 mt10"><label class="col-sm-5 control-label pr0" style="line-height:30px;" for="inputEmail3">Số tiền:<\/label><div class="col-sm-7 pl0 pr0 input-group"><input name="MoneyAnotherFee" placeholder="" class="form-control input-sm" value="'+t._money.toNum().toMn()+'"><div class="input-group-addon">đ<\/div><\/div><\/div><div class="col-md-1 pr0 pl0 mt10"><button name="RemoveMoreFee" type="button" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-remove"><\/i><\/button><\/div>')});g=n.tData.Ts[n.tTime][0].ClosedStatus;g==2&&app.rights.indexOf("5|10095|1")==-1&&(r.find("input,button").prop("disabled","disabled"),r.find("button.tk-save-trip,button.btn-chot-phoi").addClass("hidden"));h._bindEventTKTienKhach();h._bindEventTKTienHang(n);h._bindEventTKChiPhi(n)},_bindEventTKTienKhach:function(){var n=$(".vbooking-sheet"),i=n.find('td[name="TotalFareTicket"]').attr("data-fare").toNum(),r=0,t=0;n.find('input[name="AnotherFareTienKhach"]').on("change",function(){var f=n.find('input[name="FeeTienKhach"]').val().replace(/\./g,"").toNum(),u=$(this).val().replace(/\./g,"").toNum(),e,o;u<1e4&&(u=u*1e3);e=n.find("h4.totalTienHang").attr("data-total-tien-hang").toNum();o=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum();u>0?($(this).val(u.toMn()),t=u+i-f):($(this).val(0),t=i-f);r=t+e-o;n.find("h4.totalTienKhach").attr("data-total-tien-khach",t);n.find("h4.totalTienKhach").text(t.toMn()+" đ");n.find('span[name="TotalTotal"]').text(r.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="FeeTienKhach"]').on("change",function(){var u=$(this).val().replace(/\./g,"").toNum(),f=n.find('input[name="AnotherFareTienKhach"]').val().replace(/\./g,"").toNum(),e,o;u<1e4&&(u=u*1e3);t=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum();e=n.find("h4.totalTienHang").attr("data-total-tien-hang").toNum();o=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum();u>0?($(this).val(u.toMn()),t=i+f-u):($(this).val(0),t=i+f);r=t+e-o;n.find("h4.totalTienKhach").attr("data-total-tien-khach",t);n.find("h4.totalTienKhach").text(t.toMn()+" đ");n.find('span[name="TotalTotal"]').text(r.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()})},_bindEventTKTienHang:function(){var n=$(".vbooking-sheet"),s=0,h=0,l=0,u=0,f=0,a=0,e=0,o=0,r=0,i=0,t=0,c=0;n.find('input[name="BranchNotPaid"]').on("change",function(){var a=$(this),v=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum(),y=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum(),u;s=$(this).val().replace(/\./g,"").toNum();h=a.closest("tr").find('input[name="BranchPaid"]').val().replace(/\./g,"").toNum();f=n.find('input[name="PickedNotPaid"]').val().replace(/\./g,"").toNum();o=n.find("h4.totalPaid").attr("data-total-paid").toNum();r=n.find('input[name="FeeTienHang"]').val().replace(/\./g,"").toNum();s<1e4&&(s=s*1e3);s>0?($(this).val(s.toMn()),l=s+h):($(this).val(0),l=h);u=0;$.each(n.find('input[name="BranchNotPaid"]'),function(n,t){var i=$(t).val().replace(/\./g,"").toNum();u+=i});e=u+f;i=e+o;t=i-r;c=v+t-y;a.closest("tr").find('td[name="TotalFareBranch"]').text(l.toMn()+" đ");n.find("h4.totalNotPaid").text(e.toMn()+" đ");n.find("h4.totalNotPaid").attr("data-total-not-paid",e);n.find("h4.totalTienHangNotFee").text(i.toMn()+" đ");n.find("h4.totalTienHangNotFee").attr("data-total-tien-hang-not-fee",i);n.find("h4.totalTienHang").text(t.toMn()+" đ");n.find("h4.totalTienHang").attr("data-total-tien-hang",t);n.find('span[name="TotalTotal"]').text(c.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="BranchPaid"]').on("change",function(){var a=$(this),v=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum(),y=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum(),f;h=$(this).val().replace(/\./g,"").toNum();s=a.closest("tr").find('input[name="BranchNotPaid"]').val().replace(/\./g,"").toNum();u=n.find('input[name="PickedPaid"]').val().replace(/\./g,"").toNum();e=n.find("h4.totalNotPaid").attr("data-total-not-paid").toNum();r=n.find('input[name="FeeTienHang"]').val().replace(/\./g,"").toNum();h<1e4&&(h=h*1e3);h>0?($(this).val(h.toMn()),l=s+h):($(this).val(0),l=s);f=0;$.each(n.find('input[name="BranchPaid"]'),function(n,t){var i=$(t).val().replace(/\./g,"").toNum();f+=i});o=f+u;i=e+o;t=i-r;c=v+t-y;a.closest("tr").find('td[name="TotalFareBranch"]').text(l.toMn()+" đ");n.find("h4.totalPaid").text(o.toMn()+" đ");n.find("h4.totalPaid").attr("data-total-paid",o);n.find("h4.totalTienHangNotFee").text(i.toMn()+" đ");n.find("h4.totalTienHangNotFee").attr("data-total-tien-hang-not-fee",i);n.find("h4.totalTienHang").text(t.toMn()+" đ");n.find("h4.totalTienHang").attr("data-total-tien-hang",t);n.find('span[name="TotalTotal"]').text(c.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="PickedPaid"]').on("change",function(){var h=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum(),l=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum(),s;u=$(this).val().replace(/\./g,"").toNum();f=n.find('input[name="PickedNotPaid"]').val().replace(/\./g,"").toNum();e=n.find("h4.totalNotPaid").attr("data-total-not-paid").toNum();r=n.find('input[name="FeeTienHang"]').val().replace(/\./g,"").toNum();u<1e4&&(u=u*1e3);u>0?($(this).val(u.toMn()),a=f+u):($(this).val(0),a=f);s=0;$.each(n.find('input[name="BranchPaid"]'),function(n,t){var i=$(t).val().replace(/\./g,"").toNum();s+=i});o=u+s;i=e+o;t=i-r;c=h+t-l;n.find('td[name="TotalFarePicked"]').text(a.toMn()+" đ");n.find("h4.totalPaid").text(o.toMn()+" đ");n.find("h4.totalPaid").attr("data-total-paid",o);n.find("h4.totalTienHangNotFee").text(i.toMn()+" đ");n.find("h4.totalTienHangNotFee").attr("data-total-tien-hang-not-fee",i);n.find("h4.totalTienHang").text(t.toMn()+" đ");n.find("h4.totalTienHang").attr("data-total-tien-hang",t);n.find('span[name="TotalTotal"]').text(c.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="PickedNotPaid"]').on("change",function(){var h=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum(),l=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum(),s;f=$(this).val().replace(/\./g,"").toNum();u=n.find('input[name="PickedPaid"]').val().replace(/\./g,"").toNum();o=n.find("h4.totalPaid").attr("data-total-paid").toNum();r=n.find('input[name="FeeTienHang"]').val().replace(/\./g,"").toNum();f<1e4&&(f=f*1e3);f>0?($(this).val(f.toMn()),a=f+u):($(this).val(0),a=u);s=0;$.each(n.find('input[name="BranchNotPaid"]'),function(n,t){var i=$(t).val().replace(/\./g,"").toNum();s+=i});e=f+s;i=e+o;t=i-r;c=h+t-l;n.find('td[name="TotalFarePicked"]').text(a.toMn()+" đ");n.find("h4.totalNotPaid").attr("data-total-not-paid",e);n.find("h4.totalNotPaid").text(e.toMn()+" đ");n.find("h4.totalTienHangNotFee").text(i.toMn()+" đ");n.find("h4.totalTienHangNotFee").attr("data-total-tien-hang-not-fee",i);n.find("h4.totalTienHang").text(t.toMn()+" đ");n.find("h4.totalTienHang").attr("data-total-tien-hang",t);n.find('span[name="TotalTotal"]').text(c.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="NumBranchNotPaid"]').on("change",function(){var t=0,i;$.each(n.find('input[name="NumBranchNotPaid"]'),function(n,i){var r=$(i).val().toNum();t+=r});i=n.find('input[name="NumPickedNotPaid"]').val().toNum();n.find("h4.totalCountNotPaid").text(t+i)}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="NumPickedNotPaid"]').on("change",function(){var t=0,i;$.each(n.find('input[name="NumBranchNotPaid"]'),function(n,i){var r=$(i).val().toNum();t+=r});i=$(this).val().toNum();n.find("h4.totalCountNotPaid").text(t+i)}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="NumBranchPaid"]').on("change",function(){var t=0,i;$.each(n.find('input[name="NumBranchPaid"]'),function(n,i){var r=$(i).val().toNum();t+=r});i=n.find('input[name="NumPickedPaid"]').val().toNum();n.find("h4.totalCountPaid").text(t+i)}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="NumPickedPaid"]').on("change",function(){var t=0,i;$.each(n.find('input[name="NumBranchPaid"]'),function(n,i){var r=$(i).val().toNum();t+=r});i=$(this).val().toNum();n.find("h4.totalCountPaid").text(t+i)}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('input[name="FeeTienHang"]').on("change",function(){var u=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum(),f=n.find('span[name="TotalFee"]').attr("data-total-fee").toNum();i=n.find("h4.totalTienHangNotFee").attr("data-total-tien-hang-not-fee").toNum();r=$(this).val().replace(/\./g,"").toNum();r<1e4&&(r=r*1e3);r>0?($(this).val(r.toMn()),t=i-r):($(this).val(0),t=i);c=u+t-f;n.find("h4.totalTienHang").text(t.toMn()+" đ");n.find("h4.totalTienHang").attr("data-total-tien-hang",t);n.find('span[name="TotalTotal"]').text(c.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()})},_bindEventTKChiPhi:function(n){var c=this,t=$(".vbooking-sheet"),r=0,u=0,f=0,i=0,e=0,o=0,s=0,h=0;t.find('input[name="TollFee"]').on("change",function(){r=$(this).val().replace(/\./g,"").toNum();r<1e4&&(r=r*1e3);u=t.find('input[name="WashFee"]').val().replace(/\./g,"").toNum();f=t.find('input[name="EatFee"]').val().replace(/\./g,"").toNum();e=t.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum();o=t.find("h4.totalTienHang").attr("data-total-tien-hang").toNum();s=t.find('span[name="TotalAnotherFee"]').attr("data-total-another-fee").toNum();r>0?$(this).val(r.toMn()):$(this).val("");i=r+u+f+s;h=e+o-i;t.find('span[name="TotalFee"]').text(i.toMn()+" đ");t.find('span[name="TotalFee"]').attr("data-total-fee",i);t.find('span[name="TotalTotal"]').text(h.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});t.find('input[name="WashFee"]').on("change",function(){u=$(this).val().replace(/\./g,"").toNum();u<1e4&&(u=u*1e3);r=t.find('input[name="TollFee"]').val().replace(/\./g,"").toNum();f=t.find('input[name="EatFee"]').val().replace(/\./g,"").toNum();e=t.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum();o=t.find("h4.totalTienHang").attr("data-total-tien-hang").toNum();s=t.find('span[name="TotalAnotherFee"]').attr("data-total-another-fee").toNum();u>0?$(this).val(u.toMn()):$(this).val("");i=r+u+f+s;h=e+o-i;t.find('span[name="TotalFee"]').text(i.toMn()+" đ");t.find('span[name="TotalFee"]').attr("data-total-fee",i);t.find('span[name="TotalTotal"]').text(h.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});t.find('input[name="EatFee"]').on("change",function(){f=$(this).val().replace(/\./g,"").toNum();f<1e4&&(f=f*1e3);r=t.find('input[name="TollFee"]').val().replace(/\./g,"").toNum();u=t.find('input[name="WashFee"]').val().replace(/\./g,"").toNum();e=t.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum();o=t.find("h4.totalTienHang").attr("data-total-tien-hang").toNum();s=t.find('span[name="TotalAnotherFee"]').attr("data-total-another-fee").toNum();f>0?$(this).val(f.toMn()):$(this).val("");i=r+u+f+s;h=e+o-i;t.find('span[name="TotalFee"]').text(i.toMn()+" đ");t.find('span[name="TotalFee"]').attr("data-total-fee",i);t.find('span[name="TotalTotal"]').text(h.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});t.find('button[name="AddMoreFee"]').on("click",function(i){i.preventDefault();i.stopPropagation();var r=!0;$.each(t.find('input[name="NameAnotherFee"]'),function(n,t){$(t).val()==""?(r=!1,$(t).closest("div").addClass("has-error")):$(t).closest("div").removeClass("has-error")});$.each(t.find('input[name="MoneyAnotherFee"]'),function(n,t){$(t).val().replace(/\./g,"").toNum()==0?(r=!1,$(t).closest("div").addClass("has-error")):$(t).closest("div").removeClass("has-error")});r&&($(this).closest("td.another-fee").append('<div class="form-group col-md-6 pl0 mt10"><label class="col-sm-5 control-label pr0" style="line-height:30px;" for="inputEmail3">Tên chi phí:<\/label><div class="col-sm-7 pl0 pr0"><input name="NameAnotherFee" placeholder="" class="form-control input-sm"><\/div><\/div><div class="form-group col-md-5 mt10"><label class="col-sm-5 control-label pr0" style="line-height:30px;" for="inputEmail3">Số tiền:<\/label><div class="col-sm-7 pl0 pr0 input-group"><input name="MoneyAnotherFee" placeholder="" class="form-control input-sm" value="0"><div class="input-group-addon">đ<\/div><\/div><\/div><div class="col-md-1 pr0 pl0 mt10"><button name="RemoveMoreFee" type="button" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-remove"><\/i><\/button><\/div>'),c._bindEventAnotherFee(n))});t.find("button.tk-save-trip").unbind().on("click",function(t){t.preventDefault();t.stopPropagation();c._tkSaveTrip(n)});t.find("button.btn-chot-phoi").unbind().on("click",function(t){var i,r,u;if(t.preventDefault(),t.stopPropagation(),i=n.tData.Ts[n.tTime][0].ClosedStatus,r=FlatObj.cTripInfo,i!=1){vbf("onShowPopModal",{msg:"Xe chưa xuất bến, không thể chốt phơi. Vui lòng kiểm tra lại."});return}if(r._numBooking>0){vbf("onShowPopModal",{msg:"Còn vé đặt chỗ, vui lòng chuyển thanh toán hoặc hủy rồi thực hiện chốt phơi lại."});return}if(u=n.tData.Ts[n.tTime][0].TripDetailId,typeof u=="undefined"){vbf("onShowPopModal",{msg:"Chuyến này chưa được đặt vé. Vui lòng kiểm tra lại."});return}c._createChotPhoiDialogDiv(n)});c._bindEventAnotherFee()},_bindEventAnotherFee:function(){var n=$(".vbooking-sheet");n.find('input[name="MoneyAnotherFee"]').on("change",function(t){var r,u,f;t.preventDefault();t.stopPropagation();var e=n.find('input[name="TollFee"]').val().replace(/\./g,"").toNum(),o=n.find('input[name="WashFee"]').val().replace(/\./g,"").toNum(),s=n.find('input[name="EatFee"]').val().replace(/\./g,"").toNum(),h=n.find("h4.totalTienKhach").attr("data-total-tien-khach").toNum(),c=n.find("h4.totalTienHang").attr("data-total-tien-hang").toNum(),i=$(this).val().replace(/\./g,"").toNum();i<1e4&&(i=i*1e3);i>0?$(this).val(i.toMn()):$(this).val("");r=0;$.each(n.find('input[name="MoneyAnotherFee"]'),function(n,t){var i=$(t).val().replace(/\./g,"").toNum();r+=i});u=e+o+s+r;f=c+h-u;n.find('span[name="TotalAnotherFee"]').text(r.toMn()+" đ");n.find('span[name="TotalAnotherFee"]').attr("data-total-another-fee",r);n.find('span[name="TotalFee"]').text(u.toMn()+" đ");n.find('span[name="TotalFee"]').attr("data-total-fee",u);n.find('span[name="TotalTotal"]').text(f.toMn()+" đ")}).focus(function(){$(this).select()}).mouseup(function(n){n.preventDefault()});n.find('button[name="RemoveMoreFee"]').on("click",function(){var n=$(this).closest("div"),t=n.prev(),i=t.prev();n.remove();t.remove();i.remove()})},_tkSaveTrip:function(n){var rt=this,t=$(".vbooking-sheet"),o=n.tData.Ts[n.tTime][0].TripDetailId,e,y;console.log(n);console.log(o);var p=FlatObj.cTripInfo,i={},s={_a:"UpTrip",_c:{Id:o}},w=p._mainFareTienKhach,h=t.find('input[name="AnotherFareTienKhach"]').val().replace(/\./g,"").toNum(),r=t.find('input[name="NameAnotherFareTienKhach"]').val(),c=t.find('input[name="FeeTienKhach"]').val().replace(/\./g,"").toNum(),u=t.find('input[name="NameFeeTienKhach"]').val();if(h>0){if(r==""){vbf("onShowPopModal",{msg:"Vui lòng nhập tên doanh thu khác."});return}}else if(r!=""){vbf("onShowPopModal",{msg:"Doanh thu "+r+" phải lớn hơn 0."});return}if(c>0){if(u==""){vbf("onShowPopModal",{msg:"Vui lòng nhập tên chi phí văn phòng."});return}}else if(u!=""){vbf("onShowPopModal",{msg:"Chi phí "+u+" phải lớn hơn 0."});return}i.PassengerMoney="1~"+w+"|"+r+"##"+h+"|"+u+"##"+c;e=[];$.each(t.find("table.thong-ke.tien-hang tbody tr.branch-pro"),function(n,t){var i=$(t),r=i.find('td[name="BranchCode"]').attr("data-branch-code"),u=i.find('input[name="BranchNotPaid"]').val().replace(/\./g,"").toNum(),f=i.find('input[name="NumBranchNotPaid"]').val(),o=i.find('input[name="BranchPaid"]').val().replace(/\./g,"").toNum(),s=i.find('input[name="NumBranchPaid"]').val();e.push(r+":"+s+"|"+o+"##"+f+"|"+u)});var b=t.find('input[name="PickedNotPaid"]').val().replace(/\./g,"").toNum(),k=t.find('input[name="NumPickedNotPaid"]').val(),d=t.find('input[name="PickedPaid"]').val().replace(/\./g,"").toNum(),g=t.find('input[name="NumPickedPaid"]').val(),l=t.find('input[name="FeeTienHang"]').val().replace(/\./g,"").toNum(),f=t.find('input[name="NameFeeTienHang"]').val();if(l>0){if(f==""){vbf("onShowPopModal",{msg:"Vui lòng nhập tên chi phí hàng hóa."});return}}else if(f!=""){vbf("onShowPopModal",{msg:"Chi phí "+f+" phải lớn hơn 0."});return}i.ProductMoney="1~"+e.join(",")+"~"+g+"|"+d+"##"+k+"|"+b+"~"+f+"##"+l;var nt=t.find('input[name="TollFee"]').val().replace(/\./g,"").toNum(),tt=t.find('input[name="WashFee"]').val().replace(/\./g,"").toNum(),it=t.find('input[name="EatFee"]').val().replace(/\./g,"").toNum(),a=[],v=1;$.each(t.find('input[name="NameAnotherFee"]'),function(n,t){var i=$(t),r=v,u=i.val(),f=i.closest("div.form-group").next("div").find('input[name="MoneyAnotherFee"]').val().replace(/\./g,"").toNum();a.push(r+"|"+u+"|"+f);v++});i.FeeMoney="1~"+nt+"~"+tt+"~"+it+"~"+a.join("##");s._d=i;y=function(n){n==1&&vbf("onShowSuccessModal",{hdr:"Thông báo",msg:"Lưu thành công."})};vRqs(s,y)},_chotPhoi:function(n){var t=$(".vbooking-sheet"),h=$(".vbooking-info"),u=n.tData.Ts[n.tTime][0].TripDetailId,c=FlatObj.cTripInfo,i={},f={_a:"UpTrip",_c:{Id:u}},l=c._mainFareTienKhach,a=t.find('input[name="AnotherFareTienKhach"]').val().replace(/\./g,"").toNum(),v=t.find('input[name="FeeTienKhach"]').val().replace(/\./g,"").toNum(),r,s;i.PassengerMoney="1~"+l+"|"+a+"|"+v;r=[];$.each(t.find("table.thong-ke.tien-hang tbody tr.branch-pro"),function(n,t){var i=$(t),u=i.find('td[name="BranchCode"]').attr("data-branch-code"),f=i.find('input[name="BranchNotPaid"]').val().replace(/\./g,"").toNum(),e=i.find('input[name="NumBranchNotPaid"]').val(),o=i.find('input[name="BranchPaid"]').val().replace(/\./g,"").toNum(),s=i.find('input[name="NumBranchPaid"]').val();r.push(u+":"+s+"|"+o+"##"+e+"|"+f)});var y=t.find('input[name="PickedNotPaid"]').val().replace(/\./g,"").toNum(),p=t.find('input[name="NumPickedNotPaid"]').val(),w=t.find('input[name="PickedPaid"]').val().replace(/\./g,"").toNum(),b=t.find('input[name="NumPickedPaid"]').val(),k=t.find('input[name="FeeTienHang"]').val().replace(/\./g,"").toNum();i.ProductMoney="1~"+r.join(",")+"~"+b+"|"+w+"##"+p+"|"+y+"~"+k;var d=t.find('input[name="TollFee"]').val().replace(/\./g,"").toNum(),g=t.find('input[name="WashFee"]').val().replace(/\./g,"").toNum(),nt=t.find('input[name="EatFee"]').val().replace(/\./g,"").toNum(),e=[],o=1;$.each(t.find('input[name="NameAnotherFee"]'),function(n,t){var i=$(t),r=o,u=i.val(),f=i.closest("div.form-group").next("div").find('input[name="MoneyAnotherFee"]').val().replace(/\./g,"").toNum();e.push(r+"|"+u+"|"+f);o++});i.FeeMoney="1~"+d+"~"+g+"~"+nt+"~"+e.join("##");f._d=i;s=function(i){if(i==1){var r={_a:"UpTrip",_c:{Id:u},_d:{ClosedStatus:2}},f=function(i){if(i==1){vbf("onRenderTripInfo",{});var r=$.trim(n.tDate.toFormatString("dd-mm-yyyy")),u=$.trim(n.tTime),f=$.trim(n.tData.Name);h.append('<h4 style="font-size: 24px;text-align: center;">Thống kê theo chuyến '+f+" ngày "+r+" lúc "+u+"<\/h4>");app.rights.indexOf($.rights.bEdtAtCphoi.val)==-1&&(t.find("input,button").prop("disabled","disabled"),t.find("button.tk-save-trip,button.btn-chot-phoi").addClass("hidden"))}};vRqs(r,f)}};vRqs(f,s)},_closeChotPhoiDialog:function(){this._$chotphoiModal.modal("hide")},_createChotPhoiDialogDiv:function(n){var t=this,i=$("<div />").addClass("modal-body").append($("<form />").attr("id","ChotPhoiPopup").append($("<table />").addClass("table no-border mb0 table-modal table-condensed").append($("<tr />").append($('<td style="border:0;" />').addClass("col-md-6").append($("<div />").addClass("form-group").append($("<p />").html("Khi bấm nút Chốt phơi, phơi được chốt sẽ không còn thay đổi thông tin được nữa. Đồng ý ?"))))).append($("<tr />").append($("<td />").addClass("col-md-12 list-btn").attr("colspan",3).append($("<button />",{type:"button"}).addClass("btn btn-danger").text("Đồng ý").css("float","left").click(function(){t._chotPhoi(n);t._closeChotPhoiDialog()})).append($("<button />",{type:"button"}).addClass("btn btn-default").text("Không").css("float","left").click(function(){t._closeChotPhoiDialog()}))))));t._$chotphoiModal=$("<div />").addClass("modal fade").attr("id","chotphoi-popup").attr("role","dialog").attr("aria-hidden","true").append($("<div />").addClass("modal-dialog modal-md").append($("<div />").addClass("modal-content").append($("<div />").addClass("modal-header bg-primary").append($("<h3 />").addClass("modal-title thin-1").html("Xác nhận"))).append(i))).appendTo($("body"));t._$chotphoiModal.modal("show")}});
//# sourceMappingURL=p.min.js.map
