define({_reloadBks:function(n){$("#report").hide();$("#product-content").hide();$("#bksContent").show();$("#bTickets").hide();$("#roleConfig").hide();$("#busManager").hide();FlatObj.FTripGetTrip=!1;FlatObj.LDefTrip=!0;$("#bksContent").vbooking(window.app);$("#bksContent").vbooking("load",n.data)},start:function(n){try{var t=this;vdc.gD(n.data,function(){t._reloadBks(n);$(document).keypress(function(n){if(n.keyCode==13&&!$("#update-popup input").is(":focus")){var t=$("#update-popup");t.hasClass("in")&&$("#update-popup .btn-update").trigger("click")}});vbv("rlBKS",function(){t._reloadBks({})})})}catch(i){console.log("(E) Co.Bks/Main",i)}}}),function(n){var t={_create:n.custom.vbooking.prototype._create};n.extend(!0,n.custom.vbooking.prototype,{options:{},_seatStack:null,_selectedPhone:null,_selectedCode:"",_ctrlOn:!1,_fMoving:!1,_movingStack:null,_cMovingSeat:null,_cMovingTrip:null,_$updateForm:null,_$validForm:null,_$historyForm:null,_hasCopyTicket:!1,_hasBookReturnTicket:!1,_cBookReturnTripId:null,_copyInfo:{},_seatToBeUpdatedReturningInfo:[],_dataToBeSavedReturningInfo:{date:"",code:""},_$modal:null,_$cmodal:null,_$emodal:null,_$popModal:null,_$xuatbenModal:null,_$chotphoiModal:null,_suggestCustomer:[],_totalSuggestCustomer:0,_isBooking:!1,_$xuatbenButton:null,_$connection:null,_isFirstTime:!0,_allowBookAllSeat:!0,_allowedSeats:[],_create:function(){(t._create.apply(this,arguments),this.options.serviceUrl)&&(this._initializeBookingFields(),this._bindEventOnSheet())},_createXuatBenButton:function(){return this._$xuatbenButton=this._$filterForm.find("button.btn-xuat-ben")},_initializeBookingFields:function(){app.seatStack=[];this._movingStack=[];this._selectedPhone="";this._selectedCode=""},_createXuatBenDialogDiv:function(){var t=this,i=n("<div />").addClass("modal-body").append(n("<form />").attr("id","XuatBenForm").append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n("<tr />").append(n('<td style="border:0;" />').addClass("col-md-6").append(n("<div />").addClass("form-group").append(n("<p />").html("Khi bấm nút Xuất Bến, phơi sẽ được chốt và tất cả vé đã thanh toán sẽ không còn thay đổi được nữa. Đồng ý ?"))))).append(n("<tr />").append(n("<td />").addClass("col-md-12 list-btn").attr("colspan",3).append(n("<button />",{type:"button"}).addClass("btn btn-danger").text("Đồng ý").css("float","left").click(function(){t._closedTrip();t._closeXuatBenDialog()})).append(n("<button />",{type:"button"}).addClass("btn btn-default").text("Không").css("float","left").click(function(){t._closeXuatBenDialog()}))))));t._$xuatbenModal=n("<div />").addClass("modal fade").attr("id","xuatben-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header bg-primary").append(n("<h3 />").addClass("modal-title thin-1").html("Xác nhận"))).append(i))).appendTo(n("body"));t._$xuatbenModal.modal("show")},_hideXuatBenButton:function(){this._$xuatbenButton.removeClass("hidden");this._$xuatbenButton.addClass("hidden")},_showXuatBenButton:function(){this._$xuatbenButton.removeClass("hidden")},_showModal:function(){this._$modal.modal("show")},_showCModal:function(){this._$cmodal.modal("show")},_showEModal:function(){this._$emodal.modal("show")},_closePopupModal:function(){this._$popModal.modal("hide")},_showSuccessModal:function(t,i){var u=n("<div />").addClass("modal-body").append(n("<form />").attr("id","announceRole").append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n("<tr />").append(n('<td style="border:0;" />').addClass("col-md-6").append(n("<div />").addClass("form-group").attr("area-hidden","true").append(n("<p />").html("<b> "+i+"<\/b>"))))))),r=n("<div />").addClass("modal fade confirmSaveRole-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header").css("background-color","#008000").addClass("bg-primary").append(n("<h2 />").addClass("modal-title thin-1").html(t))).append(u)));r.appendTo(n("body"));r.modal("show");setTimeout(function(){r.modal("hide")},1500)},_showPopModal:function(t){var i=this,r=n("<div />").addClass("modal-body").css("padding-top",0).append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n('<tr class="col-md-12 pl0 pr0"/>').append(n('<td style="border-top:0;" class="col-md-1" />').append(n('<img src="Content/images/warning-popup-icon.png" width="80px" />'))).append(n('<td  style="border-top:0;vertical-align:middle;" class="col-md-11" />').append(n('<h4 style="line-height:22px;"/>').addClass("message").html(t)))).append(n("<tr />").append(n("<td />").addClass("col-md-12 list-btn").attr("colspan",3).append(n("<button />",{type:"button"}).addClass("btn btn-default").text("Đóng").css("float","left").click(function(){i._closePopupModal()})))));i._$popModal=n("<div />").addClass("modal fade").attr("id","message-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header bg-primary").css("background-color","#d9534f").append(n("<h3 />").addClass("modal-title thin-1").html("Thông báo"))).append(r))).appendTo(this.element);i._$popModal.modal("show")},_closeXuatBenDialog:function(){this._$xuatbenModal.modal("hide")},_getCurrentBKSHash:function(){var n=this,t=n._getDepartureTime();return n._cTripId+t.getTime()+n._cTripBus},_updateSeatStack:function(n,t){var i=this,r=app.seatStack.indexOf(t);r!=-1?i._removeFromSeatStack(n,t,r):i._addToSeatStack(n,t)},_addToSeatStack:function(t,i){app.seatStack.indexOf(i)==-1&&(app.seatStack.push(i),n(t).addClass(_dict._slc[0]))},_removeFromSeatStack:function(t,i,r){app.seatStack.splice(r,1);n(t).removeClass(_dict._slc[0])},_clearSelectedItem:function(){var n=this;n._grid?(n._$sheet.find(".seat").removeClass(_dict._slc[0]),n._$notComeSheet.find(".seat").removeClass(_dict._slc[0]),n._$cancelSheet.find(".seat").removeClass(_dict._slc[0])):(n._$sheet.find(".lseat").removeClass(_dict._slc[0]),n._$notComeSheet.find(".lseat").removeClass(_dict._slc[0]),n._$cancelSheet.find(".lseat").removeClass(_dict._slc[0]))},_maskSelectedSeat:function(t){n(t).find("table").toggleClass(_dict._slc[0])},_existingSeatStack:function(t){var u=this,i=-1,r=t._getCurrentTicket();return n.each(app.seatStack,function(n,u){if(-1==i){var f=u._getCurrentTicket();u._coach==t._coach&&u._row==t._row&&u._col==t._col&&f._id==r._id&&(i=n)}}),!(-1==i)},_fakeBookedSeat:function(t,i){var e=this,f={_coach:i._coach,_row:i._row,_col:i._col,_class:"booking",_label:i._label,_suser:"B:&nbsp;"+app.un,_pmInfo:" - "+app.aice,_half:[_dict._g[_dict._tplNumCol-1],_dict._sg[_dict._tplNumCol-1],_dict._mg[_dict._tplNumCol-1]].join(" "),buttons:'<button type="button" class="btn btn-sm bg-none circle active" data-type="update">U<\/button><button type="button" class="btn btn-sm bg-none circle active" data-type="move">M<\/button>'},s,h,r,c;try{var u=vGetArr({Id:e._cTripId},!1,e._data),l=u[0].FromArea.split("~")[1].split("|"),o=u[0].ToArea.split("~")[1].split("|");f._stageName=o[2];s=u[0].FareInfo.substring(u[0].FareInfo.indexOf("~")+1);n.each(s.split("~"),function(n,t){t.indexOf(l[0]+"|"+o[0])>=0&&(f._fare=vToMn(t.split("|")[2])+"đ")});h={seat:f};r=n(vtpl(_dict._sTpl,h));r.find(".pick").css("background","none");r.addClass("selected");c=r.attr("data-position");n(".vbooking-sheet").find("button").unbind();n(".vbooking-sheet").find(".seat[data-position="+c+"]").addClass("paid",100,"easeInOutQuint",function(){n(this).replaceWith(r)})}catch(a){console.log(a)}},_generateCode:function(){return Math.floor(Math.random()*1e5)},_checkRightOnUpdateForm:function(){var i,t,n;if(app.rights.indexOf("~3|2|")==-1)return!0;for(i=app.rights.indexOf("~3|2|0")>=0?!1:!0,t=app.rights.split("~"),n=0;n<t.length;n++)if(t[n].indexOf("3|2|")>=0&&this._cTripId==t[n].split("|")[2])return!i;return i},_bindEventOnValidForm:function(){var i=this,t=i._$validForm;t.find("input.datepicker").not("[readonly]").datepicker({dateFormat:"dd-mm-yy"});t.find("i.glyphicon-calendar").parent().on("click",function(){n(this).prev().datepicker("show")});t.find("button").each(function(t,r){n(r).hasClass("btn-confirm")?vev(r,"click",function(n){n.preventDefault();i._validTicket()}):n(r).hasClass("btn-close")&&vev(r,"click",function(n){n.preventDefault();vbf("onClearSelectedItem");vbf("resetSeatStack");i._closeUpdateDialog()})});t.find("input[name=CancelFee]").not(["readonly"]).on("keyup",function(){var u=parseInt(t.closest("div.modal-body").find("input[name=NumSeat]").val()),i=n(this).val().replace(/\./g,""),r;i=parseInt(i)?parseInt(i):0;r=i*u;n(this).val(i.toMn());t.find("input[name=ToTalCancelFee]").val(r.toMn())})},_validTicket:function(){var n=this,t=n._createValidTicketObj(),i=function(t){t==1&&(vbf("resetSeatStack"),n._reloadSheet(),n._closeUpdateDialog())};n._submitAction(t,i)},_createValidTicketObj:function(){var i=this,t=i._convertFormDataToObj(i._$validForm),u=0,r;return typeof t.PassCode!="undefined"&&t.PassCode!=null&&t.PassCode!=""&&(u=i._getTicketIdFromPassCode(t.PassCode)),r={},r._a="UpdateBookTicket",r._c=[],r._d=[],n.each(app.seatStack,function(n,f){var o=f._getCurrentTicket(),s,h,e;u!=0?(r._c.push({Id:o._id,TripId:i._cTripId,SeatCode:f._getSeatInfo(),PickupDate:o._pdate.toFormatString("iso"),Bus:i._cTripBus}),r._c.push({Id:u,TripId:i._cTripId,SeatCode:f._getSeatInfo(),PickupDate:o._pdate.toFormatString("iso"),Bus:i._cTripBus}),s={TripAlias:parseInt(i._cTripBus),Status:3,PassCode:t.PassCode},h={TripId:i._cTripId,SeatCode:f._getSeatInfo(),TripDate:i._getDepartureTime().toFormatString("iso"),PickupDate:o._pdate.toFormatString("iso"),TripAlias:parseInt(i._cTripBus),Status:2},r._d.push(s),r._d.push(h)):(r._c.push({Id:o._id,TripId:i._cTripId,SeatCode:f._getSeatInfo(),PickupDate:o._pdate.toFormatString("iso"),Bus:i._cTripBus}),e={},t.Status==7?(e.Status=7,e.TripDate=null):t.Status==6?(e.Status=6,t.FromValid!=null&&t.FromValid!=""&&(e.FromValid=vPrsDt(t.FromValid)),t.ToValid!=null&&t.ToValid!=""&&(e.ToValid=vPrsDt(t.ToValid))):t.Status==3&&(e.TripAlias=parseInt(i._cTripBus),e.Status=t.Status,e.CancelFee=parseInt(t.CancelFee),isNaN(e.CancelFee)&&(e.CancelFee=0)),r._d.push(e))}),r},_getTicketIdFromPassCode:function(n){return parseInt(n)},_bindEventOnHistoryForm:function(){var t=this,i=t._$historyForm;i.find("button").each(function(i,r){n(r).hasClass("btn-close")&&vev(r,"click",function(n){n.preventDefault();vbf("onClearSelectedItem");vbf("resetSeatStack");t._closeUpdateDialog()})})},_startNotification:function(){var t=this;t._$connection=n.connection.notificationHub;typeof t._$connection!="undefined"&&(t._$connection.client.sendNotification=function(n,i,r){t._createWarningDialog(n,i,r)});n.connection.hub.start()},_sendNotification:function(){},_startConnection:function(){n.connection.hub.start()},_isConnected:function(){},_createWarningDialog:function(t,i,r){var o=this,f="",e,u;vIsEstStr(r)&&(f="Mọi chi tiết vui lòng liên hệ: <b>"+r+"<\/b>");e=n("<div />").addClass("modal-body").append(n("<form />").append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n("<tr />").append(n('<td style="border:0;" />').addClass("col-md-6").append(n("<div />").addClass("form-group").attr("area-hidden","true").append(n("<h3 />").html(i)).append(n("<br />")).append(n("<h4 />").html(f))))).append(n("<tr />").append(n("<td />").addClass("col-md-12 list-btn").attr("colspan",3).append(n("<button />",{type:"button"}).addClass("btn btn-danger").text("Đồng ý").css("float","left").click(function(){n("body").find(".warning-popup").modal("hide")}))))));u=n("<div />").addClass("modal fade warning-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header").css("background-color","#c9302c").addClass("bg-danger").append(n("<h2 />").addClass("modal-title thin-1").css("color","white").html(t))).append(e)));u.appendTo(n("body"));u.modal("show")},_parseNotification:function(){}})}(jQuery);
//# sourceMappingURL=p.min.js.map
