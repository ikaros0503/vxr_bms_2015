define({onVMLoaded:function(){$(this.o.jHtml.placeToInsertTable).append(this.o.jHtml.tabTpl);$(this.o.jHtml.placeToInsertTable).parent().append(this.o.jHtml.tableTpl);$(this.o.jHtml.searchResultMenu).remove();$(this.o.jHtml.searchBarInput).val("");this.loadCustomer()},loadCustomer:function(){var n=this;app.cusphone!="undefined"&&app.cusphone!=null&&vRqs({_a:n.o.jVar.getCustomerFunction,_c:{Phone:app.cusphone,CompId:app.cid},_f:n.o.jVar.getCustomerFields},function(t,i){i.length>0?($(n.o.jHtml.inputCustomerId).val(i[0][0]),$(n.o.jHtml.inputCustomerName).val(i[0][1]),$(n.o.jHtml.inputCustomerPhone).val(i[0][2]),$(n.o.jHtml.inputCustomerEmail).val(i[0][3]),$(n.o.jHtml.inputCustomerAddress).val(i[0][4]),$(n.o.jHtml.selectCustomerGender).val(i[0][5]),$(n.o.jHtml.inputCustomerBirthday).datepicker("setDate",new Date(i[0][6]!=null?new Date(parseInt(i[0][6].substring(i[0][6].indexOf("(")+1).replace(")/",""))):"")),$(n.o.jHtml.inputCustomerNote).val(i[0][7]),n.getTrips("U"),n.getTrips("P"),n.getTrips("C")):n.showError(n.o.jVar.getCustomerErrorString)})},onUpdateInfo:function(){var n=this,t={Id:$(this.o.jHtml.inputCustomerId).val(),Name:$(this.o.jHtml.inputCustomerName).val(),Phone:$(this.o.jHtml.inputCustomerPhone).val(),Email:$(this.o.jHtml.inputCustomerEmail).val(),Gender:$(this.o.jHtml.selectCustomerGender).val(),AddressInfo:$(this.o.jHtml.inputCustomerAddress).val(),Birthday:this.toDbDateString(new Date($(this.o.jHtml.inputCustomerBirthday).datepicker("getDate"))),Note:$(this.o.jHtml.inputCustomerNote).val()};if(!this.isNullOrEmpty(t.Id)){if(this.isNullOrEmpty(t.Name)){this.showError(this.o.jVar.updateErrorName);$(this.o.jHtml.inputCustomerName).focus();return}if(this.isNullOrEmpty(t.Phone)){this.showError(this.o.jVar.updateErrorPhone);$(this.o.jHtml.inputCustomerPhone).focus();return}vRqs({_a:n.o.jVar.updateFunction,_c:{Id:t.Id},_d:t},function(t){t==1?n.showSuccess(n.o.jVar.updateSuccess):n.showError(n.o.jVar.updateError)})}},getTrips:function(n){var t=this;vRqs({_a:this.o.jVar.getCustomerTicketsFunction,_ft:vtpl(n=="U"?this.o.jVar.getTripConditions_U:n=="P"?this.o.jVar.getTripConditions_P:n=="C"?this.o.jVar.getTripConditions_C:"",{id:$(this.o.jHtml.inputCustomerId).val(),compId:app.cid,date:t.toDbDateString(new Date)}),_se:this.o.jVar.getCustomerTicketsSort,_f:this.o.jVar.getCustomerTicketsFields,_si:n=="U"?this.o.jVar.pageU.current:n=="P"?this.o.jVar.pageP.current:this.o.jVar.pageC.current,_mr:n=="U"?this.o.jVar.pageU.itemsPerPage:n=="P"?this.o.jVar.pageP.itemsPerPage:this.o.jVar.pageC.itemsPerPage},function(i,r,u,f){n=="U"?($(t.o.jHtml.countU).html(f),r.length>0?t.renderTable(t.o.jHtml.tableU,r):$(t.o.jHtml.tableU).html(t.o.jHtml.noTicket_U),t.o.jVar.pageU.totalRecords=f,t.o.jVar.pageU.total=Math.ceil((f==0?1:f)/t.o.jVar.pageU.itemsPerPage)):n=="P"?($(t.o.jHtml.countP).html(f),r.length>0?t.renderTable(t.o.jHtml.tableP,r):$(t.o.jHtml.tableP).html(t.o.jHtml.noTicket_P),t.o.jVar.pageP.totalRecords=f,t.o.jVar.pageP.total=Math.ceil((f==0?1:f)/t.o.jVar.pageP.itemsPerPage)):n=="C"&&($(t.o.jHtml.countC).html(f),r.length>0?t.renderTable(t.o.jHtml.tableC,r):$(t.o.jHtml.tableC).html(t.o.jHtml.noTicket_C),t.o.jVar.pageC.totalRecords=f,t.o.jVar.pageC.total=Math.ceil((f==0?1:f)/t.o.jVar.pageC.itemsPerPage));t.updatePage(n)})},renderTable:function(n,t){if(!(t.length<=0)){$(n).html("");for(var i=0;i<t.length;i++)$(n).append(vtpl(this.o.jHtml.ticketRow,{code:t[i][2],route:t[i][3],pickupDate:this.toDateString(t[i][4]!=null?new Date(parseInt(t[i][4].substring(t[i][4].indexOf("(")+1).replace(")/",""))):""),seat:t[i][5]!=null?t[i][5].split("|")[0]:"",money:vToMn(t[i][6]),issueDate:this.toDateString(t[i][8]!=null?new Date(parseInt(t[i][8].substring(t[i][8].indexOf("(")+1).replace(")/",""))):""),status:t[i][7]==1?this.o.jVar.statusBooked:t[i][7]==2?this.o.jVar.statusPaid:this.o.jVar.statusCancelled,account:t[i][9],note:t[i][10]==null?"":t[i][10]}))}},updatePage:function(n){for(var t=this,o=$(vtpl(this.o.jHtml.divPage,{type:n})).html("").attr("style",this.o.jHtml.divPageStyle),i=n=="U"?t.o.jVar.pageU.total:n=="P"?t.o.jVar.pageP.total:t.o.jVar.pageC.total,r=n=="U"?t.o.jVar.pageU.current:n=="P"?t.o.jVar.pageP.current:t.o.jVar.pageC.current,s=n=="U"?t.o.jVar.pageU.itemsPerPage:n=="P"?t.o.jVar.pageP.itemsPerPage:t.o.jVar.pageC.itemsPerPage,f=$(this.o.jHtml.paginationContainer).append(vtpl(this.o.jHtml.paginationButtonFirst,{type:n,page:1})).append(vtpl(this.o.jHtml.paginationButtonPrevious,{type:n,page:r-1})),e=$(vtpl(this.o.jHtml.paginationSelectPage,{type:n})),u=1;u<=i;u++)e.append(vtpl(this.o.jHtml.selectPageOption,{page:u})),f.append(vtpl(u==r?this.o.jHtml.paginationButtonCurrent:this.o.jHtml.paginationButtonNumber,{type:n,page:u}));o.append(f.append(vtpl(this.o.jHtml.paginationButtonNext,{type:n,page:r+1})).append(vtpl(this.o.jHtml.paginationButtonLast,{type:n,page:i}))).append($(this.o.jHtml.paginationGroupSelect).append(this.o.jHtml.paginationSelectPageLabel).append(e).append(this.o.jHtml.paginationSelectItemsPerPageLabel).append($(vtpl(this.o.jHtml.paginationSelectItemsPerPage,{type:n}))));$(vtpl(this.o.jHtml.selectPage,{type:n})).val(r);$(vtpl(this.o.jHtml.selectItemsPerPage,{type:n})).val(s);this.setVisibility(vtpl(t.o.jHtml.firstPageButton,{type:n}),i>1&&r>1);this.setVisibility(vtpl(t.o.jHtml.previousPageButton,{type:n}),i>1&&r>1);this.setVisibility(vtpl(t.o.jHtml.nextPageButton,{type:n}),i>1&&r<i);this.setVisibility(vtpl(t.o.jHtml.lastPageButton,{type:n}),i>1&&r<i);this.setVisibility(vtpl(t.o.jHtml.selectPage,{type:n}),i>1);$(vtpl(t.o.jHtml.paginationAllButtons,{type:n})).click(function(){if(!$(this).parent().hasClass(t.o.jHtml.classToDisableButton)){var n=$(this).attr(t.o.jHtml.typeAttribute);n=="U"?t.o.jVar.pageU.current=parseInt($(this).attr(t.o.jHtml.indexAttribute)):n=="P"?t.o.jVar.pageP.current=parseInt($(this).attr(t.o.jHtml.indexAttribute)):n=="C"&&(t.o.jVar.pageC.current=parseInt($(this).attr(t.o.jHtml.indexAttribute)));t.getTrips(n)}});$(vtpl(this.o.jHtml.selectPage,{type:n})).on("change",function(){var n=$(this).attr(t.o.jHtml.typeAttribute);n=="U"?t.o.jVar.pageU.current=parseInt($(this).val()):n=="P"?t.o.jVar.pageP.current=parseInt($(this).val()):n=="C"&&(t.o.jVar.pageC.current=parseInt($(this).val()));t.getTrips(n)});$(vtpl(this.o.jHtml.selectItemsPerPage,{type:n})).on("change",function(){var n=$(this).attr(t.o.jHtml.typeAttribute);n=="U"?t.o.jVar.pageU.itemsPerPage=parseInt($(this).val()):n=="P"?t.o.jVar.pageP.itemsPerPage=parseInt($(this).val()):n=="C"&&(t.o.jVar.pageC.itemsPerPage=parseInt($(this).val()));t.getTrips(n)})},toDateString:function(n){return(n.getDate()<=9?"0":"")+n.getDate()+(n.getMonth()<=8?"-0":"-")+(n.getMonth()+1)+"-"+n.getFullYear()+(n.getHours()<=9?" 0":" ")+n.getHours()+(n.getMinutes()<=9?":0":":")+n.getMinutes()+(n.getSeconds()<=9?":0":":")+n.getSeconds()},toDbDateString:function(n){return n.getFullYear()+(n.getMonth()<=8?"-0":"-")+(n.getMonth()+1)+(n.getDate()<=9?"-0":"-")+n.getDate()+(n.getHours()<=9?" 0":" ")+n.getHours()+(n.getMinutes()<=9?":0":":")+n.getMinutes()+(n.getSeconds()<=9?":0":":")+n.getSeconds()},showError:function(n){vv.showMessage({element:$(this.o.jHtml.alertMesageContainer),type:this.o.jHtml.alertMesageError,content:n})},showSuccess:function(n){vv.showMessage({element:$(this.o.jHtml.alertMesageContainer),type:this.o.jHtml.alertMesageSuccess,content:n})},isNullOrEmpty:function(n){return!(n!="undefined"&&n!=null&&n.length!="undefined"&&n.length>0)},setVisibility:function(n,t){t?$(n).removeClass(this.o.jHtml.classToDisableButton):$(n).addClass(this.o.jHtml.classToDisableButton)}});
//# sourceMappingURL=p.min.js.map
