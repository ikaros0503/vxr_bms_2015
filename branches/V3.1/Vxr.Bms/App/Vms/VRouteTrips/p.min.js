define({start:function(n,t){try{t&&t.call(this)}catch(i){}},_escapeSearchString:function(n){return n.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a").replace(/Đ/g,"D").replace(/đ/g,"d").replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y").replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u").replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ.+/g,"o").replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ.+/g,"e").replace(/ì|í|ị|ỉ|ĩ/g,"i")},getTripDate:function(n,t){var i=t.Time,r=t.Date;return vAddTime(i,r)},_checkBeforeDelete:function(n,t){var i=this,f=i.o,e=i.view,u,r,o;if(n&&t){t.call(i);return}u=f.checkDelConditions;r=vCloneObj(u._c);$.each(r,function(n,t){var e,o,u,s;t=="$base"?r[n]=i._getBaseModel().Id:t.indexOf&&t.indexOf("$")==0?(e=t.substring(1),i._applyCondition(gDx(f),e,r,n)):t.params&&t.get?(o=t.params.split(","),u={},$.each(o,function(n,t){if(t.indexOf("$")==0){var r=t.substring(1);i._applyCondition(gDx(f),r,u,r)}}),s=i[t.get].call(i,t,u),r[n]=s):r[n]=t});o={_a:u._a,_c:r,_f:u._f};vRql(o,{z:function(n,r,f){if(f){var o=u.existMsg.replace("{$x}",f);vv.showMessage({element:e.find(".alert.message"),type:"alert-danger",content:o})}else t&&t.call(i)}},i,e)},_checkInputTime:function(n){var r=this,i=r.view,u=r._getOptions("select.pickup-time option"),t;if(n.length==5&&n.indexOf(":")!=-1)if(t=n.split(":"),t[0].length==2&&t[1].length==2)if(parseInt(t[0])>=0&&parseInt(t[0])<=24&&parseInt(t[1])>=0&&parseInt(t[1])<=60){if(u.indexOf(n)<0)return!0;vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Giờ này đã tồn tại, bạn nên chọn Bus khác để tạo chuyến cùng giờ."})}else vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Thời gian không chính xác, vui lòng kiểm tra lại."});else vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Vui lòng nhập thời gian theo dạng --:--"});else vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Vui lòng nhập thời gian theo dạng --:--"});return!1},_checkHasTicket:function(n,t){var i=this,u=i.o,o=i.view,f=u.checkHasTicket,r=vCloneObj(f._c),e;$.each(r,function(n,t){var e,o,f,s;t=="$base"?r[n]=i._getBaseModel().Id:t.indexOf&&t.indexOf("$")==0?(e=t.substring(1),i._applyCondition(gDx(u),e,r,n)):t.params&&t.get?(o=t.params.split(","),f={},$.each(o,function(n,t){if(t.indexOf("$")==0){var r=t.substring(1);i._applyCondition(gDx(u),r,f,r)}}),s=i[t.get].call(i,t,f),r[n]=s):r[n]=t});e={_a:f._a,_c:r,_f:f._f};vRql(e,{z:function(r,u,f){if(f){var o=u,e=!0;$.each(o,function(t,r){var u=r[0].split("|"),f=u[1]+"|"+u[2]+"|"+u[3];if(n.indexOf(f)!=-1)return vv.showMessage({element:i.view.find(".alert.message"),type:"alert-danger",content:"Đã có vé được đặt vào vị trí ghế bị khóa, vui lòng kiểm tra lại."}),e=!1,!1});e&&t&&t.call()}else t&&t.call()}},i,o)},onItemLoaded:function(n){var t=this.o.view;t.find("total-booked-seats").val(n.TotalBookedSeats);t.find("total-paid-seats").val(n.TotalPaidSeats)},onAfterUnloadItem:function(){var n=this.o.view;n.find("total-booked-seats").val("");n.find("total-paid-seats").val("")},onBeginSelectionChange:function(){return},getFinalExtRow:function(n){return vSort("Time",!0,n)},afterUpdate:function(){$("#bksContent").vbooking&&(FlatObj.FTripGetTrip=!1,$("#bksContent").vbooking("load"))},afterReload:function(){var n=this;n._updateSubtitle();n._updateRouteList()},_loadPersons:function(){var n=this,t={_a:"fGetPerson",_c:{CompId:app.cid,IsPrgStatus:1,Type:"($x in (2,4,5))"},_f:"Id, Type, FullName, PhoneInfo"},i;n._listPersons=[];i=t._f.split(",");vRql(t,{a:function(){},m:function(t,r){var u={};$.each(i,function(n,t){t=t.trim();u[t]=r[n]});n._listPersons.push(u)},z:function(){n._listPersons=vSort("FullName",!1,n._listPersons);n._initOptionPerson("Driver",oPst.driver);n._initOptionPerson("Assistant",oPst.assistant)}},n)},_updateSubtitle:function(){var t=this,n=t.allData?t.allData[t.o.mainModel.SumIdx][0]:[],i=n?{Comps:n[0],Routes:n[1],Trips:n[2]}:{},r=$.html("vTripsSumInfo",i);$(".gSubTitle").html(r)},_initOptionPerson:function(n,t){var r=this,u=r.o,o=u.view,f=vGetObj({name:n},gDx(u)),i,e;f.options=[];i=o.find("select[name="+n+"]");i.empty();e=vGetArr({Type:t},!1,r._listPersons);$.each(e,function(n,t){vIsEstStr(t.FullName)&&(f.options.push(t),$.vCheckAndAppendOptions(i,t.Id,t.FullName,"R"))});i.trigger("chosen:updated")},reloadTimeCount:0,checkAndSave:function(n){var i=this,r=i.view;if(typeof _dict._blockSeatByVehicle!="undefined"){var f=r.find('select[name="Vehicle"]').val(),u=r.find('select[name="Vehicle"] option[value="'+f+'"]').text(),t=[];typeof _dict._unblockSeatByVehicle!="undefined"&&_dict._unblockSeatByVehicle[u]?$.each(_dict._blockSeatByVehicle,function(n,i){_dict._unblockSeatByVehicle[u].indexOf(i)==-1&&t.push(i)}):t=_dict._blockSeatByVehicle;t.length>0?i._checkHasTicket(t,n):n.call()}else n.call()},onClickAddBus:function(){var n=this,t=n.o,i=n.view,r=n._getMatchedRecords(n.mainModels,t.keyFields,!1,t.finalKeyFields,!0);r.length>=1?vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Chuyến đã tồn tại, vui lòng chọn Bus khác"}):n._updateByInsert("Thêm")},onClickAddTime:function(){return;var n,t},onRunTimeChange:function(){this._selectRowFromForm()},onAliasChange:function(){var n=this,t=n.o,r=n.view,i;n._selectRowFromForm();i=n._getMatchedRecords(n.mainModels,t.keyFields,!1,t.finalKeyFields,!0);i.length<1&&(i=n._getMatchedRecords(n.baseDetailModels,t.keyFields,!1,t.finalKeyFields,!0));i.length>=1?r.find("button.addBus").prop("disabled",!0):r.find("button.addBus").prop("disabled",!1)},onClosedStatusChange:function(n,t){var i=t.val();i==1&&app.rights.indexOf($.rights.mTrip_eiad.val)==-1&&($(".form-control.vehicle").prop("disabled",!0),$(".form-control.Driver").prop("disabled",!0),$(".form-control.Assistant").prop("disabled",!0),$(".mt5 button.multiselect.dropdown-toggle.btn.btn-default").prop("disabled",!0))},getData:function(n){return n},onClickBtnCancel:function(){var i,r;return;var t,n,u},onVehicleChange:function(){$("body").find("select.vehicle").trigger("chosen:updated")},gDisDate:function(n){var t=n.record.Date?n.record.Date:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisFare:function(n){var t=n.record.MasterFare?n.record.MasterFare:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisComp:function(n){var t=n.record.CompIdName?n.record.CompIdName:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisName:function(n){return n.record.Type==1?getMasterCellFormat(n.record.Name):n.record.Name},gDisTime:function(n){var t=n.record.Time?n.record.Time:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisFareKM:function(n){var t=(n.record.VxrMasterFare?n.record.VxrMasterFare:"")+(n.record.VxrDiscount?" (-"+n.record.VxrDiscount+"%)":"");return n.record.Type==1?getMasterCellFormat(t):t},gDisVBookingText:function(n){var t=n.record.VBookingText?n.record.VBookingText:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisVPaymentText:function(n){var t=n.record.VPaymentText?n.record.VPaymentText:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisVAppText:function(n){var t=n.record.VAppText?n.record.VAppText:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisNo:function(n){var t=n.record.No?n.record.No:"";return n.record.Type==1?getMasterCellFormat(t):t},gDisVxrFareInfo:function(n){if(!n.record.VxrFareInfo)return"";var t=n.record.VxrDiscount,u=n.record.FromArea,f=n.record.ToArea,e=vGas(u)[0],o=vGas(f)[0],s=[e,o],i=vGfs(s,n.record.VxrFareInfo)[0],r=i?i.Fare:"";return t?r+(" (-"+t+"%)"):r},gDisVxrDiscount:function(n){return n.record.VxrDiscount?n.record.VxrDiscount+"%":""},gDisVBookingConfig:function(n){var u=n.record.VBookingConfig,t,i,r;return u?(t="",i=u.toString(2),i.length==3&&(i="0"+i),r=i.split(""),r[0]=="1"&&(t=t+"/WEB"),r[1]=="1"&&(t=t+"/ĐLY"),r[2]=="1"&&(t=t+"/WID"),r[3]=="1"&&(t=t+"/AFF"),t.substring(1)):""},gDisVPaymentConfig:function(n){var u=n.record.VPaymentConfig,t,i,r;return u?(t="",i=u.toString(2),i.length==2&&(i="0"+i),r=i.split(""),r[0]=="1"&&(t=t+"/OLI"),r[1]=="1"&&(t=t+"/COD"),r[2]=="1"&&(t=t+"/ĐLY"),t.substring(1)):""},gDisClosedStatus:function(n){return n.record.ClosedStatus?"Đã xuất bến":"---"},gDisVehicle:function(n){return n.record.VehicleInfo?vGvp(n.record.VehicleInfo,"LicensePlate"):""},gDisTeam:function(n){var t="",i=vGtmp(n.record.TeamInfo,oPst.assistant),r=vGtmp(n.record.TeamInfo,oPst.driver),u=vGtmp(n.record.TeamInfo,oPst.guide);return r&&(t=", T: "+r),i&&(t=t+", L: "+i),u&&(t=t+", G: "+u),t.substring(1)},gDisStatusInfo:function(n){var t=n.record.StatusInfo;return vGTrds(t)},gDisAction:function(n){var t=n.record.Id,i=n.record.Type,r=i==1?n.record.Id:n.record.BaseId,u=n.record.Date,f=n.record.Time,e=n.record.CompId,o="{Type: 'Trip', Id: "+t+", Date: '"+u+"', Time: '"+f+"', BaseId: "+r+", CompId: "+e+"}",s="$('body').mask('Loading...');  var c = $.getModuleConfig('MTicConf'); $.loadModule(c, "+o+", function () { $('body').unmask(); });";return'<button class="btn btn-success btn-sm" onclick="event.preventDefault();'+s+'">Cấu hình<\/button>'},gDisDriver:function(n){return vGtmp(n.record.TeamInfo,oPst.driver)},gDisAid:function(n){return vGtmp(n.record.TeamInfo,oPst.assistant)},gDisGuide:function(n){return vGtmp(n.record.TeamInfo,oPst.guide)},gDisSeatStatus:function(n){var t=n.record.TotalBookedSeats,i=n.record.TotalPaidSeats,r,u;return t=vIsEstStr(t)?t:0,i=vIsEstStr(i)?i:0,r=parseInt(n.record.SeatTemplateInfo.split("|")[2])-parseInt(t)-parseInt(i),u=t+" -- "+i+" -- "+r,u},gDisTripStatus:function(n){var t=n.record;if(t.ClosedStatus==1)return"Xuất bến";if(t.ClosedStatus==2)return"Chốt phơi";switch(t.StatusInfo){case 2:return"Tăng cường";case 3:return"Hủy";default:return"--"}},svcDate:function(n,t){return vSaveDate(t)},svcTime:function(n,t){var i=t.split("-");return i&&i[0]?i[0].trim():""},svcStpl:function(n,t){return t+"~"+vFindById(t,n.options).Info},svcFI:function(n,t){var i=this.view,r=i.find("input.from-area").val(),u=i.find("input.to-area").val();return"1~"+vGai(r)+"|"+vGai(u)+"|"+parseInt(t.replace(/\./g,"")+"|đ||")},svcXB:function(n,t){return typeof t!="undefined"&&t?1:0},svcVhc:function(n,t){var i=vFindById(t,n.options);return i?vGvs(i.Id,i.Type,i.LicensePlate,i.VehicleTypeName):""},svcVhcI:function(n,t,i){return i.Vehicle},svcTI:function(n,t,i){var r=app.mvs,u=r;return($.each(i,function(n,t){t&&(r=r+"~"+t)}),u!=r)?r:""},svcSI:function(n,t,i){if(t==oTrs.cancel)return t;if(i){var r=i.Base,u=i.Time;if(r&&r.Info.indexOf(u)>=0)return oTrs.normal}return oTrs.add},svcMem:function(n,t,i){if(!i||jQuery.isEmptyObject(i))return"";var r="";return $.each(i,function(t,i){i&&(r+="~"+vGpi(n.mType,t,i.FullName,i.PhoneInfo))}),r.substring(1)},rvcStpl:function(n,t){return vGtp(t,"Id")},rvcVhc:function(n,t){return vGvp(t,"Id")},rvcMem:function(n,t){return vGtmp(t,n.mType,!0)},rvcFI:function(n,t){return vGfa(t)},cpcDate:function(n,t,i){return i},cpcAlias:function(){return 0},cpcSI:function(){return oTrs.waiting},svbMem:function(n,t){return vGetSearchCondt(t)},svbTime:function(n,t){var i=t.split("-");return i&&i[0]?i[0].trim():""},svbStpl:function(n,t){return"$x like '"+t+"~%'"},svbFare:function(n,t){return"1|"+parseInt(t.replace(/\./g,""))+""},svbVhc:function(n,t){return"$x like '"+app.mvs+"~"+t+"|%'"},svbNote:function(n,t){return"$x like '%"+t+"%'"},xchrTime:function(n,t){return t.split("~")},xchvTime:function(n,t){var i=[],r={},u={};return n&&n.Info&&$.each(n.Info.split("~"),function(n,t){t.indexOf(":")>0&&(r[t]=!0,i.push(t))}),$.each(t,function(n,t){var f=t.Time,e,o,s;r[f]?(e="",o=t.StatusInfo,o==oTrs.cancel&&(e=" - Hủy"),s=i.indexOf(f),i[s]=f+e):u[f]||(u[f]=!0,f=f+" - Tăng cường",i.push(f))}),vSort(null,!0,i)},listConfigRouteNameCb:function(n,t,i){console.log("listConfigRouteNameCb");var r=this;$("#"+n.gId).mask("Loading..........");r.listBase=[];$.each(i,function(n,t){r.listBase.push(t)});this._reloadTrips()},_getAjaxConfig:function(n){var r=this,t=r.o,i={};return t.queryConditions&&$.each(t.queryConditions,function(n,t){i[n]=t}),n&&$.each(n,function(n,t){i[n]=t}),{_a:t.queryAction,_c:i,_f:r._getQueryFields()}},_reloadTrips:function(n,t){var i=this,r,u;$("#"+i.o.gId).mask("Loading..........");r=i.view.find(".xDate").val();u=n?n:{yDate:vSaveDate(r?r:vGetNow())};i._reload(u);t&&t.call(i)},_applyCDate:function(n){var i=this,t;return(n||(n={}),t=i.view.find(".xDate").val(),!t)?n:(n.yDate=vSaveDate(t),n)},_applyCComp:function(n){var i=this,t;return(n||(n={}),t=i.view.find("select.compId").val(),!t)?n:(t.length==1&&(n.compId=t[0]),t.length>1&&(n.compIds=t.join()),n)},_applyCComp2:function(n){var i=this,t;return(n||(n={}),t=i.view.find("select.compId").val(),!t)?n:(t.length==1&&(n.CompId=t[0]),t.length>1&&(n.CompId="$x in ("+t.join()+")"),n)},_applyCRoute:function(n){var i=this,t;return(n||(n={}),t=i.view.find("select.route").val(),!t)?i._applyCComp(n):(t.length==1&&(n.routeId=t[0]),t.length>1&&(n.routeIds=t.join()),n)},_applyCBookingConfig:function(n){var u=this,i,t,r;return(n||(n={}),i=[0,0,0,0],t=u.view.find("select.vBookingConfig").val(),!t)?n:(t.length>=1&&($.each(t,function(n,t){i[parseInt(t)]=1}),r=parseInt(vJoin(i.reverse()),2),n.vBookingConfig=r),n)},_applyCPaymentConfig:function(n){var u=this,i,t,r;return(n||(n={}),i=[0,0,0],t=u.view.find("select.vPaymentConfig").val(),!t)?n:(t.length>=1&&($.each(t,function(n,t){i[parseInt(t)]=1}),r=parseInt(vJoin(i.reverse()),2),n.vPaymentConfig=r),n)},_applyCAppConfig:function(n){var u=this,i,t,r;return(n||(n={}),i=[0,0,0],t=u.view.find("select.vAppConfig").val(),t==7)?(n.compType=t,n):t?(t.length>=1&&($.each(t,function(n,t){i[parseInt(t)]=1}),r=parseInt(vJoin(i.reverse()),2),n.compType=r),n):n},onCompIdChange:function(n,t){var i=this,r={};r=i._applyCDate(r);r=i._applyCComp(r);var u=t.val(),f=i.view.find("select.route").val(),e=i.view.find("select.vAppConfig").val();(u||f)&&!e&&(r.compType=null);i._reloadTrips(r);u&&(i._stopRouteTrigger=!0,i._loadCbb("Name",i._applyCComp2(),function(){i._stopRouteTrigger=!1}))},onRouteIdChange:function(n,t){var i,r;if(console.log("onRouteIdChange",t.val()),i=this,r={},i._stopRouteTrigger){i._stopRouteTrigger=!1;return}r=i._applyCComp(r);r=i._applyCRoute(r);r=i._applyCDate(r);var u=t.val(),f=i.view.find("select.compId").val(),e=i.view.find("select.vAppConfig").val();(f||u)&&!e&&(r.compType=null);i._reloadTrips(r)},onDateChange:function(){var t=this,n={};n=t._applyCDate(n);n=t._applyCComp(n);n=t._applyCRoute(n);var i=t.view.find("select.route").val(),r=t.view.find("select.compId").val(),u=t.view.find("select.vAppConfig").val();(r||i)&&!u&&(n.compType=null);t._reloadTrips(n)},onVBookingConfigChange:function(){var t=this,n={};n=t._applyCBookingConfig(n);n=t._applyCDate(n);n=t._applyCComp(n);n=t._applyCRoute(n);var i=t.view.find("select.route").val(),r=t.view.find("select.compId").val(),u=t.view.find("select.vAppConfig").val();(r||i)&&!u&&(n.compType=null);t._reloadTrips(n)},onVPaymentConfigChange:function(){var t=this,n={};n=t._applyCPaymentConfig(n);n=t._applyCDate(n);n=t._applyCComp(n);n=t._applyCRoute(n);var i=t.view.find("select.route").val(),r=t.view.find("select.compId").val(),u=t.view.find("select.vAppConfig").val();(r||i)&&!u&&(n.compType=null);t._reloadTrips(n)},onVAppConfigChange:function(){var t=this,n={};n=t._applyCAppConfig(n);n=t._applyCDate(n);n=t._applyCComp(n);n=t._applyCRoute(n);var i=t.view.find("select.route").val(),r=t.view.find("select.compId").val(),u=t.view.find("select.vAppConfig").val();(r||i)&&!u&&(n.compType=null);t._reloadTrips(n)},onVMLoaded:function(){var n=this;n.onDateChange();n.view.find("select.vAppConfig").val(7);$(".zRouteName").unbind("keyup").keyup(function(t){if(t.which===13){var f=$(".zRouteName").find("input").val(),r=f.split("/"),u=n.view.find(".xDate").val(),i={compType:null,yDate:vSaveDate(u?u:vGetNow())};r[0]&&(i.fromAreaTxt=r[0]);r.length>1&&r[1]&&(i.toAreaTxt=r[1]);i=n._applyCBookingConfig(i);i=n._applyCPaymentConfig(i);n._stopRouteTrigger=!0;n._reloadTrips(i)}})},_updateRouteList:function(){var t=this,r=t.view.find("select.compId").val(),i,n;r||(i=t.view.find("select.route").val(),i)||(n=vGetObj({name:"Name"},gDx(t.o)),n.local=!0,n.options=t.advModels[2],n.valField="Id",n.displayField="Name",t._loadCbb("Name",null,function(){n.local=!1;n.valField="BaseId";n.displayField="Name"}))},_stopRouteTrigger:!1});
//# sourceMappingURL=p.min.js.map
