define({_reloadProduct:function(){$("#product-content").product({compId:app.cid});$("ul.primary-menu-top li").removeClass("active");$(this).parent().addClass("active");$("#product-content").product("init");$("#product-content").show();$("#bksContent").hide();$("#roleConfig").hide();$("#report").hide();app.module="product"},loadProduct:function(){var n=this;$("#proTemplate").load("App/Template/Shipping.html");$.getScript("Comp/"+app.cid+"/product-custom.js?v="+app.vsn,function(){n._reloadProduct()})},start:function(n){try{var t=this;t.loadProduct(n)}catch(i){console.error(i)}}}),function(n){n.widget("custom.product",{options:{compId:0},_$formNhapHang:null,_$formOfficeReceive:null,_$proMatrix:null,_$headerProduct:null,_$headerTableProduct:null,_$proList:null,_$typeOfView:null,_$dataFromView:null,_$proObj:null,_$proOrderObj:null,_$trip:null,_$receiveOffice:[],_$updateModal:null,_$cancelModal:null,_$phieuHangHTML:null,_$phoiHangHTML:null,_$updateFromSearch:null,_$paginationElement:null,_$jumpPageElement:null,_$pageSizeElement:null,_$pageIndex:1,_$pageSize:10,_createFormNhapHang:function(){return this._$formNhapHang=n("div.product-container div.nhap-hang")},_createFormOfficeReceive:function(){return this._$formOfficeReceive=n('div.product-container div.nhap-hang select[name="ReceivedAgentId"]')},_createProMatrix:function(){return this._$proMatrix=n("div.product-matrix")},_createProList:function(){return this._$proList=n(".product-list tbody")},_getTypeOfView:function(){return this._$typeOfView=n('#product-content div.btn-filter input[name="TypeOfView"]')},_createHeaderProduct:function(){return this._$headerProduct=this._$proMatrix.find(".row.header-product")},_createHeaderTableProduct:function(){return this._$headerTableProduct=this._$proMatrix.find("table.product-list thead")},_getPageSize:function(){return this._$pageSize=parseInt(this._$pageSizeElement.val())},_createPaginationElement:function(){return this._$paginationElement=this._$proMatrix.find("ul.pagination")},_createJumpPageElement:function(){return this._$jumpPageElement=this._$proMatrix.find('select[name="JumpPage"]')},_createPageSizeElement:function(){return this._$pageSizeElement=this._$proMatrix.find('select[name="PageSize"]')},_initBaseFunc:function(){this._createProList();this._createProMatrix();this._createPaginationElement();this._createJumpPageElement();this._createPageSizeElement();this._createHeaderProduct();this._createHeaderTableProduct();this._createFormNhapHang();this._createFormOfficeReceive();this._getTypeOfView();this._getPageSize()},_submitAction:function(n,t){vRqs(n,t,{async:!1})},_loadPro:function(t,i,r,u){var f=this,h="",c="",s="",a="",v=[],o={},l=[],e=f._getCounter(u),y=function(t,y,p,w){var b;if(t&&p>0?(f._renderPagination(w),n.each(y,function(t,i){var r=f._convertDbIntoProOrderPaginationObj(i),e;r._index=t+1;e=n.mapItemToView(n.convertProToItem(r));e.typeOfView=u;u=="kho-hang-ve"&&(r._statusInfo._code==4||r._statusInfo._code==6)&&(e.disabled="");v.push(e)})):(f._$paginationElement.hide(),f._$jumpPageElement.hide(),f._$jumpPageElement.prev().hide(),f._$pageSizeElement.hide(),f._$pageSizeElement.prev().hide()),n.each(v,function(t,i){a+=n.getHtml("product",i)}),u!="kho-hang-di"){var k=f._getTripIdFromView(),d=f._getTripTimeFromView(),g=f._getDateFromView(),nt=vDtToStr("iso",vGtDtObj("00:00",g)),tt=function(t,i,r){var u,f;t==1&&r==1?(vIsEstStr(i[0][1])?(u=i[0][1].split("~"),n.each(u,function(n,t){if(t.length>1){var i=t.split("|");i[0]==2&&l.push(i[2]+" - "+(i[3]?i[3]:""))}}),o.driverInfo=l.join(", ")):o.driverInfo="",vIsEstStr(i[0][2])?(f=i[0][2].substr(i[0][2].indexOf("~"),i[0][2].length).split("|"),o.vehicleNumber=f[2]):o.vehicleNumber=""):(o.driverInfo=l,o.vehicleNumber="")};f._submitAction(n.createGetTripDetailObj(k,d,nt),tt)}r.toLowerCase()=="header01"?(b={},b.totalRecords=e.totalRecords,b.totalPaid=e.totalBooked,b.totalBooking=e.totalBooking,b.totalNumItems=e.totalNumItems,s=n.getHtml(r,b),f._$headerProduct.html(s),f._$headerTableProduct.html('<tr><th class="v-align-m bg-thead"><input type="checkbox" name="CheckAllPro"/><\/th><th class="v-align-m bg-thead">STT<\/th><th class="bg-thead bg-thead">Mã hàng<\/th><th class="v-align-m bg-thead">VP Nhận<\/th><th class="bg-thead bg-thead">Người gửi<\/th><th class="bg-thead bg-thead">Người nhận<\/th><th class="bg-thead bg-thead">Địa chỉ nhận<\/th><th class="v-align-m bg-thead">SL/ĐV<\/th><th class="v-align-m bg-thead">Nặng<\/th><th class="bg-thead">Ghi chú<\/th><th class="bg-thead">Giá tiền<\/th><th class="bg-thead">Th.Toán<\/th><th class="bg-thead">NV Nhập<\/th><th class="v-align-m bg-thead">Chức năng<\/th><\/tr>'),f._bindEventLenXe()):r.toLowerCase()=="header02"?(n.each(f._$trip,function(n,t){if(t[0]==f._getTripIdFromView()){var i=t[2].indexOf("~"),r=t[2].substr(i,t[2].length).split("|"),u=t[3].indexOf("~"),e=t[3].substr(u,t[3].length).split("|");h=r[3];c=e[3]}}),s=n.getHtml(r,{fromAreaName:h,toAreaName:c,tripDate:f._getDateFromView(),tripTime:f._getTripTimeFromView(),vehicleNumber:o.vehicleNumber,driverInfo:o.driverInfo,totalRecords:e.totalRecords,totalBooked:e.totalBooked,totalBooking:e.totalBooking,totalNumItems:e.totalNumItems,totalDelivery:e.totalDelivery,totalNotDelivery:e.totalNotDelivery}),f._$headerProduct.html(s),f._$headerTableProduct.html('<tr><th class="v-align-m bg-thead"><input type="checkbox" name="CheckAllPro" /><\/th><th class="v-align-m bg-thead">STT<\/th><th class="bg-thead bg-thead">Mã hàng<\/th><th class="v-align-m bg-thead">VP Nhận<\/th><th class="bg-thead bg-thead">Người gửi<\/th><th class="bg-thead bg-thead">Người nhận<\/th><th class="bg-thead bg-thead">Địa chỉ nhận<\/th><th class="v-align-m bg-thead">SL/ĐV<\/th><th class="v-align-m bg-thead">Nặng<\/th><th class="bg-thead">Ghi chú<\/th><th class="bg-thead">Giá tiền<\/th><th class="bg-thead">Th.Toán<\/th><th class="bg-thead">NV Nhận<\/th><th class="v-align-m bg-thead">Chức năng<\/th><\/tr>'),f._bindEventDaGiao()):(n.each(f._$trip,function(n,t){if(t[0]==f._getTripIdFromView()){var i=t[2].indexOf("~"),r=t[2].substr(i,t[2].length).split("|"),u=t[3].indexOf("~"),e=t[3].substr(u,t[3].length).split("|");h=r[3];c=e[3]}}),s=n.getHtml(r,{fromAreaName:h,toAreaName:c,tripDate:f._getDateFromView(),tripTime:f._getTripTimeFromView(),vehicleNumber:o.vehicleNumber,driverInfo:o.driverInfo,totalRecords:e.totalRecords,totalBooked:e.totalBooked,totalBooking:e.totalBooking,totalReceived:e.totalReceived,totalNotReceived:e.totalNotReceived,totalNumItems:e.totalNumItems,totalDelivery:e.totalDelivery,totalNotDelivery:e.totalNotDelivery}),f._$headerProduct.html(s),f._$headerTableProduct.html('<tr><th class="v-align-m bg-thead"><input type="checkbox" name="CheckAllPro" /><\/th><th class="v-align-m bg-thead">STT<\/th><th class="bg-thead bg-thead">Mã hàng<\/th><th class="v-align-m bg-thead">VP Nhận<\/th><th class="bg-thead bg-thead">Người gửi<\/th><th class="bg-thead bg-thead">Người nhận<\/th><th class="bg-thead bg-thead">Địa chỉ nhận<\/th><th class="v-align-m bg-thead">SL/ĐV<\/th><th class="v-align-m bg-thead">Nặng<\/th><th class="bg-thead">Ghi chú<\/th><th class="bg-thead">Giá tiền<\/th><th class="bg-thead">Th.Toán<\/th><th class="bg-thead">Nhân viên<\/th><th class="v-align-m bg-thead">Chức năng<\/th><\/tr>'),f._bindEventDaNhan());i.html(a);f._bindEventU();f._bindEventC();f._bindEventP();f._bindEventD();f._bindEventCheckAll()};f._submitAction(t,y)},_submitSavePro:function(t){var i=this,r=i._createProOrderObj(t),u=function(n,r){if(n==1)var u=i._createProductObj(r),f=function(){};i._clearForm();t.find("button.btn-save-pro").button("reset");i._reloadProContainer()};i._submitAction(n.createInsertProOrderObj(r),u)},_getDataFromView:function(t){var i=[],r=[];return n.each(t.find("div.row"),function(t,u){var f=n(u),e;f.hasClass("pro-child")?(e=[],n.each(f.find("input,select"),function(t,r){n(r).hasClass("noSave")||(n(r).attr("name").toLowerCase()=="receiveraddress"||n(r).attr("name").toLowerCase()=="statusofpro"?i.push({Name:n(r).attr("name"),Value:n(r).val()}):e.push({Name:n(r).attr("name"),Value:n(r).val()}))}),r.push(e)):n.each(f.find("input,select"),function(t,r){i.push({Name:n(r).attr("name"),Value:n(r).val()})})}),i.push({Name:"ListProChild",Value:r}),i},_createProOrderObj:function(t){var i={},u=this,o,s,r,e,f;return u._$dataFromView=u._getDataFromView(t),o=app.aid,s=function(n,t,r){n==1&&r==1&&(i.AgentInfo=t[0][0]+"|"+t[0][1]+"|"+t[0][2]+"|"+t[0][3]+"|"+t[0][4]+"|"+t[0][5])},u._submitAction(n.createGetPostOfficeObj(o),s),r=u._$dataFromView,i.CompId=app.cid,i.TripId=u._getTripIdFromView(),i.Type=1,i.IsPrgStatus=1,i.Status=n.findObjByKey(r,"StatusOfPro"),parseInt(i.Status)==2&&(i.UserCharge=app.un),i.PickupInfo="1|1|0|"+n.findObjByKey(r,"SenderName")+"|"+n.findObjByKey(r,"SenderPhone")+"|||",i.DropOffInfo="1|1|0|"+n.findObjByKey(r,"ReceiverName")+"|"+n.findObjByKey(r,"ReceiverPhone")+"|||"+n.findObjByKey(r,"ReceiverAddress"),e=n.findObjByKey(r,"ReceivedAgentId"),i.ReceivedAgentId=e,n.each(u._$receiveOffice,function(n,t){t[0]==e&&(i.ReceivedAgentInfo=t[0]+"|"+t[1]+"|"+t[2]+"|"+t[3]+"|"+t[4]+"|"+t[5])}),i.CreatedUser=app.un,f=n.findObjByKey(r,"ListProChild"),i.AmountInfo=n.findObjByKey(f[0],"UnitOfPro")+"|"+n.findObjByKey(f[0],"NumOfPro"),i.WeightInfo=n.findObjByKey(f[0],"WeightOfPro"),i.Note=n.findObjByKey(f[0],"NoteOfPro"),i.Fare=parseInt(n.findObjByKey(f[0],"FareOfPro").replace(/\./g,"")),i},_createProOrderUpdateObj:function(t){var i={},f=this,e,u;f._$dataFromView=f._getDataFromView(t);var r=f._$dataFromView,o=app.aid,s=function(n,t,r){n==1&&r==1&&(i.AgentInfo=t[0][0]+"|"+t[0][1]+"|"+t[0][2]+"|"+t[0][3]+"|"+t[0][4]+"|"+t[0][5])};return f._submitAction(n.createGetPostOfficeObj(o),s),i.Status=n.findObjByKey(r,"StatusOfPro"),parseInt(i.Status)==2&&(i.UserCharge=app.un),i.PickupInfo="1|1|0|"+n.findObjByKey(r,"SenderName")+"|"+n.findObjByKey(r,"SenderPhone")+"|||",i.DropOffInfo="1|1|0|"+n.findObjByKey(r,"ReceiverName")+"|"+n.findObjByKey(r,"ReceiverPhone")+"|||"+n.findObjByKey(r,"ReceiverAddress"),e=n.findObjByKey(r,"ReceivedAgentId"),i.ReceivedAgentId=e,n.each(f._$receiveOffice,function(n,t){t[0]==e&&(i.ReceivedAgentInfo=t[0]+"|"+t[1]+"|"+t[2]+"|"+t[3]+"|"+t[4]+"|"+t[5])}),u=n.findObjByKey(r,"ListProChild"),i.AmountInfo=n.findObjByKey(u[0],"UnitOfPro")+"|"+n.findObjByKey(u[0],"NumOfPro"),i.WeightInfo=n.findObjByKey(u[0],"WeightOfPro"),i.Note=n.findObjByKey(u[0],"NoteOfPro"),i.Fare=parseInt(n.findObjByKey(u[0],"FareOfPro").replace(/\./g,"")),i},_createLenXeObj:function(n){var i=this,t={};switch(parseInt(n)){case 1:t.Status=3;break;case 2:t.Status=5}return t.TripTime=i._getTripTimeFromView(),t.TripDate=vDtToStr("iso",vGtDtObj("00:00",i._getDateFromView())),t},_createDaNhanObj:function(n){var t={};switch(parseInt(n)){case 3:t.Status=4;break;case 5:t.Status=6}return t.ReceivedUser=app.un,t},_createDaGiaoObj:function(n){var t={};return t.Status=9,t.DeliveryInfo=n,t},_createProductObj:function(t){var i=[],r=this,u=r._$dataFromView,f=n.findObjByKey(u,"ListProChild");return n.each(f,function(r,u){var f={};f.Type=1;f.OrderId=t;f.IsPrgStatus=1;f.Fare=parseInt(n.findObjByKey(u,"FareOfPro").replace(/\./g,""));f.Note=n.findObjByKey(u,"NoteOfPro");f.SizeInfo="1|"+n.findObjByKey(u,"NumOfPro")+"|"+n.findObjByKey(u,"UnitOfPro");f.WeightInfo=n.findObjByKey(u,"WeightOfPro");i.push(f)}),i},_loadFilter:function(){var t=this,i="",r=function(r,u,f){r&&f>0&&(t._$trip=u,n.each(u,function(n,t){i+='<option value="'+t[0]+'">'+t[1]+"<\/option>"}),n("div.product-toolbar").find('select[name="TripId"]').append(i),n("div.product-toolbar").find('select[name="TripId"] option:first-child').attr("selected","selected"),t._$typeOfView.val("kho-hang-di"),n("div.product-toolbar").find('select[name="TripId"]').trigger("change"))};t._submitAction(n.createGetAllTripObj(),r)},_reloadProContainer:function(t,i,r,u,f,e,o){var s=this,h=o!=null?o:s._$typeOfView.val();if(typeof t!="undefined"&&h=="kho-hang-di")s._loadPro(n.crGetProOrderDetailObj(t),s._$proList,"header01","kho-hang-di");else{var c=i!=null?i:s._$pageIndex,l=r!=null?r:s._$pageSize,a=u!=null?u:s._getTripIdFromView(),v=f!=null?f:s._getTripTimeFromView(),y=e!=null?e:s._getDateFromView(),p=vDtToStr("iso",vGtDtObj("00:00",y));h.toLowerCase()=="kho-hang-di"?s._loadPro(n.createGetProOrderTripObj(a,c,l),s._$proList,"header01","kho-hang-di"):h.toLowerCase()=="kho-hang-ve"?s._loadPro(n.createGetProOrderReceivedObj(a,c,l),s._$proList,"header02","kho-hang-ve"):s._loadPro(n.createGetProOrderTripDetailObj(a,v,p,c,l),s._$proList,"header03","xem-chuyen")}},_loadOfficeReceive:function(){var t=this,i="",r;t._$receiveOffice=[];r=function(r,u,f){r&&f>0&&n.each(u,function(n,r){r[0]!=app.aid&&(i+='<option value="'+r[0]+'">'+r[3]+"<\/option>",t._$receiveOffice.push(r))});t._$formOfficeReceive.html(i);t._$formOfficeReceive.find("option:first-child").prop("selected","selected")};t._submitAction(n.createGetOfficeObj(),r)},_getOfficeReceive:function(){var t=this,i=[],r=function(r,u,f){r&&f>0&&(t._$receiveOffice=u,n.each(u,function(n,t){i.push({Id:t[0],Name:t[3]})}))};return t._submitAction(n.createGetOfficeObj(),r),i},_convertDbIntoProOrderObj:function(n){var t=new Pro;return t._id=n[0],t._code=_dictionary._proCode+n[0],t._parseSenderInfo(n[3]),t._parseReceiverInfo(n[4]),t._note=n[5],t._parseAmountInfo(n[8]),t._weight=n[9],t._fare=vToMn(n[11]),t._parseStatusInfo(n[12]),t._parseAgentInfo(n[13]),t._createdUser=n[14],t._agentId=n[15],t._parseCreatedDate(vPrsDt(n[16])),t._tripId=n[17],t._tripTime=n[18],t._tripDate=n[19],t._receivedUser=n[20],t._parseReceivedAgentInfo(n[21]),t._deliveryInfo=n[22],t},_convertDbIntoProOrderPaginationObj:function(n){var t=new Pro;return t._id=n[1],t._code=_dictionary._proCode+n[1],t._parseSenderInfo(n[4]),t._parseReceiverInfo(n[5]),t._note=n[6],t._parseAmountInfo(n[9]),t._weight=n[10],t._fare=vToMn(n[12]),t._parseStatusInfo(n[13]),t._parseAgentInfo(n[14]),t._createdUser=n[15],t._agentId=n[16],t._parseCreatedDate(vPrsDt(n[17])),t._tripId=n[18],t._tripTime=n[19],t._tripDate=n[20],t._receivedUser=n[21],t._parseReceivedAgentInfo(n[22]),t._deliveryInfo=n[23],t},_getCounter:function(t){var i=this,r=0,f=0,s=0,h=0,c=0,u=0,e=0,o=0,l,a,v,y;switch(t){case"kho-hang-di":l=n.crGetProOrderTripCounterObj(i._getTripIdFromView());a=function(t,u,s,h){t&&s>0&&(n.each(u,function(n,t){var u=i._convertDbIntoProOrderObj(t);u._statusInfo._code==1?f++:u._statusInfo._code==2&&r++;e+=parseInt(u._num)}),o=h)};i._submitAction(l,a);break;case"xem-chuyen":var p=i._getTripIdFromView(),w=i._getTripTimeFromView(),b=vDtToStr("iso",vGtDtObj("00:00",i._getDateFromView())),k=n.crGetProOrderTripDetailCounterObj(p,w,b),d=function(t,l,a,v){t&&a>0&&(n.each(l,function(n,t){var o=i._convertDbIntoProOrderObj(t);o._statusInfo._code==3?(h++,f++,u++):o._statusInfo._code==4?(f++,s++,u++):o._statusInfo._code==5?(r++,h++,u++):o._statusInfo._code==6?(r++,s++,u++):o._statusInfo._code==9&&(r++,c++);e+=parseInt(o._num)}),o=v)};i._submitAction(k,d);break;case"kho-hang-ve":v=n.crGetProOrderTripDetailDeliveryCounterObj();y=function(t,s,h,l){t&&h>0&&(n.each(s,function(n,t){var o=i._convertDbIntoProOrderObj(t);o._statusInfo._code==4?(f++,u++):o._statusInfo._code==6?(r++,u++):o._statusInfo._code==9&&(r++,c++);e+=parseInt(o._num)}),o=l)};i._submitAction(v,y)}return{totalBooked:r,totalBooking:f,totalNumItems:e,totalRecords:o,totalDelivery:c,totalNotDelivery:u,totalNotReceived:h,totalReceived:s}},_initListener:function(){var t=this;vev('div.product-toolbar select[name="TripId"]',"change",function(){var i="";n.each(t._$trip,function(n,r){var u,e,f;if(r[0]==t._getTripIdFromView())if(u=r[4],u.indexOf("~")!=-1)for(e=u.split("~"),f=0;f<e.length;f++)i+='<option value="'+e[f]+'">'+e[f]+"<\/option>";else u.length==5&&(i+='<option value="'+u+'">'+u+"<\/option>")});n("div.product-toolbar").find('select[name="TimeSlot"] option').remove();n("div.product-toolbar").find('select[name="TimeSlot"]').append(i);n("div.product-toolbar").find('select[name="TimeSlot"] option:first-child').attr("selected","selected");t._reloadProContainer()});vev('div.product-toolbar select[name="TimeSlot"]',"change",function(){t._reloadProContainer()});n('div.product-toolbar input[name="DepartureDate"]').datepicker({dateFormat:"dd-mm-yy",onSelect:function(){t._reloadProContainer()}}).datepicker("setDate",new Date);n("span.glyphicon-calendar").parent().on("click",function(){n(this).prev().datepicker("show")});vev("button.btn-nhap-kho","click",function(){n(this).hasClass("open")?(t._$formNhapHang.slideUp("fast"),n(this).removeClass("open")):(t._loadOfficeReceive(),t._$formNhapHang.slideDown("fast"),n(this).addClass("open"),t._$formNhapHang.find("div.form-group").tooltip())});vev("div.product-toolbar div.btn-filter a.kho-hang-di","click",function(){n("div.product-toolbar div.btn-filter a.btn-typeofview").removeClass("btn-danger").removeClass("btn-default").addClass("btn-default");n(this).removeClass("btn-default").addClass("btn-danger");t._$typeOfView.val("kho-hang-di");n("button.btn-in-phoi-hang").removeClass("hidden");n("button.btn-in-phoi-hang").addClass("hidden");n("button.btn-nhap-kho").removeClass("hidden");t._reloadProContainer()});vev("div.product-toolbar div.btn-filter a.kho-hang-ve","click",function(){n("div.product-toolbar div.btn-filter a.btn-typeofview").removeClass("btn-danger").removeClass("btn-default").addClass("btn-default");n(this).removeClass("btn-default").addClass("btn-danger");t._$typeOfView.val("kho-hang-ve");n("button.btn-in-phoi-hang").removeClass("hidden");n("button.btn-in-phoi-hang").addClass("hidden");n("button.btn-nhap-kho").removeClass("hidden");n("button.btn-nhap-kho").addClass("hidden");t._reloadProContainer()});vev("div.product-toolbar div.btn-filter a.xem-chuyen","click",function(){n("div.product-toolbar div.btn-filter a.btn-typeofview").removeClass("btn-danger").removeClass("btn-default").addClass("btn-default");t._$typeOfView.val("xem-chuyen");n(this).removeClass("btn-default").addClass("btn-danger");n("button.btn-in-phoi-hang").removeClass("hidden");n("button.btn-nhap-kho").removeClass("hidden");n("button.btn-nhap-kho").addClass("hidden");t._reloadProContainer()});vev("button.btn-save-pro","click",function(){n(this).button("loading");t._submitSavePro(n(this).closest("div.nhap-hang"))});vev("button.nhap-hang-dong","click",function(){t._$formNhapHang.slideUp("fast");n("button.btn-nhap-kho").removeClass("open");t._clearForm()});vev("button.btn-in-phoi-hang","click",function(){t._initPhoiHang()});vev(t._$pageSizeElement,"change",function(){t._$pageSize=t._getPageSize();t._reloadProContainer()});t._autoFormatFare()},_bindEventU:function(){var t=this;vev("button.btn-update-pro","click",function(){t._initUpdateForm(n(this).closest("tr"))})},_bindEventC:function(){var t=this;vev("button.btn-cancel-pro","click",function(){t._initCancelForm(n(this).closest("tr"))})},_bindEventP:function(){var t=this;vev("button.btn-phieu-hang","click",function(){t._initPhieuHang(n(this).closest("tr"))})},_bindEventD:function(){var t=this;vev("button.btn-deliveried","click",function(){var r=n(this).closest("tr"),u=r.attr("data-id"),i={},f=function(){t._reloadProContainer()};t._$typeOfView.val()=="xem-chuyen"?i=t._createDaGiaoObj("Tài xế"):t._$typeOfView.val()=="kho-hang-ve"&&(i=t._createDaGiaoObj(un));t._submitAction(n.createUpdateProOrderObj({Id:u},i),f)})},_bindEventLenXe:function(){var t=this,i=[],r=[];vev("div.product-matrix button.btn-len-xe","click",function(){n.each(n('div.product-matrix table.product-list tbody input[name="ProId"]:checked'),function(u,f){var e=n(f).closest("tr").attr("data-id");if(i.push(e),i.length>0){var o=function(){r.push(e)},s=n(this).closest("tr").find("td.td-status").attr("data-status-code"),h=t._createLenXeObj(s);t._submitAction(n.createUpdateProOrderObj({Id:e},h),o)}});i.length==r.length&&t._reloadProContainer()})},_bindEventDaNhan:function(){var t=this,i=[],r=[];vev("div.product-matrix button.btn-da-nhan","click",function(){n.each(n('div.product-matrix table.product-list tbody input[name="ProId"]:checked'),function(u,f){var e=n(f).closest("tr").attr("data-id");i.push(e);var o=function(){r.push(e)},s=n(this).closest("tr").find("td.td-status").attr("data-status-code"),h=t._createDaNhanObj(s);t._submitAction(n.createUpdateProOrderObj({Id:e},h),o)});i.length==r.length&&t._reloadProContainer()})},_bindEventDaGiao:function(){var t=this,i=[],r=[];vev("div.product-matrix button.btn-da-giao","click",function(){n.each(n('div.product-matrix table.product-list tbody input[name="ProId"]:checked'),function(u,f){var e=n(f).closest("tr").attr("data-id"),o,s;i.push(e);o=function(){r.push(e)};s=t._createDaGiaoObj(un);t._submitAction(n.createUpdateProOrderObj({Id:e},s),o)});i.length==r.length&&t._reloadProContainer()})},_autoFormatFare:function(){vev('input[name="FareOfPro"]',"keyup",function(){var t=vToMn(n(this).val().replace(/\./g,""));n(this).val(t)})},_bindEventCheckAll:function(){var t=this;t._$headerTableProduct.find('input[name="CheckAllPro"]').unbind().on("click",function(){n(this).is(":checked")?t._$proList.find('input[name="ProId"]').each(function(){this.checked=!0}):t._$proList.find('input[name="ProId"]').each(function(){this.checked=!1})})},init:function(){var n=this;n._initBaseFunc();n._initListener();n._loadFilter()},reload:function(){var n=this;n._reloadProContainer()},load:function(t){var i=this;vIsEstStr(t.tTime)&&n("div.product-toolbar").find('select[name="TimeSlot"]').val(t.tTime);vIsEstStr(t.tDate)&&n("div.product-toolbar").find('input[name="DepartureDate"]').val(t.tDate);n("div.product-toolbar").find('select[name="TripId"]').val(t.tId);n("div.product-toolbar div.btn-filter a.btn-typeofview").removeClass("btn-danger").removeClass("btn-default").addClass("btn-default");switch(t.tOView){case"kho-hang-di":n("div.product-toolbar div.btn-filter a.kho-hang-di").removeClass("btn-default").addClass("btn-danger");n("button.btn-in-phoi-hang").removeClass("hidden");n("button.btn-in-phoi-hang").addClass("hidden");break;case"kho-hang-ve":n("div.product-toolbar div.btn-filter a.kho-hang-ve").removeClass("btn-default").addClass("btn-danger");n("button.btn-in-phoi-hang").removeClass("hidden");n("button.btn-in-phoi-hang").addClass("hidden");break;case"xem-chuyen":n("div.product-toolbar div.btn-filter a.xem-chuyen").removeClass("btn-default").addClass("btn-danger");n("button.btn-in-phoi-hang").removeClass("hidden")}n(this).removeClass("btn-default").addClass("btn-danger");i._reloadProContainer(t.proId,t.pIndex,t.pSize,t.tId,t.tTime,t.tDate,t.tOView)},_getPagination:function(n,t,i){for(var u,e,f=Math.ceil(i/t),r=[],o=n-5;o<n;o++)o>=1&&r.push(o);for(u=[],e=n+1;e<n+5;e++)e<=f&&u.push(e);return{CurrentPage:n,CountAllPages:f,First:-1!=r.indexOf(1)&&1!=n?1:"",FrevPage:r.length>0?r[r.length-1]:"",FrevPages:r,NextPages:u,NextPage:u.length>0?u[0]:"",Last:-1!=u.indexOf(f)&&f!=n?f:"",NumPerPage:t}},_renderPagination:function(t){var r=this,u="",s="",h=r._$pageIndex,c=r._$pageSize,i=r._getPagination(h,c,t),f,e,o;if(i.CountAllPages>0){if(u+=i.First!=""?'<li><a href="javascript:;" data-index="'+i.First+'"><i class="glyphicon glyphicon-fast-backward"><\/i><\/a><\/li>':'<li class="disabled"><a href="javascript:;" data-index=""><i class="glyphicon glyphicon-fast-backward"><\/i><\/a><\/li>',u+=i.FrevPage!=""?'<li><a href="javascript:;" data-index="'+i.FrevPage+'"><i class="glyphicon glyphicon-backward"><\/i><\/a><\/li>':'<li class="disabled"><a href="javascript:;" data-index=""><i class="glyphicon glyphicon-backward"><\/i><\/a><\/li>',i.FrevPages.length>0)for(f=0;f<i.FrevPages.length;f++)u+='<li><a href="javascript:;" data-index="'+i.FrevPages[f]+'">'+i.FrevPages[f]+"<\/a><\/li>";if(u+='<li class="active"><a href="javascript:;" data-index="'+i.CurrentPage+'">'+i.CurrentPage+"<\/a><\/li>",i.NextPages.length>0)for(e=0;e<i.NextPages.length;e++)u+='<li><a href="javascript:;" data-index="'+i.NextPages[e]+'">'+i.NextPages[e]+"<\/a><\/li>";u+=i.NextPage!=""?'<li><a href="javascript:;" data-index="'+i.NextPage+'"><i class="glyphicon glyphicon-forward"><\/i><\/a><\/li>':'<li class="disabled"><a href="javascript:;" data-index=""><i class="glyphicon glyphicon-forward"><\/i><\/a><\/li>';u+=i.Last!=""?'<li><a href="javascript:;" data-index="'+i.Last+'"><i class="glyphicon glyphicon-fast-forward"><\/i><\/a><\/li>':'<li class="disabled"><a href="javascript:;" data-index=""><i class="glyphicon glyphicon-fast-forward"><\/i><\/a><\/li>';r._$paginationElement.html(u);r._$paginationElement.find("a").not(".disabled").on("click",function(t){t.preventDefault();t.stopPropagation();r._$pageIndex=parseInt(n(this).attr("data-index"));r._reloadProContainer()});for(o=1;o<=i.CountAllPages;o++)s+='<option value="'+o+'">'+o+"<\/option>";r._$jumpPageElement.html(s);r._$jumpPageElement.val(i.CurrentPage);r._$jumpPageElement.unbind().on("change",function(){r._$pageIndex=parseInt(n(this).val());r._reloadProContainer()});r._$paginationElement.show();r._$jumpPageElement.show();r._$jumpPageElement.prev().show();r._$pageSizeElement.show();r._$pageSizeElement.prev().show()}},_getTripIdFromView:function(){return n("div.product-toolbar").find('select[name="TripId"]').val()},_getTripTimeFromView:function(){return n("div.product-toolbar").find('select[name="TimeSlot"]').val()},_getDateFromView:function(){return n("div.product-toolbar").find('input[name="DepartureDate"]').val()},_clearForm:function(){var n=this;n._$formNhapHang.find("input").val("")},_createDataUpdateForm:function(t){var r=this,i={},u;return i.receivedOffices=r._getOfficeReceive(),u=function(n,u,f){if(n&&f==1){var e=r._convertDbIntoProOrderObj(u[0]);i.proId=t;i.receivedOfficeId=e._agentId;i.status=e._statusInfo._code;i.senderName=e._senderInfo._name;i.senderPhone=e._senderInfo._phone;i.receiverName=e._receiverInfo._name;i.receiverPhone=e._receiverInfo._phone;i.fareOfPro=e._fare;i.noteOfPro=e._note;i.weightOfPro=e._weight;i.unitOfPro=e._unitInfo._code;i.numOfPro=e._num;i.receivedAddress=e._receiverInfo._address}},r._submitAction(n.createGetProOrderDetailObj(t),u),i},_bindEventUpdateForm:function(){var t=this;t._autoFormatFare();t._$updateModal.find("button.btn-update-form-save").unbind().on("click",function(){var i=t._$updateModal.find('input[name="ProId"]').val(),r=t._createProOrderUpdateObj(t._$updateModal),u=function(n){n==1&&(t._reloadProContainer(),t._$updateModal.modal("hide"))};t._submitAction(n.createUpdateProOrderObj({Id:i},r),u)})},_initUpdateForm:function(t){var i=this,r=t.attr("data-id"),u=n.getHtml("update-product-form",i._createDataUpdateForm(r));n("body div.ui-layout-center div.update-hang-hoa").remove();i._$updateModal=n(u).appendTo(n("body div.ui-layout-center"));i._bindEventUpdateForm()},_initCancelForm:function(t){var i=this,r=t.attr("data-id"),u=n.getHtml("cancel-product-form",{proOrderId:r});n("body div.ui-layout-center div.cancel-hang-hoa").remove();i._$cancelModal=n(u).appendTo(n("body div.ui-layout-center"));i._bindEventCancelForm()},_bindEventCancelForm:function(){var t=this;t._$cancelModal.find("button.btn-cancel").unbind().on("click",function(){var i=n(this).attr("data-id"),r=function(n){n==1&&(t._reloadProContainer(),t._$cancelModal.modal("hide"))};t._submitAction(n.createCancelProOrderObj(i),r)})},_initPhieuHang:function(t){var r=this,u=t.attr("data-id");r._$phieuHangHTML=n.getHtml("phieu-hang",r._createDataPhieuHang(u));var f=r._$phieuHangHTML,i=window.open("about:blank","width="+screen.width+", height="+screen.height+", scrollbars=1");i.document.write('<link rel="stylesheet" href="'+_dictionary._baseUrl+"/"+app.cssBootStrap+'" type="text/css" />');i.document.write('<link rel="stylesheet" media="(max-width: 800px)" href="'+_dictionary._baseUrl+_dictionary._pStyleUrl+'" type="text/css" />');i.document.write('<\/head><body onload="window.top.print()" >');i.document.write(f);i.document.write("<\/body><\/html>");i.document.close();i.focus()},_createDataPhieuHang:function(t){var u=this,i={},r={},f=[],e="",o="",s=function(t,s,h){var c,l,a;if(t&&h==1){c=u._convertDbIntoProOrderObj(s[0]);i.logoUrl=_dictionary._logoUrl;l=vDtToStr("iso",vGtDtObj("00:00",c._tripDate));a=function(t,u,s){var h,c,l,a,v,y;t==1&&s==1?(vIsEstStr(u[0][1])?(h=u[0][1].split("~"),n.each(h,function(n,t){if(t.length>1){var i=t.split("|");i[0]==2&&f.push(i[2]+" - "+(i[3]?i[3]:""))}}),r.driverInfo=f.join(", ")):r.driverInfo="",vIsEstStr(u[0][2])?(c=u[0][2].substr(u[0][2].indexOf("~"),u[0][2].length).split("|"),r.vehicleNumber=c[2]):r.vehicleNumber="",vIsEstStr(u[0][3])&&(l=u[0][3].indexOf("~"),a=u[0][3].substr(l,u[0][3].length).split("|"),e=a[3],i.fromName=e),vIsEstStr(u[0][4])&&(v=u[0][4].indexOf("~"),y=u[0][4].substr(v,u[0][4].length).split("|"),o=y[3],i.toName=o)):(r.driverInfo=f,r.vehicleNumber="");i.driverInfo=r.driverInfo;i.vehicleNumber=r.vehicleNumber};u._submitAction(n.createGetTripDetailObj(c._tripId,c._tripTime,l),a);i.tripDate=vDtToStr("dd/mm/yyyy",vGtDtObj("00:00",c._tripDate));i.tripTime=c._tripTime;i.createdUser=c._createdUser;i.postOfficeName=c._agentInfo._name;i.postOfficePhone=c._agentInfo._phone;i.postOfficeAddress=c._agentInfo._address;i.receivedOfficeName=c._receivedAgentInfo._name;i.receivedOfficePhone=c._receivedAgentInfo._phone;i.receivedOfficeAddress=c._receivedAgentInfo._address;i.createdDate=c._createdDate._date;i.createdTime=c._createdDate._time;i.senderName=c._senderInfo._name;i.senderPhone=c._senderInfo._phone;i.receiverName=c._receiverInfo._name;i.receiverPhone=c._receiverInfo._phone;i.receivedAddress=c._receiverInfo._address;i.fareOfPro=c._fare;i.noteOfPro=c._note;i.weightOfPro=c._weight;i.unitOfPro=c._unitInfo._name;i.numOfPro=c._num;i.proCode=c._code;switch(parseInt(c._statusInfo._code)){case 1:i.status="Chưa thanh toán";break;case 2:i.status="Đã thanh toán";break;case 3:i.status="Chưa thanh toán";break;case 4:i.status="Chưa thanh toán";break;case 5:i.status="Đã thanh toán";break;case 6:i.status="Đã thanh toán";break;case 7:i.status="Chưa thanh toán";break;case 8:i.status="Đã thanh toán";break;case 9:i.status="Đã thanh toán"}}};return u._submitAction(n.createGetProOrderDetailObj(t),s),i},_initPhoiHang:function(){var i=this;i._$phoiHangHTML=n.getHtml("phoi-hang",i._createDataPhoiHang());var r=i._$phoiHangHTML,t=window.open("about:blank","width="+screen.width+", height="+screen.height+", scrollbars=1");t.document.write('<link rel="stylesheet" href="'+_dictionary._baseUrl+"/"+app.cssBootStrap+'" type="text/css" />');t.document.write('<link rel="stylesheet" media="(max-width: 800px)" href="'+_dictionary._baseUrl+_dictionary._pStyleUrl+'" type="text/css" />');t.document.write('<\/head><body onload="window.top.print()" >');t.document.write(r);t.document.write("<\/body><\/html>");t.document.close();t.focus()},_createDataPhoiHang:function(){var r=this,t={},s=[],h=r._getTripIdFromView(),u=r._getTripTimeFromView(),c=vDtToStr("iso",vGtDtObj("00:00",r._getDateFromView())),i={},f=[],l="",a="",e=0,o=0,v=function(v,y,p){if(v&&p>0){n.each(y,function(t,i){var u=r._convertDbIntoProOrderObj(i),f;u._index=t+1;u._statusInfo._code==3||u._statusInfo._code==4?o+=parseInt(u._fare.replace(/\./g,"")):(u._statusInfo._code==5||u._statusInfo._code==6)&&(e+=parseInt(u._fare.replace(/\./g,"")));f=n.mapItemToView(n.convertProToItem(u));s.push(f)});var w=function(r,u,e){var o,s,h,c,v,y;r==1&&e==1?(vIsEstStr(u[0][1])?(o=u[0][1].split("~"),n.each(o,function(n,t){if(t.length>1){var i=t.split("|");i[0]==2&&f.push(i[2]+" - "+(i[3]?i[3]:""))}}),i.driverInfo=f.join(", ")):i.driverInfo="",vIsEstStr(u[0][2])?(s=u[0][2].substr(u[0][2].indexOf("~"),u[0][2].length).split("|"),i.vehicleNumber=s[2]):i.vehicleNumber="",vIsEstStr(u[0][3])&&(h=u[0][3].indexOf("~"),c=u[0][3].substr(h,u[0][3].length).split("|"),l=c[3],t.fromName=l),vIsEstStr(u[0][4])&&(v=u[0][4].indexOf("~"),y=u[0][4].substr(v,u[0][4].length).split("|"),a=y[3],t.toName=a)):(i.driverInfo=f,i.vehicleNumber="");t.driverInfo=i.driverInfo;t.vehicleNumber=i.vehicleNumber};r._submitAction(n.createGetTripDetailObj(h,u,c),w)}};return r._submitAction(n.createGetProOrderTripDetailNoPaginationObj(h,u,c),v),t.logoUrl=_dictionary._logoUrl,t.tripTime=u,t.tripDate=r._getDateFromView(),t.totalFareBooked=e!=0?vToMn(e):0,t.totalFareBooking=o!=0?vToMn(o):0,t.listProductOrder=s,t}});n.convertProToItem=function(n){return new ItemPro(n._id,n._index,n._code,n._agentInfo,n._senderInfo,n._receiverInfo,n._num,n._unitInfo._name,n._weight,n._note,n._fare,n._statusInfo,n._createdUser,n._tripId,n._tripTime,n._tripDate,n._receivedUser,n._receivedAgentInfo,n._deliveryInfo)};n.mapItemToView=function(n){var t={};t.proId=n._id;t.proIndex=n._index;t.proCode=n._code;t.officeReceivedName=n._officeReceivedName;t.postOfficeCode=n._postOfficeCode;t.senderName=n._senderName;t.senderPhone=n._senderPhone;t.receiverName=n._receiverName;t.receiverPhone=n._receiverPhone;t.receivedAddress=n._receivedAddress;t.numOfPro=n._num;t.unitOfPro=n._unit;t.proWeight=n._weight;t.proNote=n._note;t.proFare=n._fare;t.proStatusName=n._statusName;t.proStatusCode=n._statusCode;t.createdUser=n._createdUser;t.receivedUser=n._receivedUser;t.deliveryInfo=n._deliveryInfo;switch(parseInt(n._statusCode)){case 4:t.disabled="disabled";break;case 6:t.disabled="disabled";break;case 9:t.disabled="disabled";break;default:t.disabled=""}return t};n.findObjByKey=function(n,t){for(var i=0;i<n.length;i++)if(n[i].Name.toLowerCase()==t.toLowerCase())return n[i].Value;return null};n.createGetProOrderDetailObj=function(n){var t={};return t._a="fGetProductOrder",t._c={Id:n},t._f=_dictionary._qField.join(),t};n.createGetProOrderTripObj=function(n,t,i){var r={};return r._a="pGetProductOrder",r._c={},r._f=_dictionary._qField.join(),r._si=t,r._mr=i,r._se="IsPrgCreatedDate desc",r._ft="CompId = "+app.cid+" and TripId = "+n+" and TripDate is null and TripTime is null and IsPrgStatus = 1 and (Status = 1 or Status = 2) ",r};n.crGetProOrderTripCounterObj=function(n){var t={};return t._a="fGetProductOrder",t._c={CompId:app.cid,TripId:n,TripDate:"$x is null",TripTime:"$x is null",IsPrgStatus:1,Status:"($x = 1 or $x = 2)"},t._f=_dictionary._qField.join(),t};n.createGetProOrderTripDetailObj=function(n,t,i,r,u){var f={};return f._a="pGetProductOrder",f._c={},f._f=_dictionary._qField.join(),f._si=r,f._mr=u,f._se="IsPrgCreatedDate desc",f._ft="CompId = "+app.cid+" and TripId = "+n+" and TripDate = '"+i+"' and TripTime = '"+t+"' and IsPrgStatus = 1",f};n.crGetProOrderTripDetailCounterObj=function(n,t,i){var r={};return r._a="fGetProductOrder",r._c={CompId:app.cid,TripId:n,TripTime:t,TripDate:i,IsPrgStatus:1,Status:"($x = 3 or $x = 4 or $x = 5 or $x = 6 or $x = 9)"},r._f=_dictionary._qField.join(),r};n.crGetProOrderTripDetailDeliveryCounterObj=function(){var n={};return n._a="fGetProductOrder",n._c={CompId:app.cid,IsPrgStatus:1,Status:"($x = 4 or $x = 6)"},n._f=_dictionary._qField.join(),n};n.createGetProOrderTripDetailNoPaginationObj=function(n,t,i){var r={};return r._a="fGetProductOrder",r._c={CompId:app.cid,TripId:n,TripTime:t,TripDate:i,IsPrgStatus:1},r._f=_dictionary._qField.join(),r};n.createGetProOrderReceivedObj=function(n,t,i,r,u){var f={};return f._a="pGetProductOrder",f._c={},f._f=_dictionary._qField.join(),f._si=r,f._mr=u,f._se="IsPrgCreatedDate desc",f._ft="CompId = "+app.cid+" and TripId = "+n+" and (Status = 4 or Status = 6) and IsPrgStatus = 1 ",f};n.createGetAllTripObj=function(){var n={};return n._a="fGetTrip",n._c={CompId:app.cid,Type:1,IsPrgStatus:"$x='1' order by name asc"},n._f=_dictionary._qFieldTrip.join(),n};n.createGetTripObj=function(n){var t={};return t._a="fGetTrip",t._c={Id:n,CompId:app.cid,Type:1,IsPrgStatus:1},t._f=_dictionary._qFieldTrip.join(),t};n.createGetTripDetailObj=function(n,t,i){var r={};return r._a="fGetTrip",r._c={BaseId:n,CompId:app.cid,Time:t,Date:i},r._f=_dictionary._qFieldTripDetail.join(),r};n.createGetOfficeObj=function(){var n={};return n._a="fGetCompany",n._c={BaseId:app.cid,Type:2,IsPrgStatus:"$x=1 order by Name asc"},n._f=_dictionary._qFieldOffice.join(),n};n.createGetPostOfficeObj=function(n){var t={};return t._a="fGetCompany",t._c={Id:n},t._f=_dictionary._qFieldOffice.join(),t};n.createInsertProOrderObj=function(n){var t={};return t._a="InsertProductOrder",t._d=n,t};n.createUpdateProOrderObj=function(n,t){var i={};return i._a="UpdateProductOrder",i._c=n,i._d=t,i};n.createInsertProObj=function(n){var t={};return t._a="InProducts",t._d=n,t};n.createCancelProOrderObj=function(n){var t={};return t._a="UpdateProductOrder",t._c={Id:n},t._d={IsPrgStatus:3},t};n.crGetProOrderDetailObj=function(n){var t={};return t._a="pGetProductOrder",t._c={},t._f=_dictionary._qField.join(),t._si=1,t._mr=10,t._se="IsPrgCreatedDate desc",t._ft=" Id = '"+n+"'",t};n.getHtml=function(t,i){var r=n("#"+t).html();return Handlebars.compile(r)(i)};Handlebars.registerHelper("if",function(n,t){return t.hash.value===n?t.fn(this):t.inverse(this)});Handlebars.registerHelper("select",function(t,i){var r=n("<select />").html(i.fn(this));return r.find("[value="+t+"]").attr({selected:"selected"}),r.html()});Handlebars.registerHelper("xIf",function(n,t,i,r){var u,f;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(r===undefined&&(r=i,i=t,t="==="),u={"==":function(n,t){return n==t},"===":function(n,t){return n===t},"!=":function(n,t){return n!=t},"!==":function(n,t){return n!==t},"<":function(n,t){return n<t},">":function(n,t){return n>t},"<=":function(n,t){return n<=t},">=":function(n,t){return n>=t},"typeof":function(n,t){return typeof n==t}},!u[t])throw new Error("'xIf' doesn't know the operator "+t);return f=u[t](n,i),f?r.fn(this):r.inverse(this)})}(jQuery);
//# sourceMappingURL=p.min.js.map
