(function(n){var t={_create:n.custom.vbooking.prototype._create};n.extend(!0,n.custom.vbooking.prototype,{options:{},_$vocontainer:null,_$votoolbar:null,_$vosheet:null,_$vonav:null,_$vvcontainer:null,_$vvtoolbar:null,_$vvsheet:null,_$vvnav:null,_$vccontainer:null,_$vctoolbar:null,_$vcsheet:null,_$vcnav:null,_vo:null,_vv:null,_vc:null,_cVOTripId:0,_cVOPageIndex:1,_totalVOItem:0,_cVVTripId:0,_cVVPageIndex:1,_totalVVItem:0,_transfer:[],_$transfer:null,_create:function(){t._create.apply(this,arguments);this._initializeExtendFields();this._createExtendContainer();this._createExtendToolBar();this._createExtendSheet()},_initializeExtendFields:function(){this._vo=[];this._vv=[];this._vc=[]},_createExtendContainer:function(){this._$vocontainer=n(".vopen-container");this._$vvcontainer=n(".vvalid-container");this._$vccontainer=n(".vcancelled-container")},_createExtendToolBar:function(){this._$votoolbar=n(".vopen-toolbar");this._$vvtoolbar=n(".vvalid-toolbar");this._$vctoolbar=n(".vcancelled-toolbar")},_createExtendSheet:function(){this._$vosheet=n("<div />").addClass("vopen-sheet col-md-12 col-sm-12 col-xs-12").appendTo(this._$vocontainer);this._$vvsheet=n("<div />").addClass("vvalid-sheet  col-md-12 col-sm-12 col-xs-12").appendTo(this._$vvcontainer);this._$vonav=n("<div />").addClass("vopen-nav col-md-12 col-sm-12 col-xs-12").append(n("<div />").addClass("col-md-12")).appendTo(this._$vocontainer).children().first();this._$vvnav=n("<div />").addClass("vvalid-nav col-md-12 col-sm-12 col-xs-12").append(n("<div />").addClass("col-md-12")).appendTo(this._$vvcontainer).children().first()},_reloadVO:function(){var n=this,t=n._createGetVOSeatObj(),i=function(t,i,r,u){if(t!=1||r<=0){n._clearVOSheet();n._notFoundOpenTicket();return}n._clearVOSheet();r>0&&(n._mapVOTicket(i),n._totalVOItem=parseInt(u));n._renderVOSheet();n._renderVOPagination()};n._submitAction(t,i)},_createGetVOSeatObj:function(){var t=this,n={};return n._a="pGetTicket",n._c={TripId:t._cVOTripId,Status:7},n._ft="TripId = "+t._cVOTripId+" and Status = 7",n._f=_dict._tgF.join(),n._se="Id desc",n._si=t._cVOPageIndex,n._mr=_dict._nOP,n},_clearVOSheet:function(){this._$vosheet.empty();this._$vonav.empty()},_mapVOTicket:function(t){var i=this;i._vo=[];n.each(t,function(t,r){r.shift();var u=i._createTicketFromRecord(r);n.isEmptyObject(u)||i._vo.push(u)})},_renderVOSheet:function(){var n=this,u,t,f,r,i,e;if(n._vo.length>0)for(u=Math.round(n._vo.length/n._numCoach),t=0;t<n._vo.length;t+=u)for(f=n._createCoach(n._$vosheet).addClass(_dict._g[n._numCoach-1]).addClass(_dict._sg[n._numCoach-1]).addClass(_dict._mg[n._numCoach-1]),r=n._vo.slice(t,t+u),i=0;i<r.length;i++)typeof r[i]!="undefined"&&(e=r[i]._renderVOTicket().addClass(_dict._g[_dict._tplNumCol-1]),f.append(e));else n._notFoundOpenTicket()},_renderVOPagination:function(){var r=this,t=r._getPagination(r._cVOPageIndex,_dict._nOP,r._totalVOItem),i,u,f;if(t.CountAllPages>1){if(i=n("<ul />").addClass("pagination pagination-sm pull-right"),t.FrevPage!=""?i.append(n("<li />").append(n("<a />").html("&laquo;").attr("href","javascript:;").attr("data-index",t.FrevPage))):i.append(n("<li />").addClass("disabled").append(n("<a />").html("&laquo;").attr("href","javascript:;").attr("data-index",""))),t.FrevPages.length>0)for(u=0;u<t.FrevPages.length;u++)i.append(n("<li />").append(n("<a />").html(t.FrevPages[u]).attr("href","javascript:;").attr("data-index",t.FrevPages[u])));if(i.append(n("<li />").addClass("active").append(n("<a />").html(t.CurrentPage).attr("href","javascript:;").attr("data-index",t.CurrentPage))),t.NextPages.length>0)for(f=0;f<t.NextPages.length;f++)i.append(n("<li />").append(n("<a />").html(t.NextPages[f]).attr("href","javascript:;").attr("data-index",t.NextPages[f])));t.NextPage!=""?i.append(n("<li />").append(n("<a />").html("&raquo;").attr("href","javascript:;").attr("data-index",t.NextPage))):i.append(n("<li />").addClass("disabled").append(n("<a />").html("&raquo;").attr("href","javascript:;").attr("data-index","")));i.appendTo(r._$vonav);i.find("a").not(".disabled").on("click",function(t){t.preventDefault();t.stopPropagation();r._changeVOPageIndex(n(this).attr("data-index"));r._reloadVO()})}},_notFoundOpenTicket:function(){var t=this;n("<div />").addClass("alert alert-danger").html("<strong>Không tồn tại vé open.<\/strong>").appendTo(t._$vosheet)},_getPagination:function(n,t,i){for(var u,e,f=Math.ceil(i/t),r=[],o=n-5;o<n;o++)o>=1&&r.push(o);for(u=[],e=n+1;e<n+5;e++)e<=f&&u.push(e);return{CurrentPage:n,CountAllPages:f,First:-1==r.indexOf(1)&&1!=n?1:"",FrevPage:r.length>0?r[r.length-1]:"",FrevPages:r,NextPages:u,NextPage:u.length>0?u[0]:"",Last:-1==u.indexOf(f)&&f!=n?f:"",NumPerPage:t}},_changeVOPageIndex:function(n){this._cVOPageIndex=parseInt(n)},_reloadVV:function(){var n=this,t=n._createGetVVSeatObj(),i=function(t,i,r,u){if(t!=1||r<=0){n._clearVVSheet();n._notFoundValidTicket();return}n._clearVVSheet();r>0&&(n._mapVVTicket(i),n._totalVVItem=parseInt(u));n._renderVVSheet();n._renderVVPagination()};n._submitAction(t,i)},_createGetVVSeatObj:function(){var t=this,n={};return n._a="pGetTicket",n._c={TripId:t._cVVTripId,Status:6},n._ft="TripId = "+t._cVVTripId+" and Status = 6",n._f=_dict._tgF.join(),n._se="Id desc",n._si=t._cVVPageIndex,n._mr=_dict._nOP,n},_clearVVSheet:function(){this._$vvsheet.empty();this._$vvnav.empty()},_mapVVTicket:function(t){var i=this;i._vv=[];n.each(t,function(t,r){r.shift();var u=i._createTicketFromRecord(r);n.isEmptyObject(u)||i._vv.push(u)})},_renderVVSheet:function(){var n=this,u,t,f,r,i,e;if(n._vv.length>0)for(u=Math.round(n._vv.length/n._numCoach),t=0;t<n._vv.length;t+=u)for(f=n._createCoach(n._$vvsheet).addClass(_dict._g[n._numCoach-1]).addClass(_dict._sg[n._numCoach-1]).addClass(_dict._mg[n._numCoach-1]),r=n._vv.slice(t,t+u),i=0;i<r.length;i++)typeof r[i]!="undefined"&&(e=r[i]._renderVVTicket().addClass(_dict._g[_dict._tplNumCol-1]),f.append(e));else n._notFoundValidTicket()},_renderVVPagination:function(){var r=this,t=r._getPagination(r._cVVPageIndex,_dict._nOP,r._totalVVItem),i,u,f;if(t.CountAllPages>1){if(i=n("<ul />").addClass("pagination pagination-sm pull-right"),t.FrevPage!=""?i.append(n("<li />").append(n("<a />").html("&laquo;").attr("href","javascript:;").attr("data-index",t.FrevPage))):i.append(n("<li />").addClass("disabled").append(n("<a />").html("&laquo;").attr("href","javascript:;").attr("data-index",""))),t.FrevPages.length>0)for(u=0;u<t.FrevPages.length;u++)i.append(n("<li />").append(n("<a />").html(t.FrevPages[u]).attr("href","javascript:;").attr("data-index",t.FrevPages[u])));if(i.append(n("<li />").addClass("active").append(n("<a />").html(t.CurrentPage).attr("href","javascript:;").attr("data-index",t.CurrentPage))),t.NextPages.length>0)for(f=0;f<t.NextPages.length;f++)i.append(n("<li />").append(n("<a />").html(t.NextPages[f]).attr("href","javascript:;").attr("data-index",t.NextPages[f])));t.NextPage!=""?i.append(n("<li />").append(n("<a />").html("&raquo;").attr("href","javascript:;").attr("data-index",t.NextPage))):i.append(n("<li />").addClass("disabled").append(n("<a />").html("&raquo;").attr("href","javascript:;").attr("data-index","")));i.appendTo(r._$vvnav);i.find("a").not(".disabled").on("click",function(t){t.preventDefault();t.stopPropagation();r._changeVVPageIndex(n(this).attr("data-index"));r._reloadVV()})}},_notFoundValidTicket:function(){var t=this;n("<div />").addClass("alert alert-danger").html("<strong>Không tồn tại vé valid.<\/strong>").appendTo(t._$vvsheet)},_changeVVPageIndex:function(n){this._cVVPageIndex=parseInt(n)},_lrenderSeatTemplate:function(){var t=this,c,f,o;t._clearSheet();var s=n(_dict._lTpl),e=s.find("tbody"),r=1,h=t._hasBookingPermission(),l=t._data[t._cTripIndex].StopPoints,i=null,u=null;for(n.each(t._m,function(f,o){typeof o!="undefined"&&n.each(o,function(f,o){typeof o!="undefined"&&n.each(o,function(f,o){if(typeof o!="undefined"&&o!=null&&o._hasTicket())if(app.oRights.StageEnable)n.each(o._tickets,function(f,c){i=c;n.isEmptyObject(i)||typeof t._cphoneSt[i._getDefaultPhoneNumber()]=="undefined"||(s=t._cphoneSt[i._getDefaultPhoneNumber()].length);var a=t._renderStageName(i.stageCode,l);u=o._renderLSeat(s,r,h,i,a);t._bindEventOnSeat(u,o);e.append(u);r++});else{i=o._getCurrentTicket();var s=0;n.isEmptyObject(i)||typeof t._cphoneSt[i._getDefaultPhoneNumber()]=="undefined"||(s=t._cphoneSt[i._getDefaultPhoneNumber()].length);u=o._renderLSeat(s,r,h);t._bindEventOnSeat(u,o);e.append(u);r++}})})}),c=e.children(),f=c.get(),f.sort(function(t,i){var r=parseInt(n(t).attr("data-issue")),u=parseInt(n(i).attr("data-issue"));return u-r}),r=1,o=0;o<f.length;o++)n(f[o]).find(".index").text(r),r++;e.append(f);t._$sheet.append(s);t._bindEventOnListSeat()},_bindEventOnListSeat:function(){var n=this,t=n._$sheet;t.find("button.btn-print-list").on("click",function(t){t.preventDefault();n._printBKS("in-danh-sach")})},_lrenderCancelledTicket:function(){var t=this,o,r,u;if(t._c.length>0){t._$cancelSheet.append(n("<h4 />").addClass("sheet-title").html("Vé đã hủy"));var e=n(_dict._cancelListTpl),f=e.find("tbody"),i=1,s=t._hasBookingPermission();for(n.each(t._c,function(r,u){typeof u!="undefined"&&u!=null&&n.each(u,function(r,u){var e,o,h;typeof u!="undefined"&&u!=null&&u._hasTicket()&&(e=u._getCurrentTicket(),e._type!=2&&e._cancelType!=4&&(o=0,n.isEmptyObject(e)||typeof t._cphoneSt[e._getDefaultPhoneNumber()]=="undefined"||(o=t._cphoneSt[e._getDefaultPhoneNumber()].length),h=u._renderLSeat(o,i,s),t._bindEventOnSeat(h,u),f.append(h),i++))})}),o=f.children(),r=o.get(),r.sort(function(t,i){var r=parseInt(n(t).attr("data-issue")),u=parseInt(n(i).attr("data-issue"));return u-r}),i=1,u=0;u<r.length;u++)n(r[u]).find(".index").text(i),i++;f.append(r);t._$cancelSheet.append(e)}},_renderPickupTicket:function(){var u=this;u._clearSheet();u._clearCancelled();var t=[],i=[],e=[],r=[],o=0;n.each(u._m,function(u,f){typeof f!="undefined"&&n.each(f,function(u,f){typeof f!="undefined"&&n.each(f,function(u,f){var s,k,d,l,g,a,nt,v,tt,y;if(typeof f!="undefined"&&f!=null&&f._hasTicket()&&(s=f._getCurrentTicket(),!n.isEmptyObject(s)&&(k=s._getPickupInfo(),!n.isEmptyObject(k)&&vIsEstStr(k.text)&&k.type=="P"))){var p=s._code,w=s._cname,c=s._getDefaultPhoneNumber(),h=parseInt(k.pIndex),b=k.text;isNaN(h)&&(h=0);typeof t[h]=="undefined"&&(t[h]=[]);h==0?typeof _dict._allowGroupByCode!="undefined"&&_dict._allowGroupByCode?(d=(p+"|"+b+"|"+w+"|"+c+"|"+s._note+"|"+s._status).hashCode(),l=r.indexOf(d),l==-1&&(l=r.push(d)-1),typeof i[l]=="undefined"&&(i[l]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_seri:s._seri,_cname:w,_cphone:c,_code:p,_pText:b,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0}),i[l]._seatCodes.push(f._label),i[l]._seatInfos.push(f._getSeatInfo()),i[l]._tids.push(s._id),i[l]._pdate.push(s._pdate.toFormatString("iso")),i[l]._total+=s._fare):vIsEstStr(c)?(g=(p+"|"+b+"|"+w+"|"+c+"|"+s._note+"|"+s._status).hashCode(),a=r.indexOf(g),a==-1&&(a=r.push(g)-1),typeof i[a]=="undefined"&&(i[a]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_seri:s._seri,_cname:w,_cphone:c,_code:p,_pText:b,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0}),i[a]._seatCodes.push(f._label),i[a]._seatInfos.push(f._getSeatInfo()),i[a]._tids.push(s._id),i[a]._pdate.push(s._pdate.toFormatString("iso")),i[a]._total+=s._fare):e.push({_pIndex:h,_seatCodes:[f._label],_seatInfos:[f._getSeatInfo()],_tids:[s._id],_cname:w,_seri:s._seri,_cphone:c,_code:p,_pText:b,_note:s._note,_pdate:[s._pdate.toFormatString("iso")],_status:s._status,_cuser:s._cuser,_total:s._fare}):(typeof t[h]=="undefined"&&(t[h]=[]),typeof _dict._allowGroupByCode!="undefined"&&_dict._allowGroupByCode?(nt=(p+"|"+b+"|"+w+"|"+c+"|"+s._note+"|"+s._status).hashCode(),v=r.indexOf(nt),v==-1&&(v=r.push(nt)-1),typeof t[h][v]=="undefined"&&(t[h][v]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_cname:w,_seri:s._seri,_cphone:c,_code:p,_pText:b,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0}),t[h][v]._seatCodes.push(f._label),t[h][v]._seatInfos.push(f._getSeatInfo()),t[h][v]._tids.push(s._id),t[h][v]._pdate.push(s._pdate.toFormatString("iso")),t[h][v]._total+=s._fare):(tt=(p+"|"+b+"|"+w+"|"+c+"|"+s._note+"|"+s._status).hashCode(),y=r.indexOf(tt),y==-1&&(y=r.push(tt)-1),typeof t[h][y]=="undefined"&&(t[h][y]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_cname:w,_seri:s._seri,_cphone:c,_code:p,_pText:b,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0}),t[h][y]._seatCodes.push(f._label),t[h][y]._seatInfos.push(f._getSeatInfo()),t[h][y]._tids.push(s._id),t[h][y]._pdate.push(s._pdate.toFormatString("iso")),t[h][y]._total+=s._fare));o+=s._fare}})})});t[0]=_dict._allowGroupByCode!=undefined&&_dict._allowGroupByCode?i:i.concat(e);var h=[u._cTripTime],f=n(vtpl(_dict._puTpl,{t:{_timeSlots:h.join(),_total:o.toMn()+"đ"}})),s=f.find("tbody");t.length>0&&n.each(t,function(t,i){i!=undefined&&(_dict._allowGroupByCode!=undefined&&_dict._allowGroupByCode?Object.keys(i).forEach(function(t){var r=i[t],u={seat:{_index:r._pIndex,_cname:r._cname,_code:r._code,_cphone:r._cphone,_pText:r._pText,_seri:r._seri,_note:r._note,_seatCodes:r._seatCodes.join(", "),_seatInfos:r._seatInfos.join(),_tids:r._tids.join(),_pdate:r._pdate.join(),_status:r._status==1?"Đặt chỗ":"Đã thanh toán",_total:r._total.toMn()+"đ"}},f;r._pIndex>0&&(u.seat._class="sorted");f=n(vtpl(_dict._ipuTpl,u));s.append(f)}):n.each(i,function(t,i){var r,u;i!=undefined&&(r={seat:{_index:i._pIndex,_cname:i._cname,_code:i._code,_cphone:i._cphone,_pText:i._pText,_seri:i._seri,_note:i._note,_seatCodes:i._seatCodes.join(", "),_seatInfos:i._seatInfos.join(),_tids:i._tids.join(),_pdate:i._pdate.join(),_status:i._status==1?"Đặt chỗ":"Đã thanh toán",_total:i._total.toMn()+"đ"}},i._pIndex>0&&(r.seat._class="sorted"),u=n(vtpl(_dict._ipuTpl,r)),s.append(u))}))});u._hasBookingPermission()||(f.find("input.pIndex").prop("disabled",!0),f.find("button.btn-order").remove());u._$sheet.append(f);u._bindEventOnPickUpTicket()},_bindEventOnPickUpTicket:function(){var t=this;n("input.pIndex",".plist").focus(function(){n(this).select()}).mouseup(function(n){n.preventDefault()});t._$sheet.find(".plist button").each(function(i,r){n(r).hasClass("btn-order")?vev(r,"click",function(i){var o,u,f;i.preventDefault();var e=n(".plist tbody"),s=e.children(),r=s.get();for(r.sort(function(t,i){var r=parseInt(n(t).find("input.pIndex").val()),u=parseInt(n(i).find("input.pIndex").val());return r-u}),o=1,u=0;u<r.length;u++)if(f=parseInt(n(r[u]).find("input.pIndex").val()),isNaN(f)&&(f=0),f==0)continue;else n(r[u]).find("input.pIndex").val(o),o++;return e.append(r),e.find("tr").addClass("sorted"),t._orderPickupInfo(),!1}):n(r).hasClass("btn-print-list")&&vev(r,"click",function(n){n.preventDefault();t._printPickupTicket()})})},_orderPickupInfo:function(){var n=this,t=n._createOrderPickUpObj(),i;!1!=t&&(i=function(t){t==1&&n._reloadSheet()},n._submitAsyncAction(t,i))},_createOrderPickUpObj:function(){var i=this,t=!1,r=i._$sheet.find("table.list-ticket input.pIndex");return r.length>0&&(t={},t._a="UpdateBookTicket",t._c=[],t._d=[],n.each(r,function(u,f){for(var h,c,e=n(f).closest("tr"),s=e.attr("data-seatinfos").split(","),l=e.attr("data-pdate").split(","),a=e.attr("data-ids").split(","),v=e.attr("data-code"),y=e.attr("data-pText")+"||"+n(r[u]).val(),o=0;o<s.length;o++)h=parseInt(a[o]),t._c.push({Id:h,TripId:i._cTripId,SeatCode:s[o],PickupDate:l[o],Bus:i._cTripBus}),c={PickupInfo:y,Code:v},t._d.push(c)})),t},_hasMergeTransfer:function(){var n=this,t=!1;return typeof _dict._hasMergeTransfer!="undefined"&&typeof _dict._hasMergeTransfer[n._cTripId]!="undefined"&&(t=_dict._hasMergeTransfer[n._cTripId]),t},_reloadMergeTransferTicket:function(){var n=this,t=n._createGetMergeTransferTicketObj(),i=function(t,i,r){t==1&&r>0&&n._mapMergeTransferTicket(i)};n._submitAction(t,i)},_createGetMergeTransferTicketObj:function(){var t=this,i=t._getDepartureTime(),n={};return n._a="fGetTicket",n._c={TripId:t._cTripId,TripDate:"convert(nvarchar(10), $x, 103) = '"+i.toFormatString("dd/mm/yyyy")+"'",PickupInfo:"($x is not null and SUBSTRING($x, CHARINDEX('|', $x) + 1, CHARINDEX('|', substring($x, charindex('|', $x) + 1, len($x))) - 1) != '')",Status:"(($x) IN("+_dict._mtks.join()+"))"},n._f=_dict._tgF.join(),n},_mapMergeTransferTicket:function(t){var i=this;i._transfer=[];n.each(t,function(t,r){var h=i._createTicketFromRecord(r),e;if(!n.isEmptyObject(h)){var o=r[4].split("|"),c=n.trim(o[0]),u=parseInt(o[1]),f=parseInt(o[2]),s=parseInt(o[3]);isNaN(u)||isNaN(f)||isNaN(s)||(typeof i._transfer[u-1]=="undefined"&&(i._transfer[u-1]=[]),typeof i._transfer[u-1][f-1]=="undefined"&&(i._transfer[u-1][f-1]=[]),e=i._transfer[u-1][f-1][s-1],typeof e=="undefined"&&(e=new S(u,f,s,1,"seat",c,2),i._transfer[u-1][f-1][s-1]=e),e!=null&&e._addTicket(h))}})},_getTimeByDept:function(n){var t=n.getHours(),i=n.getMinutes();return t.toString().length==1&&(t="0"+t),i.toString().length==1&&(i="0"+i),t+":"+i},_getHtmlTransfer:function(t,i){t.length>0&&n.each(t,function(t,r){if(typeof r!="undefined"&&r!=null){var u={seat:{_index:r._pIndex,_cname:r._cname,_cphone:r._cphone,_pText:r._pText,_note:r._note,_seatCodes:r._seatCodes.join(", "),_seatInfos:r._seatInfos.join(),_tids:r._tids.join(),_pdate:r._pdate.join(),_status:r._status==1?"Đặt chỗ":"Đã thanh toán",_total:r._total.toMn()+"đ",_time:r._time,_numSeat:r._seatCodes.length,_driverName:r._driverName!=""?r._driverName:r._time}};i.append(n(vtpl(_dict._itsfTpl,u)))}})},_isInTimeStage:function(n,t){var r=t.split("-"),u=r[0].split(":"),f=u[0],c=u[1],e=r[1].split(":"),o=e[0],l=e[1],s=n.split(":"),i=s[0],h=s[1];return parseInt(i)<parseInt(f)?!1:parseInt(i)>parseInt(o)?!1:parseInt(i)==parseInt(f)?parseInt(h)>=parseInt(c)?!0:!1:parseInt(i)==parseInt(o)?parseInt(h)<=parseInt(l)?!0:!1:!0},_renderTransferTicket:function(){var t=this,o=[],s=!1,h,f,c;if(typeof _dict._hasTransferTimeConf!="undefined"&&n.each(_dict._hasTransferTimeConf,function(n,i){if(t._isInTimeStage(t._cTripTime,i))return s=!0,!0}),h=t._m,t._hasMergeTransfer()&&typeof _dict._hasTransferTimeConf!="undefined"&&s&&(h=t._transfer),h.length>0){var r=[],i=[],v=[],u=[],p=0,y=0;if(n.each(h,function(f,e){typeof e!="undefined"&&n.each(e,function(f,e){typeof e!="undefined"&&n.each(e,function(f,e){typeof e!="undefined"&&e!=null&&e._hasTicket()&&n.each(e._tickets,function(f,o){var rt={},g="",s=o,tt,ot,st,ut,c,ft,l,et,a;if(!n.isEmptyObject(s)){var nt=s._getPickupInfo(),d=t._getTimeByDept(s._dept),ht=s.tripId;if(n.isEmptyObject(rt)&&n.each(t._data,function(n,t){t.Id==ht&&(rt=t)}),rt.Ts[d]!=undefined&&(tt=rt.Ts[d][0],tt.Dr!=null&&(ot=tt.Dr.indexOf("~"),st=tt.Dr.substr(ot,tt.Dr.length).split("|"),g=st[2])),!n.isEmptyObject(nt)&&vIsEstStr(nt.text)&&nt.type=="T"){var it=s._code,b=s._cname,w=s._getDefaultPhoneNumber(),h=parseInt(nt.pIndex),k=nt.text;isNaN(h)&&(h=0);typeof r[h]=="undefined"&&(r[h]=[]);h==0?typeof _dict._allowGroupByCode!="undefined"&&_dict._allowGroupByCode?(ut=(it+"|"+k+"|"+b+"|"+w+"|"+s._note+"|"+s._status).hashCode(),c=u.indexOf(ut),c==-1&&(c=u.push(ut)-1),typeof i[c]=="undefined"&&(i[c]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_cname:b,_cphone:w,_code:it,_pText:k,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0,_time:d,_driverName:g}),i[c]._seatCodes.push(e._label),i[c]._seatInfos.push(e._getSeatInfo()),i[c]._tids.push(s._id),i[c]._pdate.push(s._pdate.toFormatString("iso")),i[c]._total+=s._fare):vIsEstStr(w)?(ft=(k+"|"+b+"|"+w+"|"+s._note+"|"+s._status).hashCode(),l=u.indexOf(ft),l==-1&&(l=u.push(ft)-1),typeof i[l]=="undefined"&&(i[l]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_cname:b,_cphone:w,_code:it,_pText:k,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0,_time:d,_driverName:g}),i[l]._seatCodes.push(e._label),i[l]._seatInfos.push(e._getSeatInfo()),i[l]._tids.push(s._id),i[l]._pdate.push(s._pdate.toFormatString("iso")),i[l]._total+=s._fare):v.push({_pIndex:h,_seatCodes:[e._label],_seatInfos:[e._getSeatInfo()],_tids:[s._id],_cname:b,_cphone:w,_code:it,_pText:k,_note:s._note,_pdate:[s._pdate.toFormatString("iso")],_status:s._status,_cuser:s._cuser,_total:s._fare,_time:d,_driverName:g}):(typeof r[h]=="undefined"&&(r[h]=[]),et=(k+"|"+b+"|"+w+"|"+s._note+"|"+s._status).hashCode(),a=u.indexOf(et),a==-1&&(a=u.push(et)-1),typeof r[h][a]=="undefined"&&(r[h][a]={_pIndex:h,_seatCodes:[],_seatInfos:[],_tids:[],_code:it,_cname:b,_cphone:w,_pText:k,_note:s._note,_pdate:[],_status:s._status,_cuser:s._cuser,_total:0,_time:d,_driverName:g}),r[h][a]._seatCodes.push(e._label),r[h][a]._seatInfos.push(e._getSeatInfo()),r[h][a]._tids.push(s._id),r[h][a]._pdate.push(s._pdate.toFormatString("iso")),r[h][a]._total+=s._fare);y++;p+=s._fare}}})})})}),r[0]=_dict._allowGroupByCode!=undefined&&_dict._allowGroupByCode?i:i.concat(v),f=[],t._hasMergeTransfer()&&typeof _dict._hasTransferTimeConf!="undefined"&&s?n.each(t._data[t._cTripIndex].Ts,function(n){f.push(n)}):f.push(t._cTripTime),c=0,typeof _dict._hasTransferTimeConf!="undefined"&&s)n.each(_dict._hasTransferTimeConf,function(i,u){var e={},s=[],h=[],l=0;n.each(f,function(n,i){t._isInTimeStage(i,u)&&s.push(i)});n.each(r,function(t,i){typeof i!="undefined"&&n.each(i,function(n,t){typeof t!="undefined"&&t!=null&&s.indexOf(t._time)!=-1&&(h.push(t),l+=t._total)})});e._times=s;e._items=h;e._total=l;e._index=c;o.push(e);c++});else{var e={},w=f,l=[],a=0;n.each(r,function(t,i){typeof i!="undefined"&&(_dict._allowGroupByCode!=undefined&&_dict._allowGroupByCode?Object.keys(i).forEach(function(n){var t=i[n];l.push(t);a+=t._total}):n.each(i,function(n,t){typeof t!="undefined"&&t!=null&&(l.push(t),a+=t._total)}))});e._times=w;e._items=l;e._total=a;e._index=c;o.push(e)}t._$transfer=o;n.each(o,function(i,r){var u=n(vtpl(_dict._tsfTpl,{t:{_timeSlots:r._times.join(", "),_total:r._total.toMn()+"đ",_index:r._index,_totalSeat:y}})),f=u.find("tbody");t._getHtmlTransfer(r._items,f);t._$sheet.append(u);t._hasBookingPermission()||(u.find("input.tIndex").prop("disabled",!0),u.find("button.btn-order").remove())});t._bindEventOnTransferTicket()}},_bindEventOnTransferTicket:function(){var t=this;n("input.tIndex",".tlist").focus(function(){n(this).select()}).mouseup(function(n){n.preventDefault()});t._$sheet.find(".tlist button").each(function(i,r){n(r).hasClass("btn-order")?vev(r,"click",function(i){var o,u,f;i.preventDefault();var e=n(this).closest("table").find("tbody"),s=e.children(),r=s.get();for(r.sort(function(t,i){var r=parseInt(n(t).find("input.tIndex").val()),u=parseInt(n(i).find("input.tIndex").val());return r-u}),o=1,u=0;u<r.length;u++)if(f=parseInt(n(r[u]).find("input.tIndex").val()),isNaN(f)&&(f=0),f==0)continue;else n(r[u]).find("input.tIndex").val(o),o++;return e.append(r),e.find("tr").addClass("sorted"),t._orderTransferInfo(),!1}):n(r).hasClass("btn-print-list")&&vev(r,"click",function(i){i.preventDefault();t._printTransferTicket(n(this).attr("data-group-index"))})})},_orderTransferInfo:function(){var n=this,t=n._createOrderTransferObj(),i;!1!=t&&(i=function(t){t==1&&n._reloadSheet()},n._submitAsyncAction(t,i))},_createOrderTransferObj:function(){var i=this,t=!1,r=i._$sheet.find("table.list-ticket input.tIndex");return r.length>0&&(t={},t._a="UpdateBookTicket",t._c=[],t._d=[],n.each(r,function(u,f){for(var h,c,o=n(f).closest("tr"),s=o.attr("data-seatinfos").split(","),l=o.attr("data-pdate").split(","),a=o.attr("data-ids").split(","),v="|"+o.attr("data-tText")+"|"+n(r[u]).val(),e=0;e<s.length;e++)h=parseInt(a[e]),t._c.push({Id:h,TripId:i._cTripId,SeatCode:s[e],PickupDate:l[e],Bus:i._cTripBus}),c={PickupInfo:v},t._d.push(c)})),t},_showMultiticketBar:function(n){var t=this;t._$multiBar.find("nav").append(n._renderMultiTicketSeat());t._$multiBar.show()}})})(jQuery);
//# sourceMappingURL=p.min.js.map
