define({_initFromAndToArea:function(n){var u=this,h=u.o,c=u.view,t,e,i,f,r,s,o;if(h.gId=="fareTableContainer"){if(n==0){u._clearFareForm();return}for(t=n?vGetObj({Id:n},u.remoteModels):u.remoteModels[0],t.arrArea=vGas(t.RouteInfo),t.arrFare=app.rights.indexOf($.rights.mFare_cfOnlFare.val)>=0?vIsEstStr(t.VxrFareInfo)?vGfs(t.arrArea,t.VxrFareInfo):vGfs(t.arrArea,t.FareInfo):vIsEstStr(t.FareInfo)?vGfs(t.arrArea,t.FareInfo):vGfs(t.arrArea,t.FareInfo),e=$("#fare-table").find("tbody"),e.empty(),i=0;i<t.arrArea.length-1;i++)for(f=i+1;f<t.arrArea.length;f++)r=$("<tr />"),r.html(u._getNewRow()),r.find(".from-area-id").attr("data-id",t.arrArea[i].Id).val(t.arrArea[i].Name),r.find(".to-area-id").attr("data-id",t.arrArea[f].Id).val(t.arrArea[f].Name),s=t.arrArea[i].Id+"|"+t.arrArea[f].Id,o=vGetObj({Code:s},t.arrFare),o!=null?r.find("input.routeFare").val(o.Fare):r.find("input.routeFare").val(0),e.append(r)}},_mapDataOfFare:function(n){var y=this,u,f,t,h,c,i,l,e,r,a,o,s,v;return u=n,e=[],i=[],t=u.RouteInfo,t||(t=""),r=t.indexOf("~"),r>=0&&(t=t.substring(r+1),c=t.split("~"),$.each(c,function(n,t){l=vGdi(t,"|",0);i[l]=vGdi(t,"|",3)})),f=u.FareInfo,r=f.indexOf("~"),r>=0&&(f=f.substring(r+1),h=f.split("~"),$.each(h,function(n,t){o=vGdi(t,"|",0);s=vGdi(t,"|",1);v=vGdi(t,"|",2);i[o]&&i[s]&&(a={Id:u.Id,Name:u.Name,FromArea:i[o],ToArea:i[s],Fare:v},e.push(a))})),e},_getNewRow:function(){var t=this,n={cols:3,items:t.o.fareRow};return vv.initObjs(n),vv.getBodyHtml(n)},_initOptionRoute:function(n){var r=this,u=r.view,i=u.find("select.route"),t;i.empty();t=n.gtArr({Type:1},!1);t=[{Id:0,Name:"Chọn chuyến"}].concat(t);$.each(t,function(n,t){$.vCheckAndAppendOptions(i,t.Id,t.Name,"R")})},_clearFareForm:function(){var t=this,n=t.view;t.model=[];$(n).find("#fare-table").find("tbody").empty().append($("<tr >").html(t._getNewRow()));$(n).find(".route").val(0);$(n).find(".hasDatepicker").val("");$(n).find(".discounts").val(0);$(n).find("select.route").prop("disabled",!1).val(0);$(n).find(".dateStop").datepicker("enable");t.onBasicClear()},onBeginSelectionChange:function(n,t){vv.enableItem(n,"button.delete",t!=null)},onItemLoaded:function(){var t=this,n=t.view,i;t._initFromAndToArea(t.model.Id);i=t.remoteModels.gtArr({Type:1,Name:t.model.Name},!1);i&&i.length>0?n.find("select.route").val(i[0].Id):n.find("select.route").val(0);setTimeout(function(){$(n).find(".dateStop").datepicker("disable");$(n).find("input.from-area-id").prop("disabled","disabled");$(n).find("input.to-area-id").prop("disabled","disabled");$(n).find("select.route").prop("disabled","disabled")},0)},onAfterUnloadItem:function(){var n=this.view;$(n).find("select.route").prop("disabled",!1);this._clearFareForm()},onUpdateSuccess:function(n){var t=this;t.onRouteChange();$("select.route option").prop("selected",!1).filter('[value="'+n+'"]').prop("selected",!0)},afterReload:function(n){var i=this,t=i.view;i.remoteModels=vSort("Type",!1,n);i._initOptionRoute(n);$(t).find("button.applyDiscount").unbind().on("click",function(){var n=parseInt($(t).find(".discounts").val()),i;!isNaN(n)&&n<100?(i=$(t).find("#fare-table").find("tbody").find(".routeFare"),$.each(i,function(t,i){var r=$(i).val(),u;isNaN(r)?r=0:(u=parseInt(r),r=Math.round(u*(100-n)/1e5)*1e3);$(i).val(r)})):$(t).find(".discounts").val(0)})},onRouteChange:function(){var n=this,i=n.o,t=parseInt($("select.route :selected").val());n._initFromAndToArea(t)},onDeleteFare:function(){var t=this,i=t.view,r=parseInt($(i).find("select.route :selected").val()),n=t.remoteModels.gtArr({Id:r},!1),u="",f="1",e="",o;n&&n.length>0&&(u=n[0].Name,f=n[0].RouteInfo,e=n[0].FareInfo);o=$(i).find("input.dateStart").val();vIsEstStr(o)?t._deleteFare(r,u,f,e,3):(vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Bạn không thể xóa giá ngày thường."}),t._clearFareForm())},onFareClear:function(){this._clearFareForm()},onSaveFare:function(){var n=this,i=n.view,u=parseInt($(i).find("select.route :selected").val()),t=n.remoteModels.gtArr({Id:u},!1),f="",e="1",o=[],s,r,h;if(t&&t.length>0&&(f=t[0].Name,e=t[0].RouteInfo,vIsEstStr(t[0].Info)&&(o=t[0].Info.split("~"))),s=$(i).find("#fare-table tbody").find("tr"),r="1",$.each(s,function(n,t){var u=$(t).find("input.from-area-id").attr("data-id"),f=$(t).find("input.to-area-id").attr("data-id"),i=$(t).find("input.routeFare").val();i&&vIsEstStr(i)&&!isNaN(parseInt(i))||(i=0);r+="~"+u+"|"+f+"|"+i+"|đ||"}),$(i).find("input.fare-info").val(r),h=$(i).find("input.dateStart").val(),vIsEstStr(h))n._saveFare(u,f,e,r,o,1);else{n.model={Id:u};n.onBasicSave(null,null,function(){n._clearFareForm();n._reloadTable()})}},_saveFare:function(n,t,i,r,u,f){var h=this,o=h.view,y=$(o).find("input.dateStart").val(),c=$(o).find("input.dateStop").val(),s=$(o).find("input.discounts").val(),e,v,w;isNaN(s)&&(s=0);var l=[],a=[],p=!0;if(moment(y,"DD-MM-YYYY").isValid())if(e=moment(y,"DD-MM-YYYY"),vIsEstStr(c)&&moment(c,"DD-MM-YYYY").isValid())for(v=moment(c,"DD-MM-YYYY");e.isBefore(v)||e.isSame(v);)$.each(u,function(i,u){l.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),CompId:app.cid,Time:u});a.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),FareInfo:r,Name:t,CompId:app.cid,Discount:s,IsPrgStatus:f,Time:u})}),e=e.add(1,"d");else $.each(u,function(i,u){l.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),CompId:app.cid,Time:u});a.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),FareInfo:r,CompId:app.cid,Name:t,Discount:s,IsPrgStatus:f,Time:u})});else p=!1;p?(w={_a:"UpdateFareInfo",_c:l,_d:a},vRqs(w,function(n){n?(vv.showMessage({element:o.find(".alert.message"),type:"alert-success",content:"Thao tác thành công."}),h._clearFareForm(),h._reloadTable()):vv.showMessage({element:o.find(".alert.message"),type:"alert-danger",content:"Thao tác thất bại."})})):vv.showMessage({element:o.find(".alert.message"),type:"alert-danger",content:"Thông tin bạn nhập không đúng."})},_deleteFare:function(n,t,i,r,u){var e=this,f=e.view,o=$(f).find("input.dateStart").val(),s=[],h=[],c=!0,l,a;moment(o,"DD-MM-YYYY").isValid()?(l=moment(o,"DD-MM-YYYY"),s.push({Type:2,BaseId:n,Date:l.format("YYYY-MM-DD"),CompId:app.cid}),h.push({FareInfo:r,Discount:0,IsPrgStatus:u})):c=!1;c?(a={_a:"UpdateFareInfo",_c:s,_d:h},vRqs(a,function(n){n?(vv.showMessage({element:f.find(".alert.message"),type:"alert-success",content:"Thao tác thành công."}),e._clearFareForm(),e._reloadTable()):vv.showMessage({element:f.find(".alert.message"),type:"alert-danger",content:"Thao tác thất bại."})})):vv.showMessage({element:f.find(".alert.message"),type:"alert-danger",content:"Thông tin bạn nhập không đúng."})},onSaveVxrFare:function(){var i=this,t=i.view,u=parseInt($(t).find("select.route :selected").val()),n=i.remoteModels.gtArr({Id:u},!1),f="",e="1",o=[],s,r,h;n&&n.length>0&&(f=n[0].Name,e=n[0].RouteInfo,vIsEstStr(n[0].Info)&&(o=n[0].Info.split("~")));s=$(t).find("#fare-table tbody").find("tr");r="1";$.each(s,function(n,t){var u=$(t).find("input.from-area-id").attr("data-id"),f=$(t).find("input.to-area-id").attr("data-id"),i=$(t).find("input.routeFare").val();i&&vIsEstStr(i)&&!isNaN(parseInt(i))||(i=0);r+="~"+u+"|"+f+"|"+i+"|đ||"});$(t).find("input.fare-info").val(r);h=$(t).find("input.dateStart").val();vIsEstStr(h)?i._saveVxrFare(u,f,e,r,o,1):(vv.showMessage({element:t.find(".alert.message"),type:"alert-danger",content:"Bạn không thể cập nhật giá vé ngày thường."}),i._clearFareForm())},_saveVxrFare:function(n,t,i,r,u,f){var h=this,o=h.view,y=$(o).find("input.dateStart").val(),c=$(o).find("input.dateStop").val(),s=$(o).find("input.discounts").val(),e,v,w;isNaN(s)&&(s=0);var l=[],a=[],p=!0;if(moment(y,"DD-MM-YYYY").isValid())if(e=moment(y,"DD-MM-YYYY"),vIsEstStr(c)&&moment(c,"DD-MM-YYYY").isValid())for(v=moment(c,"DD-MM-YYYY");e.isBefore(v)||e.isSame(v);)$.each(u,function(i,u){l.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),CompId:app.cid,Time:u});a.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),VxrFareInfo:r,Name:t,CompId:app.cid,VxrDiscount:s,IsPrgStatus:f,Time:u})}),e=e.add(1,"d");else $.each(u,function(i,u){l.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),CompId:app.cid,Time:u});a.push({Type:2,BaseId:n,Date:e.format("YYYY-MM-DD"),VxrFareInfo:r,CompId:app.cid,Name:t,VxrDiscount:s,IsPrgStatus:f,Time:u})});else p=!1;p?(w={_a:"UpdateFareInfo",_c:l,_d:a},vRqs(w,function(n){n?(vv.showMessage({element:o.find(".alert.message"),type:"alert-success",content:"Thao tác thành công."}),h._clearFareForm(),h._reloadTable()):vv.showMessage({element:o.find(".alert.message"),type:"alert-danger",content:"Thao tác thất bại."})})):vv.showMessage({element:o.find(".alert.message"),type:"alert-danger",content:"Thông tin bạn nhập không đúng."})},onDelVxrFare:function(){var n=this,i=n.view,r=parseInt($(i).find("select.route :selected").val()),t=n.remoteModels.gtArr({Id:r},!1),u="",f="1",e;t&&t.length>0&&(u=t[0].Name,f=t[0].RouteInfo);e=$(i).find("input.dateStart").val();vIsEstStr(e)?n._deleteVxrFare(r,u,f,"",3):(vv.showMessage({element:i.find(".alert.message"),type:"alert-danger",content:"Bạn không thể xóa giá ngày thường."}),n._clearFareForm())},_deleteVxrFare:function(n,t,i,r,u){var e=this,f=e.view,o=$(f).find("input.dateStart").val(),s=[],h=[],c=!0,l,a;moment(o,"DD-MM-YYYY").isValid()?(l=moment(o,"DD-MM-YYYY"),s.push({Type:2,BaseId:n,Date:l.format("YYYY-MM-DD"),CompId:app.cid}),h.push({VxrFareInfo:r,VxrDiscount:0,IsPrgStatus:u})):c=!1;c?(a={_a:"UpdateFareInfo",_c:s,_d:h},vRqs(a,function(n){n?(vv.showMessage({element:f.find(".alert.message"),type:"alert-success",content:"Thao tác thành công."}),e._clearFareForm(),e._reloadTable()):vv.showMessage({element:f.find(".alert.message"),type:"alert-danger",content:"Thao tác thất bại."})})):vv.showMessage({element:f.find(".alert.message"),type:"alert-danger",content:"Thông tin bạn nhập không đúng."})},onFromAreaChange:function(n,t){var u=this,c=parseInt($("select.route :selected").val()),r=vGetObj({Id:c},u.listBase),f=vGetObj({ref:".to-area-id"},gDx(u.o)),o=t.val(),e,i;for(n.find(f.ref).empty(),e=!1,i=0;i<r.arrArea.length;i++)e&&$.vCheckAndAppendOptions(n.find(f.ref),r.arrArea[i].Id,r.arrArea[i].Name,"R"),r.arrArea[i].Id==o&&(e=!0);var s=vGetObj({ref:"input.fare"},gDx(u.o)),l=r.arrFare,a=n.find(f.ref).val(),v=o+"|"+a,h=vGetObj({Code:v},l);h!=null?n.find(s.ref).val(vToMn(h.Fare)):n.find(s.ref).val("")},onToAreaChange:function(n){var t=this,u=parseInt($("select.route :selected").val()),f=vGetObj({Id:u},t.listBase),e=vGetObj({ref:".from-area-id"},gDx(t.o)),o=vGetObj({ref:".to-area-id"},gDx(t.o)),s=n.find(e.ref).val(),i=vGetObj({ref:"input.fare"},gDx(t.o)),h=f.arrFare,c=n.find(o.ref).val(),l=s+"|"+c,r=vGetObj({Code:l},h);r!=null?n.find(i.ref).val(vToMn(r.Fare)):n.find(i.ref).val("")},gDisFare:function(n){return vToMn(n.record.Fare)},gDisDiscount:function(n){return app.rights.indexOf($.rights.mFare_cfOnlFare.val)>=0?n.record.VxrDiscount:n.record.Discount},gDisDate:function(n){var i=n.record.Date,t;return vIsEstStr(i)?(t=vGtDtObj(i),t)?vDtToStr("dd-mm-yyyy",t):"":"Giá ngày thường"},rvcFare:function(n,t){return vToMn(t)}});
//# sourceMappingURL=p.min.js.map
