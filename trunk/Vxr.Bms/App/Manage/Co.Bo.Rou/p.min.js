define({_loadUtility:function(n){var e=this,r,u,f,t,i;if(e._unloadUtility(),vIsEstStr(n)&&(r=n.indexOf("~"),r>=0))for(n=n.substring(r+1),u=n.split("~"),i=0;i<u.length;i++){f=parseInt(u[i]);switch(f){case 1:t="input.water";break;case 2:t="input.towel";break;case 3:t="input.toilet";break;case 4:t="input.dvd";break;case 5:t="input.condition";break;case 6:t="input.rug";break;case 7:t="input.food";break;case 8:t="input.wifi";break;default:t=""}f>0&&$(t).prop("checked",!0)}},_unloadUtility:function(){var n=$("#utility-form input");$.each(n,function(n,t){$(t).prop("checked",!1)})},_unloadRouteTable:function(){var u=this,r=document.getElementById("route-table"),n,i,t;if(r){for(n=r.rows,i=n.length-2;i>1;i--)r.deleteRow(i);for(t=1;t<n.length;t++)cell=$(n[t]).find(".city").find("option"),cell.find(":selected").prop("selected",!1),cell.filter('[value="-1"]').prop("selected",!0),$(n[t]).find("input.point-code").val("");u.onCityChange()}},_getRouteStopItems:function(n,t,i){var u=this,f=[],r={items:[]};return $.each(u.o.routeStopRow,function(n,t){r[n]=t}),$.each(u.o.routeStopItems,function(n,u){i.push(u.items[0]);(u.items[0].name=="btnAddRouteStop"||u.items[0].name=="btnDelRouteStop")&&(u.row=t);typeof u.items[1]!="undefined"&&u.items[1].name=="btnDelRouteStop"&&(u.row=t,i.push(u.items[1]));r.items.push(u)}),f.push(r),f},_getNewRow:function(n,t){var i=this,r={cols:12,items:i._getRouteStopItems(i.o.routeStopItems,n,t)};return vv.initObjs(r),vv.getBodyHtml(r)},_initOptionCity:function(n){var i=this,r=i.o,u,t;(n||(n=r.view),r.gId=="routeTableContainer")&&(u=n.find(".city"),t=vGetArr({Type:3},!1,i.listArea),t=vSort("Name",!0,t),t=[{Id:-1,Name:"Chọn thành phố"}].concat(t),$.each(t,function(n,t){$.vCheckAndAppendOptions(u,t.Id,t.Name,"R")}))},_initListArea:function(n){var i=this,u=i.o,r,t;(n||(n=u.view),u.gId=="routeTableContainer")&&(r=n.find(".lstArea"),t=vGetArr({Type:3},!1,i.listArea),t=vSort("Name",!1,t),t=[{Id:0,Name:"Chọn"}].concat(t),$.each(t,function(n,t){var u=$("<optgroup />").attr("label",t.Name),f=vGetArr({BaseId:t.Id},!1,i.listArea);$.each(f,function(n,t){var r=vGetArr({BaseId:t.Id},!1,i.listArea);$.each(r,function(n,t){var i;i=t.Type==16?$("<option />").val(t.Id).text("(*) "+t.Name):$("<option />").val(t.Id).text(t.Name);u.append(i)})});r.append(u)}),r.val(""),r.chosen({width:"100%"}))},_loadRouteTable:function(n,t){var e,i,r,o,u,a,h,f,s;if(t){e=this;e._unloadRouteTable();var v=document.getElementById(n),c=v.rows,l=t.indexOf("~");if(l>=0){for(t=t.substring(l+1),i=t.split("~"),f=1;f<i.length-1;f++)e.onAddRouteStop(null,null,null,null,f);for(f=0;f<i.length;f++)o=c[f+1],u=parseInt(vGvl(i[f],"|",0)),s=vGetObj({Id:u},e.listArea),s&&(h=s.BaseId,s=vGetObj({Id:h},e.listArea),s&&(a=s.BaseId)),r=$(o).find(".city").find("option"),r.find(":selected").prop("selected",!1),r.filter('[value="'+a+'"]').prop("selected",!0);e.onCityChange();setTimeout(function(){for(var t,f,n=0;n<i.length;n++)o=c[n+1],u=parseInt(vGvl(i[n],"|",0)),t=vGetObj({Id:u},e.listArea),t&&(h=t.BaseId),f=$(o).find(".ward"),f.find('option[selected="selected"]').prop("selected",!1),f.val(h);for(e.onWardChange(),n=0;n<i.length;n++)o=c[n+1],u=parseInt(vGvl(i[n],"|",0)),r=$(o).find(".stop-area").find("option"),r.find(":selected").prop("selected",!1),r.filter('[value="'+u+'"]').prop("selected",!0),u=parseInt(vGvl(i[n],"|",5)),r=$(o).find("input.distance"),r.val(u),u=vGvl(i[n],"|",6)+":"+vGvl(i[n],"|",7),r=$(o).find("input.hour"),r.val(u)},1)}}},onBeginSelectionChange:function(n,t){vv.enableItem(n,"button.delete",t!=null)},onLoadingField:function(n,t){var i=this;n.tableContent?i._loadRouteTable(n.id,t[n.name]):n.isUtility&&i._loadUtility(t[n.name])},onAfterUnloadItem:function(){var n=this;n._unloadRouteTable();n._unloadUtility();$("select.lstArea").val("").trigger("chosen:updated")},onEndloadBaseData:function(n,t){var i=this,r;n.extCf&&n.gId=="routeTableContainer"&&(r=n.extCf._f.split(","),vRql(n.extCf,{a:function(){},m:function(n,t){var u={};$.each(r,function(n,i){i=i.trim();u[i]=t[n]});i.listArea.push(u)},z:function(){i.listArea=vSort("Name",!0,i.listArea);i._initOptionCity();i._initListArea();t&&t.call(i)}},i))},afterReload:function(){var t=this,n=t.o.view;n.find("button.genTime").unbind().on("click",function(){var u;_dict._hasDriverTrip&&(t.lstDriverReder(),u=view.find("#driver-table tbody"),u.empty());var f=n.find("input.genTime").val(),e=n.find("input.genTimeStop").val(),o=parseInt(n.find("input.frequence").val());if(moment(f,"HH:mm").isValid()&&moment(e,"HH:mm").isValid()&&!isNaN(o)){for(var r="",i=moment(f,"HH:mm"),s=moment(e,"HH:mm"),h=0;s.isAfter(i)||i.isSame(s);)r+=""+i.format("HH:mm")+"~",_dict._hasDriverTrip&&u.append(t.renderLstDriverData(i.format("HH:mm"),h++,i.format("HHmm"),"")),i.add(o,"minutes");r=r.substring(0,r.length-1);n.find("input.info").val(r)}else alert("Nhập sai thông tin. Vui lòng kiểm tra lại!")});n.find("button.addTime").unbind().on("click",function(){var e=n.find("input.addDelTime").val(),r,f,o,h;if(moment(e,"HH:mm").isValid()){var u=n.find("input.info").val(),i=moment(e,"HH:mm").format("HH:mm"),s=moment(e,"HHmm").format("HHmm");u.length==0?(n.find("input.info").val(i),_dict._hasDriverTrip&&(t.lstDriverReder(),r=view.find("#driver-table tbody"),r.empty(),f=0,r.append(t.renderLstDriverData(i,f++,s,"")))):u.indexOf(i)==-1?(u+="~"+i,n.find("input.info").val(u),_dict._hasDriverTrip&&(r=view.find("#driver-table tbody"),r.length<=0&&t.lstDriverReder(),f=n.find("#driver-table tbody tr:last").find("td:first").text(),o=f.split("."),o.length>=1&&(h=t.renderLstDriverData(i,parseInt(o[0]),s,""),$("#driver-table tbody").find("tr:last").after(h)))):alert("Giờ đã tồn tại! Không thể thêm!")}else alert("Nhập sai thông tin. Vui lòng kiểm tra lại!")});n.find("button.delTime").unbind().on("click",function(){var i=n.find("input.addDelTime").val();if(moment(i,"HH:mm").isValid()){var t=n.find("input.info").val(),r=moment(i,"HH:mm").format("HH:mm"),u=moment(i,"HHmm").format("HHmm");t=t.replace(r,"");t=t.replace("~~","~");t[t.length-1]=="~"&&(t=t.substring(0,t.length-1));t[0]=="~"&&(t=t.substring(1,t.length));n.find("#driver-table tbody tr").each(function(){var n=$(this).attr("data-driverId"),t=view.find("#driver-table tbody tr").length;u==n&&($(this).remove(),t<=1&&view.find("#driver-table").html(""))});n.find("input.info").val(t)}else alert("Nhập sai thông tin. Vui lòng kiểm tra lại!")})},onItemLoaded:function(){var n=this,t=n.o.view;t.find(".lstArea").trigger("chosen:updated");_dict._hasDriverTrip&&n._onLoadDriver()},onCityChange:function(n,t,i){var r=this,o,s,h;if(i){var f={target:null},e=$(i.target).parent().parent(),c=parseInt($(e).find(".city").val()),u=$(e).find(".ward");u.empty();f.target=u;o=vGetArr({BaseId:c},!1,r.listArea);$.each(o,function(n,t){var i=vGetArr({BaseId:t.Id,Type:15},!1,r.listArea).concat(vGetArr({BaseId:t.Id,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));i.length>0&&$.vCheckAndAppendOptions(u,t.Id,t.Name,"R")});r.onWardChange(n,t,f)}else s=$("#route-table"),h=s.find("tbody").find("tr"),$.each(h,function(n,t){var f=parseInt($(t).find(".city").val()),i=$(t).find(".ward"),u;i.empty();u=vGetArr({BaseId:f},!1,r.listArea);$.each(u,function(n,t){var u=vGetArr({BaseId:t.Id,Type:15},!1,r.listArea).concat(vGetArr({BaseId:t.Id,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));u.length>0&&$.vCheckAndAppendOptions(i,t.Id,t.Name,"R")})}),r.onWardChange()},onAddRouteStop:function(n,t,i,r,u){var e=this,f,c;r?(f=parseInt($(r).attr("row")),isNaN(f)&&(f=1)):f=u;f++;var o=document.getElementById("route-table"),h=o.insertRow(f),s=[];h.innerHTML=e._getNewRow(-1,s);s.length>0&&e._applyListeners(s);e._initOptionCity($(h));o=$("#route-table");c=o.find("tbody").find("tr");$.each(c,function(n,t){var r=$(t).find(".addRouteStop"),u=$(t).find(".delRouteStop"),i=parseInt(r.attr("row"));i==-1||isNaN(i)?(r.attr("row",f),u.attr("row",f)):i>=f&&(r.attr("row",i+1),u.attr("row",i+1))})},onDelRouteStop:function(n,t,i,r,u){var y=this,s,e,l,p,f,h,a,c,o,v;if(s=r?parseInt($(r).attr("row")):u,e=document.getElementById("route-table"),l=$(e.rows[s]).find(".stop-area").find("option:selected").val(),e.deleteRow(s),e=$("#route-table"),p=e.find("tbody").find("tr"),$.each(p,function(n,t){var r=$(t).find(".addRouteStop"),u=$(t).find(".delRouteStop"),i=parseInt(r.attr("row"));i>=s&&(r.attr("row",i-1),u.attr("row",i-1))}),y.model&&(f=y.model.FareInfo,vIsEstStr(f)))try{if(h=f.indexOf("~"),h>=0){for(a=f.substring(0,h),f=f.substring(h+1),c=f.split("~"),o=0;o<c.length;o++)v=c[o].split("|"),v[0]!=l&&v[1]!=l&&(a+="~"+c[o]);$("input.fare-info").val(a)}}catch(w){console.log("Catched",w)}},onWardChange:function(n,t,i){var r=this,u,f,h;if(i){var e=$(i.target).parent().parent(),o=parseInt($(e).find(".ward").val()),s=$(e).find(".stop-area");s.empty();h=vGetArr({BaseId:o,Type:15},!1,r.listArea).concat(vGetArr({BaseId:o,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));$.each(h,function(n,t){$.vCheckAndAppendOptions(s,t.Id,t.Code+" ~ "+t.Name,"R")})}else u=$("#route-table"),f=u.find("tbody").find("tr"),$.each(f,function(n,t){var i=parseInt($(t).find(".ward").val()),u=$(t).find(".stop-area"),f;u.empty();f=vGetArr({BaseId:i,Type:15},!1,r.listArea).concat(vGetArr({BaseId:i,Type:16,CompId:parseInt(app.cid)},!1,r.listArea));$.each(f,function(n,t){$.vCheckAndAppendOptions(u,t.Id,t.Code+" ~ "+t.Name,"R")})})},onRouteSave:function(){var c=this,u=this.view,ut=document.getElementById("route-table"),p=ut.rows,w="1",i=!1,r="",f,s,e,b,k,l=0,d=0,g=0,nt=$(u).find(".info").val(),t="",a,tt,o,n,v,h,it,rt,y;for(u.find("#driver-table tbody tr").each(function(){var i=$(this).attr("data-childdriverId"),r=moment($(this).attr("data-driverid"),"HH:mm").format("HH:mm"),n=$(this).find(".txt_driver").val(),u=i.split(".");u.length==1?t+=r+"|"+n+"~":t=t.substring(0,t.length-1)+("|"+n+"~")}),t=t.substring(0,t.length-1),$(u).find(".info").val(nt),$(u).find("input.driver-info").val(t),a=$(u).find(".route-order").val(),tt=/^([0-9]|[01]?[0-9]|2[0-3]):([0-9]|[0-5][0-9])(|(~([0-9]|[01]?[0-9]|2[0-3]):([0-9]|[0-5][0-9])))+$/g,nt.match(tt)||(i=!0,r="Lịch chạy không đúng, vui lòng kiểm tra lại!"),a==""||vIsPNum(a)||(i=!0,r+="\nThứ tự vị trí hiển thị không đúng định dạng."),o=1;o<p.length;o++)if(f=p[o],n="",v=$(f).find(".stop-area").find("option:selected"),v.length>0){if(e=parseInt(v.val()),o==1&&(d=e),g=e,h=vGetObj({Id:e},c.listArea),b=h.Name,k=h.Code,s=$(f).find("input.hour").val(),!s.match(/^([0-9]|[01]?[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/g)){i=!0;r="Thời gian điểm dừng không đúng!";break}if(it=$(f).find("input.distance").val(),isNaN(it)){i=!0;r="Khoảng cách điểm dừng không đúng!";break}n+=e;n+="|"+h.Type;n+="|"+k;n+="|"+b;n+="|";n+="|"+$(f).find("input.distance").val();n+="|"+moment(s,"HH:mm").format("H");n+="|"+moment(s,"HH:mm").format("m");w+="~"+n;l+=1}else i=!0,r="Vui lòng cập nhật thông tin điểm dừng!";i?vv.showMessage({element:c.view.find(".alert.message"),type:"alert-danger",content:r}):($("input.route-info").val(w),$("input.total-stage").val(l>1?l-1:0),$("input.fromId").val(d),$("input.toId").val(g),rt=$("#utility-form input"),y="1",$.each(rt,function(n,t){$(t).prop("checked")&&(y+="~"+$(t).attr("code"))}),$("input.facility-info").val(y),$("#driver-table").html(""),c.onBasicSave(),$("select.lstArea").val("").trigger("chosen:updated"))},gDisToArea:function(n){var t=n.record.ToArea;try{return t.split("|")[3]}catch(i){return""}},gDisFromArea:function(n){var t=n.record.FromArea;try{return t.split("|")[3]}catch(i){return""}},gDisStpl:function(n){return vGvo(n.record.SeatTemplateInfo,1,5)},gDisDptTime:function(n){for(var r=n.record.Info.split("~"),i="",t=0;t<r.length;t++)t==5&&(i+="\n"),t==0?i=r[t]:i+=", "+r[t];return i},svcStpl:function(n,t){return t+"~"+vFindById(t,n.options).Info},svcArea:function(n,t){var r=this,i=vGetArr({Id:parseInt(t)},!1,r.listArea);return i.length>0?"1~"+[i[0].Id,i[0].Type,i[0].Code,i[0].Name].join("|"):""},rvcStpl:function(n,t){return vGtp(t,"Id")},rvcArea:function(n,t){var i;return vIsEstStr(t)?(i=t.split("~"),i.length>1)?parseInt(i[1].split("|")[0]):"":""},lstDriverReder:function(){var t=this,n;o=t.o;view=o.view;n=view.find("#driver-table");n.empty();n.append($("<thead />").append($("<tr />").html("<th>STT<\/th><th>Khung giờ<\/th><th>Số tài<\/th><th><\/th>"))).append($("<tbody />"))},renderLstDriverData:function(n,t,i,r){var u=this,f;return o=u.o,view=o.view,f="",$("<tr />").attr("data-driverId",i).attr("data-childdriverId",i).append($("<td />").addClass("stt_driver").html(t+1)).append($("<td />").append($("<div />").addClass("input-group").attr("data-original-title","Khung giờ xe xuất phát").attr("data-toggle","tooltip").attr("data-placement","top").append($("<input />").addClass("form-control txt_time rights R").attr("type","text").attr("placeholder","Khung giờ xe xuất phát").val(n).attr("readonly","readonly")))).append($("<td />").append($("<div />").addClass("input-group").attr("data-original-title","Tài xế").attr("data-toggle","tooltip").attr("data-placement","top").append($("<input />").addClass("form-control txt_driver rights R").attr("type","text").attr("placeholder","Tài xế").val(r)))).append($("<td />").append($("<button />").addClass("btn btn-danger mt0 delDriver delete btn-sm rights").attr("type","button").attr("row","2").attr("data-driverId",i).append($("<i/>").addClass("glyphicon glyphicon-trash")).append(" Xóa").on("click",function(){u._onClickDelDriver()})))},renderLstDriverChildData:function(n,t,i,r){var u=this,f;return o=u.o,view=o.view,f="",$("<tr />").attr("data-driverId",n).attr("data-childdriverId",i).append($("<td />").addClass("stt_driver").html(t)).append($("<td />")).append($("<td />").append($("<div />").addClass("input-group").attr("data-original-title","Tài xế").attr("data-toggle","tooltip").attr("data-placement","top").append($("<input />").addClass("form-control txt_driver rights R").attr("type","text").attr("placeholder","Tài xế").val(r)))).append($("<td />").append($("<button />").addClass("btn btn-danger mt0 delDriver delete btn-sm rights").attr("type","button").attr("row","2").attr("data-driverId",i).append($("<i/>").addClass("glyphicon glyphicon-trash")).append(" Xóa").on("click",function(){u._onClickDelDriver()})))},_onClickaddDriver:function(){var n=this;o=n.o;view=o.view;$("body").unbind().on("click","button.addDriver",function(){var i=$(this).attr("data-driverId"),r=null,u=1,t,f,e;r=$(view).find("#driver-table").find('tr[data-driverid="'+i+'"]:last').find("td:first").text();t=r.split(".");t.length>1?(f=parseInt(t[1])+1,r=f,u=t[0]+"."+f):u=t[0]+".1";e=n.renderLstDriverChildData(i,u,i+"."+r,"");$("#driver-table").find('tr[data-driverid="'+i+'"]:last').after(e)})},_onClickDelDriver:function(){var n=this;o=n.o;view=o.view;$("body").unbind().on("click","button.delDriver",function(){var t=$(this).attr("data-driverId"),n=view.find("input.info").val(),i=moment(t,"HH:mm").format("HH:mm"),r=moment(t,"HHmm").format("HHmm");n="~"+n.replace(i,"");n=n.replace("~~","~");n[n.length-1]=="~"&&(n=n.substring(0,n.length-1));n[0]=="~"&&(n=n.substring(1,n.length));view.find("input.info").val(n);$(this).parent().parent().remove()})},_onLoadDriver:function(){var r=this,f,e,l,i,c,t,n,s,h;if(o=r.o,view=o.view,f=view.find("input.driver-info").val(),e=view.find("input.info").val(),f.length>=1)for(r.lstDriverReder(),i=view.find("#driver-table tbody"),i.empty(),c=0,t=f.split("~"),n=0;n<t.length;n++){var u=t[n].split("|"),s=u[0],h=moment(u[0],"HHmm").format("HHmm");u.length<=2&&(l=u[1],i.append(r.renderLstDriverData(s,n,h,l)))}else if(e.length>=1)for(r.lstDriverReder(),i=view.find("#driver-table tbody"),i.empty(),c=0,t=e.split("~"),n=0;n<t.length;n++)s=t[n],h=moment(t[n],"HHmm").format("HHmm"),i.append(r.renderLstDriverData(s,n,h,""));else $("#driver-table").html("")}});
//# sourceMappingURL=p.min.js.map
