define({_initOptionRoles:function(n){var i=this,r=i.view,u=n.gtArr({Type:2},!1),t=r.find("select.role");t.empty();$.each(u,function(n,i){$.vCheckAndAppendOptions(t,i.Id,i.Name,"R")})},_loadPerson:function(){var n=this,t,i;n._listPersons=[];t={_a:"fGetPerson",_c:{CompId:app.cid,IsPrgStatus:1},_f:"Id, Type, FullName, CompId, AgentId"};i=t._f.split(",");vRql(t,{a:function(){},m:function(t,r){var u={};$.each(i,function(n,t){t=t.trim();u[t]=r[n]});n._listPersons.push(u)},z:function(){}},n)},getCPersonId:function(n,t){var r=this.view,i=r.find("select.agent-id").val();return i&&(t.AgentId=i),t},onBeginSelectionChange:function(n,t){var u=this,i=u.view,r;vv.enableItem(n,"button.delete",t!=null);t&&(i.find("select.agent-id").trigger("change"),i.find("select.person-id").find("option[value="+t.PersonId+"]").prop("selected",!0),i.find("select.rolegroup").val(parseInt(t.RoleGroups)),r=t.Info.split("~"),r.length>1&&$.each(r,function(n,t){var r=t.trim().split("|");r.length==3&&r[0]=="3"&&i.find("select.trip-id").find("option[value="+r[2]+"]").prop("selected",!0)}))},onVMLoaded:function(){var t=this,n=!1;$(document).ajaxStop(function(){n||(t.view.find("select.agent-id").trigger("change"),n=!0)})},onBeginReload:function(){this.o.queryConditions=app.cid==app.vid?{IsPrgStatus:"$x=1"}:{Type:"($x <> 2 or ($x = 2 and IsPrgStatus != 3))",CompId:"$x = "+app.cid+"  order by Type asc"}},afterReload:function(n){var t=this;t._initOptionRoles(n);t.view.find("button.dupInfo").unbind().on("click",function(n){n.preventDefault();t._copyInfo(!0)});t._loadPerson();this.onTripChange(t.view)},onTripChange:function(n){var i=parseInt(n.find("select.trip-id").val()),r=n.find("input.account-info"),t=[],u=r.val().split(","),f=!1;u.length>1?($.each(u,function(n,r){var u=r.trim().split("|");u.length==3&&(isNaN(u[0])||isNaN(u[1])||isNaN(u[2])||(u[0]=="3"&&(u[2]=i,f=!0),t.push(u.join("|"))))}),f||t.push("3|1|"+i)):t.push("3|1|"+i);r.val(t.join(", "))},onRoleChange:function(n){this._copyInfo(!1);this.onTripChange(n)},_copyInfo:function(n){var s=this,h=s.view,c=parseInt(h.find("select.role").val()),t=[],r,u,i,f,e,o;if(!isNaN(c)&&(r=s.remoteModels.gtArr({Id:c},!1),r.length>0))for(u=r[0].Info.split("~"),i=1;i<u.length;i++)t.push(u[i].trim());f=h.find("input.account-info");n||(e=f.val().split(","),o=[],e.length>1&&$.each(e,function(n,t){var i=t.trim().split("|");i.length==3&&(isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||o.push(i.join("|")))}),t=_.union(o,t));f.val(t.join(", "))},onAgentChange:function(){var t=this,i=t.view,u=i.find(".agent-id").val(),n=i.find("select.person-id"),r=t._listPersons.gtArr({AgentId:parseInt(u)},!1);n.empty();r.length>0?($.each(r,function(t,i){$.vCheckAndAppendOptions(n,i.Id,i.FullName,"R")}),n.find("option:first-child").prop("selected","selected")):n.empty()},gDisRole:function(n){var r=this,i=n.record.Role,t=$(".dialog-config").find("select.role").find('option[value="'+i+'"]');return!t||t.length<1?"":t.text()},gDisAgentId:function(n){return n.record.AgentName},gDisPersonId:function(n){return n.record.PersonFullName},gDisTripId:function(n){return n.record.Name},gDisInfo:function(n){var t=n.record.Info;return t.length>70?t.substring(0,70)+"....":t},svcPC:function(n,t,i){return i?app.cid+"-"+i.AgentId+"-"+i.PersonId:t},rvcInfo:function(n,t){if(vIsEstStr(t)){var i=t.substring(t.indexOf("~")+1).split("~");if(i.length>1)return i.join(", ")}return"Không có quyền"},svcInfo:function(n,t){var r=[1],i;return vIsEstStr(t)&&(i=t.split(","),i.length>0&&$.each(i,function(n,t){var i=t.trim().split("|");i.length==3&&(isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||r.push(i.join("|")))})),r.join("~")},gRoleGroup:function(n){var i=n.record.RoleGroups,t=_.where(this.cf.options,{Id:parseInt(i)});return!t||t.length<1?"":t[0].Name},gDeactivate:function(){var t=this,i=t.view,n=i.find('input[name="IsPrgStatus"]'),r=n.prop("checked");r===!0?n.val(3):n.val(1)},gIsPrgStatus:function(n){var i=n.record.IsPrgStatus,t=_.where(this.cf.options,{Id:parseInt(i)});return!t||t.length<1?"":t[0].Name},svcactive:function(){var n=this,t=n.view;return parseInt(t.find('input[name="IsPrgStatus"]').val())},rvcactive:function(n,t){var r=this,u=r.view,i=u.find('input[name="IsPrgStatus"]');return vIsEstStr(t)&&(t===1?(i.prop("checked",!1),i.val(1)):(i.prop("checked",!0),i.val(3))),t}});
//# sourceMappingURL=p.min.js.map
