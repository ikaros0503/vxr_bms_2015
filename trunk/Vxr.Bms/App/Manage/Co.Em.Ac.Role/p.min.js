define({loadRoleConfig:function(){$("#bksContent").hide();$("#bTickets").hide();$("#report").hide();$("#product-content").hide();$("#cod").hide();$("#roleConfig").show();$("#roleConfig").roleConfig({});$("#roleConfig").roleConfig("load");$('[data-toggle="tooltip"]').tooltip()},start:function(){try{var n=this;n.loadRoleConfig()}catch(t){console.error(t)}}}),function(n){n.widget("custom.roleConfig",{options:{},listRole:[],listRights:[],$lstRoleBox:null,$edtRoleBox:null,$contentBox:null,load:function(n){this.renderView(n)},renderView:function(n){this.element.html("");this.options=n;this.contentBoxRender();this.lstRoleBoxReder();this.edtRoleBoxRender();this.loadRoles();this.loadRights()},contentBoxRender:function(){this.$contentBox=n('<div id="contentRoleBox" style="min-height: 480px"/>').addClass("col-md-12");this.element.append(this.$contentBox)},lstRoleBoxReder:function(){var t=n("<h3 />").html("Quản lý vai trò"),i=n('<table id="tblLstRole" class="col-md-12 table-responsive table table-qlvt table-striped"/>').append(n("<thead />").append(n("<tr />").html('<th class="bg-thead">STT<\/th><th class="bg-thead">Tên vai trò<\/th><th class="bg-thead">Đối tượng<\/th><th class="bg-thead">Ghi chú<\/th><th class="bg-thead">Tác vụ<\/th>'))).append(n("<tbody />"));this.$lstRoleBox=n('<div id="lstRoleBox" />').append(t).append(i);this.$contentBox.append(this.$lstRoleBox)},edtRoleBoxRender:function(){var t=this,i=n("<h4 />").html("Thêm / Tùy chỉnh vai trò"),r=n("<div />").addClass("col-md-12 pl0 mt10 formEditRole").append(n("<div />").addClass("col-md-4 pl0").append(n("<div />").addClass("form-group").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Tên vai trò").append(n('<input type="text"/>').addClass("form-control input-sm").addClass("txtNewRole").attr("placeholder","Tên vai trò")))).append(n("<div />").addClass("col-md-4 pl0").append(n("<div />").addClass("form-group").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Đối tượng").append(n('<input type="text"/>').addClass("form-control input-sm").addClass("txtActor").attr("placeholder","Đối tượng")))).append(n("<div />").addClass("col-md-4 pl0").append(n("<div />").addClass("form-group").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Ghi chú").append(n('<input type="text"/>').addClass("form-control input-sm").addClass("txtNote").attr("placeholder","Ghi chú")))).append(n("<div />").addClass("clearfix")).append(n("<h5 />").addClass("col-md-1 pl0 pr0").html("Kế thừa quyền:")).append(n('<div id="inheritRights"/>').addClass("col-md-6 pl0")),u=n("<div />").addClass("col-md-12 pl0 pr0 mt10 lstRight").append(n("<div />").addClass("tar mr15").append(n("<label />").addClass("checkbox-inline mr0").append(n('<input type="checkbox" id="showAllRight"/>').on("change",function(i){if(i.preventDefault(),n(this).prop("checked")){t.$edtRoleBox.find("#pnlAllRights").removeClass("hidden");t.$edtRoleBox.find("#pnlRights").addClass("hidden");var r=t.$edtRoleBox.find("#pnlAllRights").find('a[href="#allRgtCollapse"]');r.hasClass("collapsed")&&setTimeout(function(){r.trigger("click")},100)}else n(this).find("input:checkbox").prop("checked",!1),t.$edtRoleBox.find("#pnlAllRights").addClass("hidden"),t.$edtRoleBox.find("#pnlRights").removeClass("hidden")})).append("Xem đầy đủ các quyền"))).append(n('<div id="pnlRights" />').addClass("panel-group mt10").attr("role","tablist").attr("aria-multiselectable","true")).append(n('<div id="pnlAllRights" />').addClass("panel-group mt10 hidden").attr("role","tablist").attr("aria-multiselectable","true")),f=n("<div />").append(n('<button id="saveRole" />').addClass("btn btn-success mb50 mr15").append(n("<i />").addClass("glyphicon glyphicon-ok-circle")).append(" Lưu").on("click",function(){var n=t._isAddNewRole();n==oCAorU.Add?t.onAddRole():n==oCAorU.Invalid?t.showAnnounce("Lỗi","Thông tin bạn nhập không đúng. Vui lòng nhập lại!","#c9302c"):t.showSaveConfirm(n.split(".")[2],function(){t.onSaveRole(n)})})).append(n('<button id="clearRole" />').addClass("btn btn-primary mb50").append(n("<i />").addClass("glyphicon glyphicon-refresh")).append(" Làm mới").on("click",function(){t.$edtRoleBox.find("input:text").val("");t.$edtRoleBox.find("input:checkbox").prop("checked",!1)}));t.$edtRoleBox=n('<div id="edtRoleBox" />').append(i).append(r).append(u).append(f);t.$contentBox.append(t.$edtRoleBox)},loadRights:function(){var t=this,i,r;t.listRights=[];i={_a:"fGetRights",_c:{IsPrgStatus:"($x is null or $x != 3)"},_f:"Id, Type, Code, Name, App, Note, RoleGroup"};r=i._f.split(",");vRql(i,{a:function(){},m:function(i,u){var f={};n.each(r,function(n,t){t=t.trim();f[t]=u[n]});t.listRights.push(f)},z:function(){t.renderLstRightsData();t.renderLstAllRightsData()}},t)},renderLstRightsData:function(){var t=this,i=t.$edtRoleBox.find("#pnlRights");i.empty();var r="",u=8,f=t.listRights.gtArr({Type:0},!1);n.each(f,function(f,e){var a;r=n("<div />").addClass("panel panel-default").append(n('<div role="tab"/>').addClass("panel-heading").attr("id","myheading"+e.Code).append(n("<h4 />").addClass("panel-title").append(n('<a class="collapsed" data-toggle="collapse" data-parent="#pnlRights" aria-expanded="false" />').attr("aria-controls","mycollapse"+e.Code).attr("href","#mycollapse"+e.Code).html(e.Name))));var h=n('<div role="tabpanel"/>').addClass("panel-collapse collapse").attr("id","mycollapse"+e.Code).css("height","0px").attr("aria-labelledby","myheading"+e.Code),c=n("<tbody />").addClass("table mb0").append(n("<tr />").append(n("<td />").attr("colspan",u-2)).append(n("<td />").append(n("<div />").addClass("checkbox").append(n("<label />").attr("data-code",e.Code).append(n("<i />").addClass("glyphicon glyphicon-ok-circle clc")).append(n("<b />").addClass("text-primary").html(" Chọn hết")).on("click",function(){t.$edtRoleBox.find("#mycollapse"+(n(this).attr("data-code")?n(this).attr("data-code"):"null")).find("input.Rs:checkbox").prop("checked",!0)})))).append(n("<td />").append(n("<div />").addClass("checkbox").append(n("<label />").attr("data-code",e.Code).append(n("<i />").addClass("glyphicon glyphicon-remove-circle clc")).append(n("<b />").addClass("text-primary").html(" Bỏ chọn hết")).on("click",function(){t.$edtRoleBox.find("#mycollapse"+(n(this).attr("data-code")?n(this).attr("data-code"):"null")).find("input.Rs:checkbox").prop("checked",!1)}))))),l=t.listRights.gtArr({RoleGroup:e.Code},!1),o=n("<tr />"),s=1;n.each(l,function(t,i){o.append(n("<td />").append(n("<div />").addClass("checkbox").append(n("<label />").attr("data-toggle","tooltip").attr("data-placement","top").attr("data-original-title",i.Note).append(n('<input type="checkbox" />').val(i.Id).addClass("Rs")).append(i.Name))));s==u||t==l.length-1?(c.append(o),o=n("<tr />"),s=1):s++});a=n("<div />").addClass("panel-body").append(n("<table />").addClass("table mb0").append(c));h.append(a);r.append(h);i.append(r);i.removeClass("hidden")});i.find('[data-toggle="tooltip"]').tooltip()},renderLstAllRightsData:function(){var t=this,i=t.$edtRoleBox.find("#pnlAllRights"),f,r,o;i.empty();var u="",e=6,s=t.listRights.gtArr({Type:0},!1);u=n("<div />").addClass("panel panel-default").append(n('<div role="tab"/>').addClass("panel-heading").attr("id","allRgtHeading").append(n("<h4 />").addClass("panel-title").append(n('<a class="collapsed" data-toggle="collapse" data-parent="#pnlAllRights" aria-expanded="false" />').attr("aria-controls","allRgtCollapse").attr("href","#allRgtCollapse").html("Tất cả các quyền"))));f=n('<div role="tabpanel"/>').addClass("panel-collapse collapse").attr("id","allRgtCollapse").css("height","0px").attr("aria-labelledby","allRgtHeading");r=n("<tbody />").addClass("table mb0");n.each(s,function(i,u){r.append(n("<tr />").addClass("bgl").append(n("<td />").append(n("<div />").addClass("mt10").append(n("<label />").append(n("<i />").addClass("glyphicon glyphicon-chevron-right clc")).append(n("<b />").addClass("text-success").html(" "+u.Name))))).append(n("<td />").attr("colspan",e-3)).append(n("<td />").append(n("<div />").addClass("checkbox").append(n("<label />").attr("data-code",u.Code).append(n("<i />").addClass("glyphicon glyphicon-ok-circle clc")).append(n("<b />").addClass("text-primary").html(" Chọn hết")).on("click",function(){t.$edtRoleBox.find("#allRgtCollapse").find("input.isAll"+(n(this).attr("data-code")?n(this).attr("data-code"):"null")+":checkbox").prop("checked",!0)})))).append(n("<td />").append(n("<div />").addClass("checkbox").append(n("<label />").attr("data-code",u.Code).append(n("<i />").addClass("glyphicon glyphicon-remove-circle clc")).append(n("<b />").addClass("text-primary").html(" Bỏ chọn hết")).on("click",function(){t.$edtRoleBox.find("#allRgtCollapse").find("input.isAll"+(n(this).attr("data-code")?n(this).attr("data-code"):"null")+":checkbox").prop("checked",!1)})))));var s=t.listRights.gtArr({RoleGroup:u.Code},!1),f=n("<tr />"),o=1;n.each(s,function(t,i){f.append(n("<td />").append(n("<div />").addClass("checkbox").append(n("<label />").attr("data-toggle","tooltip").attr("data-placement","top").attr("data-original-title",i.Note).append(n('<input type="checkbox" />').val(i.Id).addClass("ARs isAll"+u.Code)).append(i.Name))));o==e||t==s.length-1?(r.append(f),f=n("<tr />"),o=1):o++})});o=n("<div />").addClass("panel-body").append(n("<table />").addClass("table mb0").append(r));f.append(o);u.append(f);i.append(u);i.addClass("hidden");i.find('[data-toggle="tooltip"]').tooltip()},loadRoles:function(){var t=this,i,r;t.listRole=[];i={_a:"fGetAccount",_c:{Type:2,IsPrgStatus:"($x is null or $x != 3)",CompId:app.cid},_f:"Id, Type, Name, Username, Note, Info"};r=i._f.split(",");vRql(i,{a:function(){},m:function(i,u){var f={};n.each(r,function(n,t){t=t.trim();f[t]=u[n]});t.listRole.push(f)},z:function(){t.renderLstRolesData()}},t)},renderLstRolesData:function(){var t=this,r="",u="",f=t.$lstRoleBox.find("#tblLstRole tbody"),i;f.empty();i=t.$edtRoleBox.find("#inheritRights");i.empty();n.each(t.listRole,function(e,o){r=n("<tr />").append(n("<td />").html(e+1)).append(n("<td />").html(o.Username.substring(namePreLength))).append(n("<td />").html(o.Name)).append(n("<td />").html(o.Note)).append(n("<td />").append(n("<button />").addClass("btn btn-sm btn-primary mr15 btnEdtRole").attr("data-index",o.Id).append(n("<i />").addClass("glyphicon glyphicon-edit")).append(" Sửa").on("click",function(){var r=n(this).attr("data-index"),i=t.listRole.gtArr({Id:parseInt(r)},!1);i.length>0&&(t.$edtRoleBox.find(".txtNewRole").val(i[0].Username.substring(namePreLength)),t.$edtRoleBox.find(".txtActor").val(i[0].Name),t.$edtRoleBox.find(".txtNote").val(i[0].Note),t.$edtRoleBox.find(".formEditRole input:text").addClass("bgy",1e3,"easeInOutQuint",function(){setTimeout(function(){t.$edtRoleBox.find(".formEditRole input:text").removeClass("bgy")},1500)}),t._autoCheckRights(i[0].Info))})).append(n("<button />").addClass("btn btn-sm btn-danger btnDelRole").attr("data-index",o.Id).append(n("<i />").addClass("glyphicon glyphicon-trash")).append(" Xóa").on("click",function(){var r=n(this).attr("data-index"),i=t.listRole.gtArr({Id:parseInt(r)},!1);i.length>0&&t.showDelConfirm(i[0].Username.split(".")[2],function(){t.onDelRole(i[0].Id)})})));f.append(r);u=n("<label />").addClass("checkbox-inline mr15").append(n('<input type="checkbox" />').addClass("cbIhrRgt").val(o.Id)).append(o.Name);i.append(u)})},_getCheckedRights:function(){var t=this,u=[],f,o=t.$edtRoleBox.find("#pnlAllRights"),e,i,r;return f=o.hasClass("hidden")?t.$edtRoleBox.find(".Rs:checkbox:checked"):t.$edtRoleBox.find(".ARs:checkbox:checked"),n.each(f,function(i,r){var o=n(r).val(),f=t.listRights.gtArr({Id:parseInt(o)},!1),e;f.length>0&&(e=[f[0].Type,f[0].Id,f[0].App].join("|"),u.push(e))}),e=t.$edtRoleBox.find(".cbIhrRgt:checkbox:checked"),i=[],n.each(e,function(r,u){var o=n(u).val(),e=t.listRole.gtArr({Id:parseInt(o)},!1),f;e.length>0&&(f=e[0].Info.split("~"),f.splice(0,1),i=_.union(i,f))}),r=_.union(u,i),r=["1"].concat(r),r.join("~")},_autoCheckRights:function(n){var u=this,f,i,r,t;for(u._uncheckAllRights(),f=n.split("~"),i=1;i<f.length;i++)r=f[i].split("|"),r[0]!=3&&(t=u.$edtRoleBox.find(".Rs[value="+r[1]+"]"),t&&t.prop("checked",!0),t=u.$edtRoleBox.find(".ARs[value="+r[1]+"]"),t&&t.prop("checked",!0))},_uncheckAllRights:function(){var n=this;n.$edtRoleBox.find(".Rs").prop("checked",!1);n.$edtRoleBox.find(".ARs").prop("checked",!1)},_isAddNewRole:function(){var t=this,i=t.$edtRoleBox.find(".txtNewRole").val().trim(),n;return vIsEstStr(i)?(n=t.listRole.gtArr({Username:namePrefix+i},!1),n.length>0)?n[0].Username:oCAorU.Add:oCAorU.Invalid},onDelRole:function(n){var t=this,i={_a:"UpdateAccount",_c:{Id:parseInt(n)},_d:{IsPrgStatus:3}};vRqs(i,function(n){n>0?(t.showAnnounce("Thông báo","Xóa vai trò thành công!","#008000"),t.loadRoles()):t.showAnnounce("Lỗi","Đã xảy ra lỗi! Vui lòng thử lại sau!","#c9302c")})},onSaveRole:function(n){var t=this,i=t.listRole.gtArr({Username:n},!1),r={Name:t.$edtRoleBox.find(".txtActor").val().trim(),Note:t.$edtRoleBox.find(".txtNote").val().trim(),Info:t._getCheckedRights()},u={_a:"UpdateAccount",_c:{Id:parseInt(parseInt(i[0].Id))},_d:r};vRqs(u,function(n){n>0?(t.showAnnounce("Thông báo","Cập nhật vai trò thành công!","#008000"),t.loadRoles(),t.clearForm()):t.showAnnounce("Lỗi","Đã xảy ra lỗi! Vui lòng thử lại sau!","#c9302c")})},onAddRole:function(){var n=this,t={Type:2,Name:n.$edtRoleBox.find(".txtActor").val().trim(),Username:namePrefix+n.$edtRoleBox.find(".txtNewRole").val().trim(),Note:n.$edtRoleBox.find(".txtNote").val().trim(),Info:n._getCheckedRights(),IsPrgStatus:1,CompId:app.cid},i={_a:"InsertAccount",_c:{},_d:t};vRqs(i,function(t){t>0?(n.showAnnounce("Thông báo","Thêm vai trò thành công!","#008000"),n.loadRoles(),n.clearForm()):n.showAnnounce("Lỗi","Đã xảy ra lỗi! Vui lòng thử lại sau!","#c9302c")})},showDelConfirm:function(t,i){var r=this,f=n("<div />").addClass("modal-body").append(n("<form />").attr("id","cfDeleteRole").append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n("<tr />").append(n('<td style="border:0;" />').addClass("col-md-6").append(n("<div />").addClass("form-group").attr("area-hidden","true").append(n("<p />").html("Bạn muốn xóa vai trò <strong style='color:red'>"+t+"<\/strong> ?<br/><b>Lưu ý:<\/b> Vai trò đã xóa <strong>không thể hoàn lại!<\/strong>"))))).append(n("<tr />").append(n("<td />").addClass("col-md-12 list-btn").attr("colspan",3).append(n("<button />",{type:"button"}).addClass("btn btn-danger").text("Đồng ý").css("float","left").click(function(){typeof i=="function"&&i.call();r.$contentBox.find(".confirmDelRole-popup").modal("hide")})).append(n("<button />",{type:"button"}).addClass("btn btn-default").text("Không").css("float","left").click(function(){r.$contentBox.find(".confirmDelRole-popup").modal("hide")})))))),u=n("<div />").addClass("modal fade confirmDelRole-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header").css("background-color","#c9302c").addClass("bg-primary").append(n("<h2 />").addClass("modal-title thin-1").html("Cảnh báo"))).append(f)));u.appendTo(r.$contentBox);u.modal("show")},showSaveConfirm:function(t,i){var r=this,f=n("<div />").addClass("modal-body").append(n("<form />").attr("id","cfDeleteRole").append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n("<tr />").append(n('<td style="border:0;" />').addClass("col-md-6").append(n("<div />").addClass("form-group").attr("area-hidden","true").append(n("<p />").html("Bạn muốn cập nhật vai trò <strong style='color:red'>"+t+"<\/strong> ?"))))).append(n("<tr />").append(n("<td />").addClass("col-md-12 list-btn").attr("colspan",3).append(n("<button />",{type:"button"}).addClass("btn btn-success").text("Đồng ý").css("float","left").click(function(){typeof i=="function"&&i.call();r.$contentBox.find(".confirmSaveRole-popup").modal("hide")})).append(n("<button />",{type:"button"}).addClass("btn btn-default").text("Không").css("float","left").click(function(){r.$contentBox.find(".confirmSaveRole-popup").modal("hide")})))))),u=n("<div />").addClass("modal fade confirmSaveRole-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header").css("background-color","#008000").addClass("bg-primary").append(n("<h2 />").addClass("modal-title thin-1").html("Cập nhật vai trò"))).append(f)));u.appendTo(r.$contentBox);u.modal("show")},showAnnounce:function(t,i,r){var f=this,e=n("<div />").addClass("modal-body").append(n("<form />").attr("id","announceRole").append(n("<table />").addClass("table no-border mb0 table-modal table-condensed").append(n("<tr />").append(n('<td style="border:0;" />').addClass("col-md-6").append(n("<div />").addClass("form-group").attr("area-hidden","true").append(n("<p />").html("<b> "+i+"<\/b>"))))))),u=n("<div />").addClass("modal fade confirmSaveRole-popup").attr("role","dialog").attr("aria-hidden","true").append(n("<div />").addClass("modal-dialog modal-md").append(n("<div />").addClass("modal-content").append(n("<div />").addClass("modal-header").css("background-color",r).addClass("bg-primary").append(n("<h2 />").addClass("modal-title thin-1").html(t))).append(e)));u.appendTo(f.$contentBox);u.modal("show");setTimeout(function(){u.modal("hide")},1500)},clearForm:function(){var n=this;n._uncheckAllRights();n.$contentBox.find("input:text").val("");n.$contentBox.find("#inheritRights input:checkbox").prop("checked",!1)}})}(jQuery);
//# sourceMappingURL=p.min.js.map
